---
title: UE4 BenCloward教程
tags: UnrealEngine
categories: UnrealEngine
abbrlink: c2b4cd0d
date: 2023-08-29 03:57:00
---
<meta name="referrer" content="no-referrer" />

<a name="ejnU5"></a>
# Ben Cloward材质课
<a name="e2fe0"></a>
## 课程贴图设置
如果实现的效果不是很好可能是贴图压缩设置问题，因为教程很多贴图都是混合的，因此虚幻引擎可能无法准确的判断出贴图的正确压缩以及颜色设置，因此将贴图设置成![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640693735902-705d7a68-90b5-483c-8d5b-9bae040f05b2.png#clientId=u434c1aaf-447b-4&from=paste&height=180&id=uf5893fa2&originHeight=180&originWidth=420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12156&status=done&style=none&taskId=u7727b55e-ab61-4112-a383-16637572208&title=&width=420)是最好的质量。
<a name="VkO5s"></a>
## 什么是着色器
着色器是控制屏幕上每个像素颜色的代码
<a name="B8xuo"></a>
## 扭曲着色器
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637824890952-3c76a9be-eb4f-4bb2-b42b-8019f1f99891.png#clientId=u6fdcd340-1ad3-4&from=paste&height=528&id=ubf3f9b36&originHeight=528&originWidth=1043&originalType=binary&ratio=1&rotation=0&showTitle=false&size=556233&status=done&style=none&taskId=ue3a43be0-e204-4efc-a1de-dc91c3d8e29&title=&width=1043)<br />解析：![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637825142570-c3b1db99-2d2b-4055-8a7d-f1c7af8b2a86.png#clientId=u6fdcd340-1ad3-4&from=paste&height=136&id=uc37793d8&originHeight=136&originWidth=121&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32904&status=done&style=none&taskId=u3a711a15-01db-47a3-868e-d41543479d5&title=&width=121)此贴图相当于将不同的noise灰度图分别储存到3个通道中。<br />其中扭曲效果由此连接法产生，连接法的作用是为其不同地方添加很小的偏移数值实现扭曲。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637825278892-bdf103c3-8008-4c9d-a49a-e43446b8c532.png#clientId=u6fdcd340-1ad3-4&from=paste&height=536&id=u60940a1d&originHeight=536&originWidth=890&originalType=binary&ratio=1&rotation=0&showTitle=false&size=382400&status=done&style=none&taskId=u8a044fb5-4997-49ba-953e-4f3bf8139c5&title=&width=890)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637825300822-504d1743-0707-4d8b-99ff-76a5172e6380.png#clientId=u6fdcd340-1ad3-4&from=paste&height=283&id=u3054bf31&originHeight=283&originWidth=321&originalType=binary&ratio=1&rotation=0&showTitle=false&size=247608&status=done&style=none&taskId=u36df7276-5a00-4950-af1d-628d777d6e1&title=&width=321)<br />其中time节点和texcoord节点相加可以使Texture Sample的贴图在对角线处匀速移动，于是为Time节点乘以不同数值的float 2 节点可以实现非线性运动，通过![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637825781598-c32fc9d7-2203-4fa5-a0d4-64b72c99fcfb.png#clientId=u6fdcd340-1ad3-4&from=paste&height=231&id=u0c7049b4&originHeight=231&originWidth=227&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88831&status=done&style=none&taskId=u5de3c631-3a66-4058-a4cc-2303bbf93bb&title=&width=227)不同数值的灰度图的叠加可以打破重复度。<br />可以参考海洋材质的水的移动制作思想
<a name="OlmB6"></a>
## 特效翻页动画（图像序列视图/Flipbook序列图）
**Flipbook 序列图：**在DCC软件中如maya，blender，houdini，embergen 把制作好的流体，烟雾等等，烘焙成序列帧的形式，到UE4的材质里用flipbook节点播放，或者在粒子里用subuvindex播放。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637911686717-6cc1837d-92d6-4913-a3b0-23b9159c5253.png#clientId=ucabc6807-740f-4&from=paste&height=474&id=uc0dddcdb&originHeight=1423&originWidth=1538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1410491&status=done&style=none&taskId=u230d5c74-d6c8-4065-8a2b-c10ae5a2a68&title=&width=512.6666666666666)粒子特效纹理，相当于一个6*6=36帧的动画。<br />flipbook节点是专门读取这种贴图而存在的。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637912117136-137fa793-ef60-45cd-9a31-e9ff02158a0d.png#clientId=ucabc6807-740f-4&from=paste&height=244&id=ufadc4ae9&originHeight=731&originWidth=2398&originalType=binary&ratio=1&rotation=0&showTitle=false&size=684301&status=done&style=none&taskId=ua8a19c07-5079-430c-9a55-d8b50b0da78&title=&width=799.3333333333334)<br />其中乘以0.8的意义：如果不乘以0.8，那么此着色器得到的是每秒30帧的动画过程，如果需要的是输出每秒24帧的动画那么只需要乘以0.8就可以得到符合视频的动画效果。因为30*0.8=24。<br />6的意义是指纹理是6*6帧的。<br />如果不使用FlipBook可以使用此节点连法。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637913113991-839b256a-4758-42b9-9d8b-516a9a02394a.png#clientId=ucabc6807-740f-4&from=paste&height=281&id=u8d08f88c&originHeight=844&originWidth=2794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=881736&status=done&style=none&taskId=uc2aeefd8-b5f8-4131-a539-d8245b9e84d&title=&width=931.3333333333334)<br />这里的time的结束时间是1.5，乘的数值是24（最终输出视频的每秒帧数），结果是36，36对应的是第36个的贴图，floor使线性的函数变成了，意义是使一个连续的动画变成了有间隔的动画。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637914787309-14f162e2-acde-469c-83d7-8f3c16c66d79.png#clientId=ucabc6807-740f-4&from=paste&height=282&id=ub4ec203b&originHeight=845&originWidth=965&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55509&status=done&style=none&taskId=u27ec843a-d34b-4666-819d-0a5b0a097f5&title=&width=321.6666666666667)<br />frac节点的意义是只输出小数点后的数值。<br />循环输出对角线从![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637911686717-6cc1837d-92d6-4913-a3b0-23b9159c5253.png#clientId=ucabc6807-740f-4&from=paste&height=474&id=K760z&originHeight=1423&originWidth=1538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1410491&status=done&style=none&taskId=u230d5c74-d6c8-4065-8a2b-c10ae5a2a68&title=&width=512.6666666666666)左上角到右下角的动画：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637915295890-557b843b-f584-47bf-b1d5-f97bb5d58513.png#clientId=ucabc6807-740f-4&from=paste&height=289&id=uc62fcb26&originHeight=868&originWidth=2621&originalType=binary&ratio=1&rotation=0&showTitle=false&size=785328&status=done&style=none&taskId=u4bd3e7da-b271-4b0d-9018-798a17a0297&title=&width=873.6666666666666)<br />使可以从1\~6，6\~12，12\~18，18\~24,24\~30,30\~36依此播放。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1637913113991-839b256a-4758-42b9-9d8b-516a9a02394a.png#clientId=ucabc6807-740f-4&from=paste&height=281&id=EAzPq&originHeight=844&originWidth=2794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=881736&status=done&style=none&taskId=uc2aeefd8-b5f8-4131-a539-d8245b9e84d&title=&width=931.3333333333334)
<a name="wPZYt"></a>
## 环境材质混合
基础实现：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639819852407-b2a2c87a-f59c-43be-b190-d67d19d11432.png#clientId=u5a00d30a-4e1f-4&from=paste&height=714&id=u9deb2e31&originHeight=714&originWidth=1161&originalType=binary&ratio=1&rotation=0&showTitle=false&size=570030&status=done&style=none&taskId=u25e319da-2e1e-4426-8fbf-eb06ee739df&title=&width=1161)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639820046474-9708d2d8-ac24-40b0-bb3f-d093de863a00.png#clientId=u5a00d30a-4e1f-4&from=paste&height=478&id=u020bcc0c&originHeight=478&originWidth=535&originalType=binary&ratio=1&rotation=0&showTitle=false&size=308119&status=done&style=none&taskId=ua3c4e59a-7aa5-4670-a9a9-980f9cfe58b&title=&width=535)<br />vertexnormal的B通道得出模型从下到上-1\~+1的数值，其中add加的数值控制的是混合范围，Power控制的混合的对比度，数值越大则边界线越明显，clamp使数值保持在0\~1的范围之间，可以用saturate代替，![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639820322614-423a8ad8-1dd9-447e-a980-956480c187b6.png#clientId=u5a00d30a-4e1f-4&from=paste&height=163&id=ud900ed3c&originHeight=163&originWidth=540&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72062&status=done&style=none&taskId=uab0cf812-73d4-4d97-9ea5-c015faab081&title=&width=540)此过程得到的是一个黑白图，无论模型旋转到什么角度都会使另一个材质混合在上方。<br />法线贴图在切线空间中。VertexNormal是在世界空间中（由节点的WS（world space）可以得出）<br />将数学计算替换成

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639820713922-8fe4f4e7-fa94-4d64-8395-57fda9693839.png#clientId=u5a00d30a-4e1f-4&from=paste&height=283&id=u9b3653d4&originHeight=283&originWidth=499&originalType=binary&ratio=1&rotation=0&showTitle=false&size=93922&status=done&style=none&taskId=u98c6969d-e760-4fcc-ba2c-a1e25fe42a1&title=&width=499)其中TransformVector作用是转换空间<br />通过将法线的切线空间转换为世界空间再进行B通道的遮罩<br />可以得到这样的遮罩黑白图<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639820757724-8e19f396-7aaf-468b-aa43-0ccbdcebce55.png#clientId=u5a00d30a-4e1f-4&from=paste&height=426&id=udb14f857&originHeight=426&originWidth=501&originalType=binary&ratio=1&rotation=0&showTitle=false&size=257360&status=done&style=none&taskId=ubbbe9d01-c289-41dd-9ed6-e9b2b9123cd&title=&width=501)<br />可以使混合是依据法线细节的<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639820863870-a80cf8b0-35b2-4ae0-8e79-d16dd663734c.png#clientId=u5a00d30a-4e1f-4&from=paste&height=384&id=u6d605816&originHeight=384&originWidth=470&originalType=binary&ratio=1&rotation=0&showTitle=false&size=279184&status=done&style=none&taskId=u0d53dc13-1478-4184-8baf-69d4a96bf5c&title=&width=470)。
<a name="iTMOE"></a>
## 着色器性能优化
第一种查看着色器复杂度方式：alt+8快捷键进入着色器复杂程度视图，绿色为简单，红色为中等，白色为复杂。<br />第二种：进入材质窗口中观察着色器执行的指令数量。但这不是一个很好的方式，因为并非所有的指令都是消耗相同的时间。<br />第三种：也是最准确的一种，将着色器应用于要使用的平台，对比着色器应用前后的性能差距。<br />优化着色器的方法<br />第一种：删除没有提供任何效果的节点连线。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639921294481-d2faa781-48d0-4d4b-b1b1-010d2e52b502.png#clientId=ua3196c8d-51d4-4&from=paste&height=169&id=ueaf5d905&originHeight=169&originWidth=1663&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31462&status=done&style=none&taskId=u2d15e8e9-ba25-4952-84d1-435c06a2b20&title=&width=1663)<br />get rid of anything you're not using<br />第二种：重构数学实现方式，使用不同的方法实现相同的效果。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639921368471-86dc01cd-a55f-4f23-981d-30d724898447.png#clientId=ua3196c8d-51d4-4&from=paste&height=149&id=u5ca1321b&originHeight=149&originWidth=1324&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24804&status=done&style=none&taskId=u21cc31b9-7fb6-43c5-b683-75b5248c48c&title=&width=1324)<br />举例：![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639977741793-4aedd784-ff86-4846-8bfa-afbb0cf7208a.png#clientId=u67341e96-c423-4&from=paste&height=737&id=u4b29febd&originHeight=737&originWidth=1177&originalType=binary&ratio=1&rotation=0&showTitle=false&size=561789&status=done&style=none&taskId=uf868a3ec-a4ee-44eb-aaeb-19e5787e496&title=&width=1177)通过减乘加替换power节点可以节省需要的指令数，减乘加的思想解释：其中乘法的数值控制的是对比度强弱的程度，此处减0.5乘1加0.5是无对比度，运算思想是使接近0.5的数值（灰色）进行运算后向白色靠近，而小于0.5的数值进行运算后向黑色靠近，依据此运算思想达到增加对比的效果而且使着色器指令更少。<br />第三种：将数值结合到一起运算<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639978235390-5af6c2c3-2584-4e5f-99b5-69788e085905.png#clientId=u67341e96-c423-4&from=paste&height=172&id=u074a40cd&originHeight=172&originWidth=1675&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51511&status=done&style=none&taskId=ue7a94cdf-1d88-49dd-8ee8-491b5145f6a&title=&width=1675)<br />举例:<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639978420828-a9d3031b-c732-4910-98d8-c335826076c1.png#clientId=u67341e96-c423-4&from=paste&height=733&id=u4bb0f29c&originHeight=733&originWidth=1019&originalType=binary&ratio=1&rotation=0&showTitle=false&size=513116&status=done&style=none&taskId=uc11833fb-b9d1-4f81-a0b7-d60e3a228f7&title=&width=1019)<br />将相同的运算方式但是不同数值的数学整合到一起再分成不同通道使用。<br />**举例二**<br />将贴图合并，例如将只带有黑白信息的ORM贴图合并到一起。
<a name="BboKl"></a>
## 凹凸与视差贴图
首先凹凸与视差节点的输出都是针对贴图的坐标UV的，它们依赖高度图。高度图中的白色为凸出，越白越凸出<br />BumpOffset与视差节点（POM）都是通过视觉效果实现的凹凸感，过程是通过渲染多张相同的材质效果但是带一些偏移来形成凹凸的视觉效果。<br />凹凸节点使用：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639821053805-28932542-f008-436d-91f7-83c452f8558c.png#clientId=u5a00d30a-4e1f-4&from=paste&height=556&id=u22e96ca8&originHeight=556&originWidth=761&originalType=binary&ratio=1&rotation=0&showTitle=false&size=377764&status=done&style=none&taskId=u75bad28a-92d7-4962-a8cc-585f307788d&title=&width=761)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639821463422-8d1bb732-f735-4eb8-93a0-6a7457cec01c.png#clientId=u5a00d30a-4e1f-4&from=paste&height=499&id=u892cfbbf&originHeight=499&originWidth=767&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45948&status=done&style=none&taskId=uc4ddfa89-ada9-4e8c-99ba-6aae8518837&title=&width=767)<br />一般使用时通常只需要控制HeightRatio的数值来控制凹凸强度。<br />POM节点是bump节点的进阶用法，它可以获得相比bump offset更好的效果，但是相应的性能消耗也会提高。<br />一般只会使用这么多节点<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639821682286-b8f58f92-b6bc-432b-b9ba-d0c5280205bc.png#clientId=u5a00d30a-4e1f-4&from=paste&height=439&id=u943eb42a&originHeight=439&originWidth=806&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239017&status=done&style=none&taskId=u2508ea62-e20a-4932-8f5d-f951f4f11e9&title=&width=806)<br />其中Height Ratio控制凹凸强度<br />Min Setps（默认为2）  Max Step的数值越大得到的效果越好。  heightmap Channel控制的是要读取的高度贴图属于哪个通道的，例如如果将高度图放到了G通道就将0，1，0，0输入。<br />再进阶(栗子的课程)：<br />会有锯齿效果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1622288570864-eda1d8b0-7b52-4a2e-8c7a-2bffc425cb37.png#clientId=u4a9e6bbb-6167-4&from=paste&height=471&id=u655081f8&originHeight=471&originWidth=752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=517995&status=done&style=none&taskId=u02e68282-2c4e-4d4a-b910-52a249e82e6&title=&width=752)<br />配合dither temporal AA![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1622288627080-d98035b4-f3b6-436a-95b9-e567ae209f85.png#clientId=u4a9e6bbb-6167-4&from=paste&height=71&id=ucf18f79c&originHeight=71&originWidth=315&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3963&status=done&style=none&taskId=u72573e19-e6c2-49e9-94f2-85033b2cfab&title=&width=315)可以模糊锯齿  DTAA可以理解为抖动像素，让不同深度的像素产生混合效果来来实现融合边缘的效果![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1626067046470-69f31526-9ad6-4438-b311-8a25c89588bd.png#clientId=udb44799c-ae35-4&from=paste&height=382&id=u2ee0e05d&originHeight=382&originWidth=942&originalType=binary&ratio=1&rotation=0&showTitle=false&size=389067&status=done&style=none&taskId=uc1e23757-b50e-441b-8f66-93d5ca6aadb&title=&width=942)<br />![](https://cdn.nlark.com/yuque/0/2021/png/2623605/1622288717339-5630f847-4328-42bc-98f2-49e538f403c4.png?x-oss-process=image%2Fresize%2Cw_583%2Climit_0#from=url&id=n6Uad&originHeight=341&originWidth=583&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)。
<a name="thLL4"></a>
## 织物着色器（不更改光照模型的情况下模拟）
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639978768281-8617e7c8-64f1-40e0-b492-40d2fbbda88c.png#clientId=u67341e96-c423-4&from=paste&height=734&id=u38f7df64&originHeight=734&originWidth=918&originalType=binary&ratio=1&rotation=0&showTitle=false&size=450585&status=done&style=none&taskId=u9aca3913-91d0-4ac0-bfb9-d3d6ae1060e&title=&width=918)<br />其中camera vector 和pixelNormalWS进行dot运算的结果是类似菲涅尔的效果（边缘黑中间白）<br />然后power控制的是对比度，乘法运算控制的是强度。<br />反向和不反向的相加到一起是为了既能够控制中间的亮度也能够控制边缘的亮度（为了能够模拟不同布料的效果）<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1639979004552-8b3db5a0-b4ce-4428-a533-08749b48d7ce.png#clientId=u67341e96-c423-4&from=paste&height=681&id=u55f677d1&originHeight=681&originWidth=700&originalType=binary&ratio=1&rotation=0&showTitle=false&size=572017&status=done&style=none&taskId=u39160624-4594-4b8f-86fc-b4ea4724d47&title=&width=700)<br />将法线贴图从切线空间转换为世界空间再与camera vector 进行dot运算的作用是使菲涅尔效果是能够根据模型细节变化而变化的，（可以参考环境材质混合中使用法线贴图的作用)。
<a name="Ifbbo"></a>
## 体积冰着色器
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640184918858-8bf2054b-36bb-4e34-a21e-afd13ed49b64.png#clientId=uff50c105-6843-4&from=paste&height=766&id=u316f18bf&originHeight=766&originWidth=1716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=298984&status=done&style=none&taskId=ubc6172ff-d808-4b2a-a6c0-8792ad07f0d&title=&width=1716)<br />其中![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640012241218-0be91701-b2df-4a6e-879e-4856ea103d1a.png#clientId=u8fc0f64a-3d05-4&from=paste&height=349&id=ub8b7deba&originHeight=349&originWidth=874&originalType=binary&ratio=1&rotation=0&showTitle=false&size=234561&status=done&style=none&taskId=u24027563-ded1-4621-99bd-9e2a04c76d4&title=&width=874)作用是根据摄影机的改变纹理会跟着改变，法线贴图的作用是使表面不是光滑的（0,0,1）,是带有细节的。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640012366609-4a3e9c3c-6d32-448c-baa4-ab6b330811ac.png#clientId=u8fc0f64a-3d05-4&from=paste&height=236&id=ubbcffee1&originHeight=236&originWidth=731&originalType=binary&ratio=1&rotation=0&showTitle=false&size=141448&status=done&style=none&taskId=u4cb41d63-9bb4-43a0-aaaf-c93cf901693&title=&width=731)<br />除100控制的是纹理整体向远离摄影机位置偏移的大小，利用贴图替换100可以实现有些远离摄影机有些不远离。<br />后面乘1/512，是匹配贴图的分辨率。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640012600908-781b2689-998c-4f70-b9af-c2442f982c58.png#clientId=u8fc0f64a-3d05-4&from=paste&height=671&id=u52d41c8c&originHeight=671&originWidth=652&originalType=binary&ratio=1&rotation=0&showTitle=false&size=408460&status=done&style=none&taskId=u2b9b1af0-5752-48db-8b4c-506c3a4c55c&title=&width=652)

<a name="ehbso"></a>
## MatCap着色器
首先了解一下MatCap纹理![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010694033-0879ceaf-e220-4d0f-a910-162eb9655979.png#clientId=ucec13de9-5e0d-4&from=paste&height=232&id=u70d26647&originHeight=232&originWidth=827&originalType=binary&ratio=1&rotation=0&showTitle=false&size=180360&status=done&style=none&taskId=u0921b0b0-eecb-4873-8a79-d7027cabe9b&title=&width=827)<br />制作MatCap着色器的主要思想是无论摄影机处于什么位置，物体总是以相同的纹理图案呈现在窗口上面。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010773343-b3f56ebd-3172-431a-bad5-b8092ea9b946.png#clientId=ucec13de9-5e0d-4&from=paste&height=713&id=u8bd98e0b&originHeight=713&originWidth=1203&originalType=binary&ratio=1&rotation=0&showTitle=false&size=387029&status=done&style=none&taskId=uf4a26742-733c-421f-883e-aab803c4dab&title=&width=1203)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010914715-787dd504-2de7-490a-ad6b-645a71713825.png#clientId=ucec13de9-5e0d-4&from=paste&height=212&id=uf5de272a&originHeight=212&originWidth=208&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48717&status=done&style=none&taskId=u1559e3cb-6b8c-42e6-9ed7-4c45d0818fe&title=&width=208)<br />如果只是单纯的将顶点法线空间转换为视图空间的RG通道赋予贴图UV会得到![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010955666-016cd180-fd9b-4de6-8db5-2a3068d79679.png#clientId=ucec13de9-5e0d-4&from=paste&height=354&id=u3fe7ab6d&originHeight=354&originWidth=349&originalType=binary&ratio=1&rotation=0&showTitle=false&size=139406&status=done&style=none&taskId=u263ca96b-1fbd-4836-9d74-3d8834c3544&title=&width=349)因此经过数学运算后![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010986533-e89a7143-5cda-4055-ac60-4ee8ce8eabc1.png#clientId=ucec13de9-5e0d-4&from=paste&height=184&id=u47c846ba&originHeight=184&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69184&status=done&style=none&taskId=u95fcd003-29c8-454c-8470-7d9a1153903&title=&width=576)其中带G通道进行了负号运算是为了进行垂直翻转。

MatCap着色器也称为球面投影，![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640010823107-37f95846-afe4-4894-a060-648d824318b0.png#clientId=ucec13de9-5e0d-4&from=paste&height=393&id=u9b808367&originHeight=393&originWidth=393&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98721&status=done&style=none&taskId=u30480bf7-b9ef-4612-8969-3928953607d&title=&width=393)
<a name="ARc50"></a>
## 摇曳树叶着色器
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640185080436-b560ce33-0678-4fe0-99f7-c94baf50bec8.png#clientId=uff50c105-6843-4&from=paste&height=1013&id=u3b6fc5f7&originHeight=1013&originWidth=1700&originalType=binary&ratio=1&rotation=0&showTitle=false&size=302947&status=done&style=none&taskId=u77c46cb8-0611-41f5-ac19-c91025879aa&title=&width=1700)
<a name="UR2M7"></a>
## 雨水着色器
首先要了解下雨的特点<br />下雨后路面颜色改变，物体表面吸水会让颜色变暗饱和度变高。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640593305482-1f9acc9b-0380-485f-94b1-a7e93fca671c.png#clientId=u4aa6ce16-a77b-4&from=paste&height=317&id=u4183c232&originHeight=317&originWidth=451&originalType=binary&ratio=1&rotation=0&showTitle=false&size=193900&status=done&style=none&taskId=u3993464a-436c-4c3e-b0ac-17d35bc7fb0&title=&width=451)<br />粗糙度降低，并且要注意有些物体是表面渗水的有些物体是表面不渗水的。<br />还有涟漪，水坑，水珠，流淌水滴的特点。
<a name="lVeaB"></a>
### 雨的湿度着色器
首先颜色饱和度的控制通过desaturation去饱和度节点![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640594273036-eb1db6d0-f18e-4bbb-8bcb-1ff65de0527b.png#clientId=u4aa6ce16-a77b-4&from=paste&height=212&id=u2b52600a&originHeight=212&originWidth=426&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60206&status=done&style=none&taskId=uf5d88c36-3f5a-4459-bd16-66d47ad265b&title=&width=426)控制，为其设置一个负值可以增加饱和度。<br />这里是得到一个饱和度更高颜色更暗的颜色设置。<br />材质函数写法：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640795354567-dcceb492-fb52-4353-93f1-a5a172f48cb4.png#clientId=u00367ec4-d802-4&from=paste&height=736&id=ue93eb574&originHeight=736&originWidth=1125&originalType=binary&ratio=1&rotation=0&showTitle=false&size=206137&status=done&style=none&taskId=u2fdeb9c8-ab69-4201-9bb9-af62e41cf54&title=&width=1125)<br />其中0.07和0.3控制的是有水的地方的粗糙度和高光。<br />水的高光值是比默认材质0.5的高光小的。
<a name="Vl0ZK"></a>
### 表面水珠着色器
首先解析制作效果所需要的贴图<br />红绿通道：![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640606750751-f951549d-8fc5-432c-b5a0-d199dbeef8d5.png#clientId=u4aa6ce16-a77b-4&from=paste&height=424&id=u2a8fff45&originHeight=424&originWidth=420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231981&status=done&style=none&taskId=ua5e5e54c-8312-46f8-ac7f-05013754d8a&title=&width=420)<br />红绿通道是用来配合append一个数值为1的标量来充当法线的<br />蓝色通道：这是一个时间偏移遮罩，这个遮罩让每个雨滴都在不同的时间出现<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640606856194-29d82fa1-abc4-4b88-a5c4-db235ac6ed94.png#clientId=u4aa6ce16-a77b-4&from=paste&height=416&id=uad940706&originHeight=416&originWidth=415&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85327&status=done&style=none&taskId=uf1ffdecc-8c8d-42a1-94dc-e177be59a91&title=&width=415)<br />alpha通道：小黑点们代表我们想让他们成为静止的水滴，白色的代表我们想让他们动起来的水滴，动静结合<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640606889454-fd3953ac-a84c-458f-8b76-0c3495dfcd1a.png#clientId=u4aa6ce16-a77b-4&from=paste&height=421&id=u474c48e9&originHeight=421&originWidth=421&originalType=binary&ratio=1&rotation=0&showTitle=false&size=211989&status=done&style=none&taskId=u74a9db0a-681a-441d-88ce-a5b5cd55921&title=&width=421)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640790536664-9fb6ce5c-8887-4a9c-bafa-172f2c5a34be.png#clientId=u00367ec4-d802-4&from=paste&height=1670&id=u41ecaba1&originHeight=1670&originWidth=3635&originalType=binary&ratio=1&rotation=0&showTitle=false&size=761178&status=done&style=none&taskId=u8b0a33d4-e90f-4cf3-8b8f-879c0789626&title=&width=3635)<br />材质函数写法：<br />此处主要对水滴的UV进行了改变，这里水滴改成了依照世界坐标的形式，并且可以通过更改Rain的输入值来更改水滴的强弱。并将输出改成了MASK和Normal<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640789994366-5c86c8a8-7930-4c78-8c44-4c02ffe4f916.png#clientId=u00367ec4-d802-4&from=paste&height=1240&id=u4d81fa01&originHeight=1240&originWidth=2277&originalType=binary&ratio=1&rotation=0&showTitle=false&size=498473&status=done&style=none&taskId=ua811c926-4a98-4cf0-919d-a5fbe445fb3&title=&width=2277)
<a name="jrmRK"></a>
### 流淌雨滴着色器
依然是先介绍所需要的贴图。<br />第一张：<br />红绿通道：用来制作法线贴图（需要乘2减1加一个数值为1的通道才能得到正确的法线效果）<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640678519138-59ed052b-5dd4-4dfe-9d24-2244e4e140bb.png#clientId=u1295fa07-04b8-4&from=paste&height=313&id=uc86088dd&originHeight=313&originWidth=311&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51143&status=done&style=none&taskId=u5c3229de-adc6-4d34-881d-e0af5b3e6c5&title=&width=311)<br />蓝通道：控制雨滴的掉落轨迹<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640678543574-c4f3ed09-9f29-4d6e-a407-3472dfcfae14.png#clientId=u1295fa07-04b8-4&from=paste&height=318&id=u7eac0703&originHeight=318&originWidth=315&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53243&status=done&style=none&taskId=u30c9adc1-3730-4ec8-a7dd-9aff0dfddf2&title=&width=315)<br />alpha通道：时间蒙版，为了使雨滴落下的时间是不统一的<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640678561321-a67ec3eb-aeeb-4891-9f24-9af3d0adf66d.png#clientId=u1295fa07-04b8-4&from=paste&height=319&id=u9e184497&originHeight=319&originWidth=316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1322&status=done&style=none&taskId=u90637de8-a85a-4145-8a32-e70a8a49c2b&title=&width=316)<br />第二张：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640678590613-2caad0da-0f5b-40f2-ad66-0e9e97d75ecd.png#clientId=u1295fa07-04b8-4&from=paste&height=551&id=u57e0e850&originHeight=551&originWidth=202&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4397&status=done&style=none&taskId=ub10f5ae2-5071-43d9-8dc9-21a15583ca5&title=&width=202)<br />三个通道都是有一片区域为从1到0的一小块渐变<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640679220516-90f351ec-20a1-4cba-993a-05c0140470b7.png#clientId=u1295fa07-04b8-4&from=paste&height=661&id=u054522a6&originHeight=661&originWidth=231&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6641&status=done&style=none&taskId=u40265373-eb7f-4c5c-9062-5199f158126&title=&width=231)<br />作用是制作雨滴的遮罩，使雨滴不是统一颜色的。<br />材质编辑器：<br />首先复习一下材质节点的作用：<br />world positon 绝对世界位置，作用是输出每个像素的世界位置信息<br />sign：正数输出1，零输出0，负数输出-1<br />round：  对小数部分四舍五入<br />实现此材质效果适用于任何模型，（纹理是随着世界空间平铺的）只针对XY不针对Z![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640683382755-20b24628-db94-4356-ab4a-07a531e19d84.png#clientId=u1295fa07-04b8-4&from=paste&height=207&id=u895e1024&originHeight=207&originWidth=237&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61506&status=done&style=none&taskId=u73a15ef1-cedc-4c36-9941-ae3fe500023&title=&width=237)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640683266331-67157596-dfe4-4605-a709-8128712140e6.png#clientId=u1295fa07-04b8-4&from=paste&height=672&id=u21fbda9e&originHeight=672&originWidth=1447&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220507&status=done&style=none&taskId=u6c0ac071-a76b-402d-8868-7f3d7c1f857&title=&width=1447)<br />但是这种效果我觉得使用全局一致纹理也能达到差不多的效果。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640683432099-f8effe1c-20d7-4e99-abb4-87542d79a465.png#clientId=u1295fa07-04b8-4&from=paste&height=485&id=ua58b76d8&originHeight=485&originWidth=735&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82200&status=done&style=none&taskId=u1a3ee947-f575-4ae4-98ab-1adf329d626&title=&width=735)<br />整体：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640771339483-7bd04b38-d5e0-4170-8bb8-c87eaa609727.png#clientId=u8bffab1e-e229-4&from=paste&height=1672&id=u1511cf5c&originHeight=1672&originWidth=3651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=761846&status=done&style=none&taskId=u35247144-fa08-4233-94e1-b7eb4e7f962&title=&width=3651)<br />转换为材质函数：更改了一下数值使其更符合现实；输入雨的强度来控制水滴的强度（0\~1）,输入表面渗入性来更改是否有雨滴的流淌速度。（但是我觉得这两个输入应该反过来）<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640790682202-9bb20d91-ad1f-4033-aa13-6c24554ca2b6.png#clientId=u00367ec4-d802-4&from=paste&height=1672&id=uc2eb189d&originHeight=1672&originWidth=3625&originalType=binary&ratio=1&rotation=0&showTitle=false&size=727756&status=done&style=none&taskId=u48a44b6b-b55e-4fdd-b8a3-12ef492016e&title=&width=3625)
<a name="BgdvE"></a>
### 雨滴涟漪着色器
首先此连接目的是制作材质函数，为的是针对不同模型可以快速的使用此函数添加涟漪效果。<br />首先了解一下贴图<br />R通道：制作动态涟漪效果使用<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640694106552-b8d7fb0d-2deb-4ccb-87df-7f715c9497eb.png#clientId=u434c1aaf-447b-4&from=paste&height=366&id=u0f210896&originHeight=366&originWidth=359&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70259&status=done&style=none&taskId=u8867158b-1af9-4155-bcb4-82677df5091&title=&width=359)<br />GB通道：配合增加一个通道制造法线<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640694147023-46bc3905-a559-480e-a1f4-ace960b94b7d.png#clientId=u434c1aaf-447b-4&from=paste&height=365&id=u52aeb41a&originHeight=365&originWidth=368&originalType=binary&ratio=1&rotation=0&showTitle=false&size=137551&status=done&style=none&taskId=u9762d662-2ad0-4aa0-ba0e-66449d06e5c&title=&width=368)<br />A通道：时间mask，使涟漪出现的时间有差别。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640694212837-e988bae2-f706-4d2a-8080-1d8a06bdb011.png#clientId=u434c1aaf-447b-4&from=paste&height=366&id=ucf9a675a&originHeight=366&originWidth=361&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74465&status=done&style=none&taskId=ub875874f-1a24-4ca8-a727-e8475d98ccd&title=&width=361)<br />先看涟漪材质的连接<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640695915304-3f9ec423-35f0-46ee-8f93-1f3b58da5d97.png#clientId=u434c1aaf-447b-4&from=paste&height=1014&id=u9901e721&originHeight=1014&originWidth=2258&originalType=binary&ratio=1&rotation=0&showTitle=false&size=352188&status=done&style=none&taskId=ucf353a9f-19de-447c-a633-1e7735994f2&title=&width=2258)<br />函数制作以及改进版：<br />教程中在涟漪数量那里，乘了一个圆周率并将sine的周期改成了6.283185，我不知道为什么要这么改。<br />删除了控制涟漪速度的节点，因为等一下再创建一个材质函数，作用是将四个不同涟漪效果合并成一个涟漪效果，然后再创建一个最终的材质函数，在这个最终的函数中制造四个不同的数值赋予给涟漪函数和涟漪合并函数，最终输出法线。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640791382060-bdab80cd-fce9-4a47-8e45-3d580e499d1c.png#clientId=u00367ec4-d802-4&from=paste&height=1032&id=uea15afb8&originHeight=1032&originWidth=2319&originalType=binary&ratio=1&rotation=0&showTitle=false&size=360917&status=done&style=none&taskId=u9e03c6dd-ca61-4c5d-b0ac-9386eab8d18&title=&width=2319)<br />合并涟漪效果函数：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640699311228-0b085e22-e738-4fe4-a296-d08b10c91e12.png#clientId=u434c1aaf-447b-4&from=paste&height=1008&id=u15493db5&originHeight=1008&originWidth=2479&originalType=binary&ratio=1&rotation=0&showTitle=false&size=401937&status=done&style=none&taskId=uc9917546-0f01-407f-a028-107f35dc21f&title=&width=2479)<br />最终涟漪函数：![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640792202517-2be328a6-84d4-4cda-9dfb-572d40c744e5.png#clientId=u00367ec4-d802-4&from=paste&height=1462&id=u2192e703&originHeight=1462&originWidth=2160&originalType=binary&ratio=1&rotation=0&showTitle=false&size=559557&status=done&style=none&taskId=uf662bdd8-9aca-4ae2-87a7-aea0fd5f466&title=&width=2160)
<a name="eOu1V"></a>
### 水坑着色器
制作水坑着色器首先需要一个能够代表水坑位置的黑白图，此处使用之前课上的一张贴图的G通道图来代替。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640753890671-1b09e662-6938-427a-88b9-dc5734ce3558.png#clientId=u33b067b9-d59e-4&from=paste&height=475&id=u22a2292f&originHeight=475&originWidth=472&originalType=binary&ratio=1&rotation=0&showTitle=false&size=104082&status=done&style=none&taskId=uc44571d0-79c0-4d8c-a811-040e47f803e&title=&width=472)<br />制作水坑仍然使用根据绝对世界位置映射贴图的方法。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640792255901-4a83e702-572d-4ef6-b613-c383854e3730.png#clientId=u00367ec4-d802-4&from=paste&height=1432&id=u150d4c8f&originHeight=1432&originWidth=2275&originalType=binary&ratio=1&rotation=0&showTitle=false&size=455151&status=done&style=none&taskId=ue50628dc-b0d7-4f0c-a5d6-f6594463ff1&title=&width=2275)<br />这里解释一下这为什么Puddles参数能控制蒙版的大小，可以直接看当Puddles为0时，减去0，除以一个特别小的值，那么蒙版就几乎全白，再1-x就几乎全黑就是无水坑，当Puddles趋向于1时，减去的数增加，除的数增大，黑色的就越多，然后再反转就得到了白色的。<br />风吹涟漪材质函数：![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640760190145-a0503b32-84b9-41d5-988c-2d5a110fcc95.png#clientId=u33b067b9-d59e-4&from=paste&height=1336&id=ue343dfb7&originHeight=1336&originWidth=2334&originalType=binary&ratio=1&rotation=0&showTitle=false&size=482359&status=done&style=none&taskId=ue78a853d-7758-48e2-b812-c1efcec20eb&title=&width=2334)
<a name="bgLPn"></a>
### 完整雨水着色器
材质：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640795397412-8b927a8e-499e-445b-98a8-1e8305ae94fe.png#clientId=u00367ec4-d802-4&from=paste&height=992&id=u5a7a8a01&originHeight=992&originWidth=2605&originalType=binary&ratio=1&rotation=0&showTitle=false&size=437950&status=done&style=none&taskId=u2011bf4f-43eb-4928-8d20-3170983d9ab&title=&width=2605)<br />弄到材质函数中：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640798057257-0301bdb1-59ea-4d40-af8c-701c04c76bda.png#clientId=u00367ec4-d802-4&from=paste&height=992&id=u3f60e464&originHeight=992&originWidth=2623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=489545&status=done&style=none&taskId=u851f15b6-c0e6-48d1-96a6-5ab5995f6b1&title=&width=2623)<br />目前上面版本的shader可能是我们的下雨shader里性能消耗最昂贵的一种<br />所以我们要做的是，创建这个shader的不同版本<br />这取决于要施加雨水的对象的类型是什么<br />如果要把这个shader用到地板上，那么puddle肯定要的，但是我们不需要drips（因为他从侧面流下）<br />如果我们知道在雨中的这个物体没有大的平面，那么我们可能不需要puddle，需要drips和drops<br />所以可以的话我们需要根据这个shader创建这几种不同的版本，取决于应用的表面类型，去除不需要的效果

另外，在用蓝图做游戏的时候，我们这个shader所需要的参数可能是会从蓝图那边来（比如暴雨的启动和结束）<br />我们就需要了解蓝图以及如何从shader外引入值，这些自行了解即可
<a name="pxAcb"></a>
## 程序化噪点
主要使用这个节点<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640841923591-6c3958d9-be4d-4217-9197-a62938f8b6fc.png#clientId=u6687c7fe-2385-4&from=paste&height=269&id=udd89f437&originHeight=269&originWidth=363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70880&status=done&style=none&taskId=u57a174f6-1d32-463a-b300-cd95fa03946&title=&width=363)<br />perlin noise介绍：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640842067017-76d5eb20-260f-449a-a472-890608f37c56.png#clientId=u6687c7fe-2385-4&from=paste&height=378&id=ua9917cc5&originHeight=378&originWidth=372&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71699&status=done&style=none&taskId=ue11e5e6d-f586-419d-b6d8-9928637a4f7&title=&width=372)<br />这是一个无限的非重复图案，图上展示的只是一小部分。我们通常不会直接使用它，因为我们可以以它为基本图案并对其进行大量修改。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640842115720-76a60e07-8a11-4aa1-86cc-b059f34c226a.png#clientId=u6687c7fe-2385-4&from=paste&height=690&id=ua0594b1f&originHeight=690&originWidth=1547&originalType=binary&ratio=1&rotation=0&showTitle=false&size=455512&status=done&style=none&taskId=u55c34a98-9879-46f0-adfb-67e8b03a837&title=&width=1547)<br />右边这个图是我们比较熟悉的,PS中的渲染云彩滤镜就是使用了perlin noise<br />我们可以通过组合噪音来创建各种不同的噪音图案<br />perlin noise 的个别应用：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640842298008-90e4ef2f-3e85-4052-a33c-ec90563ba91e.png#clientId=u6687c7fe-2385-4&from=paste&height=833&id=u3cae1ac3&originHeight=833&originWidth=1771&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2009031&status=done&style=none&taskId=uae4eb8ca-2177-4a73-89c6-a4be06c15c0&title=&width=1771)<br />perlin noise 广泛应用于地形生成过程纹理。<br />它是各种程序化生成的内容游戏的基础。<br />生成perlin noise的核心代码：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640842445861-8e5361cc-173b-4716-adf1-575176b75f4c.png#clientId=u6687c7fe-2385-4&from=paste&height=687&id=ubc07aee9&originHeight=687&originWidth=1229&originalType=binary&ratio=1&rotation=0&showTitle=false&size=373147&status=done&style=none&taskId=udf00e82b-a209-471e-bf89-13d464de921&title=&width=1229)<br />当上面这些代码被shader编译的时候，大约会变成61个像素着色器的指令和8个纹理样本，Perlin噪声图用的时候，通常循环3\~8次来获得所需要的图案作为mask（8次的话，就有488个指令和64个纹理样本）这样做虽然是可行的但是因为消耗过于昂贵，因此需要另外找其他办法。<br />方法一：利用三维空间重合perlin noise 将8个纹理样本合并为1个纹理样本。但是这样做会导致内存体积占的过于庞大这是它的缺点。并且要使用它的话需要使其在所有三个维度进行平铺，并且由于它是平铺的，因此不再是无限且非重复的。但是我们可以挑选彼此不对齐的纹理来隐藏平铺的效果。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640842902937-6bb7a37f-a9d6-45be-a262-10a28c57bf72.png#clientId=u6687c7fe-2385-4&from=paste&height=451&id=u20a528da&originHeight=451&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=160055&status=done&style=none&taskId=u3f2fe5d7-11b9-455a-adc0-f9d1abce834&title=&width=779)<br />在UE4中：如果选择3d纹理那一项，我们就是对Peilin噪声的体积纹理进行采样，而不是做代码中的各种数学运算<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640843210638-efaf0655-81bd-4d4f-82eb-b47dd2319ddc.png#clientId=u6687c7fe-2385-4&from=paste&height=621&id=ucadb9091&originHeight=621&originWidth=1688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=443953&status=done&style=none&taskId=u380e2057-280f-4fb1-8223-31cc8fc4928&title=&width=1688)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640844427260-921ad68f-ed96-4f1f-822f-3cdcade7f7ae.png#clientId=u6687c7fe-2385-4&from=paste&height=372&id=uc31d3ba8&originHeight=372&originWidth=367&originalType=binary&ratio=1&rotation=0&showTitle=false&size=317744&status=done&style=none&taskId=ua5e018ca-1815-4dfd-8698-e0b3b1cf5f9&title=&width=367)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640844438583-e2580e63-80dd-4162-b25e-25e17a0cc732.png#clientId=u6687c7fe-2385-4&from=paste&height=140&id=uf31a19ca&originHeight=188&originWidth=473&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29536&status=done&style=none&taskId=udb660b81-51d8-4be3-94ba-2aaf6356000&title=&width=352)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640844457992-388dfdd1-f37c-43d6-8c88-8a1e0ea72883.png#clientId=u6687c7fe-2385-4&from=paste&height=392&id=u9c8caa11&originHeight=392&originWidth=715&originalType=binary&ratio=1&rotation=0&showTitle=false&size=425319&status=done&style=none&taskId=uf9dee7c8-eb0a-4c49-b6ae-c9054ff0515&title=&width=715)<br />噪音节点的细节：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640845451506-2de3e84f-9506-4428-91ed-f9feedcd8610.png#clientId=u6687c7fe-2385-4&from=paste&height=290&id=ua3604c09&originHeight=290&originWidth=290&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17571&status=done&style=none&taskId=uc32492be-82e9-43f9-856d-f09545db6b3&title=&width=290)<br />湍流的是否勾选决定了noise的组合方式，使用湍流noise更圆润<br />关卡的大小决定了noise的精细程度，最小输出和最大输出控制的是噪音的黑白程度。并且最小输出代表着黑色的值的大小。<br />一共可以选择这么多种噪音生成方式，一般使用第三个。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640845579087-4fda7db8-4589-4805-a79b-fdd564eaf1fa.png#clientId=u6687c7fe-2385-4&from=paste&height=105&id=uc2543a33&originHeight=105&originWidth=142&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11111&status=done&style=none&taskId=u0190978b-eef5-446d-8d2f-db664b19b8d&title=&width=142)<br />Voronoi![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640845623337-ba131f42-8066-4577-b5a8-63e3274bc7ba.png#clientId=u6687c7fe-2385-4&from=paste&height=88&id=pSuDE&originHeight=88&originWidth=314&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11187&status=done&style=none&taskId=u281b6786-abcd-4670-b2f8-69cb69c65d5&title=&width=314)可以生成这种noise。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2623605/1640845685812-48aa7cc9-ab72-48d1-9d03-a645fea5af66.png#clientId=u6687c7fe-2385-4&from=paste&height=766&id=uee2d63e7&originHeight=766&originWidth=1113&originalType=binary&ratio=1&rotation=0&showTitle=false&size=296658&status=done&style=none&taskId=u2c49658e-b62b-491b-a3f1-eb6eb5c9982&title=&width=1113)
<a name="rEwXr"></a>
### 枯木积雪着色器
核心连法：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641449841802-b22aecf6-226f-40af-b020-2965e18594b1.png#clientId=uf528f3e6-60a0-4&from=paste&height=896&id=u23e400ab&originHeight=896&originWidth=1215&originalType=binary&ratio=1&rotation=0&showTitle=false&size=208445&status=done&style=none&taskId=u8510db20-2707-4812-a94a-6a9974ea65b&title=&width=1215)<br />作用：利用根据世界位置投射的noise使每个使用此材质的树都拥有不同的雪的覆盖。
<a name="Olpot"></a>
### 层积岩着色器
环境艺术家创造了一大堆岩石，我们要做的是把这些岩石塞在一起成为岩层<br />但是真正去做的时候，这些岩石就像是一堆混乱的石头，有什么方法能够让他们看起来像是放在一起的结构，方法便是程序化噪声<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641450069314-9c40d142-068c-47d6-95c7-16dd517f5b5e.png#clientId=uf528f3e6-60a0-4&from=paste&height=582&id=u349e25f0&originHeight=582&originWidth=648&originalType=binary&ratio=1&rotation=0&showTitle=false&size=427970&status=done&style=none&taskId=ucd65cba6-9279-45bc-8735-a05bfb47077&title=&width=648)<br />使用的贴图：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641453610761-6047aed4-2b6a-46d3-8b48-3ac385546775.png#clientId=uf528f3e6-60a0-4&from=paste&height=677&id=ufec94cff&originHeight=677&originWidth=188&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11577&status=done&style=none&taskId=ucff2b800-8fb1-4760-92e1-463d836b42c&title=&width=188)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641451420975-4040d394-8305-493a-bede-7ee87693d15e.png#clientId=uf528f3e6-60a0-4&from=paste&height=719&id=ue3223da9&originHeight=719&originWidth=1312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=162645&status=done&style=none&taskId=u9314de67-7829-4541-964e-ac2ffbe5be8&title=&width=1312)<br />使用案例：将不同的岩石资产更好的拼接在一起。

![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641451138729-df004681-8800-4a0e-86be-58c0d929e91c.png#clientId=uf528f3e6-60a0-4&from=paste&height=835&id=u07806a82&originHeight=835&originWidth=1079&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1031232&status=done&style=none&taskId=u2f5ae110-726d-4967-8e4a-d8fb8d80710&title=&width=1079)
<a name="lIX0a"></a>
### 与世界坐标对齐 World-Aligned Shader
适合程序化搭建时使用。例如洞穴![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641453340901-e1e8908f-c1d6-41d0-bc41-edfea2c68c2a.png#clientId=uf528f3e6-60a0-4&from=paste&height=784&id=u2917273e&originHeight=784&originWidth=1015&originalType=binary&ratio=1&rotation=0&showTitle=false&size=755985&status=done&style=none&taskId=u68e7e8aa-3cba-4ec3-bfb2-456ffb31164&title=&width=1015)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641453264466-b8993b6c-26bc-4106-8dd2-63428fa8e9a3.png#clientId=uf528f3e6-60a0-4&from=paste&id=uc9f873de&originHeight=740&originWidth=1398&originalType=url&ratio=1&rotation=0&showTitle=false&size=583187&status=done&style=none&taskId=ud1a8a878-27ae-4e0d-a405-fbdb173ce67&title=)
<a name="MgtAQ"></a>
## 水流着色器

<a name="y108m"></a>
### 涟漪着色器
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641464792765-3532d6a5-6c05-4155-b630-eb6989ae7db6.png#clientId=uf528f3e6-60a0-4&from=paste&height=1118&id=u5cdce380&originHeight=1118&originWidth=2370&originalType=binary&ratio=1&rotation=0&showTitle=false&size=509613&status=done&style=none&taskId=u4435fac7-a8b7-44d6-be00-c2313fa48c4&title=&width=2370)<br />其中DeriveNormalZ_Function的作用是输入法线的XY信息通过计算得到Z的数值并附加XY最终输出正确的法线信息。<br />雨滴涟漪根据情况添加。
<a name="XxeiS"></a>
### 水深着色器（根据水深得到河流不同地方的透明度）
首先先回顾一下节点的介绍<br />Scene Depth：这个节点只适用于具有半透明属性的材质，它的作用是得到当前视口摄像机的位置与透过使用着色器的物体（河流）所看到的下一个物体之间的距离。<br />pixel depth：得到当前视口摄像机与像素之间的距离<br />绝对世界位置：物体每个像素的位置信息。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641470603052-ef0daf92-cd3c-4da2-bcf6-2b3571b710b0.png#clientId=uf528f3e6-60a0-4&from=paste&id=u14ffb3da&originHeight=609&originWidth=908&originalType=url&ratio=1&rotation=0&showTitle=false&size=170609&status=done&style=none&taskId=ue216d92b-d2cc-47b7-aaa8-e5fd66f9580&title=)<br />首先先看ben教程中的计算水深的方法![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641470964059-285d7f4e-6e48-4fb0-a314-ab626685d7c7.png#clientId=uf528f3e6-60a0-4&from=paste&height=776&id=ue5719cfb&originHeight=776&originWidth=1384&originalType=binary&ratio=1&rotation=0&showTitle=false&size=196351&status=done&style=none&taskId=u66227a01-50fd-431d-a86e-a300240ea54&title=&width=1384)<br />此计算过程主要思想是通过相似三角形得到水深。<br />Scene Depth除以PixelDepth得到了比例。<br />之所以不直接通过摄像机减去object position得到摄像机到水面的距离是因为这样得到的数值是一个单一的值不是针对每个像素的，并且水面可能通过顶点动画而使一个平面有不同的高度值。这里不理解的是为什么要用1-x节点反转，他前面得到的是一个负值，后面应该乘-1或者用绝对值节点得到正确的。<br />这是示例图：举例ABCD四个地方通过此算法得到的水深数值。（原点在最下方）<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641472168441-78ff309d-8430-4e97-8a02-b755338c74a7.png#clientId=uf528f3e6-60a0-4&from=paste&height=761&id=ua27db52e&originHeight=761&originWidth=967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99974&status=done&style=none&taskId=u8ab78ff4-8ff0-4073-ad68-70674e17359&title=&width=967)<br />并且这个自我感觉有一些麻烦。<br />网上找的这个得到的结果应该是最精准的水深。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641472272521-4f76675c-5388-44d5-b6f1-1022c0fbf6f9.png#clientId=uf528f3e6-60a0-4&from=paste&height=393&id=u1b2de2dc&originHeight=393&originWidth=646&originalType=binary&ratio=1&rotation=0&showTitle=false&size=125048&status=done&style=none&taskId=u51e0291b-8785-4f22-b32c-285dabcd20f&title=&width=646)<br />了解了水深的计算过程后我们需要的是通过水深得到相应的不透明度的变化<br />水越深的地方越颜色越暗不透明度越大，浅的地方是相反的。<br />水菲涅尔效应比较明显<br />因此通过此连接方法得到不透明度的变化和颜色变化。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641642774669-faa34c25-8093-4893-9d74-10dacdf3bde9.png#clientId=ufc486b54-6866-4&from=paste&height=1030&id=ue75a7156&originHeight=1030&originWidth=2689&originalType=binary&ratio=1&rotation=0&showTitle=false&size=370971&status=done&style=none&taskId=uf53a6fc3-2d23-4b4d-8c8c-7031281f2ca&title=&width=2689)
<a name="h5VQx"></a>
### 水体反射与折射
要在UE4中实现反射，应该一共有5种方法，教程中提到了三种，<br />第一种是天空盒，但水面只会反射天空，不能反射其他物体<br />第二种是![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641629493696-56145bee-0db7-4f37-a78a-0e192c7fc25b.png#clientId=ufc486b54-6866-4&from=paste&height=95&id=ub3d8aebb&originHeight=95&originWidth=218&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11878&status=done&style=none&taskId=u53d64f95-c25d-4093-be3a-9d8477aa4af&title=&width=218)作用是捕获四周的环境创建一个立方体贴图，然后利用立方体贴图进行反射。这个仅仅比天空盒好一些。<br />第三种是屏幕空间反射，需要在材质球中勾选![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641629805256-8efe9c9a-8532-46a8-89e6-2e77d3353c70.png#clientId=ufc486b54-6866-4&from=paste&height=75&id=u82eb49de&originHeight=75&originWidth=186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5634&status=done&style=none&taskId=u8b71f57e-532d-4529-b95e-f560d87abfb&title=&width=186)这个效果很好，但是它只能实现反射窗口视图中的物体。举例：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641629869607-befe816f-1cc8-4686-934e-bc89df3cf186.png#clientId=ufc486b54-6866-4&from=paste&id=ueb908d4a&originHeight=574&originWidth=1124&originalType=url&ratio=1&rotation=0&showTitle=false&size=794824&status=done&style=none&taskId=u679699b8-2776-45b9-8948-49ba24a8a69&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641629875080-c5e07e7f-7a72-41bc-8912-0286912f7d16.png#clientId=ufc486b54-6866-4&from=paste&id=ueef530a8&originHeight=620&originWidth=1134&originalType=url&ratio=1&rotation=0&showTitle=false&size=697135&status=done&style=none&taskId=u21b9a011-8133-4857-a61f-fcc7e0ad093&title=)<br />这三种反射方法可以一起使用。<br />折射设置：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641635912570-003bf737-5894-44b6-88eb-98a67c8d1c39.png#clientId=ufc486b54-6866-4&from=paste&height=141&id=uda76913c&originHeight=141&originWidth=768&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50936&status=done&style=none&taskId=u23fb302b-29df-47c9-a942-3d661d63610&title=&width=768)<br />像素正常偏移适用于水面这类的大型折射表面。<br />使用折射率的造成的错误折射效果：<br />当视口向下偏移时一部分水面折射消失了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641636073194-b29a4da3-dd76-41a5-9cac-a600d4ba582c.png#clientId=ufc486b54-6866-4&from=paste&height=567&id=u3ce42f7a&originHeight=567&originWidth=1112&originalType=binary&ratio=1&rotation=0&showTitle=false&size=613226&status=done&style=none&taskId=u3366bb7b-4a29-4243-9642-ebd3ddfed58&title=&width=1112)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641636092471-cd419fa3-04e9-47ac-858e-aea723c6f2af.png#clientId=ufc486b54-6866-4&from=paste&height=398&id=u742c7e48&originHeight=398&originWidth=1120&originalType=binary&ratio=1&rotation=0&showTitle=false&size=558236&status=done&style=none&taskId=uc344c538-0af3-403b-a134-2d9e3d8429f&title=&width=1120)<br />官网教程材质大师的举例：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641636412091-b5b82e8b-06d7-489e-92a5-ef5ec6612b79.png#clientId=ufc486b54-6866-4&from=paste&height=586&id=u14d42f5a&originHeight=586&originWidth=1454&originalType=binary&ratio=1&rotation=0&showTitle=false&size=839925&status=done&style=none&taskId=u5670e1f8-4bcc-4853-92b5-010944690b0&title=&width=1454)<br />河流的边缘折射率低，其余部分为标准折射率1.33。如下设置：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641643857352-2ca96b0b-53e7-4433-9d76-c15e2c715315.png#clientId=ufc486b54-6866-4&from=paste&height=243&id=u9cf8c003&originHeight=243&originWidth=752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48427&status=done&style=none&taskId=u3852f1b4-196b-459c-b07f-383a7b65924&title=&width=752)
<a name="zmHlL"></a>
### Gerstner算法海浪
接下来通过顶点动画的形式通过数学计算配合函数生成海浪。<br />因为需要足够的顶点来实现顶点动画效果。增加模型的顶点数可以通过UE4自带的曲面细分来实现。<br />在材质球中的细节面板中为以下设置![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641716535084-545cc2e3-3c9e-4500-9d37-e7c4fd03a5d4.png#clientId=u290fc695-f701-4&from=paste&height=141&id=u00faa88a&originHeight=141&originWidth=260&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11419&status=done&style=none&taskId=ub1246599-3e8b-4113-a891-365787a3629&title=&width=260)<br />通过曲面细分乘数来控制细分程度（不宜过大）。一般会使用相机和表面的距离来控制曲面细分乘数。<br />这里先使用0.5的细分乘数。<br />Gerstner算法的解释：<br />普通的sin波是上面那个趋势，而Gerstner波是下面这种趋势，Gerstner波更符合海浪的动画形式。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641644784764-5cea1759-544e-4c00-a8fb-5679eeb0cb05.png#clientId=ufc486b54-6866-4&from=paste&id=u525050e8&originHeight=360&originWidth=960&originalType=url&ratio=1&rotation=0&showTitle=false&size=157092&status=done&style=none&taskId=u11371af0-92a8-43d2-91d1-aa4c0a500fd&title=)<br />![PreviewMaterial_12-MaterialGraph_0.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641729954548-4e7ac442-368a-4e30-83e8-66910a0cfa8f.png#clientId=u290fc695-f701-4&from=paste&height=1430&id=ub510fca3&originHeight=1430&originWidth=2015&originalType=binary&ratio=1&rotation=0&showTitle=false&size=632844&status=done&style=none&taskId=u80951f8f-f930-4508-8d76-c2f81209321&title=&width=2015)<br />这里有个严重错误：最后append应该是反过来的应该是这样的，找了很长时间才发现的...![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641895036608-a048b0b9-7910-4bca-aeeb-02594d373187.png#clientId=u331f69b2-277c-4&from=paste&height=315&id=udbece243&originHeight=315&originWidth=367&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28469&status=done&style=none&taskId=uab00becd-b579-44ec-9777-590db946486&title=&width=367)<br />其中波长意思为这个距离![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641729274059-b05f026f-b7b4-42c5-8b4a-b7111913acf9.png#clientId=u290fc695-f701-4&from=paste&height=537&id=u3def6b57&originHeight=537&originWidth=506&originalType=binary&ratio=1&rotation=0&showTitle=false&size=506230&status=done&style=none&taskId=u997f00a0-2e81-472a-bbe7-1a57ffde95a&title=&width=506)

陡度为1时：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641729379949-617ef62b-848d-4906-ac8a-f8b40dc66e41.png#clientId=u290fc695-f701-4&from=paste&height=222&id=uff4c0a4d&originHeight=222&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=193317&status=done&style=none&taskId=ub13cc59c-1ec0-4fbb-a8e1-00a458c3fee&title=&width=513)<br />陡度为0.3时![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641729398996-f0633fcc-c096-4710-a3d3-8594cb1ac1f5.png#clientId=u290fc695-f701-4&from=paste&height=153&id=uca0be7db&originHeight=153&originWidth=428&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106682&status=done&style=none&taskId=uc2f3e704-119d-49af-86a8-17fa9093074&title=&width=428)<br />因为河流不是只有一个海浪而是很多个海浪因此将算法转换成材质函数多次调用。<br />只是简单的将方向 波长 波高 陡度（默认陡度给了0.3）变成了输入节点，输出有normal 和offset<br />![Material_0-MaterialGraph_0.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641729917884-a54bd738-8523-4ca5-83c8-bebf14edec3d.png#clientId=u290fc695-f701-4&from=paste&height=1268&id=ud55711ef&originHeight=1268&originWidth=2133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=637141&status=done&style=none&taskId=u8742cd9a-bf15-4dc4-9b51-71a35c9044d&title=&width=2133)<br />这里转换为材质函数依然跟刚才那个错误一样：最后append应该是反过来的应该是这样的，找了很长时间才发现的...![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641895036608-a048b0b9-7910-4bca-aeeb-02594d373187.png#clientId=u331f69b2-277c-4&from=paste&height=315&id=BUjjC&originHeight=315&originWidth=367&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28469&status=done&style=none&taskId=uab00becd-b579-44ec-9777-590db946486&title=&width=367)<br />整合到主材质中：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641785599515-83fe85f9-076b-4710-a695-eff5a2717934.png#clientId=uaeab7d83-ce22-4&from=paste&height=900&id=u0d9cae6f&originHeight=900&originWidth=1495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=244736&status=done&style=none&taskId=ucadb9e5e-611a-4c41-923f-8ba4b9d37b0&title=&width=1495)<br />更改了一下颜色后的全部材质：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641785609795-57f5f180-dae4-4b90-9bdd-0cc94e7f453f.png#clientId=uaeab7d83-ce22-4&from=paste&height=2366&id=u609c585e&originHeight=2366&originWidth=3824&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1133349&status=done&style=none&taskId=u824953ea-d65c-4fe0-8bd3-c833e6b91b9&title=&width=3824)
<a name="XQvXK"></a>
### 波光的焦散效果

![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641783233258-d2922861-e4d6-479c-834e-b39db59a09b8.png#clientId=uaeab7d83-ce22-4&from=paste&height=757&id=u20ff09a9&originHeight=757&originWidth=1364&originalType=binary&ratio=1&rotation=0&showTitle=false&size=790695&status=done&style=none&taskId=ud5bb871a-e760-431c-b1b0-84818b7cc01&title=&width=1364)<br />要想在UE4中实现这种焦散效果，我们可以使用延迟贴花来达到。<br />步骤：<br />创建一个新的材质，将材质模式改为![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641786937226-74944c93-cbd1-4c06-b22c-0ba89b602417.png#clientId=uaeab7d83-ce22-4&from=paste&height=162&id=u4fa41727&originHeight=162&originWidth=315&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12765&status=done&style=none&taskId=u3fb9e369-492c-49c8-abe5-4dfe1afb436&title=&width=315)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641794238126-dd873b8b-2f13-498d-92e3-96f49fe45a95.png#clientId=uaeab7d83-ce22-4&from=paste&height=1076&id=ua843d0b2&originHeight=1076&originWidth=3075&originalType=binary&ratio=1&rotation=0&showTitle=false&size=503360&status=done&style=none&taskId=udb7ba1ba-729a-4811-b4db-a9ad56625c6&title=&width=3075)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645946005261-f2a494c4-c808-4e04-9356-67de1fd43643.png#clientId=u4da8d356-351f-4&from=paste&height=530&id=u9aaaf0d3&originHeight=530&originWidth=1030&originalType=binary&ratio=1&rotation=0&showTitle=false&size=144030&status=done&style=none&taskId=u1cf6be62-39cb-4ce2-be3c-69c317a454d&title=&width=1030)<br />这里利用世界场景法线进行绝对值并且四舍五入（只需要0或1的蒙版）然后取Z通道线性插值得到投射X平面和Z平面再进行通过线性插值得到投射XYZ平面<br />前后对比：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641794427238-a3ba6084-8550-4e1d-bb42-930935daa4f1.png#clientId=uaeab7d83-ce22-4&from=paste&height=421&id=ube6015d8&originHeight=421&originWidth=556&originalType=binary&ratio=1&rotation=0&showTitle=false&size=343389&status=done&style=none&taskId=u4d6c2de6-11f6-4237-b16c-102eb9fed2a&title=&width=556)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641794432664-94caa0e0-bff1-47e6-9ac6-389c6bd37cdb.png#clientId=uaeab7d83-ce22-4&from=paste&height=458&id=ub4d940f3&originHeight=458&originWidth=626&originalType=binary&ratio=1&rotation=0&showTitle=false&size=451940&status=done&style=none&taskId=ua10bb802-3e4f-493c-bc09-54cb73886f3&title=&width=626)
<a name="L6PaC"></a>
### 浪花泡沫
先介绍一下所用到的纹理<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795360129-ce010ed5-897c-4b8d-9ce2-babc26fc39cd.png#clientId=uaeab7d83-ce22-4&from=paste&height=729&id=ufdba8470&originHeight=729&originWidth=725&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1116949&status=done&style=none&taskId=udf80419b-7190-424c-a917-9073ce74f5a&title=&width=725)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795440128-341c2331-648c-4da6-a887-2cbfedcb3b90.png#clientId=uaeab7d83-ce22-4&from=paste&height=162&id=ud86df103&originHeight=162&originWidth=424&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11291&status=done&style=none&taskId=u176c9185-a364-4833-b41f-f91c4ac2b8e&title=&width=424)<br />这个纹理是将三个黑白图包装在了一起，红绿蓝分别对应了薄中厚三种不同的泡沫需求。<br />渐变纹理：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795525613-4b875c25-2ce6-4c5b-a294-dd367d4c479b.png#clientId=uaeab7d83-ce22-4&from=paste&height=74&id=uae564b89&originHeight=74&originWidth=924&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1554&status=done&style=none&taskId=u85d64d2c-3345-4af6-8807-7dab2cf5e43&title=&width=924)<br />红通道：对应的是薄泡沫<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795795909-474b325e-8f7b-41ee-ba6c-db0a9b4e92fb.png#clientId=uaeab7d83-ce22-4&from=paste&height=39&id=u829fd28f&originHeight=39&originWidth=859&originalType=binary&ratio=1&rotation=0&showTitle=false&size=437&status=done&style=none&taskId=ubc4fd7e3-4c27-4db3-b40c-2308b40ebbb&title=&width=859)<br />绿通道：对应的是中等泡沫![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795827672-f28bac4f-3bef-4133-b17c-f49118d09c8b.png#clientId=uaeab7d83-ce22-4&from=paste&height=43&id=ua24515d4&originHeight=43&originWidth=867&originalType=binary&ratio=1&rotation=0&showTitle=false&size=853&status=done&style=none&taskId=u95eb0789-a501-46e7-b136-e278156360c&title=&width=867)<br />蓝通道：对应的是厚泡沫![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795859582-699f08cf-d06d-4c72-8e2b-9b44f3489616.png#clientId=uaeab7d83-ce22-4&from=paste&height=45&id=ucc52bedc&originHeight=45&originWidth=873&originalType=binary&ratio=1&rotation=0&showTitle=false&size=783&status=done&style=none&taskId=ue3c2cb3d-48a6-4724-938d-b586156db79&title=&width=873)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641795512957-4e8bdfa0-ef6a-4ae0-86eb-e01904584a64.png#clientId=uaeab7d83-ce22-4&from=paste&height=289&id=uc90d426a&originHeight=289&originWidth=494&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20947&status=done&style=none&taskId=u468edd47-4c3c-4a3e-ac9a-3865f5a5103&title=&width=494)<br />这里将x轴平铺法和Y轴平铺法改为限制目的是为了使大小超过1的值限制到纹理的最左端，防止例如1.1的数值因为纹理是平铺的而对应的蒙版位置是黑色。<br />需要使用虚幻引擎自带的材质函数![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641887367065-8f8bdef8-147c-41a1-a608-392f9894ccdb.png#clientId=u331f69b2-277c-4&from=paste&height=128&id=uafd15147&originHeight=128&originWidth=83&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9393&status=done&style=none&taskId=u4cfab179-2125-45cb-a5c4-ba8475a47c1&title=&width=83)需要在![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641887376057-28494f14-2bde-45af-b025-97fac4e79941.png#clientId=u331f69b2-277c-4&from=paste&height=28&id=uef5bb32a&originHeight=28&originWidth=112&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1927&status=done&style=none&taskId=u998038ce-c0ff-4550-8a03-0514726287e&title=&width=112)中搜索。<br />这个材质函数的是采样一个纹理然后朝四个不同的方向进行位移的四元混乱函数，作用是使纹理更多样化。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641888210603-e42faf05-0a47-459f-853f-19e8ae897520.png#clientId=u331f69b2-277c-4&from=paste&height=1377&id=u06b3bfc7&originHeight=1377&originWidth=1953&originalType=binary&ratio=1&rotation=0&showTitle=false&size=531377&status=done&style=none&taskId=ub0d8ceba-b118-4984-a0a9-3ac8c856041&title=&width=1953)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641888295698-fd3cc65f-2a2c-4671-b691-27a7d337e896.png#clientId=u331f69b2-277c-4&from=paste&height=171&id=uc86855f6&originHeight=171&originWidth=261&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17644&status=done&style=none&taskId=ud8ceecbb-9d98-43fd-a908-7f295ca8785&title=&width=261)由图可知divisor（除数）控制的是纹理亮度，除数越大亮度越高。<br />根据深度控制泡沫出现的地方：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645874197465-9c914edf-408e-4432-b5db-8935c9ff6cc2.png#clientId=ub4e925bb-ce1c-4&from=paste&height=390&id=u5a381c6e&originHeight=390&originWidth=1256&originalType=binary&ratio=1&rotation=0&showTitle=false&size=175155&status=done&style=none&taskId=u92143b7f-a682-4bcd-acd6-0c411a1663c&title=&width=1256)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645874227987-68ac827c-276d-45fe-b44b-cd8bbf27fb36.png#clientId=ub4e925bb-ce1c-4&from=paste&height=2964&id=ua35da101&originHeight=2964&originWidth=3779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1410379&status=done&style=none&taskId=ud396c65d-c1fd-4631-832b-ea2af0f23be&title=&width=3779)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641896144373-d9c5af40-30f9-4ce2-8c9d-6e096a2bcf2e.png#clientId=u331f69b2-277c-4&from=paste&height=95&id=ue22cbf2d&originHeight=95&originWidth=295&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47669&status=done&style=none&taskId=u1550fd78-e15f-4825-bc10-c62352d1b68&title=&width=295)<br />这只是其中一种办法，也可以通过顶点绘制来决定泡沫出现的地方，或者在Gerstner的波峰的地方添加泡沫。
<a name="l4rgn"></a>
### 水流映射
通过着色器制作的涟漪没有自定义的方向，如果我们想要在特定的地方使其拥有特定的流动方向就需要FlowMap（流动贴图）<br />要想绘制并得到FlowMap需要去[网站](http://teckartist.com/?page_id=107)下载流图画家这个软件来进行绘制。<br />软件使用：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645879812783-5b8a3aef-66a4-4663-a065-d1b9d40b59f3.png#clientId=ub4e925bb-ce1c-4&from=paste&height=1054&id=ud6d1929b&originHeight=1054&originWidth=1829&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2724224&status=done&style=none&taskId=u008472ba-ffb4-499e-9400-d713324e4e6&title=&width=1829)<br />绘制好FlowMap后导入到UE4中需要将贴图格式改为法线贴图，使用法线贴图的压缩设置可以使向量不被压缩得足够多，而且还将扩大颜色范围从0\~1变成-1\~1。<br />流动贴图的作用：它可以扭曲纹理。例如这里，取得流动贴图的RG数值，0.25控制强度，然后加上纹理坐标<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645877275394-8c820e67-5213-4387-b49e-5edd7040a6fc.png#clientId=ub4e925bb-ce1c-4&from=paste&height=296&id=u3c762ae6&originHeight=296&originWidth=1054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=196780&status=done&style=none&taskId=u89874175-239c-4719-96c2-4a1af6fe652&title=&width=1054)<br />它将原图![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645877287979-b8e46b1e-6bb9-40ac-9168-cfffaead4236.png#clientId=ub4e925bb-ce1c-4&from=paste&height=445&id=u28a9b6ca&originHeight=445&originWidth=474&originalType=binary&ratio=1&rotation=0&showTitle=false&size=107328&status=done&style=none&taskId=u1b8e4152-4e70-41f0-9c44-93ab1594c1c&title=&width=474)扭曲成了![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645877309473-e49d7231-1506-4fb0-96dd-e2a39064706d.png#clientId=ub4e925bb-ce1c-4&from=paste&height=458&id=u9b7cbe60&originHeight=458&originWidth=469&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102411&status=done&style=none&taskId=u6c8b713a-f2ad-484e-bc90-b74fd8ce23a&title=&width=469)<br />使用这种材质连法可以得到流动效果。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645881852624-c9d10943-7343-49b8-9d80-cf8480d94b09.png#clientId=ub4e925bb-ce1c-4&from=paste&height=1132&id=uca1163c3&originHeight=1132&originWidth=1764&originalType=binary&ratio=1&rotation=0&showTitle=false&size=353931&status=done&style=none&taskId=uc93f95ec-f745-40a7-8b39-d52c8c23cce&title=&width=1764)<br />解析：这里的0.25控制的是扭曲强度。<br />这里时间节点frac后乘2减1再绝对值可以得到1\~0\~1\~0\~1的线性数值。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645881908150-0f1a4836-0ead-4ce0-a404-fc6d7fb04348.png#clientId=ub4e925bb-ce1c-4&from=paste&height=134&id=u60fe8987&originHeight=134&originWidth=484&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36158&status=done&style=none&taskId=ufcbbb8fb-42e5-4456-99d9-24c536bc9a5&title=&width=484)<br />将两张相同的贴图（一个从0开始流动，一个从0.5开始流动）通过Lerp混合后可以使流动部分一直重复的进行下去。<br />Lerp混合解析：刚开始进行从0开始流动的动画，然后过渡到从0.5开始流动的动画，再然后过渡到从0开始流动的动画。这样重复过渡形成一直流动的视觉效果。<br />整理成材质函数：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645882724020-07bd0514-a7dc-4dd5-824d-ede09e4ca51b.png#clientId=ub4e925bb-ce1c-4&from=paste&height=731&id=ue19241af&originHeight=731&originWidth=1298&originalType=binary&ratio=1&rotation=0&showTitle=false&size=188039&status=done&style=none&taskId=ub842b302-d658-4c39-934e-6463d85c8fb&title=&width=1298)<br />使用举例：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641900311734-fd6c3b35-a79b-4593-a307-4f6c4dccd651.png#clientId=ud3a46a59-9589-4&from=paste&height=382&id=u5b1aa037&originHeight=382&originWidth=763&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220240&status=done&style=none&taskId=uc44dcb7c-6bdb-4389-9bc9-4a2dbb0b3d6&title=&width=763)<br />将这些连接到normal上，最终结果就是按照法线贴图的形状依照流动贴图绘制的流动方向来源源不断的流动。<br />使用流动贴图的好处是可以自定义水流的流动方向。<br />在平时使用时通常是根据需要决定FlowMap，因此在顶视图中截取一张图并在PS裁剪好![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641900410388-b916a45a-a250-4471-9a73-568e9ab4c36c.png#clientId=ud3a46a59-9589-4&from=paste&height=737&id=uf758dde1&originHeight=737&originWidth=805&originalType=binary&ratio=1&rotation=0&showTitle=false&size=859961&status=done&style=none&taskId=u0bc94fe3-2097-4b65-b3b4-9a162b94284&title=&width=805)<br />然后在绘制软件中![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1641900518708-48650671-ca16-433c-8d79-ad20b1a1793f.png#clientId=ud3a46a59-9589-4&from=paste&height=72&id=u722c5710&originHeight=72&originWidth=267&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9151&status=done&style=none&taskId=u57ff8787-680f-4da8-8b83-2607a2eee70&title=&width=267)覆盖贴图再进行绘制。
<a name="oTtQZ"></a>
# Ben Cloward地编课
<a name="ag0Ld"></a>
## 创建地形
UE4官方文档：<br />[https://docs.unrealengine.com/4.27/zh-CN/BuildingWorlds/Landscape/TechnicalGuide/](https://docs.unrealengine.com/4.27/zh-CN/BuildingWorlds/Landscape/TechnicalGuide/)<br />总结：

| **颜色：** | **地形组件** |
| --- | --- |
| **黄色：** | 地形Actor边缘 |
| **浅绿色：** | 地形组件边缘 |
| **中绿色：** | 地形分段边缘 |
| **深绿色：** | 地形单独四边形 |

![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1642250926346-4150f1e9-cecd-4d3c-bec8-3029a6a6e302.jpeg#clientId=u42d9bbbb-1a31-4&from=paste&id=u150b3704&originHeight=474&originWidth=741&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ua131f293-1636-4421-8f98-729735c9e44&title=)<br />使用更少的组件通常可以获得更好的性能。<br />性能注意事项<br />组件大小与组件总数的选择是一种性能上的权衡。较小的组件大小可实现更快的LOD过渡，也可实现更多地形的遮挡，但是组件越小，需要的组件越多。<br />每个组件都有一个渲染线程CPU处理成本，每个分段都是一个绘制调用，所以尽量将这些数字保持在最小值。对于最大的地形，Epic建议最多使用1024个组件。<br />下面是一个单独的组件（其轮廓为绿色），包含四个分段。每个分段由9（3x3）个四边形组成。同样，您可以看到这些分段相交的顶点都是重复的。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1642251311284-3972b111-d6bc-4322-8798-fa23bedef413.jpeg#clientId=u42d9bbbb-1a31-4&from=paste&id=uc18fc317&originHeight=256&originWidth=256&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9d8e54be-ccc4-4d82-9a80-4818cd14581&title=)<br />如果我们从包含64x64个顶点的单个分段组成的组件开始，那么组件的大小就是63x63个四边形。假设我们有一个由10x10个这些组件组成的地形，那么地形中总共有630x630个四边形。现在，如果我们想要导入这样一个地形的高度，我们必须有一个有631x631个顶点的高度图，因为存在的顶点总是比四边形多一行（想象一个1x1四边形 - 它需要4个顶点）。因此631x631是一个有效的地形大小。<br />为了让事情变得更简单，这里有一些尺寸可以用于在最大化面积的同时最小化地形组件的数量。

| **整体大小（Overall Size）（顶点）** | **四边形 / 分段（Quads / Section）** | **分段 / 组件（Sections / Component）** | **组件大小（Component Size）** | **组件总数（Total Components）** |
| --- | --- | --- | --- | --- |
| 8129x8129 | 127 | 4 (2x2) | 254x254 | 1024 (32x32) |
| 4033x4033 | 63 | 4 (2x2) | 126x126 | 1024 (32x32) |
| 2017x2017 | 63 | 4 (2x2) | 126x126 | 256 (16x16) |
| 1009x1009 | 63 | 4 (2x2) | 126x126 | 64 (8x8) |
| 1009x1009 | 63 | 1 | 63x63 | 256 (16x16) |
| 505x505 | 63 | 4 (2x2) | 126x126 | 16 (4x4) |
| 505x505 | 63 | 1 | 63x63 | 64 (8x8) |
| 253x253 | 63 | 4 (2x2) | 126x126 | 4 (2x2) |
| 253x253 | 63 | 1 | 63x63 | 16 (4x4) |
| 127x127 | 63 | 4 (2x2) | 126x126 | 1 |
| 127x127 | 63 | 1 | 63x63 | 4 (2x2) |

默认创建的地形的密度是1m×1m的，为了增加地形的密度而获得更多的细节可以通过重设大小通过重采样将256×256方块的地形采样到之前创建的地形上来增加地形密度。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642251842374-2c9e3b8d-c066-4a68-8710-a8e9e7bf7ce8.png#clientId=u42d9bbbb-1a31-4&from=paste&height=317&id=uf4977827&originHeight=317&originWidth=559&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69528&status=done&style=none&taskId=ua23b3d61-de90-4a4c-90c9-3e56bd98b3b&title=&width=559)<br />采样前：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642252084036-39df2890-3ddf-417a-8f94-5bed8c30dc68.png#clientId=u42d9bbbb-1a31-4&from=paste&height=565&id=u52856789&originHeight=565&originWidth=566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210052&status=done&style=none&taskId=u0aec9ca6-eb65-4999-9ee7-e315798e21c&title=&width=566)<br />采样后：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642252106289-f66200f0-30cb-40b5-8758-168186f63eb7.png#clientId=u42d9bbbb-1a31-4&from=paste&height=537&id=ufbf8cd13&originHeight=537&originWidth=569&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18762&status=done&style=none&taskId=u432de124-5e31-4e49-b2b8-465b7488d1f&title=&width=569)<br />这样会导致密度增加的非常恐怖。<br />可以通过设置地形的LOD分布优化一下<br />原来的LOD分布：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642252228425-f774e8e3-5c2d-4bfa-8def-6f0dbb77baf9.png#clientId=u42d9bbbb-1a31-4&from=paste&height=131&id=u7aeb842f&originHeight=131&originWidth=325&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6648&status=done&style=none&taskId=u16216f6c-cb0f-467c-9dd6-0f1bd439475&title=&width=325)<br />更改后的LOD分布：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642252265900-747266fb-cc30-4abe-879c-37c99bb3fbe7.png#clientId=u42d9bbbb-1a31-4&from=paste&height=115&id=u2258ef3b&originHeight=115&originWidth=294&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5705&status=done&style=none&taskId=u5af26956-a76b-4fb2-b866-be285d7f634&title=&width=294)<br />拉远镜头时密度很小，但是当镜头近的时候密度会变大。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642252288328-9cace684-819d-4e7b-86c4-b4f9c5c65d61.png#clientId=u42d9bbbb-1a31-4&from=paste&height=508&id=uc149a659&originHeight=508&originWidth=582&originalType=binary&ratio=1&rotation=0&showTitle=false&size=141422&status=done&style=none&taskId=uc03d51cf-6706-49b1-b196-7cd42b6270f&title=&width=582)
<a name="sQ5ll"></a>
## 地形贴图
因为制作地形材质需要的贴图数量很多，因此可以把Color和Roughness合并成一张贴图，后缀简称CR，RGB使用Base Color，A通道使用Roughness贴图。 然后法线贴图和AO贴图和Height贴图合并成一张贴图简称NOH。<br />合并过程：<br />SD中：<br />其中AO与Cavity贴图混合的方式为正片叠底。要想获得Cavity贴图需要在Bridge的下载设置中勾选![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642342948276-e0455f31-d3f5-4d46-8700-d86b88d6c86e.png#clientId=u7a0a6a04-b34e-4&from=paste&height=118&id=u51b375c2&originHeight=118&originWidth=445&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4517&status=done&style=none&taskId=u8b28d60c-d07c-4305-81f8-8ea43b68672&title=&width=445)<br />其中一些贴图需要更改颜色模式![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646098207803-bb4109c8-5891-4951-a6b9-cc7b803a5779.png#clientId=uda092ed3-089c-4&from=paste&height=118&id=u7d1fe1a4&originHeight=118&originWidth=359&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2661&status=done&style=none&taskId=u439d5081-f5e5-4442-be94-cb338369e45&title=&width=359)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646097846153-2d6ccbb3-f469-4978-a35a-f151f1343c3a.png#clientId=uda092ed3-089c-4&from=paste&height=859&id=uec2465f0&originHeight=859&originWidth=573&originalType=binary&ratio=1&rotation=0&showTitle=false&size=185604&status=done&style=none&taskId=u146ef88a-9cb2-4d72-b96c-3da7b0d7333&title=&width=573)<br />制作好后导出贴图并导入UE4中<br />贴图压缩设置：NOH贴图使用BC7压缩设置并且取消srgb<br />贴图准备好以后开始制作地形材质。
<a name="Go6Ac"></a>
## 地形材质
首先先看一下地形贴图在材质编辑器中的设置：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642405039355-936c1d79-afc2-4c37-bae1-0e7e3160f477.png#clientId=udec924ca-7c97-4&from=paste&height=955&id=ue19b6343&originHeight=955&originWidth=1396&originalType=binary&ratio=1&rotation=0&showTitle=false&size=304170&status=done&style=none&taskId=u8aaba81a-43f0-42e5-939b-023a54d3d6e&title=&width=1396)<br />转换成材质函数：其中法线求B通道的方法改成了附加0.4并规范化，这样做的目的是达到差不多的效果并使材质性能消耗变得便宜一些。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642405668735-62e45ccf-2616-4030-a404-249d1730801e.png#clientId=udec924ca-7c97-4&from=paste&height=975&id=u328eda32&originHeight=975&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=212649&status=done&style=none&taskId=u063acc08-47a4-49d5-9f36-b80196204b0&title=&width=1278)<br />因为制作地形材质需要将很多个跟地形相关的材质进行混合，为了主材质的简单，利用这个材质函数再创建一个材质函数。只需要输入贴图纹理对象和贴图UV缩放数值（1m*1m的材质对应准确UV缩放大小为100），然后就能输出材质和高度图：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642422079160-e856b0f4-72fb-4fa6-9bc1-63daf84be814.png#clientId=udec924ca-7c97-4&from=paste&height=1148&id=uc99349ff&originHeight=1148&originWidth=1594&originalType=binary&ratio=1&rotation=0&showTitle=false&size=260939&status=done&style=none&taskId=uf4af46a9-07e4-47a2-9a0d-ceb73e32b3d&title=&width=1594) 接着利用这个Mat材质函数创建对应的单一地形材质函数：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642422405872-f6b9abd7-3a0d-4c8f-8fd9-1b2d8d902cc3.png#clientId=udec924ca-7c97-4&from=paste&height=560&id=ufa402a98&originHeight=560&originWidth=746&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128735&status=done&style=none&taskId=u7dfae834-521c-4fc1-ac06-1cf5c083e4c&title=&width=746)<br />一共有6个材质函数代表6个单一地形材质。对应的贴图UV缩放大小为![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642422553459-d9ea9f8a-c221-4d7e-9eeb-0d7323273c9e.png#clientId=udec924ca-7c97-4&from=paste&height=516&id=u50ebd9fd&originHeight=516&originWidth=263&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66282&status=done&style=none&taskId=uecf4ae90-f666-4ee0-8123-5416b3f12bf&title=&width=263)83，89，127，97，101，241.<br />最终地形材质：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642422601461-f71464a4-833f-4810-b9b0-4a0c502389d6.png#clientId=udec924ca-7c97-4&from=paste&height=891&id=u4c6c8b50&originHeight=891&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&size=225822&status=done&style=none&taskId=u6865b9f8-6590-42c3-9f7a-9537a56cf69&title=&width=1092)<br />其中Layer Blend节点中除了第一个混合模式为透明度混合，其余都用高度混合。这样的作用时防止绘制时出现黑斑。<br />虽然这个地形材质可以用了，但是有严重的地形贴图重复率。接着来改进这个地形材质。
<a name="DG0Cd"></a>
## 修正重复

修正重复度的方法有四种，首先介绍一下使用的蒙版贴图和第一种方法。<br />Mask贴图三通道混合程度从小到大<br />R通道![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642427863642-c72944d9-9263-49e9-9535-08f077aa47c3.png#clientId=udec924ca-7c97-4&from=paste&height=517&id=uee3110e9&originHeight=517&originWidth=519&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88973&status=done&style=none&taskId=udc9ab9e9-893f-49ed-ba29-43105b25856&title=&width=519)<br />G通道![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642427899060-55c4ba0b-a4a2-4c59-a9fc-e9cf9c65d61f.png#clientId=udec924ca-7c97-4&from=paste&height=522&id=ubc1dc340&originHeight=522&originWidth=518&originalType=binary&ratio=1&rotation=0&showTitle=false&size=124418&status=done&style=none&taskId=u22327335-9ea7-46ee-8009-d650ae51a0c&title=&width=518)、<br />B通道![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642427915447-98d23981-8c4e-4f9f-8b37-76702f0ad771.png#clientId=udec924ca-7c97-4&from=paste&height=518&id=u98dce2b2&originHeight=518&originWidth=521&originalType=binary&ratio=1&rotation=0&showTitle=false&size=198645&status=done&style=none&taskId=u6b62b29f-4c25-44e8-997c-e08073acd7f&title=&width=521)<br />RGB图![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642427960531-c3737da5-4230-4bb2-bf87-7db41ed5370c.png#clientId=udec924ca-7c97-4&from=paste&height=522&id=u791fae2b&originHeight=522&originWidth=523&originalType=binary&ratio=1&rotation=0&showTitle=false&size=269766&status=done&style=none&taskId=u99ee7cd6-0175-4314-b632-d67f6910d57&title=&width=523)
<a name="EgL6q"></a>
### 第一种方法
通过将相同的贴图进行旋转后再混合,可以通过swizzle节点来使贴图XY通道数值交换输出充当贴图UV达到旋转的效果（但是使用swizzle节点不只是使贴图旋转还会镜像贴图（因此后面会将法线贴图XY通道交换来得到正确的法线效果））。<br />更改之前做的单一地形材质函数。<br />之前的：<br />![](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642422079160-e856b0f4-72fb-4fa6-9bc1-63daf84be814.png?x-oss-process=image%2Fresize%2Cw_750%2Climit_0#from=url&id=HeHkb&originHeight=540&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />更改后：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642668637582-778388ca-fd16-44a9-b150-6fc92e3050a2.png#clientId=u5a97b1bf-4917-4&from=paste&height=1428&id=uc2d67b0f&originHeight=1428&originWidth=2721&originalType=binary&ratio=1&rotation=0&showTitle=false&size=560134&status=done&style=none&taskId=ue37b4d27-072c-4181-90d4-42b7754fbf9&title=&width=2721)<br />就是简单的通过mask将旋转前和旋转后的贴图混合了。来得到更多样化的贴图。(这里mask贴图连接错了应该连接B通道。)<br />但是这样还是不够的,接下来利用第二种方法。
<a name="JWvqV"></a>
### 第二种方法
利用CameraDepthFade节点控制远处贴图。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642680444941-40425541-8511-4119-ab63-7cb5104886b2.png#clientId=u5a97b1bf-4917-4&from=paste&height=1924&id=u963e1fa9&originHeight=1924&originWidth=2968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=870514&status=done&style=none&taskId=uf596e6cc-46ba-4a81-b574-40274e9cd14&title=&width=2968)<br />CameraDepthFade：作用是通过相机距离得到黑白蒙版（离得远的输出白色离得近的输出黑色）<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642670334188-3fc6330b-7550-4d75-9240-176068c93dab.png#clientId=u05a888fa-14ae-4&from=paste&height=110&id=ucfdb74fa&originHeight=110&originWidth=218&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15217&status=done&style=none&taskId=uad60a374-9ce2-40da-b349-7d863a535e3&title=&width=218)第一个FadeLength控制的是开始产生白色向黑色渐变的距离，例如输入2000，那么当模型距离摄像机距离达到2000后就开始产生变黑的渐变。第二个Fade Offset控制的是完全变成黑色时的距离大小，当距离达到Fade Offset的大小后就完全变成黑色。<br />这个多添加的方法作用是离摄影机距离近的使用标准UV的贴图，而距离远的就使用大贴图。<br />好处是都使用同一组贴图不会产生额外的纹理内存。<br />但是这种方法使其看起来不真实。因此通过第三种方法改进
<a name="yGowO"></a>
### 第三种方法
为了让远处的大贴图不那么单调，因此通过sd来处理贴图，并通过Make it tile patch节点使纹理平铺并打乱纹理。<br />Make it tile patch节点属性：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1642682132795-703001df-ea6d-429a-a723-4cd50cd060f9.png#clientId=u5a97b1bf-4917-4&from=paste&height=539&id=u50fe484c&originHeight=539&originWidth=475&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10009&status=done&style=none&taskId=u36c1763a-a81f-4d34-92ed-efb3b4d7685&title=&width=475)<br />SD连接图：利用了两个substance图形，可以将这些理解为材质函数加入输入和输出就可以当节点来使用<br />分别是![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643021258779-693bfa5b-aae4-4e57-8751-7f0ef9853e71.png#clientId=u8470106e-dd9c-4&from=paste&height=92&id=u891b3da8&originHeight=92&originWidth=229&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4171&status=done&style=none&taskId=u84cac164-a134-4fe8-a7ba-7ab3cc71f51&title=&width=229)<br />MakeCRNOH作用跟利用SD生成地形贴图的方法是一样的<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643021379439-0e3804ae-b5ff-4333-a184-d1c4c8a5e40d.png#clientId=u8470106e-dd9c-4&from=paste&height=883&id=u1386e272&originHeight=883&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80784&status=done&style=none&taskId=u3c7f2ce3-1fb9-49f5-ab56-1f5d79b7c2a&title=&width=779)<br />MaterialScrambie作用是将地形贴图转换成平铺打乱的形式<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643021394673-761b0998-c682-4535-9c97-7ed4fb7bf7ed.png#clientId=u8470106e-dd9c-4&from=paste&height=867&id=u38d376d7&originHeight=867&originWidth=534&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50680&status=done&style=none&taskId=u8d572eff-9c33-4131-ae72-2024ef4dcc0&title=&width=534)<br />最后通过利用这两个substance图形，导入要更改的贴图就可以制作出8×8米的贴图了。最终导出时选择1024*1024的贴图因为是远处的所以不需要用那么高清的贴图了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643021843742-bcfadd37-91f6-4ca0-8fee-c5b4183bf854.png#clientId=u8470106e-dd9c-4&from=paste&height=803&id=u2bc8eee2&originHeight=803&originWidth=818&originalType=binary&ratio=1&rotation=0&showTitle=false&size=321631&status=done&style=none&taskId=u78fb80c7-1f92-4cbb-bbba-65eb41bca63&title=&width=818)<br />然后将输出的贴图替换成第二种方法中新创建的远处贴图就是第三种方法。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026750554-894573fd-439b-42ae-a99c-8af8ccae1248.png#clientId=u8470106e-dd9c-4&from=paste&height=1909&id=u532eeb37&originHeight=1909&originWidth=2964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=945731&status=done&style=none&taskId=u79c47f6e-8edf-41e0-aca3-8dca9cee3f6&title=&width=2964)<br />其中通过在CameraDepthFade后面加一个AppendMany是为了解决UE4无法正确识别格式![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026492866-a547c98e-6dcc-49ac-ac76-46e379b62f69.png#clientId=u8470106e-dd9c-4&from=paste&height=266&id=u71231b3c&originHeight=266&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=164715&status=done&style=none&taskId=u43cb4b70-42f3-4293-89e4-586380e2e5a&title=&width=819)<br />这些材质函数的参数如图所示<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026573058-6b4887eb-f8cc-499e-8954-0325f913e215.png#clientId=u8470106e-dd9c-4&from=paste&height=784&id=ufe875244&originHeight=784&originWidth=1006&originalType=binary&ratio=1&rotation=0&showTitle=false&size=232108&status=done&style=none&taskId=u6ab6999d-780e-482d-8fba-52ab7d93948&title=&width=1006)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026584223-690b82ae-a0b5-4349-9186-a74e61630db0.png#clientId=u8470106e-dd9c-4&from=paste&height=784&id=ue149f14c&originHeight=784&originWidth=874&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235840&status=done&style=none&taskId=u6792dae0-c371-4dd9-92ee-3d943417306&title=&width=874)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026589536-91433277-97b0-4494-88c3-bfe57658f7bb.png#clientId=u8470106e-dd9c-4&from=paste&height=768&id=u57afbcb6&originHeight=768&originWidth=842&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222746&status=done&style=none&taskId=ubc1efdbd-fc73-42b1-90d8-e5c63e4f94a&title=&width=842)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026595605-1be803e7-4af3-41cc-ad1a-d5790481838a.png#clientId=u8470106e-dd9c-4&from=paste&height=768&id=u6122eea4&originHeight=768&originWidth=906&originalType=binary&ratio=1&rotation=0&showTitle=false&size=230102&status=done&style=none&taskId=u829921dd-d51f-4c88-8811-49507c1aa3a&title=&width=906)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026601114-6b490b39-b680-477d-ae01-9d5d756fd2c4.png#clientId=u8470106e-dd9c-4&from=paste&height=768&id=udf536796&originHeight=768&originWidth=970&originalType=binary&ratio=1&rotation=0&showTitle=false&size=237935&status=done&style=none&taskId=ud8801e81-395c-4119-8243-fde6cbccc83&title=&width=970)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643026606845-3f387d62-1fb1-4972-a34e-a58e36319242.png#clientId=u8470106e-dd9c-4&from=paste&height=784&id=u7d9a4b24&originHeight=784&originWidth=974&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239592&status=done&style=none&taskId=u6ff75221-c39d-42cb-b3da-0906adf8f53&title=&width=974)
<a name="QZ2dQ"></a>
### 第四种方法
在最终的地形材质中加一个全局mask来控制![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643029355716-1ea1d634-f7a7-41ee-ae3c-cf3d54c910ee.png#clientId=u8470106e-dd9c-4&from=paste&height=576&id=u24072d59&originHeight=576&originWidth=613&originalType=binary&ratio=1&rotation=0&showTitle=false&size=436504&status=done&style=none&taskId=uaad6cb10-72ef-4ed8-8ed0-2c3c31e9c74&title=&width=613)<br />注意这张贴图是带有一些颜色的，但是他们的RGB数值都在0.5左右，RGB通道的数值有些微差别，但是在UE4中要将他们的压缩设置改为BC7并且取消srgb<br />通过这张MASK贴图使地形不同地方出现些许的颜色变化，<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643029534306-36cf43dd-f79b-4fb9-b2a9-0027051257d7.png#clientId=u8470106e-dd9c-4&from=paste&height=1278&id=ua03fead2&originHeight=1278&originWidth=1620&originalType=binary&ratio=1&rotation=0&showTitle=false&size=405576&status=done&style=none&taskId=u51fe19bd-6275-4d33-91a7-e080eaba2e6&title=&width=1620)<br />将这四种方法结合起来为最终的降低重复度方法。
<a name="cIev7"></a>
## 近景位移贴图
因为虽然绘制地形材质后的法线能够起到的效果已经很好了，但是依然使地形看起来十分的平坦，因为地形的线框不够多。所以为了修复这点，首先将靠近相机的三角形细分，然后根据height贴图来偏移顶点。<br />要增加地形的细分首先需要在材质面板中![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643288230333-885c62f5-39da-42dc-b236-87259e7f3c6d.png#clientId=ua466f464-931b-4&from=paste&height=139&id=u22d7c6bb&originHeight=139&originWidth=269&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10925&status=done&style=none&taskId=u4716c732-57e4-4d6d-8861-b05e37b4ca6&title=&width=269)Ben佬没有开无裂纹置换但是我觉得应该勾选比较好。<br />为此使用材质函数来创建这些功能：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643290814023-8c1f5b8e-8500-4c33-a76b-5bcd4a741247.png#clientId=u9d1d03da-d541-4&from=paste&height=918&id=u04f6e02b&originHeight=918&originWidth=1933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=306153&status=done&style=none&taskId=u1f52f28b-2305-434c-acf4-60ae3aa79b8&title=&width=1933)<br />最终地形材质：利用材质函数输出到细分乘数与世界场景位移<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643288922671-d2ebb3b0-3d89-43bb-88d7-55211febb117.png#clientId=ua466f464-931b-4&from=paste&height=1858&id=u659d2255&originHeight=1858&originWidth=1937&originalType=binary&ratio=1&rotation=0&showTitle=false&size=651868&status=done&style=none&taskId=u38a7173e-201d-4be7-97bc-f89b7eec638&title=&width=1937)<br />实现的效果：近距离的地形材质不再看起来那么平坦了<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643288865780-0980aa49-9848-48a9-bd68-44a7a01ad8e5.png#clientId=ua466f464-931b-4&from=paste&height=342&id=u191029fa&originHeight=342&originWidth=650&originalType=binary&ratio=1&rotation=0&showTitle=false&size=446338&status=done&style=none&taskId=u655fa8e4-3a4a-46a4-8bac-71d7a8d3422&title=&width=650)<br />这种增加细分的行为会带来性能压力，谨慎使用以及参数的控制。
<a name="Tl2dN"></a>
## 植物编辑模式介绍和资产准备
植物编辑模式中常用的就不多介绍了，介绍一下有用的但不常用的。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643356795202-e55d6dd5-d74a-4fd8-aa06-8f27178fa767.png#clientId=u7ef93437-b075-4&from=paste&height=100&id=udd168ea8&originHeight=100&originWidth=340&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9644&status=done&style=none&taskId=u5ec70ee0-7d5a-40e0-9893-4f8844ac8a0&title=&width=340)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643357090303-1583ebb8-057f-4d65-a9c3-e22f087a9c9d.png#clientId=u7ef93437-b075-4&from=paste&height=85&id=uca4a51a3&originHeight=85&originWidth=524&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31398&status=done&style=none&taskId=ue48097d0-33a2-430e-95f4-3e2c8e1ae6f&title=&width=524)剔除距离决定了模型在离摄像机多远的距离时会被剔除掉不显示。将资产的剔除距离更改为不完全相同可以使资产不同时消失。<br />还有可以单独设置绘制的模型是否投射阴影。如果一些小模型的阴影在其他大型模型的阴影之下那么就就可以取消小模型的投射阴影。这样可以节省很多性能。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1643356840762-edee10da-dc4c-4a88-8ef2-68b54b51c6a9.png#clientId=u7ef93437-b075-4&from=paste&height=77&id=ub9de9fe0&originHeight=77&originWidth=238&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6433&status=done&style=none&taskId=uaca20107-2292-4680-8da3-2154e2c4907&title=&width=238)可以在模型中确定是否接收贴花，默认是不接收贴花的，但是手动摆放的那些模型是默认接收贴花的。
<a name="mlB1k"></a>
### 重应用工具
![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1643355945209-50fda06b-e900-42c7-a4c3-ed0b584ce121.jpeg#clientId=u7ef93437-b075-4&from=paste&id=uae737dc0&originHeight=94&originWidth=94&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u5477e593-dbc3-414c-91f7-819fb5eebd8&title=)<br />利用重应用工具可选择性地修改已放置在场景中的植被网格体的特定参数。 用启用的重应用工具在植被网格体上进行绘制时，在网格体列表中选中的植被网格体将更新，以反映在重应用工具中进行的修改。<br />[![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1643355945259-475bd11d-143a-496b-9ce0-51d288690734.jpeg#clientId=u7ef93437-b075-4&from=paste&id=ue909b58f&originHeight=1700&originWidth=913&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u36cc5100-646e-4a0e-9a66-7b1f2b1241e&title=)](https://docs.unrealengine.com/4.27/Images/BuildingWorlds/Foliage/Foliage_Reapply.png)<br />设置复选框后，在现有实例上绘制笔刷时将重新应用相应的参数。 使用绘制工具时多数设置均相同，然而也存在几点不同：

| **项目** | **描述** |
| --- | --- |
| **网格体** | 在此处输入要使用的静态网格体类型。 |
| **绘制** | 可在此处覆盖将植被网格体添加到关卡时要发生的情况。 |
| **放置** | 可在此处覆盖植被网格体放置在关卡中的方式。 |

<a name="OJYOZ"></a>
### 剔除
因为植被实例在单次绘制调用中被渲染为群集，所以每个群集将基于遮挡被渲染（或不被渲染）。如在 **结束剔除距离** 参数中设置了一个值，则超过此距离的群集也将被剔除。然而，此项将导致网格体分组因整个群集超出范围而突然消失。<br />添加一个 **开始剔除距离** 参数并正确设置材质即可解决此问题。 在顶点着色器中将计算一个逐实例淡化因子，其在开始距离处为1.0、结束距离处为0.0。 可使用 **PerInstanceFadeAmount** 节点在材质中进行访问。 如将此连接到一个不透明度或遮罩值，则可将其用于淡化一定距离之外的距离（在其到达 **剔除距离结束** 并从渲染中被移除之前）。<br />下方的材质范例将材质遮罩与淡化因子相乘，以弱化植被网格体的叶片，直到其完全消失。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1643357113342-9e3e6b01-1a96-4578-84ce-0a561a479505.jpeg#clientId=u7ef93437-b075-4&from=paste&id=ude8cfc9c&originHeight=1022&originWidth=1397&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ube4b037a-149f-4a33-8171-9c925dd82d0&title=)
<a name="u9zWK"></a>
### 资产
Bridge石头：<br />[https://quixel.com/assets/tllhcelva](https://quixel.com/assets/tllhcelva)<br />[https://quixel.com/assets/tlljeeyva](https://quixel.com/assets/tlljeeyva)<br />[https://quixel.com/assets/tliiadmva](https://quixel.com/assets/tliiadmva)<br />模型要LOD1 3 4 5 ，导出的LOD1<br />草使用4K的贴图其他的树干树桩和石头使用2k贴图即可<br />导入商城资源后，如果要摆放资产需要编译，因此为了能够保证摆放资产的流畅性推荐先将资源的地图打开，打开后电脑就会编译整个地图，这样在所有紫衫编译完后就可以流畅操作了。<br />树木：[https://www.unrealengine.com/marketplace/en-US/product/interactive-spruce-forest](https://www.unrealengine.com/marketplace/en-US/product/interactive-spruce-forest)云杉树![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645853713958-3b0a317e-44af-4961-96f7-b877ff07314f.png#clientId=u3675ee11-97da-4&from=paste&height=502&id=uc221ff58&originHeight=502&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=496349&status=done&style=none&taskId=u7cda1965-c6e9-4395-b79d-1d30ab4201d&title=&width=976)


大石头：<br />[https://quixel.com/assets/pkeeM](https://quixel.com/assets/pkeeM)<br />[https://quixel.com/assets/pjtsT](https://quixel.com/assets/pjtsT)<br />[https://quixel.com/assets/pjEr1](https://quixel.com/assets/pjEr1)<br />[https://quixel.com/assets/pkjsK](https://quixel.com/assets/pkjsK)<br />[https://quixel.com/assets/pkjsG](https://quixel.com/assets/pkjsG)<br />[https://quixel.com/assets/pjAxm](https://quixel.com/assets/pjAxm)<br />树干和草：<br />[https://quixel.com/megascans/home?assetId=tjsicjffa](https://quixel.com/megascans/home?assetId=tjsicjffa)<br />[https://quixel.com/megascans/home?assetId=tjrtcibda](https://quixel.com/megascans/home?assetId=tjrtcibda)<br />[https://quixel.com/megascans/home?assetId=rdkeg](https://quixel.com/megascans/home?assetId=rdkeg)<br />[https://quixel.com/megascans/home?assetId=rdeu3](https://quixel.com/megascans/home?assetId=rdeu3)<br />[https://quixel.com/megascans/home?assetId=tg0qedqda](https://quixel.com/megascans/home?assetId=tg0qedqda)<br />[https://quixel.com/megascans/home?assetId=qdyf7](https://quixel.com/megascans/home?assetId=qdyf7)<br />[https://quixel.com/megascans/home?assetId=ti3mdirda](https://quixel.com/megascans/home?assetId=ti3mdirda)<br />[https://quixel.com/megascans/home?assetId=okfch](https://quixel.com/megascans/home?assetId=okfch)<br />[https://quixel.com/megascans/home?assetId=sbslY](https://quixel.com/megascans/home?assetId=sbslY)<br />[https://quixel.com/megascans/home?assetId=seEoW](https://quixel.com/megascans/home?assetId=seEoW)<br />[https://quixel.com/megascans/home?assetId=tefocd1r](https://quixel.com/megascans/home?assetId=tefocd1r)
<a name="ZXuhv"></a>
### 绘制前提推荐以及一些技巧
绘制前可以将要绘制的模型全部都摆放在同一个平面上排列出来，这样就可以方便观察要绘制的模型的大小比例是否正确。还有颜色粗糙度SSS效果等是否符合想要的效果。<br />虽然绘制很方便，但是绘制的一般不如手动摆放的更好，一些前景的大型植物推荐手动摆放。<br />绘制效果：![HighresScreenshot00000.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645872369883-a91e3378-e6f6-40ae-83f0-1e3ea8624e67.png#clientId=ued2f573c-753b-4&from=paste&height=572&id=u5d2f117b&originHeight=572&originWidth=1207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1438719&status=done&style=none&taskId=u1cdb446b-383e-4297-9c0f-049e350ebac&title=&width=1207)<br />接下来将溪水材质赋予到面片中，并且制作从高处向下流的水流。
<a name="GniVQ"></a>
## 溪水着色器
溪水着色器与材质课中讲到的水流着色器差不多，主要区别在于溪水着色器不需要海浪计算，主要依靠flowmap达到想要的水流效果。溪水着色器不需要
<a name="szOj4"></a>
### 流动效果制作
通常我们应该通过流动贴图来配合之前材质课中制作的flowmap材质函数来达到流动效果，但是因为我们想要的流动效果比较简单，就是仅仅需要让水流从平面的X轴的反方向流动，X轴对应的是纹理坐标中的U坐标，因此当U方向的数值增加时采样框向U方向移动形成纹理向U方向的反方向移动的错觉。因此FlowSpeed为负值时河流向X轴负方向移动，FlowSpeed为正值时河流向X轴反方向移动。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645925684899-2ad203f2-6d04-44e8-8c98-b2973fa14cec.png#clientId=u574f2ba5-a129-4&from=paste&height=472&id=u5f468f91&originHeight=472&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=776091&status=done&style=none&taskId=u50ef966b-1dbf-46f5-8609-b9edb56e4e8&title=&width=854)<br />这里参数化的四位数自定义了四个通道名以及默认数值。使R通道负责控制涟漪的大小，G通道负责控制流动的速度，B通道负责平面X轴方向的两端的蒙版大小来使平面衔接更好，A通道负责控制Y轴两端的蒙版大小来控制流水的区域。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645926185035-96505075-a5ab-49b3-a948-8d6c40410d72.png#clientId=u574f2ba5-a129-4&from=paste&height=598&id=ub659c53a&originHeight=598&originWidth=605&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77745&status=done&style=none&taskId=u61770d39-53dc-43d6-82ec-7786c6b1506&title=&width=605)<br />如果直接使用单一的U方向有速度而V方向没有速度![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645930136962-5fb9b4a6-970f-49db-be3c-c787d8635d3a.png#clientId=u574f2ba5-a129-4&from=paste&height=208&id=u3ace08d9&originHeight=208&originWidth=533&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47725&status=done&style=none&taskId=u46a76b98-10e5-4f23-89e5-95f0558e748&title=&width=533)会导致整个河流全部都以相同的速度直线移动，因此通过制作蒙版来使河流移动的有快有慢。<br />蒙版：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645941837638-cc124763-3452-4b99-9117-4d2324b51cad.png#clientId=u4da8d356-351f-4&from=paste&height=239&id=uc8a0ec80&originHeight=239&originWidth=855&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66938&status=done&style=none&taskId=u54b3b209-91b9-430a-a9b5-dc7a503f93f&title=&width=855)<br />这里如果想要容易理解建议从TexCoord拆分成两个通道再合并到一起的方法来理解。因为TexCoord的RG通道分别为从左到右，从上到下的渐变。将他们乘1-x可以得到两端为0中间为0.25的渐变图，然后再进行平方（在遮罩方面平方或三次方以上一般作用都是为了降低对比度。），对RG通道乘以不同的数值来分别控制UV方向的不同蒙版，因为是蒙版只需要0\~1的数值，因此再使用Saturate将它们钳制到0\~1的范围。<br />因为溪水是很多个平面组合而成的，它们都拥有不同的大小，因此将它们的ObjecScale乘以纹理坐标常量就可以得到相同的涟漪大小，最后再通过一个参数来实时控制涟漪的大小，NormalDamping控制涟漪的法线的衰减。<br />这样溪水的流动就做好了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645941817667-4da8240d-773c-44a0-af86-74b8b6505bbb.png#clientId=u4da8d356-351f-4&from=paste&height=1060&id=u05646f61&originHeight=1060&originWidth=1977&originalType=binary&ratio=1&rotation=0&showTitle=false&size=407713&status=done&style=none&taskId=uebbd74d0-3625-480d-b9e5-57aea13d5c7&title=&width=1977)
<a name="Q7h4L"></a>
### 经过各种遮罩叠加最终连线
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645941780041-2e6cf81c-2ac2-479d-9be5-1c337301e42a.png#clientId=u4da8d356-351f-4&from=paste&height=2772&id=ue638f340&originHeight=2772&originWidth=3973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1363234&status=done&style=none&taskId=u11e0fbec-6de2-453b-a445-b3fcc2db2ed&title=&width=3973)<br />**这里有一个细节需要提醒一下，水的高光值是比默认的0.5小的，这里高光值给了0.3。**
<a name="QDWp1"></a>
## 潮湿贴花和焦散贴花
制造潮湿效果的贴花：<br />因为潮湿贴花的作用是将贴花范围内的粗糙度降低来达到潮湿的效果。因此贴花材质的材质属性设置如图所示：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645942547137-9b268813-8e57-4119-a7f2-04aae97764f7.png#clientId=u4da8d356-351f-4&from=paste&height=157&id=u2153e0cb&originHeight=157&originWidth=296&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12416&status=done&style=none&taskId=u4c043543-49cc-4281-8110-4e25062e16f&title=&width=296)<br />主要学习了程序化生成遮罩以及了解了可以通过贴花来影响其覆盖的模型的属性<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645943672730-1659a24a-72ef-4c05-8db1-e44716fbb975.png#clientId=u4da8d356-351f-4&from=paste&height=814&id=ue61a056b&originHeight=814&originWidth=1929&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222079&status=done&style=none&taskId=uebc2c5bd-c3f3-4e82-a8a8-78cb31525d9&title=&width=1929)<br />焦散贴花和材质课的几乎一样改了一下投射纹理大小和自发光强度![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645948214329-1a8a3b94-d628-4602-9491-877eab3daabe.png#clientId=u4da8d356-351f-4&from=paste&height=1061&id=u24e2b286&originHeight=1061&originWidth=3039&originalType=binary&ratio=1&rotation=0&showTitle=false&size=541919&status=done&style=none&taskId=u2946b8b2-9a2c-4f95-92d2-d4dbf50b228&title=&width=3039)
<a name="vRAGf"></a>
## 瀑布着色器
<a name="SlY42"></a>
### 着色器材质属性设置
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646038470398-4cfe139e-1d43-4cd4-903c-472d88375fa4.png#clientId=u010597b5-ed69-4&from=paste&height=109&id=u95f44c24&originHeight=109&originWidth=241&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7340&status=done&style=none&taskId=u1bc2f9fb-eeba-43ff-87d7-ee6eabe072d&title=&width=241)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646038474992-7f7b4454-812a-4f53-9074-7c8af08974d3.png#clientId=u010597b5-ed69-4&from=paste&height=121&id=udc082a9d&originHeight=121&originWidth=279&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11386&status=done&style=none&taskId=uba79c8d6-d1ac-4aff-9209-9d68f0da0f9&title=&width=279)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646038482239-b43d2cd1-1c45-4d71-b39e-2804b550799e.png#clientId=u010597b5-ed69-4&from=paste&height=68&id=ue88e6e97&originHeight=68&originWidth=267&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5241&status=done&style=none&taskId=u8afd2bd9-6cc7-4a53-a403-ee3071df695&title=&width=267)<br />为了制作从上向下流的效果，需要先根据这个高度制作模型片。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645954731252-7cf1dff9-5641-41cc-92a5-4883f6ff4f37.png#clientId=u45d6690b-d952-4&from=paste&height=226&id=u16fe2005&originHeight=226&originWidth=645&originalType=binary&ratio=1&rotation=0&showTitle=false&size=248576&status=done&style=none&taskId=ucfcfe8e3-d5ef-4b94-84c8-ec6fceab664&title=&width=645)<br />所以将上下两个片导出到maya，根据这两个片确定高度，制作出瀑布模型。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645954913237-f944e40a-1803-44c8-bebf-7ee9a8840129.png#clientId=u45d6690b-d952-4&from=paste&height=387&id=u52fa981c&originHeight=387&originWidth=637&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20731&status=done&style=none&taskId=u13f4e8b1-4aa9-449c-90fe-3cd863a8671&title=&width=637)<br />这里在maya中绘制顶点颜色，四周为黑色其余为白色，目的是为了在虚幻引擎中可以直接通过顶点颜色<br />这里在绘制时因为maya的工作方式会导致绘制颜色出现显示问题![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645957397078-f9c8e528-d9ca-401b-952e-fdfa495c36fb.png#clientId=u45d6690b-d952-4&from=paste&height=168&id=ua5c742a5&originHeight=168&originWidth=231&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3005&status=done&style=none&taskId=u7a9a5498-7a7c-4d33-bd4e-48f4720e43b&title=&width=231)因此通过三角化解决显示问题。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645954927625-7ab54c91-84d1-4b0b-944e-22ff4d1cf313.png#clientId=u45d6690b-d952-4&from=paste&height=365&id=ua964a05e&originHeight=365&originWidth=746&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25816&status=done&style=none&taskId=u165c2743-dfe1-4683-8dde-b06cf8ee15c&title=&width=746)<br />将这个模型导出然后导入UE4。进行着色器制作：<br />这里导入到UE4中的操作中，通过![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645962293263-9862ed29-568a-47f1-9814-fe5e895d15b5.png#clientId=u45d6690b-d952-4&from=paste&height=170&id=u3aa6fbf9&originHeight=170&originWidth=310&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13678&status=done&style=none&taskId=uc5d6cde7-b011-4072-821e-3a876384800&title=&width=310)导入可以得到带顶点颜色的王个体，但是在UE4中又出现了这种现象![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645962339150-53da4c3d-4075-4d8f-93a1-58d0072d8250.png#clientId=u45d6690b-d952-4&from=paste&height=327&id=u10e4ef4f&originHeight=327&originWidth=803&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82466&status=done&style=none&taskId=uff88bdae-96cc-4d96-ba84-ed07a6b7f14&title=&width=803)<br />因此干脆将模型文件全部改为这样再导入UE4中。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645962427753-0f5d47de-d8f8-425a-a7ac-75f77f104a91.png#clientId=u45d6690b-d952-4&from=paste&height=319&id=u72133926&originHeight=319&originWidth=740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25689&status=done&style=none&taskId=u320e1e75-6f79-4e59-adf0-f9d3bbb10f4&title=&width=740)
<a name="DM3bM"></a>
### 法线动画
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646030717875-bf07708b-907b-4515-a072-2cf73b90608a.png#clientId=u456c75c4-b091-4&from=paste&height=1000&id=u2fd4b38a&originHeight=1000&originWidth=2136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=388870&status=done&style=none&taskId=ub1b94151-3538-4937-9c6f-68ec8f29226&title=&width=2136)
<a name="bo1Rd"></a>
### 不透明度与折射
不透明度与折射也不太难理解<br />教程中的瀑布不透明度的连接法跟水一样主要思想就是通过菲涅尔来控制不透明度的变化。<br />教程中使用了Fresnel_Function节点，这个节点的功能跟Fresnel节点的功能差不多。并且Fresnel_Function中使用的是VertexNormalWS，教程中使用的是PixelNormalWS是因为想要得到更准确的结果。VertexColor对应了建模时的顶点颜色（顶点颜色也可以通过UE4手动绘制）。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645967156868-b3d59702-6220-487f-aac7-d9ecf1fae867.png#clientId=u2d7ca911-f0d4-4&from=paste&height=537&id=uce7f08f6&originHeight=537&originWidth=1044&originalType=binary&ratio=1&rotation=0&showTitle=false&size=126018&status=done&style=none&taskId=uf44d6ad5-7830-4e91-844f-15f962d75c6&title=&width=1044)<br />折射就是将水的标准折射1.33，和1通过线性插值![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645967169079-ebe8c8d1-7dcf-464e-a00d-7cc07c8ac010.png#clientId=u2d7ca911-f0d4-4&from=paste&height=231&id=u7fe9c7f6&originHeight=231&originWidth=281&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29990&status=done&style=none&taskId=u3ba6eecb-5bd8-4ba8-b041-31684959177&title=&width=281)得到。

目前的全部：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645967292440-7264e40b-680f-4b60-a366-d84c1bad8b92.png#clientId=u2d7ca911-f0d4-4&from=paste&height=1766&id=ubfcb4116&originHeight=1766&originWidth=2499&originalType=binary&ratio=1&rotation=0&showTitle=false&size=660296&status=done&style=none&taskId=udf13d212-5076-4009-90a8-f0f42791feb&title=&width=2499)<br />目前效果：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646025335681-9fd325b2-aeba-4402-a8af-935acc3574d4.png#clientId=u456c75c4-b091-4&from=paste&height=423&id=u7dcec680&originHeight=423&originWidth=629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=502985&status=done&style=none&taskId=uc5c06225-6831-44fe-9ed9-94809b00967&title=&width=629)
<a name="FAC1l"></a>
### 顶点位移动画
在顶点法线方向进行的位移动画：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646026830457-41f694cd-7e21-4fc3-a677-166f13c664c5.png#clientId=u456c75c4-b091-4&from=paste&height=765&id=ua7ff7424&originHeight=765&originWidth=2270&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240334&status=done&style=none&taskId=u8696b315-e6a1-43a3-bb6f-612c6894d7c&title=&width=2270)<br />这里通过WPO_Tilling_U和WPO_Tilling_V得到渐变图，然后加上time节点配合sin使不同区域都对应不同数值（顶点位移），然后叠加上遮罩，以及决定位移的方向以及整体强度最终得到顶点法线方向的顶点动画。<br />在局部坐标X轴处进行的位移动画：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646030753813-c43b063f-8f94-49a3-b7f7-eb6f6870fce4.png#clientId=u456c75c4-b091-4&from=paste&height=643&id=u2eb91210&originHeight=643&originWidth=1665&originalType=binary&ratio=1&rotation=0&showTitle=false&size=194815&status=done&style=none&taskId=u15ba0248-36cc-4d70-857f-e90cf2aa199&title=&width=1665)<br />通过让这两个位移动画加在一起获得最终的顶点动画。
<a name="dnDoG"></a>
### 泡沫
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646038260480-4ac8a7d7-9900-4424-8632-b417ad5166e3.png#clientId=u010597b5-ed69-4&from=paste&height=891&id=u7ea1412e&originHeight=891&originWidth=1813&originalType=binary&ratio=1&rotation=0&showTitle=false&size=318849&status=done&style=none&taskId=uda1048f5-ea77-481f-8f9b-c48edaed703&title=&width=1813)<br />将泡沫贴图通过panner节点进行位移然后（相同的贴图经过不同UV不同panner speed混合可以增加随机度），然后通过顶点颜色来控制泡沫生成的地方。这个泡沫连接到自发光。
<a name="whnhi"></a>
### 总体
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646038433618-dc11e10b-b11b-4ed0-b88b-92f0ad6e52d8.png#clientId=u010597b5-ed69-4&from=paste&height=3929&id=udbcd9d1a&originHeight=3929&originWidth=3278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1609085&status=done&style=none&taskId=u61cab073-4a1c-462f-81c9-b39b44e9baf&title=&width=3278)
<a name="EvoWJ"></a>
## 开放世界地图制作
前言：之前学习的都是通过手绘制作地形，手动绘制植物，手动绘制地形材质。这个系列主要学习通过程序化得到世界地图以及程序化生成植物，根据海拔斜率自动分配不同的材质。
<a name="Es1PT"></a>
### 获得一个地形
<a name="EPvIM"></a>
####  获取并使用真实世界的高度图
首先了解一下虚幻引擎所需要的高度图规格。对于这些参数的东西，都可以通过虚幻文档查询。<br />[https://docs.unrealengine.com/4.27/zh-CN/BuildingWorlds/Landscape/Custom/#heightmapformats](https://docs.unrealengine.com/4.27/zh-CN/BuildingWorlds/Landscape/Custom/#heightmapformats)<br />通过查询虚幻文档以及教程中的解释得到以下几点主要内容：<br />**高度图格式**<br />从第三方程序导出高度图时，只有以下格式才能在UE4中使用。

- 16位灰阶PNG文件
- 16位灰阶.RAW文件，以小端字节排序

如果使用Photoshop来导出高度图，则需要按下图对新图像进行设置： ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2623605/1646039175555-d9018559-a124-486a-bc02-46ecfae7a292.jpeg#clientId=u010597b5-ed69-4&from=paste&id=u2c2b4d8d&originHeight=1397&originWidth=2164&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ude8e72c9-f375-4bfd-91f3-bca3e9d37f4&title=)<br />在第三方应用程序中制作高度图时，**白色** 的值（在所有通道中为255）代表高度图上的最高点；**黑色** 的值（在所有通道中为0）代表高度图上的最低点。
<a name="C547q"></a>
#### 创建地形
再次将虚幻文档建议的地形大小亮出来：

| **整体大小（Overall Size）（顶点）** | **四边形 / 分段（Quads / Section）** | **分段 / 组件（Sections / Component）** | **组件大小（Component Size）** | **组件总数（Total Components）** |
| --- | --- | --- | --- | --- |
| 8129x8129 | 127 | 4 (2x2) | 254x254 | 1024 (32x32) |
| 4033x4033 | 63 | 4 (2x2) | 126x126 | 1024 (32x32) |
| 2017x2017 | 63 | 4 (2x2) | 126x126 | 256 (16x16) |
| 1009x1009 | 63 | 4 (2x2) | 126x126 | 64 (8x8) |
| 1009x1009 | 63 | 1 | 63x63 | 256 (16x16) |
| 505x505 | 63 | 4 (2x2) | 126x126 | 16 (4x4) |
| 505x505 | 63 | 1 | 63x63 | 64 (8x8) |
| 253x253 | 63 | 4 (2x2) | 126x126 | 4 (2x2) |
| 253x253 | 63 | 1 | 63x63 | 16 (4x4) |
| 127x127 | 63 | 4 (2x2) | 126x126 | 1 |
| 127x127 | 63 | 1 | 63x63 | 4 (2x2) |

<a name="aPzYH"></a>
#### 获得高分辨率的高度图
教程中讲了很多种方法，这里就写其中一种。<br />首先进入网站[https://opentopography.org/](https://opentopography.org/)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646048377493-c36cee02-1167-4e1d-84cd-88ef7a3c3e28.png#clientId=u010597b5-ed69-4&from=paste&height=312&id=ued1a0b77&originHeight=312&originWidth=1305&originalType=binary&ratio=1&rotation=0&showTitle=false&size=145097&status=done&style=none&taskId=u8efe5059-e1a6-4ef6-b60a-eb8517ec30c&title=&width=1305)<br />这个网站只能够选择红色区域的高度图，找到想要的区域后通过点击select来框选区域

![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646049018584-a4629f13-b472-4ae5-aa97-4f4609631a5e.png#clientId=u010597b5-ed69-4&from=paste&height=599&id=u648945b8&originHeight=599&originWidth=1314&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1158446&status=done&style=none&taskId=u41349d67-7a30-4a3c-84b5-74bc3aaced5&title=&width=1314)<br />可以通过左下角的标尺推算自己框选区域的大小。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646049055430-8a86cede-b4bb-462f-897c-0a35c97b314f.png#clientId=u010597b5-ed69-4&from=paste&height=126&id=u45459f47&originHeight=126&originWidth=175&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28137&status=done&style=none&taskId=u627ed4d0-a0e6-48e2-89d5-a3ca52dfe6b&title=&width=175)<br />因为要在虚幻4中创建一个8129×8129的地形，因此框选一个8公里×8公里的高度图。<br />框选完成后向下拉找到第二个的光栅点击进去。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646049329988-3fac06f8-dd9f-46b6-afd9-493a19cc9207.png#clientId=u010597b5-ed69-4&from=paste&height=284&id=u54fe1f40&originHeight=284&originWidth=1221&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57780&status=done&style=none&taskId=ue9085f96-acb4-4c82-8fc1-3debc77dd27&title=&width=1221)<br />在弹出的窗口中相比默认选择只需要取消勾选可视化中的从DEM生成山体阴影图像。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646049623484-61f1e7ca-52ce-423b-8b62-821b659891c6.png#clientId=u010597b5-ed69-4&from=paste&height=528&id=ue252b82b&originHeight=528&originWidth=1057&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38024&status=done&style=none&taskId=u7f42473b-83fe-459b-b261-dfa4e1303d6&title=&width=1057)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646049813641-922a5871-f4ca-48bf-bfe0-78a226dc207c.png#clientId=u010597b5-ed69-4&from=paste&height=404&id=u2d3bef68&originHeight=404&originWidth=1301&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33612&status=done&style=none&taskId=ud6bb389c-cb55-4ad2-a12a-09865435dc8&title=&width=1301)<br />为了处理高度图使其能够被虚幻引擎所识别，需要下载一个软件来进行处理。<br />软件的网站连接：<br />[http://www.demenzunmedia.com/home/terresculptor/](http://www.demenzunmedia.com/home/terresculptor/)<br />软件的使用：<br />在打开时的欢迎界面中选择import Terrain<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646050729278-23a1fd54-9549-4130-a738-79f0147a0463.png#clientId=u010597b5-ed69-4&from=paste&height=650&id=u795fb7e4&originHeight=650&originWidth=847&originalType=binary&ratio=1&rotation=0&showTitle=false&size=365297&status=done&style=none&taskId=u1ffdf461-3a59-4dc4-973b-98d6e9a3168&title=&width=847)<br />然后搜索的格式选择Geo TIFF raster imagery<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646050788692-4741d0b7-97e0-4672-b778-16bbd1d56cb6.png#clientId=u010597b5-ed69-4&from=paste&height=154&id=ufd77c882&originHeight=154&originWidth=265&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8773&status=done&style=none&taskId=u6633e6e3-f3d6-4265-a5cc-11829899f7f&title=&width=265)<br />然后找到下载的高度图。<br />读取成功后直接点击ok<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646051381643-4c5de3db-cbb7-490a-a308-1ba68c1e1654.png#clientId=u010597b5-ed69-4&from=paste&height=487&id=u66d7dc38&originHeight=487&originWidth=622&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17359&status=done&style=none&taskId=u0c2f07c6-1e0f-42e2-b9b4-24da171eaa6&title=&width=622)<br />刚开始导入时显示的是一个平的地形，通过更改Y轴的缩放可以查看地形的效果。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646051515145-dff36f48-8f24-400e-ba65-6505fd412aed.png#clientId=u010597b5-ed69-4&from=paste&height=556&id=u7fc7b264&originHeight=556&originWidth=551&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56973&status=done&style=none&taskId=u98702463-cbc8-480c-9ee6-c82a50809b6&title=&width=551)<br />接下来修改地形的分辨率：<br />首先在工具中选择Unreal Engine<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646052083529-0c96823a-e548-4cb2-8640-23a4629bf689.png#clientId=u010597b5-ed69-4&from=paste&height=511&id=ubf718efc&originHeight=511&originWidth=701&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36244&status=done&style=none&taskId=ue35c0947-da87-49c7-a0f3-3b1ef915292&title=&width=701)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646051599077-de4fa522-2624-4f50-a6d9-68e87697c915.png#clientId=u010597b5-ed69-4&from=paste&height=550&id=u6d175ec1&originHeight=550&originWidth=293&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34139&status=done&style=none&taskId=u2998be51-4a09-4cfb-ba5b-eea98d0a07d&title=&width=293)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646052438151-c43805af-9444-4c46-9aee-fa33e63b9107.png#clientId=u010597b5-ed69-4&from=paste&height=709&id=uc3659810&originHeight=709&originWidth=932&originalType=binary&ratio=1&rotation=0&showTitle=false&size=160513&status=done&style=none&taskId=u175dac8a-9c2e-4905-b282-8c1963fc683&title=&width=932)<br />可以选择材质赋予地形预览以下效果<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646052570096-8448f222-f1c9-4a6f-8255-b922026ecf61.png#clientId=u010597b5-ed69-4&from=paste&height=590&id=uf053eabd&originHeight=590&originWidth=554&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40108&status=done&style=none&taskId=u02c1da02-034d-446f-91d6-086e02fa471&title=&width=554)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646052599332-1f21968b-0744-4dc4-8d24-ffa637e33d81.png#clientId=u010597b5-ed69-4&from=paste&height=726&id=ua748b9ed&originHeight=726&originWidth=1065&originalType=binary&ratio=1&rotation=0&showTitle=false&size=751701&status=done&style=none&taskId=uc9c315a1-acb2-4d2b-89b4-1699aafbb60&title=&width=1065)<br />然后导出成PNG格式16位灰度的高度图。<br />然后导入到虚幻引擎通过高度图新建地形![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646052872826-486bb193-e036-493a-ad66-2168e0dc9b00.png#clientId=u010597b5-ed69-4&from=paste&height=527&id=uf51a89e3&originHeight=527&originWidth=312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45305&status=done&style=none&taskId=uad895a11-6bc0-4a9d-a0c5-cfef92e13bb&title=&width=312)<br />刚开始生成的地形同样具有高度缩放不正确的问题，可以通过调整Z轴方向的缩放大小来解决，如果想要获得严谨正确的缩放大小就去虚幻文档里面看一下，里面有教。
<a name="jRoq2"></a>
#### 地形初始设置
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646055012059-629ba43e-6a1d-4d6b-ac8b-f4d853cb9baf.png#clientId=u010597b5-ed69-4&from=paste&height=109&id=u4989e49a&originHeight=109&originWidth=273&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5631&status=done&style=none&taskId=ucb6d5e95-611c-440a-af00-b893444d29a&title=&width=273)
<a name="Nrmsb"></a>
### 高级地形斜度混合材质
做之前先去bridge下载两个surface<br />[https://quixel.com/assets/ukticbcdy](https://quixel.com/assets/ukticbcdy)<br />[https://quixel.com/assets/tdloaf1r](https://quixel.com/assets/tdloaf1r)<br />下载4k的<br />下载好后按照之前的方法将纹理压缩成CR,NOH的格式<br />转换法线贴图的压缩格式为BC7取消SRGB<br />先按照之前地形材质的做法为其设置UV缩放等参数。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646104939957-7a7d3559-59a2-41e5-85f6-d702ff361a8f.png#clientId=uda092ed3-089c-4&from=paste&height=800&id=u43652aeb&originHeight=800&originWidth=1134&originalType=binary&ratio=1&rotation=0&showTitle=false&size=249904&status=done&style=none&taskId=u0bb698e6-1816-4ce6-a3f9-d654affb328&title=&width=1134)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646102434451-722b1ec2-9bad-4236-b5ee-a956a40a5494.png#clientId=uda092ed3-089c-4&from=paste&height=800&id=u2f280667&originHeight=800&originWidth=974&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239352&status=done&style=none&taskId=ue88781c2-41b6-4533-a84a-56694055a1b&title=&width=974)<br />先介绍一下通过VertexNormal来控制两种地形的混合。看一下整体连接：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646109097680-877f75e2-b75e-4e94-bc3e-3332e581773e.png#clientId=uda092ed3-089c-4&from=paste&height=838&id=ooefA&originHeight=838&originWidth=2086&originalType=binary&ratio=1&rotation=0&showTitle=false&size=243798&status=done&style=none&taskId=u5cfd37c3-0899-4fde-85f3-7a58f41438a&title=&width=2086)<br />解析：<br />混合材质用到了BlendMaterialAttributes这个节点，这个节点的作用是通过蒙版混合两种材质。和之前使用LayerBlend节点不同，LayerBlend作用是使地形可以绘画，这里是程序生成地形材质的。<br />然后介绍一下锐化的理解：锐化就是增加对比度。<br />锐化强度为1：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646109574877-78b202ac-596f-4241-9295-36eb470fa444.png#clientId=uda092ed3-089c-4&from=paste&height=114&id=u4caf7959&originHeight=114&originWidth=131&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16839&status=done&style=none&taskId=u52dbdfbf-6cae-49b2-bb20-08eb28dbcc4&title=&width=131)锐化强度为100时：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646109584689-02acdded-7dc9-4d2c-ab5c-9464cae7655b.png#clientId=uda092ed3-089c-4&from=paste&height=108&id=u6d2a9118&originHeight=108&originWidth=126&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15497&status=done&style=none&taskId=ub8876cd5-69f2-4365-b48a-e7a668d4593&title=&width=126)锐化强度为1000时![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646109752188-c555adc5-d36d-462d-93cc-068e0dc755c9.png#clientId=uda092ed3-089c-4&from=paste&height=100&id=u9525901e&originHeight=100&originWidth=107&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11794&status=done&style=none&taskId=uec646657-9762-4170-90c6-0251642a724&title=&width=107)<br />总结锐化计算就是在数值为0.5的那条线上进行分界，将小于0.5的数值向0趋近，将大于0.5的数值向1趋近。要想好理解可以代入0.505，0.505减0.5后变成0.005再乘上100就变成了0.5再加上0.5就变成了1。<br />除了图中的锐化算法还有一种就是利用Power节点。<br />因为是蒙版所以最终加一个saturate。<br />目前整体：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646111645711-b55b4993-2091-4204-b2da-30c3d049555b.png#clientId=uda092ed3-089c-4&from=paste&height=814&id=u9a60a192&originHeight=814&originWidth=2054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=233572&status=done&style=none&taskId=uae17f7dc-bdc8-4307-9430-4c83676dfaa&title=&width=2054)<br />目前效果：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646111801648-3926d9d7-ceb3-428f-8e88-f533fcb36da3.png#clientId=uda092ed3-089c-4&from=paste&height=497&id=u3f838f91&originHeight=497&originWidth=793&originalType=binary&ratio=1&rotation=0&showTitle=false&size=595770&status=done&style=none&taskId=u53288066-aace-41ae-a523-aa19781abd2&title=&width=793)<br />因为这里看起来就像是雪全部盖在来岩石上面，因此使用PixelNormal可以使计算的数据更大得到的效果更好。（材质课中有讲法线混合）。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646111999983-3d788e42-e6bd-4244-b3f6-a9a7da74f632.png#clientId=uda092ed3-089c-4&from=paste&height=436&id=uf2b7214b&originHeight=436&originWidth=615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=420265&status=done&style=none&taskId=u8184ced8-504e-483c-ae38-7bc50cdf00a&title=&width=615)<br />如果换成使用PixelNormal混合，蒙版：这里不仅将路面混合了而且还将斜面也混合了不少。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646112803604-831163b3-2a3b-4bce-a284-c53ef7ef1001.png#clientId=uda092ed3-089c-4&from=paste&height=473&id=u8be00029&originHeight=473&originWidth=641&originalType=binary&ratio=1&rotation=0&showTitle=false&size=476646&status=done&style=none&taskId=u2f3300a4-097c-4885-9e90-4b04c85f324&title=&width=641)<br />最终选择采用将两者混合使用：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646113055575-5b5be623-6715-44f8-aa30-e5956ff00bba.png#clientId=uda092ed3-089c-4&from=paste&height=441&id=u2dd9c389&originHeight=441&originWidth=530&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283218&status=done&style=none&taskId=u67353b2b-b4eb-4416-8f6a-8d23d192e6e&title=&width=530)<br />但是混合后会出现报错，![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646113134623-6928acc9-6abd-4ffe-8fd3-e6616abf4f62.png#clientId=uda092ed3-089c-4&from=paste&height=800&id=u25dccdd5&originHeight=800&originWidth=1986&originalType=binary&ratio=1&rotation=0&showTitle=false&size=237767&status=done&style=none&taskId=ua72b4897-e07a-4ba0-a53a-eda750b44bc&title=&width=1986)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646113142801-322bdf48-81f9-4af1-bce8-aa63a8bbde1c.png#clientId=uda092ed3-089c-4&from=paste&height=44&id=ufc7d8646&originHeight=44&originWidth=585&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5535&status=done&style=none&taskId=u7a28e0f8-7a01-4c58-97d7-4f9fc09c4c4&title=&width=585)<br />因为不能通过像素法线来混合输入到normal节点中，因此这个BlendMaterialAttributes节点就不使用了，所以我们自己创建一个用来混合材质的材质函数。将其他属性用顶点与像素混合的结果，normal属性只使用顶点法线。<br />创建材质函数前可以先参考一下引擎中自带的一个![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646113592772-ef8957a7-25ba-4897-bbeb-7a52d9713f83.png#clientId=uda092ed3-089c-4&from=paste&height=121&id=u94efa749&originHeight=121&originWidth=261&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16155&status=done&style=none&taskId=u4ebd824c-cb1f-4e97-9a5b-580cd6da471&title=&width=261)将它复制到自己的材质函数中并进行一些修改可以让我们使用。<br />主要修改如下：<br />将之前的一个Alpha输入节点改成了两个Alpha输入节点，其中AlphaPixel用来接收依赖VertexNormal与PixelNormal混合生成的蒙版，AlphaVertex用来接收仅依赖VertexNormal生成的蒙版。<br />然后调整使法线属性和Height的混合使用仅依赖VertexNormal生成的蒙版，其他属性的混合都依赖VertexNormal与PixelNormal混合生成的蒙版。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646120060507-3107a5da-be6a-4b64-8ae5-d4a6f11f93b0.png#clientId=uda092ed3-089c-4&from=paste&height=526&id=u5531bc18&originHeight=526&originWidth=1184&originalType=binary&ratio=1&rotation=0&showTitle=false&size=187329&status=done&style=none&taskId=ufd8bd3e2-6ea9-40b5-848d-c39e54eec47&title=&width=1184)<br />目前整体：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646117837315-1c912785-d08f-471a-994b-8f08a6610fc3.png#clientId=uda092ed3-089c-4&from=paste&height=916&id=ue5fffcaf&originHeight=916&originWidth=2276&originalType=binary&ratio=1&rotation=0&showTitle=false&size=344071&status=done&style=none&taskId=udf4db9cd-357c-4fca-be5e-5dd06d2b5e6&title=&width=2276)<br />看效果：材质混合效果好了很多。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646117891177-bc8c4480-cbe7-4d0c-80d1-f96035c38f24.png#clientId=uda092ed3-089c-4&from=paste&height=464&id=u3776b3d1&originHeight=464&originWidth=847&originalType=binary&ratio=1&rotation=0&showTitle=false&size=714620&status=done&style=none&taskId=u0aeeb8e6-96c2-45b8-994c-0148c6d2f80&title=&width=847)<br />接下来将生成Alpha蒙版整理成材质函数，使其更加美观<br />材质函数名叫：MF_AngleBlendAplha<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646118632559-be46249a-14a3-40ca-ba7c-ac56d967cfdd.png#clientId=uda092ed3-089c-4&from=paste&height=847&id=ufae668ca&originHeight=847&originWidth=1811&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266043&status=done&style=none&taskId=ub7909c53-fa37-400d-b9cc-0f5dd718030&title=&width=1811)<br />再配合之前做的MF_LandscapeDisplacement材质函数(需要开启细分)，目前的全部节点如下：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646119009607-3ed909eb-d794-48f0-80e8-4cfaddff154a.png#clientId=uda092ed3-089c-4&from=paste&height=767&id=u80041881&originHeight=767&originWidth=1256&originalType=binary&ratio=1&rotation=0&showTitle=false&size=194246&status=done&style=none&taskId=uf6e32745-fbf2-4d23-a08a-3370ac89f95&title=&width=1256)
<a name="b2ldZ"></a>
### 高级地形自动材质
基本地形斜度混合材质已经做好了，接下来制作能够通过海拔以及地形斜度的大小来混合更多材质。<br />首先先再bridge下载课程中额外需要的纹理。<br />[https://quixel.com/megascans/home?assetId=ujldajxdy](https://quixel.com/megascans/home?assetId=ujldajxdy)<br />[https://quixel.com/megascans/home?assetId=pjwky20](https://quixel.com/megascans/home?assetId=pjwky20)<br />一个草地一个泥地。<br />依然按照之前的处理地形贴图的步骤处理一下。<br />对应材质参数设置：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646126377860-a6979a47-8ffd-4290-9781-ef9170447f51.png#clientId=uda092ed3-089c-4&from=paste&height=784&id=ua64534ce&originHeight=784&originWidth=1006&originalType=binary&ratio=1&rotation=0&showTitle=false&size=229317&status=done&style=none&taskId=u439c8850-8a72-4add-931c-69cf9376c14&title=&width=1006)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646126478173-46775754-1a96-496e-8d19-8df435ea3625.png#clientId=uda092ed3-089c-4&from=paste&height=713&id=uba03eb7d&originHeight=784&originWidth=1002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=219223&status=done&style=none&taskId=ub32a383d-0470-476b-82af-aac9ad0b292&title=&width=910.9090711656685)
<a name="x8p9S"></a>
#### 海拔高度混合
这个材质又多利用了一个节点![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646121480273-321efcc0-4469-4f91-be9a-e8654955babb.png#clientId=uda092ed3-089c-4&from=paste&height=134&id=ue3009729&originHeight=134&originWidth=167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11746&status=done&style=none&taskId=ud4e4ca79-5d53-4299-b1ed-4e05c6ac8a9&title=&width=167)这个节点的作用是根据Alpha的数值与Min和Max进行对比，趋向于Min就趋向于0，趋向于Max就趋向于1.<br />可以利用这个节点创建根据地形的海拔高度而产生的蒙版。<br />Min设置为地形Z轴最低数值，Max设置为地形Z轴最高数值，Alpha连接世界位置后得到的：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646124170691-30523c38-babf-4e1b-b010-558b5d0770d9.png#clientId=ub2041b83-99cc-4&from=paste&height=364&id=u509db291&originHeight=364&originWidth=694&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21580&status=done&style=none&taskId=u226316b3-35cc-4645-9604-d561c733697&title=&width=694)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646124409185-b02026d2-adae-4539-9298-ec99f47a3b02.png#clientId=uda092ed3-089c-4&from=paste&height=210&id=uec4eb615&originHeight=210&originWidth=520&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36021&status=done&style=none&taskId=u0bced350-1ba9-422d-882c-f050d185faa&title=&width=520)<br />Min和Max可以通过在地形的最低处和最高处放一个Box来查看<br />这里选择不包括材质偏移应该是因为地形具有根据摄像机于模型距离来增加细分和置换的功能，使用包括材质偏移的绝对世界位置的话会因为绝对世界位置一直在变化而重复计算影响性能。、<br />如果仅仅依靠smoothstep生成的遮罩充当混合时的依靠是不行的，因为这是一个平滑的过程，它是将低海拔的材质慢慢过渡到高海拔的材质，因此还需要一些其他操作。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646131499302-b67ae233-768a-4c56-a056-56c29297055f.png#clientId=uda092ed3-089c-4&from=paste&height=438&id=u10a6eead&originHeight=482&originWidth=986&originalType=binary&ratio=1&rotation=0&showTitle=false&size=107604&status=done&style=none&taskId=uea0b97f1-f272-4237-982d-323578dd29b&title=&width=896.3636169354781)<br />要想让两种材质不仅仅依靠平滑的过渡进行混合，进行如下操作：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646133007373-9e946e25-8da2-4825-8ec6-31aa11ef43fc.png#clientId=uda092ed3-089c-4&from=paste&height=371&id=ubf74852c&originHeight=408&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106849&status=done&style=none&taskId=ua0b86e99-1238-427d-bcea-0041112b88c&title=&width=1060.909067914506)<br />这里Blend_Overlay中的Base和Blend的连接反了，应该SmoothStep连接Base，Moist_Stones连接Blend<br />blend_overlay之前：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646132208786-678dd773-4e77-4635-b4ee-14ebd93f31da.png#clientId=uda092ed3-089c-4&from=paste&height=267&id=u88fc29c5&originHeight=294&originWidth=339&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35827&status=done&style=none&taskId=ud9d8cc3f-fe2b-49c4-be55-d3d7ecdb8e9&title=&width=308.1818115021573)<br />blend_overlay之后：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646132261583-966ddb3b-43cb-4a87-9b8c-937154321016.png#clientId=uda092ed3-089c-4&from=paste&height=226&id=uc59b3cf9&originHeight=398&originWidth=549&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246492&status=done&style=none&taskId=u4bdbc322-ebfb-4909-aa24-fe4edee936e&title=&width=311.09088134765625)<br />相当于混合时多加上了高度。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646132917643-4ef8a984-a60d-49d7-a740-07a2b435f831.png#clientId=uda092ed3-089c-4&from=paste&height=313&id=uabc103ab&originHeight=344&originWidth=454&originalType=binary&ratio=1&rotation=0&showTitle=false&size=290664&status=done&style=none&taskId=u3cdc026d-ca3b-4153-9a5a-6f772665da2&title=&width=412.7272637816502)<br />然后通过cheap_contrast节点增加对比度减少灰色的存在使混合更明显。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646132936633-23bf859d-e974-4008-b425-50c1001d9257.png#clientId=uda092ed3-089c-4&from=paste&height=141&id=uee0ace69&originHeight=155&originWidth=292&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62029&status=done&style=none&taskId=u803adf20-53b7-4e4d-bf06-4486acb0b91&title=&width=265.45453970097327)
<a name="zFpQp"></a>
#### 高度与角度的混合
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646140740380-a1bae642-ef1f-4b3b-a913-a81d5ae4d558.png#clientId=uda092ed3-089c-4&from=paste&height=1321&id=ubc92a0ad&originHeight=1453&originWidth=3597&originalType=binary&ratio=1&rotation=0&showTitle=false&size=914440&status=done&style=none&taskId=ua97c3a25-9cf3-4c1e-8951-0178d546639&title=&width=3269.9999291246604)<br />教程中这些材质混合后再混合 依靠不同蒙版。要学习这个混合功能主要把前面的高度混合和角度混合再仔细看一下就好理解许多了。<br />这里角度混合AngleMult的数值为0时是![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646141081785-e61cc7b3-ca64-4648-8393-af30cf49f9d3.png#clientId=uc44a8ea9-3e91-4&from=paste&height=266&id=u24fa1ee3&originHeight=293&originWidth=318&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86684&status=done&style=none&taskId=u168d524a-d938-4f4c-b027-01392812d44&title=&width=289.0909028250325)，数值增加为正值时就是白色越多，AngleMult为负值时就是黑色越多。意义就是白色越多就代表平坦程度要求越低（AngleMult数值越大），黑色越多就代表平坦程度要求越高（AngleMult数值越小。）平坦程度要求高意思是只有非常平坦的区域才会为白色蒙版区域。<br />这里还有一个巧的点在于通过海拔的高度来控制AngleMult和PixelNormalBlend。<br />就这样混合加混合就都混合在一起了。<br />目前成果：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646142126625-7ace3179-eb14-4fac-b86f-db7dd3883594.png#clientId=uc44a8ea9-3e91-4&from=paste&height=495&id=u91af599e&originHeight=544&originWidth=951&originalType=binary&ratio=1&rotation=0&showTitle=false&size=775082&status=done&style=none&taskId=ua5f2b55c-ce1e-44bf-a0fc-00f9df6abd6&title=&width=864.5454358069369)
<a name="nmdg7"></a>
### 在自动材质上绘制材质
经过刚开始的课程已经知道，要想实现绘制材质就要使用LayerBlend节点利用图层来达到绘制的效果。因此要实现在自动材质上绘制材质的功能可以如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646182997713-03a8e218-2475-4325-bf70-e904c8ac9240.png#clientId=u208596d1-8506-4&from=paste&height=489&id=u5e670bba&originHeight=538&originWidth=1094&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220396&status=done&style=none&taskId=u717d8cf7-92c3-4e14-83bd-f28de532343&title=&width=994.5454329892628)<br />就是将自动的地形材质和有斜度的地形材质和低海拔平坦的地形材质转换成地形图层，然后通过sample得到对应的图层使其能够在绘制的同时将高度信息一起绘制上去。<br />目前整体：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646183479988-e174db0c-12e1-4cf1-9020-65df27785dfb.png#clientId=u208596d1-8506-4&from=paste&height=1379&id=ufaaba6d6&originHeight=1517&originWidth=4045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1126364&status=done&style=none&taskId=u1e55dc1e-481c-4228-ab95-726f3a6ba69&title=&width=3677.272647569989)<br />这里Blend_Overlay中的Base和Blend的连接反了，应该SmoothStep连接Base，Moist_Stones连接Blend<br />更改材质后赋予地形图层就可以了![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646183707380-16179c73-6be5-46a7-949e-ec81e357b148.png#clientId=u208596d1-8506-4&from=paste&height=249&id=u76945cea&originHeight=274&originWidth=286&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35402&status=done&style=none&taskId=u552ea25b-9232-4cfe-97a8-b7839b128b9&title=&width=259.9999943646519)如果没有地形图层就重新指定一下材质
<a name="jiq33"></a>
### 程序化植被
<a name="J1HBS"></a>
#### 资产准备以及基本程序化生成植被的操作
程序化植被功能做之前先了解一下植被的分布，如图所示：草都集中生长在更平坦的地方，有绿色的也有枯草。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646184370619-262a5558-a92d-4ec8-8ca7-d20b85799a44.png#clientId=u208596d1-8506-4&from=paste&height=389&id=u7cf9434c&originHeight=428&originWidth=827&originalType=binary&ratio=1&rotation=0&showTitle=false&size=611270&status=done&style=none&taskId=ucd6fa8b7-02ef-42d9-9ebc-f7b10241de5&title=&width=751.818165522962)<br />先去下载一下需要的草丛（下载2k的）<br />[https://quixel.com/megascans/home?assetId=uddmcgbia](https://quixel.com/megascans/home?assetId=uddmcgbia)<br />[https://quixel.com/assets/rbdoo](https://quixel.com/assets/rbdoo)<br />[https://quixel.com/megascans/home?assetId=uddmcgbia](https://quixel.com/megascans/home?assetId=uddmcgbia)<br />这三个之中有一个是之前做手绘地形时用过的<br />树：树使用之前做手绘地形用过的![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646185000636-afd98137-f9ce-4e74-91bb-0c24eff1b1c0.png#clientId=u208596d1-8506-4&from=paste&height=334&id=uffd758ea&originHeight=367&originWidth=624&originalType=binary&ratio=1&rotation=0&showTitle=false&size=311115&status=done&style=none&taskId=u3317b868-cfb9-40b5-8c4c-76b96115cfe&title=&width=567.2727149774223)<br />先做程序化草：<br />我们已经知道了草生长的区域是低海拔以及平坦的范围之上。因此我们可以让根据海拔生成的蒙版以及根据斜率生成的蒙版结合得到低海拔以及平坦区域的蒙版，然后利用grass节点生成植被。<br />grass节点全名叫LandscaperGrassOutput<br />要使用grass节点需要在内容浏览器中自定义创建一个地形草地类型：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646186026981-906e282b-81a2-4974-a69e-f91879b3623f.png#clientId=u208596d1-8506-4&from=paste&height=156&id=u9027af3e&originHeight=172&originWidth=389&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17725&status=done&style=none&taskId=u36f443f9-b827-4fb8-8063-b1135256a5a&title=&width=353.63635597150204)<br />介绍一下这个地形草地类型：<br />进去后可以通过草地种类可以指定要程序化生成的植被的种类。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646186111882-4053d35d-e5dc-4419-82a3-d6dc292c6c2f.png#clientId=u208596d1-8506-4&from=paste&height=715&id=ufbe655f7&originHeight=786&originWidth=1064&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63403&status=done&style=none&taskId=u243414be-c056-4093-93bc-8717629b532&title=&width=967.272706307656)<br />其中草地密度是以十平方米为单位，**使用网格**的作用就是让植被生成时产生位置抖动使其看起来不那么对齐。<br />其中起始剔除距离以及结束剔除距离的过渡很生硬这里介绍的使用这个剔除距离需要使用PerInstanceFadeAmount材质节点这个在后面介绍，![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646225174518-0527468a-a82b-4ae9-85bf-9a8112f8bbc0.png#clientId=u12e76c12-4131-4&from=paste&height=67&id=ued01552d&originHeight=74&originWidth=529&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12395&status=done&style=none&taskId=u8f563e34-5812-4910-9c82-1a1ed7a7a4a&title=&width=480.9090804856673)然后下面的这些主要看一下要不要进行缩放，要不要接收贴花和投射动态阴影。还有这个Grass节点的使用：<br />要使用grass节点只需要指定草地类型然后将蒙版传给grass节点就可以了，grass节点会自动为蒙版区域生成指定的草地类型![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646187972956-102e3e38-1cdd-43a9-97d7-31b84277f91a.png#clientId=u208596d1-8506-4&from=paste&height=202&id=ub5eca7fe&originHeight=222&originWidth=290&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17341&status=done&style=none&taskId=ufdd64932-aba7-4363-9d0a-8f853b71da2&title=&width=263.63635792219947)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646187925324-7d310985-b029-4b45-8b43-f37bbd022fbe.png#clientId=u208596d1-8506-4&from=paste&height=213&id=u03e7e9d9&originHeight=234&originWidth=590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31592&status=done&style=none&taskId=u24a80454-9874-43e2-baf2-642c41fba8e&title=&width=536.3636247382678)<br />效果：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646188066657-e43ce263-0c78-4085-b1f0-483be0844e73.png#clientId=u208596d1-8506-4&from=paste&height=374&id=u4afd5e54&originHeight=411&originWidth=661&originalType=binary&ratio=1&rotation=0&showTitle=false&size=626127&status=done&style=none&taskId=u0cd62c8a-7b4b-4293-b468-437bd599f25&title=&width=600.9090778847374)<br />教程中的LOD过渡比较明显，但是我的草的过渡不明显。然后发现我的bridge导入到引擎中的资源并没有Billboard的贴图，因此我手动找到billboard的贴图导入到引擎中并指定。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646200179077-b02e128a-f310-4179-8ba8-1773ff9443ce.png#clientId=u208596d1-8506-4&from=paste&height=435&id=u231616d2&originHeight=478&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=119132&status=done&style=none&taskId=u582755ba-0c75-41d7-a2eb-e3e8867dab5&title=&width=681.818167040171)<br />指定后就跟教程中的效果一样了。<br />先了解一下billboard，直译名字叫广告牌。就是这种面片，比如在游戏中平视这种面片时并没有面片的感觉，因为材质效果就是将这些面片会根据观察者的视角自动转换，而造成这种面片是立体的错觉，但是他是有弊端的，那就是当俯视或者仰视时会暴露这是面片。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646200105368-25519895-5722-46bd-bac7-9c92e993be9d.png#clientId=u208596d1-8506-4&from=paste&height=382&id=ud198b5f5&originHeight=420&originWidth=717&originalType=binary&ratio=1&rotation=0&showTitle=false&size=624231&status=done&style=none&taskId=uf040d48f-295c-426d-8b29-48dec5a114a&title=&width=651.8181676904035)<br />接下来进行性能优化以及解决远处广告牌材质的显示问题以及解决过渡生硬的问题。
<a name="YxRoy"></a>
#### 草地种类介绍
**1、草地密度管理<br />**我们可以为一个草地类型增加多个草地种类，为这多种草地设置不同的草地密度以及不同的起始剔除距离与结束剔除距离。通过这样设置可以制造近处，中处，远处的草地种类。使近处的草地密度高多边形密度高投射阴影，中处的草地密度低多边形密度低不投射阴影，依此类推。<br />如图设置：这里提示一下可以通过右键将属性复制粘贴![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646201476821-9e91c865-6139-4aba-ae00-e87461d88372.png#clientId=u208596d1-8506-4&from=paste&height=127&id=uada11ec0&originHeight=140&originWidth=97&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6661&status=done&style=none&taskId=u28a7258b-38f1-458d-a705-7228111bc12&title=&width=88.18181627052878)并且我们手动在这里设置的起始剔除距离以及结束剔除距离需要在材质面板中通过一个节点来使这些参数具备剔除的功能，等下讲。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646201442381-d4edfe53-2a0c-46a6-9ed2-0b1a318120fc.png#clientId=u208596d1-8506-4&from=paste&height=644&id=u3cce9dcb&originHeight=708&originWidth=916&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66058&status=done&style=none&taskId=u2f82557b-3168-4934-8ea6-023c2edfc92&title=&width=832.7272546783955)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646201605027-500464de-c7c5-4a1e-9a31-42d0b61cf2d9.png#clientId=u208596d1-8506-4&from=paste&height=655&id=u1f24cb30&originHeight=721&originWidth=994&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67856&status=done&style=none&taskId=ue7439d81-6093-41ec-970b-0d926b9c689&title=&width=903.6363440505734)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646201657552-99e3b88b-49ab-4d6d-abee-264e5d69f77f.png#clientId=u208596d1-8506-4&from=paste&height=639&id=u992eb426&originHeight=703&originWidth=347&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34035&status=done&style=none&taskId=u7df99bf2-fd2b-42b7-bfb5-cf449517d36&title=&width=315.45453861725247)
<a name="dLK0n"></a>
#### 解决过渡生硬的问题以及增加草的多样性
要想解决这个问题需要对母材质进行更改。<br />教程中是使用了PerInstanceFadeAmount材质节点![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646225174518-0527468a-a82b-4ae9-85bf-9a8112f8bbc0.png#clientId=u12e76c12-4131-4&from=paste&height=67&id=FImIe&originHeight=74&originWidth=529&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12395&status=done&style=none&taskId=u8f563e34-5812-4910-9c82-1a1ed7a7a4a&title=&width=480.9090804856673)<br />将这个节点使用在母材质之中，将这个节点连接到基础颜色之中。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646273421761-29d5dfd2-3bc8-4563-ae31-41c3866d55cb.png#clientId=uaf76222c-30f6-4&from=paste&height=185&id=u4761f8fa&originHeight=204&originWidth=486&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27680&status=done&style=none&taskId=u2b2a1ed4-d084-43f3-97e6-4cf5ae9c8d6&title=&width=441.8181722420308)会看到这些黑色的渐变![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646273406618-24d103ff-feef-4410-879f-a4d52c542b82.png#clientId=uaf76222c-30f6-4&from=paste&height=335&id=ub70159ba&originHeight=369&originWidth=911&originalType=binary&ratio=1&rotation=0&showTitle=false&size=846834&status=done&style=none&taskId=ud8a18b7d-46dd-4b3d-8a1c-f8e8520f493&title=&width=828.1818002314611)<br />但是我自己做的时候并没有这些黑色的渐变，不知道为什么。<br />教程中利用这个节点配合DTAA节点使渐变更顺滑。DTAA的作用就是使像素随着时间的推移混合抖动。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646273595917-f2d5cd93-0b9c-48bd-a69a-80ef9c7d9dec.png#clientId=uaf76222c-30f6-4&from=paste&height=317&id=ua371cf03&originHeight=349&originWidth=1162&originalType=binary&ratio=1&rotation=0&showTitle=false&size=131541&status=done&style=none&taskId=u63713f30-545d-49e0-8229-af651ff7e0e&title=&width=1056.3636134675717)<br />不连接到不透明度是因为使用不透明度消耗性能太高了。<br />**增加草的多样性：**<br />为了增加草的多样性，为草地类型添加多个草地种类，<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646275755792-e774361b-e1b6-4ac5-b7bd-85cc94f336ed.png#clientId=u5bc2b642-bb2e-4&from=paste&height=548&id=u1dfeb254&originHeight=603&originWidth=845&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39842&status=done&style=none&taskId=u6dc92e00-5017-4a49-a495-b34f6521df6&title=&width=768.181801531926)<br />添加不同的草地种类主要是剔除距离有一些区别。
<a name="er8DA"></a>
#### 增加新的草地种类：树
要想程序化生成树，首先要先想树要生长在哪些区域，从真实世界上来看，树一般生长在低海拔的偏陡峭的区域。然后要知道树的生长跟倾斜地形的法线方向是不同的，树生长是直直的向上生长的，因此在地形草地类型中应该取消勾选对齐到表面。<br />这种树这样设置<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282006236-44715c32-feff-41d2-8114-1d8756526183.png#clientId=u5bc2b642-bb2e-4&from=paste&height=600&id=u1b2d12f2&originHeight=660&originWidth=969&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61970&status=done&style=none&taskId=u0272cdce-90e2-448f-b8f0-e18c53e7db9&title=&width=880.909071815901)<br />小一些的植物这样设置。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282038661-eb9a062a-8040-441e-b90d-ca842ab3b125.png#clientId=u5bc2b642-bb2e-4&from=paste&height=571&id=ua39893d4&originHeight=628&originWidth=943&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58172&status=done&style=none&taskId=uf1e3ad24-6679-46d4-8f4d-c94c6356a99&title=&width=857.2727086918417)<br />在Grass节点上面新增加草地类型将蒙版赋予过去![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282061892-205dff25-95f8-4de5-88e3-25e0e55e9204.png#clientId=u5bc2b642-bb2e-4&from=paste&height=272&id=u3d60d18a&originHeight=299&originWidth=303&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20222&status=done&style=none&taskId=ue4fb4df5-587f-4e41-a935-91a72c6d483&title=&width=275.4545394842291)<br />效果：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282282619-8c379c2e-8c81-4ff1-a002-2eab37fb440d.png#clientId=u5bc2b642-bb2e-4&from=paste&height=407&id=ucf8e3485&originHeight=448&originWidth=857&originalType=binary&ratio=1&rotation=0&showTitle=false&size=706910&status=done&style=none&taskId=uef280507-a6c3-4455-aa11-e2b3a4a7665&title=&width=779.0908922045687)<br />整体节点：又把各种地方的蒙版整理解释了一遍。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282341218-397f17b9-9a9c-46ea-8fed-78162326e6ca.png#clientId=u5bc2b642-bb2e-4&from=paste&height=1675&id=u3edde52e&originHeight=1843&originWidth=4045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1290450&status=done&style=none&taskId=ue70d6451-6756-4a21-bfde-00a774c42c6&title=&width=3677.272647569989)
<a name="Pfg5x"></a>
#### 解决广告牌材质的发光问题
![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646282443876-9ec81649-9a79-4dfa-8ff2-a156a23bd750.png#clientId=u5bc2b642-bb2e-4&from=paste&height=289&id=u4540614e&originHeight=318&originWidth=657&originalType=binary&ratio=1&rotation=0&showTitle=false&size=447829&status=done&style=none&taskId=u45b50a8b-3219-45aa-9a1b-48efb1c2ef6&title=&width=597.2727143271899)<br />为了解决这个问题需要对其母材质进行更改，因此将原来的母材质复制一个，将它改造成一个专门应用于广告牌的母材质。<br />先理解一下为什么远处的广告牌材质草的光照会这样，从世界场景法线的缓冲中查看法线远处的草不跟前面的草一样看起来像是朝向我们的。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646283386250-c4219055-c953-4d77-877e-3ded80089b6f.png#clientId=u5bc2b642-bb2e-4&from=paste&height=113&id=u14923e86&originHeight=124&originWidth=247&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79251&status=done&style=none&taskId=ud395ded7-6481-4271-b7b6-4b95c69bfce&title=&width=224.545449678563)所以我们需要自己创建一个专门针对这种面片草创建广告牌材质。<br />创建广告牌材质之前先了解一下引擎为广告牌材质做的材质函数SpeedTreeBillboardNormals![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646283841697-d4254159-7bb1-4c60-8b4f-3360c3b0e36b.png#clientId=u5bc2b642-bb2e-4&from=paste&height=76&id=ua2e12c86&originHeight=84&originWidth=238&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11669&status=done&style=none&taskId=u38636ac2-a9ca-42fd-8fd6-7cf113ad978&title=&width=216.36363167408095)<br />为母材质进行了以下更改：<br />1、将粗糙度统统改为1，将Wind功能删除掉（因为就两个平面，wind功能实际上起不到什么作用还提高了性能消耗），将法线栏的节点重置为如下：<br />首先是使用将法线贴图替换成0，0，1节省资源，然后乘上TwoSideSign使法线在内外两端都为正的，然后利用SpeedTreeBillboardNormals材质函数使法线始终朝向摄像机，最后因为Normal接收的是切线空间的数值，因此利用transform节点进行世界空间与切线空间之间的转换。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646284380161-8fec5da5-0b24-4462-b3b0-f428a8059cf1.png#clientId=u5bc2b642-bb2e-4&from=paste&height=1884&id=u980600e0&originHeight=2072&originWidth=1587&originalType=binary&ratio=1&rotation=0&showTitle=false&size=535711&status=done&style=none&taskId=u8d0cb9b2-8b8b-4db7-82b3-3c1d146dd5a&title=&width=1442.7272414570018)<br />让植物广告牌材质的母材质替换成修改后的母材质后，可以看到法线的效果更好了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646284954303-79de9b93-4fa8-457d-84e2-1da437009d7c.png#clientId=u5bc2b642-bb2e-4&from=paste&height=116&id=uab5976d5&originHeight=128&originWidth=253&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75663&status=done&style=none&taskId=u0696de97-17f8-43e9-8a62-388c7b57fb4&title=&width=229.99999501488438)<br />法线效果的更正解决的是植物的发光问题。现在还需要解决一个的问题就是远处的草颜色太浅了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646285146371-0619d35b-64f3-4120-b381-8a6f18356dd2.png#clientId=u5bc2b642-bb2e-4&from=paste&height=113&id=ud971e9a3&originHeight=124&originWidth=255&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79401&status=done&style=none&taskId=u41e81ece-4e34-4368-b63d-d4587d68804&title=&width=231.81817679365815)要解决这个问题只需要进入材质调节广告牌材质的颜色调暗就可以了。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646285193519-16b4587c-6ae1-43e7-8172-da569db32cc2.png#clientId=u5bc2b642-bb2e-4&from=paste&height=317&id=u11bdfb59&originHeight=349&originWidth=831&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20006&status=done&style=none&taskId=uccd67dc5-91c4-4a0a-b2e2-d8c6d2fe083&title=&width=755.4545290805095)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646285244501-acb96bd3-4663-403a-b314-daf072917e68.png#clientId=u5bc2b642-bb2e-4&from=paste&height=115&id=u8b197ede&originHeight=127&originWidth=289&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82000&status=done&style=none&taskId=u41e985f5-15db-4dcb-b4ed-974d88198b4&title=&width=262.72726703281256)调整后颜色匹配了许多。
<a name="cUXql"></a>
### 使用实时虚拟纹理优化
使用控制台命令stat unit可以增加帧速率计数器提供的信息。输入后![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646286130525-4d5b1c51-5e29-4829-8e78-0b57424310d9.png#clientId=u5bc2b642-bb2e-4&from=paste&height=127&id=zpZdG&originHeight=140&originWidth=156&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46225&status=done&style=none&taskId=u8fa4c2c4-35f8-49b3-b374-09a64c85571&title=&width=141.81817874435558)<br />其中Game和Draw是CPU的工作。<br />统计数据观察性能消耗的主要来源：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646286655545-e16d0289-8fe4-4ff1-afd6-695e34456d5f.png#clientId=u5bc2b642-bb2e-4&from=paste&height=437&id=u1652a5e1&originHeight=481&originWidth=479&originalType=binary&ratio=1&rotation=0&showTitle=false&size=188070&status=done&style=none&taskId=u6639637b-5847-44bc-8302-fc329020f59&title=&width=435.45453601632255)<br />实时虚拟纹理：<br />实时虚拟纹理就是将我们生成的这些树当成纹理，在使用时只需要加载纹理而不需要一个个加载这些网格体了。<br />在项目设置中找到虚拟纹理打开。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646297078747-56e0b5ae-2f51-4d3c-a7f4-d8e6a9c56119.png#clientId=u4f14c30e-baac-4&from=paste&height=199&id=ubd648798&originHeight=219&originWidth=733&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19206&status=done&style=none&taskId=ue9c7de29-d265-4a46-9809-3745438fa45&title=&width=666.3636219205938)<br />打开后需要重新编译一遍，然后将这个![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646302466699-c33949d4-0c1b-48e5-9a40-4b14ec0122f6.png#clientId=u6978505f-af29-4&from=paste&height=112&id=ua7e2fe5c&originHeight=123&originWidth=224&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9957&status=done&style=none&taskId=u0ab155ae-8ff9-4b0b-b2f6-2b6230043cb&title=&width=203.63635922266442)拖入场景，可以在这里设置虚拟纹理对应的Actor以及设置边界以匹配Actor（地形）以及新建运行时虚拟纹理。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303376042-1b17e557-c4ca-4d50-99ee-49aefc932b5f.png#clientId=u6978505f-af29-4&from=paste&height=85&id=u2da6be9a&originHeight=94&originWidth=456&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10499&status=done&style=none&taskId=u20a193e8-b627-4f51-ad44-c5469c5fe57&title=&width=414.545445560424)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303348046-5a371ffd-ed96-423a-afa4-cc01a092b022.png#clientId=u6978505f-af29-4&from=paste&height=515&id=uc4a94095&originHeight=566&originWidth=500&originalType=binary&ratio=1&rotation=0&showTitle=false&size=65243&status=done&style=none&taskId=u80579c2b-0b45-4903-91e3-39b664f926b&title=&width=454.54544469344734)<br />转到材质编辑器：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646302438859-9b9fc5df-06d5-401f-bafd-627f335865cb.png#clientId=u6978505f-af29-4&from=paste&height=224&id=u5a2caff2&originHeight=246&originWidth=859&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72619&status=done&style=none&taskId=ua38887cc-a193-48b5-b95d-bc46185554a&title=&width=780.9090739833425)<br />这两个节点，一个是输出虚拟纹理并可以自定义输出哪个虚拟纹理以及虚拟纹理的内容，一个是决定虚拟纹理的各种信息。<br />在拥有了虚拟纹理后就可以在需要利用虚拟纹理时使用RuntimeVirtualTextureSample节点。<br />将虚拟纹理大小提高可以将分辨率提高不然地形就太糊了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303012570-b7e5ac74-3f8d-489f-9a8b-8fe0e55432f7.png#clientId=u6978505f-af29-4&from=paste&height=143&id=udec2dbbe&originHeight=157&originWidth=914&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16154&status=done&style=none&taskId=u07ca4429-34e5-4399-80ce-8e7b3328f47&title=&width=830.9090728996217)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303658867-d415984a-73eb-42cc-8c8f-1481443a8e27.png#clientId=u6978505f-af29-4&from=paste&height=1705&id=uf3e44067&originHeight=1875&originWidth=4710&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1399123&status=done&style=none&taskId=u680bc6f7-c9bc-46e7-99f6-bdc97325573&title=&width=4281.818089012274)<br />这种操作相当于牺牲存储内存换取性能。
<a name="gNKoi"></a>
### RVT材质混合
教程开始前，提到了之前做的为了降低贴图重复度，根据摄像机与地形之间的距离将1024的Mid贴图与4K的贴图混合的功能配合虚拟纹理会导致地形效果不好，于是把那个功能删掉了。<br />RVT材质混合的效果<br />混合前：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303733203-f95a3dfe-065c-4800-a5d3-d1a712b2538d.png#clientId=u6978505f-af29-4&from=paste&height=403&id=u5b5c9612&originHeight=443&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=823369&status=done&style=none&taskId=u8882f7d3-3ffb-4923-a572-fe357bfd50f&title=&width=744.5454384078668)<br />混合后：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646303759257-6b92128d-a805-4650-b791-3ee64f47a07e.png#clientId=u6978505f-af29-4&from=paste&height=479&id=u070b3d6c&originHeight=527&originWidth=659&originalType=binary&ratio=1&rotation=0&showTitle=false&size=719773&status=done&style=none&taskId=uf5fbf84f-a372-41fd-b907-8d7bdf74956&title=&width=599.0908961059636)<br />RVT材质混合的作用就是使不同模型之间混合更加自然。<br />首先我们需要为地形新增加一个虚拟纹理，这个虚拟纹理只需要获取地形的高度，因此不需要太高的分辨率![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646308171380-c86acffe-05e7-45cb-b8df-3cb28d6be3bf.png#clientId=u6978505f-af29-4&from=paste&height=350&id=u9fc75225&originHeight=385&originWidth=950&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32965&status=done&style=none&taskId=ud10d10e4-605a-4726-95e1-c9c1db11415&title=&width=863.63634491755)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646308287525-7627e12d-acec-4eab-990e-f21419996ca8.png#clientId=u6978505f-af29-4&from=paste&height=299&id=u26daefd5&originHeight=329&originWidth=489&originalType=binary&ratio=1&rotation=0&showTitle=false&size=294151&status=done&style=none&taskId=ue045c22b-9f29-4bd8-8283-8cca89706d6&title=&width=444.5454449101915)要拥有这个效果需要对母材质进行一些更改，因此将其母材质复制一份，改成能够实现RVT混合效果的母材质。<br />利用这个得到地形与物体的蒙版。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646309631200-d43cf4b5-f949-4a57-90ef-1a099fc29fcf.png#clientId=u6978505f-af29-4&from=paste&height=325&id=u0290137d&originHeight=358&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=87271&status=done&style=none&taskId=ube88f21f-1436-4a99-b65e-3fd26386b01&title=&width=690.90907593404)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646309852263-cd88c992-dbc2-4b7b-a0a5-fccec59976b7.png#clientId=u6978505f-af29-4&from=paste&height=132&id=ud86aaba3&originHeight=145&originWidth=328&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27523&status=done&style=none&taskId=u86cb330c-98fc-4e41-ab04-8f6743756c6&title=&width=298.1818117189015)但是还是有些生硬，加一个除法后![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646309957097-62a8353c-2003-4135-82ab-c5bd7f3af796.png#clientId=u6978505f-af29-4&from=paste&height=185&id=u69c54db5&originHeight=204&originWidth=459&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31154&status=done&style=none&taskId=uee4126df-cbb2-4a1b-bf40-db2fab41404&title=&width=417.27271822858467)提高blend的数值后过渡不那么生硬了![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646309944942-bc520b13-973a-44e1-8e05-a2625acf4b82.png#clientId=u6978505f-af29-4&from=paste&height=312&id=u520b12fa&originHeight=343&originWidth=547&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99318&status=done&style=none&taskId=u32527808-a386-4042-b3d6-4654e97c085&title=&width=497.2727164946314)<br />利用这个蒙版混合地形与模型。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646311925982-d2e16cf3-ed54-4d63-bb32-1f00ebe0e41b.png#clientId=u6978505f-af29-4&from=paste&height=2126&id=u71060c5b&originHeight=2339&originWidth=3662&originalType=binary&ratio=1&rotation=0&showTitle=false&size=845072&status=done&style=none&taskId=u37425943-2d3f-4ec2-9af5-8cf3cbae7eb&title=&width=3329.0908369348085)
<a name="u0Gdc"></a>
### 4.26引擎自带的水系统
要使用引擎自带的水系统需要开启这两个插件<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646312055680-0e9bacc9-5767-47d2-bc60-10846f2d1d68.png#clientId=u6978505f-af29-4&from=paste&height=297&id=udf2a0420&originHeight=327&originWidth=1082&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36853&status=done&style=none&taskId=ud57e9afc-5292-47b6-be2a-5c8db15e376&title=&width=983.6363423166201)<br />其中landmass的作用是它能够使我们能够通过样条线编辑水，并且可以实时的改变地形。<br />因为这个水系统是非常消耗性能的，因此我们重新利用程序化生成一个2017*2017的地形。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646313876138-95d4832d-dba7-4e34-bde8-46c2a02cd161.png#clientId=u6978505f-af29-4&from=paste&height=439&id=u0ec313a7&originHeight=483&originWidth=273&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40810&status=done&style=none&taskId=u23cf4369-2122-4ef7-93be-02bda84c62a&title=&width=248.18181280262226)<br />创建地形后将地形向上平移，只要地形最低点高于0就行。<br />接下来就是创建一个新的地形材质实例赋予新地形并为其指定之前创建的两个虚拟纹理（带颜色的和高度的），然后将地形启用编辑图层![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646359262225-6adc7510-b800-43c4-895e-4852bff4c211.png#clientId=u454bd992-af13-4&from=paste&height=76&id=uca5ba39b&originHeight=84&originWidth=250&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4184&status=done&style=none&taskId=u13925cb6-9b50-4229-8c62-60700b4759c&title=&width=227.27272234672367)，最后拖入两个![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646359286037-61ede9d1-1e71-4cee-b4a5-c24b7ab98844.png#clientId=u454bd992-af13-4&from=paste&height=45&id=u5b3772d7&originHeight=49&originWidth=217&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5958&status=done&style=none&taskId=ud213c836-e7b6-449f-b970-d926a0ef2ab&title=&width=197.27272299695616)并设置边界指定虚拟纹理。<br />然后将地形的权重层赋予就可以出现材质效果了，然后因为这个新地形和之前的地形海拔不一样，因此将母材质中的控制海拔的参数暴露出来调整就可以出现跟之前地形差不多的效果。<br />接下来拖入河流：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646362208543-0d30cfbc-cbfd-4669-bb6b-3dda7f56e0c7.png#clientId=u454bd992-af13-4&from=paste&height=55&id=u90b25816&originHeight=60&originWidth=174&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4174&status=done&style=none&taskId=u98a93904-43d6-4a4d-a17c-fdd8cf47605&title=&width=158.18181475331968)拖入河流后![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646362222879-002964cd-6cd7-4929-832d-2632ce0b03b7.png#clientId=u454bd992-af13-4&from=paste&height=381&id=u8cc20bad&originHeight=419&originWidth=538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=404786&status=done&style=none&taskId=uce8f5883-885b-4ddd-89ab-be8f7386589&title=&width=489.09089849014936)<br />这个河流是根据样条线生成的并且可以实时的改变地形，接下来介绍一下河流的各个参数：<br />介绍之前先提一下创建新的样条点的方法：选择样条点，然后使用alt+移动可以生成新的样条点。<br />这一栏是可以控制某一样条点处的宽度速度深度。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646366487147-90ff4612-678e-441c-b1d1-cccd9fdc537f.png#clientId=u454bd992-af13-4&from=paste&height=111&id=u853c2fdd&originHeight=122&originWidth=295&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5636&status=done&style=none&taskId=ue8e2f86b-e867-49c3-983e-e9eb0e1e898&title=&width=268.1818123691339)<br />这一栏控制的是样条线对地形的影响。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646368558714-7b497834-9d50-4a99-991b-718706017abe.png#clientId=u454bd992-af13-4&from=paste&height=411&id=u34b7fdfa&originHeight=452&originWidth=378&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33129&status=done&style=none&taskId=u274b2654-9afb-4446-a624-271f28525bd&title=&width=343.6363561882462)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646370600421-932bca91-5cf9-4c3e-8666-26a2b42e504f.png#clientId=u454bd992-af13-4&from=paste&height=385&id=u7c10d806&originHeight=424&originWidth=537&originalType=binary&ratio=1&rotation=0&showTitle=false&size=449464&status=done&style=none&taskId=u11fa7084-4ae4-447a-8883-a4049a82e2d&title=&width=488.18180760076245)
<a name="yeqRv"></a>
#### 自动河床系统
优化一下水：<br />首先先更改一下颜色：找到水材质![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646371329617-02ab66c6-9ab3-46e1-914b-e1b58313bfc7.png#clientId=u454bd992-af13-4&from=paste&height=87&id=ua88130e8&originHeight=96&originWidth=453&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11414&status=done&style=none&taskId=u434a132b-9cdb-4b13-9d23-30a00b090c6&title=&width=411.8181728922633)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646371297121-02067374-41b9-4bdc-9481-eaf466f0fec4.png#clientId=u454bd992-af13-4&from=paste&height=272&id=u3b442590&originHeight=299&originWidth=816&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16750&status=done&style=none&taskId=uf3f675d4-39a8-4547-9dfb-c02d6f1099f&title=&width=741.818165739706)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646371637291-513496f0-0469-45ae-9cf4-058a6e7fe320.png#clientId=u454bd992-af13-4&from=paste&height=49&id=ufea1d481&originHeight=54&originWidth=319&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4636&status=done&style=none&taskId=udd78b1e5-5450-48ba-8869-9430d4a7774&title=&width=289.9999937144194)<br />优化好水之后，我们需要根据水流程序化生成水流地形以及水流旁的石头，需要这种效果：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646390301521-24ad6184-65a8-417a-8ad5-78d408b39efa.png#clientId=u0c5f0e94-5b73-4&from=paste&height=285&id=uba18422c&originHeight=314&originWidth=795&originalType=binary&ratio=1&rotation=0&showTitle=false&size=363416&status=done&style=none&taskId=u12edfc4e-a138-43d6-997a-245ad558a3c&title=&width=722.7272570625813)<br />之前水流下都是程序化生成的草，现在改成了水流方向程序化生成石头以及水流覆盖区域材质对应更改。<br />要实现这个功能还是挺简单的，前提是需要知道伴随着水插件的使用会有这个actor![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646390800578-2105b5b0-0a75-4137-a3cf-d80fb8866f49.png#clientId=u0c5f0e94-5b73-4&from=paste&height=33&id=uafa804c4&originHeight=36&originWidth=230&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5400&status=done&style=none&taskId=u6636c8f6-c2cc-4487-9ba7-e622a100f1e&title=&width=209.09090455898578)然后在它的设置之下有一个影响权重图和影响的权重图图层。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646390829782-645972b7-7bdc-4316-9041-44a7eaa9fa10.png#clientId=u0c5f0e94-5b73-4&from=paste&height=82&id=ubef67573&originHeight=90&originWidth=372&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7019&status=done&style=none&taskId=u5218aa86-352c-4297-80aa-348ccdabc07&title=&width=338.1818108519248)勾选影响权重图后的意思就是水插件的使用是可以伴随着权重的。权重就是这个![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646390993764-6c77f86f-7fb3-44df-9c88-19bcfdd19408.png#clientId=u0c5f0e94-5b73-4&from=paste&height=305&id=ua46ab9ee&originHeight=335&originWidth=304&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40932&status=done&style=none&taskId=u4cabeff2-47d4-45a4-a299-d149b91d221&title=&width=276.363630373616)。然后为其影响的权重图图层添加一个数组元素自定义命名为River，然后找到WaterBodyRiver![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391055357-a4d06f31-0b26-4fb0-b91f-867c93609538.png#clientId=u0c5f0e94-5b73-4&from=paste&height=29&id=ud6cf0f7c&originHeight=32&originWidth=199&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4574&status=done&style=none&taskId=uf895eb45-4c34-4d70-9f2a-75dbdb5e239&title=&width=180.90908698799205)在下面添加River![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391128966-8de44e92-9bed-4e87-abbd-7573a6d4d684.png#clientId=u0c5f0e94-5b73-4&from=paste&height=60&id=u1489fb32&originHeight=66&originWidth=381&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6210&status=done&style=none&taskId=uaf34ff19-944e-475a-9c69-abbf8bda315&title=&width=346.3636288564069)<br />有了River权重图以后我们就可以通过这个River权重图对材质进行修改。<br />主要利用了这个节点获取River权重图，然后就可以根据这个river权重图作为蒙版混合其他的材质，以及配合Gras<br />s节点程序化生成节点。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391222847-09f19239-2a28-4a1d-9115-b7a20b81064e.png#clientId=u0c5f0e94-5b73-4&from=paste&height=75&id=u770a6bcf&originHeight=82&originWidth=163&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8623&status=done&style=none&taskId=u208c189e-a0f9-446a-9937-147a54ac06e&title=&width=148.18181497006384)<br />也就增加了这两个功能。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391521733-db7e91ef-0bbf-4e39-955a-19fa125c91d0.png#clientId=u0c5f0e94-5b73-4&from=paste&height=585&id=u3dff80de&originHeight=643&originWidth=955&originalType=binary&ratio=1&rotation=0&showTitle=false&size=157543&status=done&style=none&taskId=ud15934b1-a2d2-41e5-9cbc-c16c53fc280&title=&width=868.1817993644845)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391555915-d4e0061b-0715-4d98-a049-c09799fd8c34.png#clientId=u0c5f0e94-5b73-4&from=paste&height=231&id=ubeba41ee&originHeight=254&originWidth=724&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71667&status=done&style=none&taskId=uf237bf68-801e-4228-9ac2-6faa324ff6a&title=&width=658.1818039161118)<br />全部材质连接法：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646391768871-6ee917bd-cb6e-477a-a4af-f76665a65776.png#clientId=u0c5f0e94-5b73-4&from=paste&height=1763&id=uc639c983&originHeight=1939&originWidth=5057&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1661274&status=done&style=none&taskId=u1f681634-070d-4aca-8af4-a97dc4c29a9&title=&width=4597.272627629526)<br />这里为了得到更好的贴图效果把之前为了优化而使用的RVT给关掉了。
<a name="Xp98l"></a>
### 程序化水坑
程序化水坑的生成在之前的课中写过一次，可以复制过来改进一下，并且使其能够匹配地形，例如地形中的水坑不能张草，并且因为之前近距离细分的原因可能导致水坑的显示有问题需要调节一下height的值。<br />这里就直接截图了。<br />首先制作一个水坑的蒙版函数用来控制水坑的蒙版大小。 这里的两组二维数值控制的是水坑蒙版的大小，可以根据自己需要手动调整。 这只是一个大概的值，当PuddleSize大小超过1时，Lerp对应的数值也会超过B的数值依然可以增大水坑蒙版。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646444503666-e7dfd86a-12bf-48f1-b00a-0aa88c561bdb.png#clientId=ua6df4fa7-aa18-4&from=paste&height=1142&id=uf5f1fe2f&originHeight=1256&originWidth=2329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=363822&status=done&style=none&taskId=u73aaee5a-014d-4a81-b621-9128ae71aea&title=&width=2117.2726813820777)<br />其中水坑遮罩就是依靠世界位置作为UV进行投影。然后依靠VertexNormalWS使水坑只生长的平坦的区域。<br />有了水坑的遮罩以后，发现水坑的遮罩还会出现在河流的下面，因此还需要河流的遮罩来控制水坑不生长的区域。<br />因此依靠这个水坑遮罩函数继续创建一个水坑函数，水坑函数可以接收一个遮罩控制水坑的生成区域，以及通过接收地形材质使地形以及水坑混合。这里设置height混合是因为之前设置了近距离置换增强的效果会导致![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646444939905-bcb40a74-5537-42d9-a7c9-98b203fc9f0c.png#clientId=ua6df4fa7-aa18-4&from=paste&height=320&id=uc39c8efc&originHeight=352&originWidth=556&originalType=binary&ratio=1&rotation=0&showTitle=false&size=300453&status=done&style=none&taskId=u4e3ce06b-6085-4258-b1b5-32876b361a4&title=&width=505.45453449911344)。因此也为水坑增加了Height变化<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646444880806-e7f16e92-e9a3-4585-b24e-d4f669b6de3c.png#clientId=ua6df4fa7-aa18-4&from=paste&height=1255&id=u3e3053bc&originHeight=1380&originWidth=1923&originalType=binary&ratio=1&rotation=0&showTitle=false&size=420895&status=done&style=none&taskId=u91e0ea21-17a6-412f-880c-05f1139f34b&title=&width=1748.1817802909986)<br />使用水坑函数后的地形材质：这里主要是对于水坑的遮罩的处理，以及使植被不生长在水坑上面。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646445000899-3ddac9a3-cb40-4392-83ed-37eea3ee015e.png#clientId=ua6df4fa7-aa18-4&from=paste&height=1763&id=u39e6016e&originHeight=1939&originWidth=5281&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1793077&status=done&style=none&taskId=u7b323a31-5167-4a4f-8c4b-a5e73935536&title=&width=4800.908986852191)
<a name="pd0Kn"></a>
#### 为水坑增加水流和涟漪
利用之前的水流涟漪材质函数，因为要制造水流和涟漪就需要对法线进行操作。因此制作PuddleRipple材质函数将水坑的法线变成水流涟漪法线。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646449138561-78ffe1f2-3e86-47b1-9b79-b7ffb576a2c9.png#clientId=ua6df4fa7-aa18-4&from=paste&height=495&id=uc012c752&originHeight=544&originWidth=1458&originalType=binary&ratio=1&rotation=0&showTitle=false&size=175778&status=done&style=none&taskId=u9fadc38e-69b7-49de-8a88-daf8cd74a43&title=&width=1325.4545167260926)<br />这个Puddle Ripple的作用就是输入法线和水坑的mask，将地形的法线和水坑的法线混合起来然后输出法线。<br />然后整理到地形材质上面。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646449714243-0187f26d-acd6-45e9-a763-d4730c72599c.png#clientId=ua6df4fa7-aa18-4&from=paste&height=140&id=u25ce4811&originHeight=154&originWidth=946&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67041&status=done&style=none&taskId=ubeffb639-938f-47c0-91f1-c7c6773c21a&title=&width=859.9999813600024)
<a name="poGzh"></a>
## 天空和雾气
创建户外场景时可以使用引擎提供的模板<br />新建关卡![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951324893-e7512f72-9b36-4248-8825-61585f8020d7.png#clientId=u4da8d356-351f-4&from=paste&height=428&id=u714d86b8&originHeight=428&originWidth=510&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100570&status=done&style=none&taskId=u7e90bd7d-5b53-4ff2-b4ac-908fc96f495&title=&width=510)选择第二个，会给我们提供一个很好的户外坏境设置<br />主要需要这五个![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951366134-e9a6b79b-8c15-4842-9dac-1993599eabbd.png#clientId=u4da8d356-351f-4&from=paste&height=118&id=ucc023783&originHeight=118&originWidth=198&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10231&status=done&style=none&taskId=ub41e06e6-8cda-4be1-a021-66ee12b14f5&title=&width=198)这里SkyDomeMesh的作用是填充地平线![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951553593-2d095796-b856-4179-8d71-ea5cc61a8099.png#clientId=u4da8d356-351f-4&from=paste&height=193&id=u53a86c4a&originHeight=193&originWidth=344&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52172&status=done&style=none&taskId=u165fee2b-0691-4026-b913-6ad2d0c5cd2&title=&width=344)→![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951533230-7cb75ecf-c390-401a-ac83-6bdc959b2f5a.png#clientId=u4da8d356-351f-4&from=paste&height=231&id=u9fc74b4f&originHeight=231&originWidth=353&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60586&status=done&style=none&taskId=u2dd150e3-cf76-4371-bf15-34a0e1270c7&title=&width=353)<br />与默认拖入比起来模板的设置：<br />定向光：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951415016-8da6fa5a-16a3-49cf-8d88-d2137cfd03cc.png#clientId=u4da8d356-351f-4&from=paste&height=53&id=udae0cd9e&originHeight=53&originWidth=286&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2925&status=done&style=none&taskId=u7d94466e-f4bc-4202-a88b-e6e5af013ab&title=&width=286)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951387464-74d3883a-4c12-477d-bfbc-ab7dad9918d4.png#clientId=u4da8d356-351f-4&from=paste&height=157&id=u96c97b3f&originHeight=157&originWidth=218&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8313&status=done&style=none&taskId=u587a7191-e11a-4810-a7c7-3a6f17679ba&title=&width=218)<br />天光：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951578407-6d0125f1-224c-4526-bcbd-ffd0844eae2b.png#clientId=u4da8d356-351f-4&from=paste&height=70&id=u257d7eb6&originHeight=70&originWidth=220&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5793&status=done&style=none&taskId=u3afd3de3-2a2d-417e-9a54-f0d0a8c764c&title=&width=220)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951583442-b8e5fe78-d4b2-4175-af8e-1f8d22aa616f.png#clientId=u4da8d356-351f-4&from=paste&height=154&id=u653d00fc&originHeight=154&originWidth=314&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10661&status=done&style=none&taskId=u7d094d8d-cf19-453e-92ce-18b79830e8d&title=&width=314)<br />体积云：![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951591863-614e1dc4-2bf2-4992-883f-905033141cfa.png#clientId=u4da8d356-351f-4&from=paste&height=155&id=ufa5f53db&originHeight=155&originWidth=277&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7762&status=done&style=none&taskId=uacb2b616-be9f-47cd-b244-93c0854f1a5&title=&width=277)![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1645951612330-ce1ce6bf-4fac-4279-b2eb-648685a0f8a5.png#clientId=u4da8d356-351f-4&from=paste&height=161&id=u1a42587e&originHeight=161&originWidth=324&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15912&status=done&style=none&taskId=u241a500a-547e-4227-8b47-564c9ea3fdc&title=&width=324)<br />**天空大气配合指数级高度雾：**<br />拖入指数级高度雾后发现天空大气并不能影响指数级高度雾，因为指数级高度雾自带![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646450100219-7d3c9adc-5c8b-4414-b1d6-f3da99fa1f0e.png#clientId=ua6df4fa7-aa18-4&from=paste&height=41&id=u63ed134f&originHeight=45&originWidth=443&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3771&status=done&style=none&taskId=ud2b85cd1-cf45-4ba8-815b-6db79d2cd8d&title=&width=402.72726399839433)<br />因此为了能够使天空大气能够配合指数级高度雾，在项目设置中开启![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646450178272-c17e7dbf-91bd-4677-a911-5de0e7594edb.png#clientId=ua6df4fa7-aa18-4&from=paste&height=222&id=ua504caa6&originHeight=244&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17991&status=done&style=none&taskId=ucc9e7578-3fb3-4b8a-84c2-bc11b13f4aa&title=&width=690.90907593404)<br />开启后将指数级高度雾中的雾内散射颜色以及定向内散射颜色改为黑色，这样就可以实现天空大气影响指数级高度雾了。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646450259353-84499481-428a-4c09-b8d2-6c048276bbc4.png#clientId=ua6df4fa7-aa18-4&from=paste&height=245&id=uac186a9c&originHeight=269&originWidth=455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23778&status=done&style=none&taskId=u9b138d0f-30e6-42e6-a633-97c22c825c1&title=&width=413.6363546710371)<br />接下来可以更改一下定向光（控制太阳的光）的设置，来使灯光更好看。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646450451501-0949fc10-ee53-4596-a491-592c3dcddb0d.png#clientId=ua6df4fa7-aa18-4&from=paste&height=230&id=uf6ae5c50&originHeight=253&originWidth=431&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18305&status=done&style=none&taskId=u7d9e3e16-1c97-439a-95fe-76b610fb434&title=&width=391.8181733257516)<br />更改了定向光设置以及增加了指数级高度雾以及使天空大气能够控制指数级高度雾后场景确实看起来更好看了。![image.png](https://cdn.nlark.com/yuque/0/2022/png/2623605/1646450553889-6cbf7ac0-48b0-4225-a8e5-ade7a1468995.png#clientId=ua6df4fa7-aa18-4&from=paste&height=410&id=u6fd0949a&originHeight=451&originWidth=875&originalType=binary&ratio=1&rotation=0&showTitle=false&size=523543&status=done&style=none&taskId=ucbc6f995-0ff3-4ec6-bc5e-5969d2754e8&title=&width=795.4545282135329)

