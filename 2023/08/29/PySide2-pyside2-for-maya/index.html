<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>pyside2 for maya | RuiChen</title><meta name="keywords" content="PySide2"><meta name="author" content="RuiChen"><meta name="copyright" content="RuiChen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1dJ41157gV?p&#x3D;2&amp;vd_source&#x3D;b1de3fe38e887eb40fc55a5485724480购买链接：https:&#x2F;&#x2F;zurbrigg.com&#x2F;tutorials&#x2F;pyside2-for-maya  创建一个新的界面的初始模板 12345678910111213141516171819202">
<meta property="og:type" content="article">
<meta property="og:title" content="pyside2 for maya">
<meta property="og:url" content="http://example.com/2023/08/29/PySide2-pyside2-for-maya/index.html">
<meta property="og:site_name" content="RuiChen">
<meta property="og:description" content="教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1dJ41157gV?p&#x3D;2&amp;vd_source&#x3D;b1de3fe38e887eb40fc55a5485724480购买链接：https:&#x2F;&#x2F;zurbrigg.com&#x2F;tutorials&#x2F;pyside2-for-maya  创建一个新的界面的初始模板 12345678910111213141516171819202">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/violet-chen/image_lib/blob/main/img%20(31).jpg?raw=true">
<meta property="article:published_time" content="2023-08-28T19:57:00.000Z">
<meta property="article:modified_time" content="2024-08-08T17:15:08.465Z">
<meta property="article:author" content="RuiChen">
<meta property="article:tag" content="PySide2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/violet-chen/image_lib/blob/main/img%20(31).jpg?raw=true"><link rel="shortcut icon" href="/"><link rel="canonical" href="http://example.com/2023/08/29/PySide2-pyside2-for-maya/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pyside2 for maya',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-09 01:15:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="RuiChen" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/assets/TouXiang.jpg" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1"></use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian"></use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei"></use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">RuiChen</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1"></use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian"></use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei"></use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></div></div><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">pyside2 for maya</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2023-08-28T19:57:00.000Z" title="发表于 2023-08-29 03:57:00">2023-08-29</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-08T17:15:08.465Z" title="更新于 2024-08-09 01:15:08">2024-08-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/PySide2/">PySide2</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.4w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>76分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pyside2 for maya"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer">
<p>教程链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dJ41157gV?p=2&amp;vd_source=b1de3fe38e887eb40fc55a5485724480">https://www.bilibili.com/video/BV1dJ41157gV?p=2&amp;vd_source=b1de3fe38e887eb40fc55a5485724480</a><br>购买链接：<a target="_blank" rel="noopener" href="https://zurbrigg.com/tutorials/pyside2-for-maya">https://zurbrigg.com/tutorials/pyside2-for-maya</a><br>
<a name="BKivW"></a></p>
<h1>创建一个新的界面的初始模板</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> maya.mel <span class="keyword">as</span> mel</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> PySide2.QtWidgets <span class="keyword">import</span> *</span><br><span class="line">    <span class="keyword">from</span> PySide2.QtCore <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">from</span> PySide.QtGui <span class="keyword">import</span> *</span><br><span class="line">    <span class="keyword">from</span> PySide.QtCore <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> shiboken <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">from</span> maya <span class="keyword">import</span> OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(<span class="title class_ inherited__">QDialog</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;MAYA-2018&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(Qt.WindowType.Window)</span><br><span class="line">        window_name = <span class="string">&quot;WindowName&quot;</span></span><br><span class="line">        <span class="keyword">if</span> cmds.window(window_name, exists=<span class="literal">True</span>):</span><br><span class="line">            cmds.deleteUI(window_name, window=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setObjectName(window_name)</span><br><span class="line">        <span class="variable language_">self</span>.setStyleSheet(<span class="string">&quot;font: 12pt &#x27;Arial&#x27;;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 控件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 布局 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 信号与槽的连接 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> aa</span><br><span class="line">    app = qApp <span class="keyword">if</span> QApplication.instance() <span class="keyword">else</span> QApplication([])</span><br><span class="line">    aa = TestDialog()</span><br><span class="line">    aa.show()</span><br><span class="line">    app.exec_()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="PlgPe"></a></p>
<h1>创建对话框</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    <span class="comment"># 将maya主窗口的C++指针转换为python可以接受的对象。</span></span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent = maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;one dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">200</span>,<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)  <span class="comment"># 将maya窗口的问号标志排除掉</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="noXJv"></a></p>
<h1>添加控件</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660209348067-aab29e6c-8246-464d-8317-e7e652053ceb.png#averageHue=%235c5b5b&amp;clientId=u766e0595-34d2-4&amp;from=paste&amp;height=239&amp;id=Bz6mZ&amp;originHeight=239&amp;originWidth=216&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=5305&amp;status=done&amp;style=none&amp;taskId=ue78fdd29-f90b-4374-b166-ff10332b25f&amp;title=&amp;width=216" alt="image.png"><br>教程中将控件和布局都分开放到函数里面了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    <span class="comment"># 将maya主窗口的C++指针转换为python可以接受的对象。</span></span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">		window_name = <span class="string">&quot;my_window&quot;</span></span><br><span class="line">        <span class="keyword">if</span> cmds.window(window_name, exists=<span class="literal">True</span>):</span><br><span class="line">            cmds.deleteUI(window_name, window=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Test Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)  <span class="comment"># 将maya窗口的问号标志排除掉</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.checkBox1 = QtWidgets.QCheckBox(<span class="string">&quot;Checkbox1&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.checkBox2 = QtWidgets.QCheckBox(<span class="string">&quot;Checkbox2&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.button1 = QtWidgets.QPushButton(<span class="string">&quot;Button 1&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.button2 = QtWidgets.QPushButton(<span class="string">&quot;Button 2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)  <span class="comment"># 传递self将这个layout作为主layout</span></span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.lineEdit)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.checkBox1)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.checkBox2)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.button1)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.button2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="eu3dY"></a></p>
<h1>layout基础</h1>
<p>代码很优雅<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660211434381-4c844e6c-e74b-4585-9562-d7ee77a631e2.png#averageHue=%23676767&amp;clientId=u766e0595-34d2-4&amp;from=paste&amp;height=151&amp;id=ub9a89202&amp;originHeight=151&amp;originWidth=216&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4631&amp;status=done&amp;style=none&amp;taskId=ubdcf75eb-e84f-4704-9bf7-3258c9fc134&amp;title=&amp;width=216" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    <span class="comment"># 将maya主窗口的C++指针转换为python可以接受的对象。</span></span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Test Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumWidth(<span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)  <span class="comment"># 将maya窗口的问号标志排除掉</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.checkBox1 = QtWidgets.QCheckBox()</span><br><span class="line">        <span class="variable language_">self</span>.checkBox2 = QtWidgets.QCheckBox()</span><br><span class="line">        <span class="variable language_">self</span>.ok_btn = QtWidgets.QPushButton(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_btn = QtWidgets.QPushButton(<span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        form_layout = QtWidgets.QFormLayout()</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Name:&quot;</span>, <span class="variable language_">self</span>.lineEdit)</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Hidden:&quot;</span>, <span class="variable language_">self</span>.checkBox1)</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Locked:&quot;</span>, <span class="variable language_">self</span>.checkBox2)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.ok_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.cancel_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)  <span class="comment"># 传递self将这个layout作为主layout</span></span><br><span class="line">        main_layout.addLayout(form_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="pGV9c"></a></p>
<h1>删除对话框</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br></pre></td></tr></table></figure>
<p><a name="rat7r"></a></p>
<h1>信号与槽</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    <span class="comment"># 将maya主窗口的C++指针转换为python可以接受的对象。</span></span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Test Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumWidth(<span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)  <span class="comment"># 将maya窗口的问号标志排除掉</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.checkBox1 = QtWidgets.QCheckBox()</span><br><span class="line">        <span class="variable language_">self</span>.checkBox2 = QtWidgets.QCheckBox()</span><br><span class="line">        <span class="variable language_">self</span>.ok_btn = QtWidgets.QPushButton(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_btn = QtWidgets.QPushButton(<span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        form_layout = QtWidgets.QFormLayout()</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Name:&quot;</span>, <span class="variable language_">self</span>.lineEdit)</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Hidden:&quot;</span>, <span class="variable language_">self</span>.checkBox1)</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Locked:&quot;</span>, <span class="variable language_">self</span>.checkBox2)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.ok_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.cancel_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)  <span class="comment"># 传递self将这个layout作为主layout</span></span><br><span class="line">        main_layout.addLayout(form_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit.editingFinished.connect(<span class="variable language_">self</span>.print_hello_name)</span><br><span class="line">        <span class="variable language_">self</span>.checkBox1.toggled.connect(<span class="variable language_">self</span>.print_is_hidden)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_btn.clicked.connect(<span class="variable language_">self</span>.close)  <span class="comment"># self.close是自带的不需要自己写函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_hello_name</span>(<span class="params">self</span>):</span><br><span class="line">        name = <span class="variable language_">self</span>.lineEdit.text()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello &#123;&#125;!&quot;</span>.<span class="built_in">format</span>(name))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_is_hidden</span>(<span class="params">self</span>):</span><br><span class="line">        hidden = <span class="variable language_">self</span>.checkBox1.isChecked()</span><br><span class="line">        <span class="keyword">if</span> hidden:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Hidden&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Visible&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="bjO1K"></a></p>
<h2 id="过载信号">过载信号</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660271563886-f57ad54c-dc87-4574-ae27-6ebb78fec497.png#averageHue=%232a2c28&amp;clientId=uc3617f6a-1057-4&amp;from=paste&amp;height=282&amp;id=u7bd615cb&amp;originHeight=282&amp;originWidth=662&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=127516&amp;status=done&amp;style=none&amp;taskId=uf32b9790-1ea2-48e6-99ca-1dd7ea32f28&amp;title=&amp;width=662" alt="image.png"><br>通过@QtCore.Slot(int)和@QtCore.Slot(str)使信号传递的参数类型改变<br>
<a name="mVcMe"></a></p>
<h2 id="自定义信号">自定义信号</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671169445449-5e7ff7c9-4408-440d-9fe3-f4f6c73d7d88.png#averageHue=%23707070&amp;clientId=u0295db91-fe64-4&amp;from=paste&amp;height=136&amp;id=u0c1e930c&amp;originHeight=122&amp;originWidth=202&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3205&amp;status=done&amp;style=none&amp;taskId=u09cc59b7-0282-4952-b90f-600b0e45c40&amp;title=&amp;width=224.4444503901919" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    <span class="comment"># 将maya主窗口的C++指针转换为python可以接受的对象。</span></span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLineEdit</span>(QtWidgets.QLineEdit):</span><br><span class="line">    enter_pressed = QtCore.Signal(<span class="built_in">str</span>)  <span class="comment"># 新建自定义信号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keyPressEvent</span>(<span class="params">self, e</span>):  <span class="comment"># 使用QLineEdit自带的事件，当按键按下时触发并发送数据</span></span><br><span class="line">        <span class="built_in">super</span>(MyLineEdit, <span class="variable language_">self</span>).keyPressEvent(e)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> e.key() == QtCore.Qt.Key_Enter:</span><br><span class="line">            <span class="variable language_">self</span>.enter_pressed.emit(<span class="string">&quot;Enter Key Pressed&quot;</span>)  <span class="comment"># 信号触发时发送的字符串</span></span><br><span class="line">        <span class="keyword">elif</span> e.key() == QtCore.Qt.Key_Return:</span><br><span class="line">            <span class="variable language_">self</span>.enter_pressed.emit(<span class="string">&quot;Enter Key Pressed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Test Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumWidth(<span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumHeight(<span class="number">90</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)  <span class="comment"># 将maya窗口的问号标志排除掉</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit = MyLineEdit()  <span class="comment"># MyLineEdit 是自定义的继承QtWidgets.QLineEdit的类</span></span><br><span class="line">        <span class="variable language_">self</span>.ok_btn = QtWidgets.QPushButton(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_btn = QtWidgets.QPushButton(<span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        form_layout = QtWidgets.QFormLayout()</span><br><span class="line">        form_layout.addRow(<span class="string">&quot;Name:&quot;</span>, <span class="variable language_">self</span>.lineEdit)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.ok_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.cancel_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)  <span class="comment"># 传递self将这个layout作为主layout</span></span><br><span class="line">        main_layout.addLayout(form_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineEdit.enter_pressed.connect(<span class="variable language_">self</span>.on_enter_pressed)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_btn.clicked.connect(<span class="variable language_">self</span>.close)  <span class="comment"># self.close是自带的不需要自己写函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_enter_pressed</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="built_in">print</span>(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="PJwXP"></a></p>
<h1>打开/导入/引用文件举例</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660486774209-460c6550-a87b-416f-b824-5837e80e3c46.png#averageHue=%23626161&amp;clientId=ud565464f-f3f4-4&amp;from=paste&amp;height=171&amp;id=u578a9f29&amp;originHeight=171&amp;originWidth=316&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7870&amp;status=done&amp;style=none&amp;taskId=u1e460f4b-9d08-4527-b323-06e1b6f468d&amp;title=&amp;width=316" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    FILE_FILTERS = <span class="string">&quot;Maya(*.ma *.mb);;Maya ASCII (*.ma);;Maya Binary (*.mb);;All Files (*.*)&quot;</span>  <span class="comment"># 全部的过滤项</span></span><br><span class="line"></span><br><span class="line">    selected_filter = <span class="string">&quot;Maya (*.ma *.mb)&quot;</span>  <span class="comment"># 记录选择的过滤项，每次更改过滤项的同时会更改这个全局变量的值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Open/Import/Reference&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.filepath_le = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn = QtWidgets.QPushButton()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setIcon(QtGui.QIcon(<span class="string">&#x27;:fileOpen.png&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setToolTip(<span class="string">&quot;select File&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb = QtWidgets.QRadioButton(<span class="string">&quot;Open&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.open_rb.setChecked(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.import_rb = QtWidgets.QRadioButton(<span class="string">&quot;Import&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.reference_rb = QtWidgets.QRadioButton(<span class="string">&quot;Reference&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.force_cb = QtWidgets.QCheckBox(<span class="string">&quot;Force&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn = QtWidgets.QPushButton(<span class="string">&quot;Apply&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        file_path_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.filepath_le)</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.select_file_path_btn)</span><br><span class="line"></span><br><span class="line">        radio_btn_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.open_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.import_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.reference_rb)</span><br><span class="line"></span><br><span class="line">        forme_layout = QtWidgets.QFormLayout()</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;File&quot;</span>, file_path_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, radio_btn_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, <span class="variable language_">self</span>.force_cb)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.apply_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addLayout(forme_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.clicked.connect(<span class="variable language_">self</span>.show_file_select_dialog)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb.toggled.connect(<span class="variable language_">self</span>.update_force_visibility)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn.clicked.connect(<span class="variable language_">self</span>.load_file)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_file_select_dialog</span>(<span class="params">self</span>):</span><br><span class="line">        file_path, <span class="variable language_">self</span>.selected_filter = QtWidgets.QFileDialog.getOpenFileName(<span class="variable language_">self</span>, <span class="string">&quot;Select File&quot;</span>, <span class="string">&quot;&quot;</span>,</span><br><span class="line">                                                                                <span class="variable language_">self</span>.FILE_FILTERS, <span class="variable language_">self</span>.selected_filter)</span><br><span class="line">        <span class="keyword">if</span> file_path:</span><br><span class="line">            <span class="variable language_">self</span>.filepath_le.setText(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_force_visibility</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.force_cb.setVisible(checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_file</span>(<span class="params">self</span>):</span><br><span class="line">        file_path = <span class="variable language_">self</span>.filepath_le.text()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_path:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)  <span class="comment"># 得到文件的信息</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_info.exists():  <span class="comment"># 判断文件是否存在</span></span><br><span class="line">            om.MGlobal.displayError(<span class="string">&quot;File does not exist: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(file_path))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.open_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.open_file(file_path)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.import_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.import_file(file_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.reference_file(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        force = <span class="variable language_">self</span>.force_cb.isChecked()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> cmds.file(q=<span class="literal">True</span>, modified=<span class="literal">True</span>):</span><br><span class="line">            result = QtWidgets.QMessageBox.question(<span class="variable language_">self</span>, <span class="string">&quot;Modified&quot;</span>, <span class="string">&quot;Current scene has unsaved changes. Continue?&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> result == QtWidgets.QMessageBox.StandardButton.Yes:</span><br><span class="line">                force = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        cmds.file(file_path, <span class="built_in">open</span>=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>, force=force)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">import_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, i=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reference_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, r=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="RbM6Q"></a></p>
<h1>将插件放入到工具架上</h1>
<p><a name="HzMTb"></a></p>
<h2 id="主要功能模块">主要功能模块</h2>
<p>首先这个是上一节使用的打开与导入对话框，区别是添加了show_dialog类方法来替代if name == ‘<strong>main</strong>’  。将这个py模块放到maya的script文件夹中后，然后通过另一组代码来调用类方法达到显示窗口的需求。好处是可以保存在窗口执行的操作，比如在文本框中输入了数据，关闭窗口再打开后数据依然保留。<br>然后新增加了两个函数show_event 和 close_event，这两个的作用是关闭窗口时记录窗口位置，打开窗口时设置窗口位置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenImportDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    FILE_FILTERS = <span class="string">&quot;Maya(*.ma *.mb);;Maya ASCII (*.ma);;Maya Binary (*.mb);;All Files (*.*)&quot;</span>  <span class="comment"># 全部的过滤项</span></span><br><span class="line"></span><br><span class="line">    selected_filter = <span class="string">&quot;Maya (*.ma *.mb)&quot;</span>  <span class="comment"># 记录选择的过滤项，每次更改过滤项的同时会更改这个全局变量的值</span></span><br><span class="line"></span><br><span class="line">    dlg_instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_dialog</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.dlg_instance:</span><br><span class="line">            cls.dlg_instance = OpenImportDialog()  <span class="comment"># 第一次使用函数会生成窗口实例给dlg_instance全局变量</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cls.dlg_instance.isHidden():</span><br><span class="line">            cls.dlg_instance.show()  <span class="comment"># 如果窗口隐藏了就显示出来</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果窗口还在屏幕中就激活窗口并顶端显示</span></span><br><span class="line">            cls.dlg_instance.raise_()</span><br><span class="line">            cls.dlg_instance.activateWindow()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(OpenImportDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Open/Import/Reference&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line">        <span class="variable language_">self</span>.geometry = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.filepath_le = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn = QtWidgets.QPushButton()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setIcon(QtGui.QIcon(<span class="string">&#x27;:fileOpen.png&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setToolTip(<span class="string">&quot;select File&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb = QtWidgets.QRadioButton(<span class="string">&quot;Open&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.open_rb.setChecked(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.import_rb = QtWidgets.QRadioButton(<span class="string">&quot;Import&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.reference_rb = QtWidgets.QRadioButton(<span class="string">&quot;Reference&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.force_cb = QtWidgets.QCheckBox(<span class="string">&quot;Force&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn = QtWidgets.QPushButton(<span class="string">&quot;Apply&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        file_path_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.filepath_le)</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.select_file_path_btn)</span><br><span class="line"></span><br><span class="line">        radio_btn_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.open_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.import_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.reference_rb)</span><br><span class="line"></span><br><span class="line">        forme_layout = QtWidgets.QFormLayout()</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;File&quot;</span>, file_path_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, radio_btn_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, <span class="variable language_">self</span>.force_cb)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.apply_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addLayout(forme_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.clicked.connect(<span class="variable language_">self</span>.show_file_select_dialog)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb.toggled.connect(<span class="variable language_">self</span>.update_force_visibility)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn.clicked.connect(<span class="variable language_">self</span>.load_file)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_file_select_dialog</span>(<span class="params">self</span>):</span><br><span class="line">        file_path, <span class="variable language_">self</span>.selected_filter = QtWidgets.QFileDialog.getOpenFileName(<span class="variable language_">self</span>, <span class="string">&quot;Select File&quot;</span>, <span class="string">&quot;&quot;</span>,</span><br><span class="line">                                                                                <span class="variable language_">self</span>.FILE_FILTERS, <span class="variable language_">self</span>.selected_filter)</span><br><span class="line">        <span class="keyword">if</span> file_path:</span><br><span class="line">            <span class="variable language_">self</span>.filepath_le.setText(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_force_visibility</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.force_cb.setVisible(checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_file</span>(<span class="params">self</span>):</span><br><span class="line">        file_path = <span class="variable language_">self</span>.filepath_le.text()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_path:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)  <span class="comment"># 得到文件的信息</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_info.exists():  <span class="comment"># 判断文件是否存在</span></span><br><span class="line">            om.MGlobal.displayError(<span class="string">&quot;File does not exist: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(file_path))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.open_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.open_file(file_path)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.import_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.import_file(file_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.reference_file(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        force = <span class="variable language_">self</span>.force_cb.isChecked()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> cmds.file(q=<span class="literal">True</span>, modified=<span class="literal">True</span>):</span><br><span class="line">            result = QtWidgets.QMessageBox.question(<span class="variable language_">self</span>, <span class="string">&quot;Modified&quot;</span>, <span class="string">&quot;Current scene has unsaved changes. Continue?&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> result == QtWidgets.QMessageBox.StandardButton.Yes:</span><br><span class="line">                force = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        cmds.file(file_path, <span class="built_in">open</span>=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>, force=force)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">import_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, i=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reference_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, r=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(OpenImportDialog, <span class="variable language_">self</span>).showEvent(e)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.geometry:</span><br><span class="line">            <span class="variable language_">self</span>.restoreGeometry(<span class="variable language_">self</span>.geometry)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(OpenImportDialog, <span class="variable language_">self</span>).closeEvent(e)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.geometry = <span class="variable language_">self</span>.saveGeometry()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="LGRqV"></a></p>
<h2 id="调用窗口显示的模块">调用窗口显示的模块</h2>
<p>open_import_dialog为模块名(py程序名)<br>OpenImportDialog为模块中的类名<br>注意：前两行是当py文件有更改时运行的，当没有更改py文件时不要运行。因为运行前两行会重置窗口的实例数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> open_import_dialog</span><br><span class="line">reload(open_import_dialog)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> open_import_dialog <span class="keyword">import</span> OpenImportDialog</span><br><span class="line"></span><br><span class="line">OpenImportDialog.show_dialog()</span><br></pre></td></tr></table></figure>
<p><a name="FF1Ia"></a></p>
<h1>各种模式对话框</h1>
<p><a name="HWSLO"></a></p>
<h2 id="自定义对话框">自定义对话框</h2>
<p>这里有文件夹对话框，警告对话框，颜色选择对话框，自定义对话框<br>这里最主要学习的是自定义对话框<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671170114446-0a3d0bcd-baf4-42ee-aa68-4e09b5d92771.png#averageHue=%23655f5d&amp;clientId=u0295db91-fe64-4&amp;from=paste&amp;height=594&amp;id=ua0005fb4&amp;originHeight=535&amp;originWidth=1002&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=52403&amp;status=done&amp;style=none&amp;taskId=u9f31be18-e0e4-4adf-8e57-a662337af7a&amp;title=&amp;width=1113.3333628265955" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&quot;Custom Dialog&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lineedit = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.ok_btn = QtWidgets.QPushButton(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        wdg_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        wdg_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Name: &quot;</span>))</span><br><span class="line">        wdg_layout.addWidget(<span class="variable language_">self</span>.lineedit)</span><br><span class="line"></span><br><span class="line">        btn_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        btn_layout.addStretch()</span><br><span class="line">        btn_layout.addWidget(<span class="variable language_">self</span>.ok_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addLayout(wdg_layout)</span><br><span class="line">        main_layout.addLayout(btn_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ok_btn.clicked.connect(<span class="variable language_">self</span>.accept)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_text</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.lineedit.text())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Test Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.initial_directory = cmds.internalVar(userPrefDir=<span class="literal">True</span>)  <span class="comment"># 默认文件窗口打开路径</span></span><br><span class="line">        <span class="variable language_">self</span>.initial_color = QtGui.QColor(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 默认颜色窗口初始选择的颜色</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.warning_btn = QtWidgets.QPushButton(<span class="string">&quot;Warning&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.folder_select_btn = QtWidgets.QPushButton(<span class="string">&quot;Folder Select&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.color_select_btn = QtWidgets.QPushButton(<span class="string">&quot;Color Select&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.custom_btn = QtWidgets.QPushButton(<span class="string">&quot;Modal (Custom)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        main_layout = QtWidgets.QHBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.warning_btn)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.folder_select_btn)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.color_select_btn)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.custom_btn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.warning_btn.clicked.connect(<span class="variable language_">self</span>.show_warning_dialog)</span><br><span class="line">        <span class="variable language_">self</span>.folder_select_btn.clicked.connect(<span class="variable language_">self</span>.show_folder_select)</span><br><span class="line">        <span class="variable language_">self</span>.color_select_btn.clicked.connect(<span class="variable language_">self</span>.show_color_select)</span><br><span class="line">        <span class="variable language_">self</span>.custom_btn.clicked.connect(<span class="variable language_">self</span>.show_custom_dialog)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_warning_dialog</span>(<span class="params">self</span>):</span><br><span class="line">        QtWidgets.QMessageBox.warning(<span class="variable language_">self</span>, <span class="string">&quot;Object Not Found&quot;</span>, <span class="string">&quot;Camera &#x27;shotcam&#x27; not found.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_folder_select</span>(<span class="params">self</span>):</span><br><span class="line">        new_directory = QtWidgets.QFileDialog.getExistingDirectory(<span class="variable language_">self</span>, <span class="string">&quot;Select Folder&quot;</span>, <span class="variable language_">self</span>.initial_directory)</span><br><span class="line">        <span class="keyword">if</span> new_directory:</span><br><span class="line">            <span class="variable language_">self</span>.initial_directory = new_directory</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Selected Folder : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(new_directory))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_color_select</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.initial_color = QtWidgets.QColorDialog.getColor(<span class="variable language_">self</span>.initial_color, <span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Red:&#123;&#125; Green:&#123;&#125; Blue:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.initial_color.red(),</span><br><span class="line">                                               <span class="variable language_">self</span>.initial_color.green(),</span><br><span class="line">                                               <span class="variable language_">self</span>.initial_color.blue()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_custom_dialog</span>(<span class="params">self</span>):</span><br><span class="line">        custom_dialog = CustomDialog()</span><br><span class="line"></span><br><span class="line">        result = custom_dialog.exec_()  <span class="comment"># 自定义窗口模式 这个模式是打开后只能够在当前窗口操作，窗口关闭前不能执行窗口外的操作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> result == QtWidgets.QDialog.Accepted:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Name: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(custom_dialog.get_text()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="n7TgF"></a></p>
<h2 id="标准Qt对话框">标准Qt对话框</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660703172622-7846ab65-52cb-4757-bcd4-e64748ce6b24.png#averageHue=%234c4c4c&amp;clientId=u88fb9660-6e1f-4&amp;from=paste&amp;height=523&amp;id=ucbd9754e&amp;originHeight=523&amp;originWidth=665&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=86237&amp;status=done&amp;style=none&amp;taskId=ufec16794-3083-451f-87df-542146cd64f&amp;title=&amp;width=665" alt="image.png"><br>没找到源码，视频上也没显示全，就不放代码了。<br>
<a name="az5pO"></a></p>
<h1>QListWidget</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660710501521-ea737a89-d60d-45aa-996b-a4db34ad19aa.png#averageHue=%23494948&amp;clientId=u88fb9660-6e1f-4&amp;from=paste&amp;height=260&amp;id=u4932fb14&amp;originHeight=260&amp;originWidth=236&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7610&amp;status=done&amp;style=none&amp;taskId=ucf9c9473-c59c-498e-839f-60d0b31d97b&amp;title=&amp;width=236" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OutputResolutionDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    <span class="comment"># 数值用带小数点的原因是要计算长宽比，长宽比是小数</span></span><br><span class="line">    RESOLUTION_ITEMS = [[<span class="string">&quot;1920X1080 (1080p)&quot;</span>, <span class="number">1920.0</span>, <span class="number">1080.0</span>],</span><br><span class="line">                        [<span class="string">&quot;1280X720 (720p)&quot;</span>, <span class="number">1280.0</span>, <span class="number">720.0</span>],</span><br><span class="line">                        [<span class="string">&quot;960X540 (540p)&quot;</span>, <span class="number">960.0</span>, <span class="number">540.0</span>],</span><br><span class="line">                        [<span class="string">&quot;640X480&quot;</span>, <span class="number">640.0</span>, <span class="number">480.0</span>],</span><br><span class="line">                        [<span class="string">&quot;320X240&quot;</span>, <span class="number">320.0</span>, <span class="number">240.0</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(OutputResolutionDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Output Resolution&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setFixedWidth(<span class="number">220</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.resolution_list_wdg = QtWidgets.QListWidget()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> resolution_item <span class="keyword">in</span> <span class="variable language_">self</span>.RESOLUTION_ITEMS:</span><br><span class="line">            list_wdg_item = QtWidgets.QListWidgetItem(resolution_item[<span class="number">0</span>])</span><br><span class="line">            <span class="comment"># QtCore.Qt.UserRole可以理解为序号0,一个item可以拥有多个数据，因此可以通过QtCore.Qt.UserRole，QtCore.Qt.UserRole+1来设置数据的序号</span></span><br><span class="line">            list_wdg_item.setData(QtCore.Qt.UserRole,</span><br><span class="line">                                  [resolution_item[<span class="number">1</span>], resolution_item[<span class="number">2</span>]]) </span><br><span class="line">            <span class="variable language_">self</span>.resolution_list_wdg.addItem(list_wdg_item)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&#x27;Close&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)  <span class="comment"># 设置布局与窗口边界的距离</span></span><br><span class="line">        main_layout.setSpacing(<span class="number">2</span>)  <span class="comment"># 设置布局中的控件之间的间隙</span></span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.resolution_list_wdg)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.resolution_list_wdg.itemClicked.connect(<span class="variable language_">self</span>.set_output_resolution)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_output_resolution</span>(<span class="params">self, item</span>):</span><br><span class="line">        resolution = item.data(QtCore.Qt.UserRole)</span><br><span class="line"></span><br><span class="line">        cmds.setAttr(<span class="string">&quot;defaultResolution.width&quot;</span>, resolution[<span class="number">0</span>])</span><br><span class="line">        cmds.setAttr(<span class="string">&quot;defaultResolution.height&quot;</span>, resolution[<span class="number">1</span>])</span><br><span class="line">        cmds.setAttr(<span class="string">&quot;defaultResolution.deviceAspectRatio&quot;</span>, resolution[<span class="number">0</span>]/resolution[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = OutputResolutionDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="BM1yP"></a></p>
<h1>可以设置的选择模式</h1>
<p>举例：<br>self.resolution_list_wdg = QtWidgets.QListWidget()<br>self.resolution_list_wdg.setSelectionMode(QtWidgets.QAbstractItemView.MultiSelection) # 设置listWidget控件的选择模式为MultiSelection     <br>ExtendedSelection与MultiSelection的区别是第一个需要按住ctrl或者shift多选，第二个不需要</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>QAbstractItemView::SingleSelection</td>
<td>1</td>
<td>When the user selects an item, any already-selected item becomes unselected. It is possible for the user to deselect the selected item by pressing the Ctrl key when clicking the selected item.</td>
</tr>
<tr>
<td>QAbstractItemView::ContiguousSelection</td>
<td>4</td>
<td>When the user selects an item in the usual way, the selection is cleared and the new item selected. However, if the user presses the Shift key while clicking on an item, all items between the current item and the clicked item are selected or unselected, depending on the state of the clicked item.</td>
</tr>
<tr>
<td>QAbstractItemView::ExtendedSelection</td>
<td>3</td>
<td>When the user selects an item in the usual way, the selection is cleared and the new item selected. However, if the user presses the Ctrl key when clicking on an item, the clicked item gets toggled and all other items are left untouched. If the user presses the Shift key while clicking on an item, all items between the current item and the clicked item are selected or unselected, depending on the state of the clicked item. Multiple items can be selected by dragging the mouse over them.</td>
</tr>
<tr>
<td>QAbstractItemView::MultiSelection</td>
<td>2</td>
<td>When the user selects an item in the usual way, the selection status of that item is toggled and the other items are left alone. Multiple items can be toggled by dragging the mouse over them.</td>
</tr>
<tr>
<td>QAbstractItemView::NoSelection</td>
<td>0</td>
<td>Items cannot be selected.</td>
</tr>
</tbody>
</table>
<p><a name="LaZ0H"></a></p>
<h1>QTableDialog</h1>
<p><a name="PgPfM"></a></p>
<h2 id="显示大纲模型名字以及变换信息窗口">显示大纲模型名字以及变换信息窗口</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1660717613536-9bd230fa-ce6a-43ed-8188-b428b498e914.png#averageHue=%23595755&amp;clientId=u88fb9660-6e1f-4&amp;from=paste&amp;height=356&amp;id=ue9e1df1d&amp;originHeight=356&amp;originWidth=691&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76846&amp;status=done&amp;style=none&amp;taskId=ua6156b97-b453-4274-a681-bd2645ee798&amp;title=&amp;width=691" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TableExampleDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    ATTR_ROLE = QtCore.Qt.UserRole</span><br><span class="line">    VALUE_ROLE = QtCore.Qt.UserRole + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TableExampleDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Table Example&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setFixedWidth(<span class="number">500</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg = QtWidgets.QTableWidget()</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnCount(<span class="number">5</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnWidth(<span class="number">0</span>, <span class="number">22</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnWidth(<span class="number">2</span>, <span class="number">70</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnWidth(<span class="number">3</span>, <span class="number">70</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnWidth(<span class="number">4</span>, <span class="number">70</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setHorizontalHeaderLabels([<span class="string">&quot;&quot;</span>, <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;TransX&quot;</span>, <span class="string">&quot;TransY&quot;</span>, <span class="string">&quot;TransZ&quot;</span>])</span><br><span class="line">        header_view = <span class="variable language_">self</span>.table_wdg.horizontalHeader()</span><br><span class="line">        header_view.setSectionResizeMode(<span class="number">1</span>, QtWidgets.QHeaderView.Stretch)  <span class="comment"># 设置标题栏为自动填充窗口</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn = QtWidgets.QPushButton(<span class="string">&quot;Refresh&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.refresh_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.table_wdg)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_cell_changed_connection_enabled(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn.clicked.connect(<span class="variable language_">self</span>.refresh_table)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_cell_changed_connection_enabled</span>(<span class="params">self, enabled</span>):  <span class="comment"># 设置单元格信号与槽的连接状态  目的是使执行refresh时不执行槽函数</span></span><br><span class="line">        <span class="keyword">if</span> enabled:</span><br><span class="line">            <span class="variable language_">self</span>.table_wdg.cellChanged.connect(<span class="variable language_">self</span>.on_cell_changed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.table_wdg.cellChanged.disconnect(<span class="variable language_">self</span>.on_cell_changed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(TableExampleDialog, <span class="variable language_">self</span>).showEvent(e)  <span class="comment"># 当启动窗口时执行这个函数</span></span><br><span class="line">        <span class="variable language_">self</span>.refresh_table()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keyPressEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(TableExampleDialog, <span class="variable language_">self</span>).keyPressEvent(e)</span><br><span class="line">        e.accept()  <span class="comment"># 当在工具窗口中使用键盘时不会影响到maya主窗口的对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_table</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_cell_changed_connection_enabled(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setRowCount(<span class="number">0</span>)  <span class="comment"># 将tableWidget 的所有项清空</span></span><br><span class="line"></span><br><span class="line">        meshes = cmds.ls(typ=<span class="string">&quot;mesh&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(meshes)):</span><br><span class="line">            transform_name = cmds.listRelatives(meshes[i], parent=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">            translation = cmds.getAttr(<span class="string">&quot;&#123;&#125;.translate&quot;</span>.<span class="built_in">format</span>(transform_name))[<span class="number">0</span>]</span><br><span class="line">            visible = cmds.getAttr(<span class="string">&quot;&#123;&#125;.visibility&quot;</span>.<span class="built_in">format</span>(transform_name))</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.table_wdg.insertRow(i)</span><br><span class="line">            <span class="variable language_">self</span>.insert_item(i, <span class="number">0</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;visibility&quot;</span>, visible, <span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.insert_item(i, <span class="number">1</span>, transform_name, <span class="literal">None</span>, transform_name, <span class="literal">False</span>)</span><br><span class="line">            <span class="variable language_">self</span>.insert_item(i, <span class="number">2</span>, <span class="variable language_">self</span>.float_to_string(translation[<span class="number">0</span>]), <span class="string">&quot;tx&quot;</span>, translation[<span class="number">0</span>], <span class="literal">False</span>)</span><br><span class="line">            <span class="variable language_">self</span>.insert_item(i, <span class="number">3</span>, <span class="variable language_">self</span>.float_to_string(translation[<span class="number">1</span>]), <span class="string">&quot;ty&quot;</span>, translation[<span class="number">0</span>], <span class="literal">False</span>)</span><br><span class="line">            <span class="variable language_">self</span>.insert_item(i, <span class="number">4</span>, <span class="variable language_">self</span>.float_to_string(translation[<span class="number">2</span>]), <span class="string">&quot;tz&quot;</span>, translation[<span class="number">0</span>], <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.set_cell_changed_connection_enabled(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_item</span>(<span class="params">self, row, column, text, attr, value, is_boolean</span>):</span><br><span class="line">        item = QtWidgets.QTableWidgetItem(text)</span><br><span class="line">        <span class="variable language_">self</span>.set_item_attr(item, attr)</span><br><span class="line">        <span class="variable language_">self</span>.set_item_value(item, value)</span><br><span class="line">        <span class="keyword">if</span> is_boolean:</span><br><span class="line">            item.setFlags(QtCore.Qt.ItemIsUserCheckable | QtCore.Qt.ItemIsEnabled)  <span class="comment"># 设置复选框</span></span><br><span class="line">            <span class="variable language_">self</span>.set_item_checked(item, value)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setItem(row, column, item)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_cell_changed</span>(<span class="params">self, row, column</span>):</span><br><span class="line">        <span class="comment"># 单元格进行改变时先将信号与槽断开连接，当rename执行完成以后再连接起来</span></span><br><span class="line">        <span class="comment"># 控制信号与槽连接状态的目的就是控制什么时候改变单元格的信息时执行槽函数</span></span><br><span class="line">        <span class="variable language_">self</span>.set_cell_changed_connection_enabled(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        item = <span class="variable language_">self</span>.table_wdg.item(row, column)</span><br><span class="line">        <span class="keyword">if</span> column == <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.rename(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_boolean = column == <span class="number">0</span></span><br><span class="line">            <span class="variable language_">self</span>.update_attr(<span class="variable language_">self</span>.get_full_attr_name(row, item), item, is_boolean)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.set_cell_changed_connection_enabled(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rename</span>(<span class="params">self, item</span>):</span><br><span class="line">        old_name = <span class="variable language_">self</span>.get_item_value(item)</span><br><span class="line">        new_name = <span class="variable language_">self</span>.get_item_text(item)</span><br><span class="line">        <span class="keyword">if</span> old_name != new_name:</span><br><span class="line">            actual_new_name = cmds.rename(old_name, new_name)</span><br><span class="line">            <span class="keyword">if</span> actual_new_name != new_name:</span><br><span class="line">                <span class="variable language_">self</span>.set_item_text(item, actual_new_name)</span><br><span class="line">            <span class="variable language_">self</span>.set_item_value(item, actual_new_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_attr</span>(<span class="params">self, attr_name, item, is_boolean</span>):</span><br><span class="line">        <span class="keyword">if</span> is_boolean:</span><br><span class="line">            value = <span class="variable language_">self</span>.is_item_checked(item)</span><br><span class="line">            <span class="variable language_">self</span>.set_item_text(item, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            text = <span class="variable language_">self</span>.get_item_text(item)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                value = <span class="built_in">float</span>(text)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="variable language_">self</span>.revert_original_value(item, is_boolean)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cmds.setAttr(attr_name, value)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="variable language_">self</span>.revert_original_value(item, is_boolean)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        new_value = cmds.getAttr(attr_name)</span><br><span class="line">        <span class="keyword">if</span> is_boolean:</span><br><span class="line">            <span class="variable language_">self</span>.set_item_checked(item, new_value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.set_item_text(item, <span class="variable language_">self</span>.float_to_string(new_value))</span><br><span class="line">        <span class="variable language_">self</span>.set_item_value(item, new_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_item_text</span>(<span class="params">self, item, text</span>):</span><br><span class="line">        item.setText(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_item_text</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> item.text()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_item_checked</span>(<span class="params">self, item, checked</span>):</span><br><span class="line">        <span class="keyword">if</span> checked:</span><br><span class="line">            item.setCheckState(QtCore.Qt.Checked)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            item.setCheckState(QtCore.Qt.Unchecked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_item_checked</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> item.checkState() == QtCore.Qt.Checked</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_item_attr</span>(<span class="params">self, item, attr</span>):</span><br><span class="line">        item.setData(<span class="variable language_">self</span>.ATTR_ROLE, attr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_item_attr</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> item.data(<span class="variable language_">self</span>.ATTR_ROLE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_item_value</span>(<span class="params">self, item, value</span>):</span><br><span class="line">        item.setData(<span class="variable language_">self</span>.VALUE_ROLE, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_full_attr_name</span>(<span class="params">self, row, item</span>):</span><br><span class="line">        node_name = <span class="variable language_">self</span>.table_wdg.item(row, <span class="number">1</span>).data(<span class="variable language_">self</span>.VALUE_ROLE)</span><br><span class="line">        attr_name = <span class="variable language_">self</span>.get_item_attr(item)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;0&#125;.&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(node_name, attr_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_item_value</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> item.data(<span class="variable language_">self</span>.VALUE_ROLE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">float_to_string</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;0:.4f&#125;&quot;</span>.<span class="built_in">format</span>(value)  <span class="comment"># 令浮点数变成保留四位数的字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">revert_original_value</span>(<span class="params">self, item, is_boolean</span>):</span><br><span class="line">        original_value = <span class="variable language_">self</span>.get_item_value(item)</span><br><span class="line">        <span class="keyword">if</span> is_boolean:</span><br><span class="line">            <span class="variable language_">self</span>.set_item_checked(item, original_value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.set_item_text(item, <span class="variable language_">self</span>.flate_to_string(original_value))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TableExampleDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="lWuF1"></a></p>
<h2 id="在表格控件中添加其他控件">在表格控件中添加其他控件</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661410775956-afb1b836-aa01-412e-846a-397b927d705f.png#averageHue=%23505050&amp;clientId=u9eaa8f12-95dd-4&amp;from=paste&amp;height=260&amp;id=uabb0d097&amp;originHeight=260&amp;originWidth=316&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7437&amp;status=done&amp;style=none&amp;taskId=ua2bdaaf9-3ef7-4efe-9e3c-cdbc5f38ed8&amp;title=&amp;width=316" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TableExampleDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TableExampleDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Table Example&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setFixedWidth(<span class="number">300</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg = QtWidgets.QTableWidget()</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setColumnCount(<span class="number">3</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setHorizontalHeaderLabels([<span class="string">&quot;QPushButton&quot;</span>, <span class="string">&quot;QSpinBox&quot;</span>, <span class="string">&quot;QComboBox&quot;</span>])</span><br><span class="line">        header_view = <span class="variable language_">self</span>.table_wdg.horizontalHeader()</span><br><span class="line">        header_view.setSectionResizeMode(<span class="number">1</span>, QtWidgets.QHeaderView.Stretch)  <span class="comment"># 设置标题栏为自动填充窗口</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn = QtWidgets.QPushButton(<span class="string">&quot;Refresh&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.refresh_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.table_wdg)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn.clicked.connect(<span class="variable language_">self</span>.refresh_table)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(TableExampleDialog, <span class="variable language_">self</span>).showEvent(e)  <span class="comment"># 当启动窗口时执行这个函数</span></span><br><span class="line">        <span class="variable language_">self</span>.refresh_table()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_table</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setRowCount(<span class="number">0</span>)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.insertRow(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        btn = QtWidgets.QPushButton(<span class="string">&quot;Button&quot;</span>)</span><br><span class="line">        btn.clicked.connect(<span class="variable language_">self</span>.on_button_pressed)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setCellWidget(<span class="number">0</span>, <span class="number">0</span>, btn)</span><br><span class="line"></span><br><span class="line">        spin_box = QtWidgets.QSpinBox()</span><br><span class="line">        spin_box.valueChanged.connect(<span class="variable language_">self</span>.on_value_changed)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setCellWidget(<span class="number">0</span>, <span class="number">1</span>, spin_box)</span><br><span class="line"></span><br><span class="line">        combo_box = QtWidgets.QComboBox()</span><br><span class="line">        combo_box.addItems([<span class="string">&quot;Item 1&quot;</span>, <span class="string">&quot;Item2&quot;</span>, <span class="string">&quot;Item3&quot;</span>])</span><br><span class="line">        combo_box.currentTextChanged.connect(<span class="variable language_">self</span>.on_current_text_changed)</span><br><span class="line">        <span class="variable language_">self</span>.table_wdg.setCellWidget(<span class="number">0</span>, <span class="number">2</span>, combo_box)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_button_pressed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Button was pressed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_value_changed</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;SpinBox value changed: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(value))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_current_text_changed</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ComboBox text changed: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(text))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TableExampleDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="tbVxe"></a></p>
<h1>QSpinBox与QDoubleSpinBox</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661412226518-48951f98-411f-4fd4-9fc4-9b8306dfb70e.png#averageHue=%23737271&amp;clientId=u9eaa8f12-95dd-4&amp;from=paste&amp;height=106&amp;id=uf4e77954&amp;originHeight=106&amp;originWidth=211&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=5030&amp;status=done&amp;style=none&amp;taskId=u71974899-6a25-4801-b784-e71cbac61fa&amp;title=&amp;width=211" alt="image.png"><br>可以通过鼠标滚轮滑动来更改数值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpinBoxDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(SpinBoxDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Spin Box Dialog&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.spin_box = QtWidgets.QSpinBox()</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setFixedWidth(<span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setMinimum(-<span class="number">100</span>)</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setMaximum(<span class="number">100</span>)</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setSingleStep(<span class="number">5</span>)</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setPrefix(<span class="string">&quot;$ &quot;</span>)  <span class="comment"># 设置显示的前缀 但是不会当值来交互，仅仅是显示</span></span><br><span class="line">        <span class="variable language_">self</span>.spin_box.setButtonSymbols(QtWidgets.QAbstractSpinBox.NoButtons)  <span class="comment"># 取消显示上下按钮框</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.double_spin_box = QtWidgets.QDoubleSpinBox()</span><br><span class="line">        <span class="variable language_">self</span>.double_spin_box.setFixedWidth(<span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.double_spin_box.setRange(-<span class="number">50.0</span>, <span class="number">50.0</span>)</span><br><span class="line">        <span class="variable language_">self</span>.double_spin_box.setSuffix(<span class="string">&quot; m&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        main_layout = QtWidgets.QFormLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addRow(<span class="string">&quot;Spin Box:&quot;</span>, <span class="variable language_">self</span>.spin_box)</span><br><span class="line">        main_layout.addRow(<span class="string">&quot;Double Spin Box:&quot;</span>, <span class="variable language_">self</span>.double_spin_box)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.spin_box.valueChanged.connect(<span class="variable language_">self</span>.print_value)</span><br><span class="line">        <span class="variable language_">self</span>.double_spin_box.valueChanged.connect(<span class="variable language_">self</span>.print_value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_value</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(value))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = SpinBoxDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="L2Pcc"></a></p>
<h1>启动maya图标资源管理器</h1>
<p>import maya.app.general.resourceBrowser as resourceBrowser<br>resourceBrowser.resourceBrowser().run()<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661419111759-00e4785c-b7ec-4dbf-bc59-ef400fa10604.png#averageHue=%23514f4e&amp;clientId=uc6467607-8068-4&amp;from=paste&amp;height=296&amp;id=ubbdb2553&amp;originHeight=296&amp;originWidth=351&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14092&amp;status=done&amp;style=none&amp;taskId=ue1cf3996-139b-4ae6-9efa-f1f57dc83aa&amp;title=&amp;width=351" alt="image.png"><br>在这里可以预览窗口的图标和名字<br>
<a name="uYFCq"></a></p>
<h1>QTreeView File Explorer</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661422262493-6e04ef7d-e127-46ac-8ba1-ef98557b76b2.png#averageHue=%233d3d3c&amp;clientId=uc6467607-8068-4&amp;from=paste&amp;height=439&amp;id=u3bf9a10f&amp;originHeight=439&amp;originWidth=516&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12708&amp;status=done&amp;style=none&amp;taskId=ua705bd21-cea0-4f6f-ac3c-1470a3bd245&amp;title=&amp;width=516" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeViewDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Tree View Dialog&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TreeViewDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        root_path = <span class="string">&quot;&#123;&#125;scripts&quot;</span>.<span class="built_in">format</span>(cmds.internalVar(userAppDir=<span class="literal">True</span>))  <span class="comment"># 得到maya脚本目录</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.model = QtWidgets.QFileSystemModel() <span class="comment"># 获得一个FileSystem模式</span></span><br><span class="line">        <span class="variable language_">self</span>.model.setRootPath(root_path)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_view = QtWidgets.QTreeView() <span class="comment"># 创建QTreeView控件</span></span><br><span class="line">        <span class="variable language_">self</span>.tree_view.setModel(<span class="variable language_">self</span>.model) <span class="comment"># 为控件添加模式</span></span><br><span class="line">        <span class="variable language_">self</span>.tree_view.setRootIndex(<span class="variable language_">self</span>.model.index(root_path))</span><br><span class="line">        <span class="variable language_">self</span>.tree_view.hideColumn(<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.tree_view.setColumnWidth(<span class="number">0</span>, <span class="number">240</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.model.setFilter(QtCore.QDir.Dirs | QtCore.QDir.NoDotAndDotDot)</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.model.setNameFilters([<span class="string">&quot;*.py&quot;</span>])  <span class="comment"># 使只能选中.py后缀的文件</span></span><br><span class="line">        <span class="variable language_">self</span>.model.setNameFilterDisables(<span class="literal">False</span>)  <span class="comment"># 将不能选中的文件进行隐藏</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.tree_view)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.tree_view.doubleClicked.connect(<span class="variable language_">self</span>.on_double_clicked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_double_clicked</span>(<span class="params">self, index</span>):</span><br><span class="line">        path = <span class="variable language_">self</span>.model.filePath(index)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.model.isDir(index):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Directory selected: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Directory selected: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TreeViewDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="ornOr"></a></p>
<h1>制作简单的大纲</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661497459146-e8a29ae1-0130-4554-abcd-245750f64cfa.png#averageHue=%23494848&amp;clientId=u7b21ee06-bbc2-4&amp;from=paste&amp;height=345&amp;id=ub97e2f98&amp;originHeight=345&amp;originWidth=384&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20501&amp;status=done&amp;style=none&amp;taskId=u9b265fd3-2f15-494b-aa9b-c4a7a3b5274&amp;title=&amp;width=384" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleOutliner</span>(QtWidgets.QDialog):</span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Simple Outliner&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleOutliner, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="keyword">if</span> cmds.about(ntOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line">        <span class="keyword">elif</span> cmds.about(macOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.Tool)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setMinimumWidth(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.transform_icon = QtGui.QIcon(<span class="string">&quot;:transform.svg&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.camera_icon = QtGui.QIcon(<span class="string">&quot;:Camera.png&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.mesh_icon = QtGui.QIcon(<span class="string">&quot;:mesh.svg&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.script_job_number = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_actions()</span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setContextMenuPolicy(QtCore.Qt.CustomContextMenu)  <span class="comment"># 使能显示上下文菜单</span></span><br><span class="line">        <span class="variable language_">self</span>.customContextMenuRequested.connect(<span class="variable language_">self</span>.show_context_menu)  <span class="comment"># 设置上下文菜单的ui</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_tree_widget()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_actions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.about_action = QtWidgets.QAction(<span class="string">&quot;About&quot;</span>, <span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action = QtWidgets.QAction(<span class="string">&quot;Shapes&quot;</span>, <span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setCheckable(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setChecked(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setShortcut(QtGui.QKeySequence(<span class="string">&quot;Ctrl+Shift+H&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.menu_bar = QtWidgets.QMenuBar()</span><br><span class="line">        display_menu = <span class="variable language_">self</span>.menu_bar.addMenu(<span class="string">&quot;Display&quot;</span>)</span><br><span class="line">        display_menu.addAction(<span class="variable language_">self</span>.display_shape_action)</span><br><span class="line">        help_menu = <span class="variable language_">self</span>.menu_bar.addMenu(<span class="string">&quot;Help&quot;</span>)</span><br><span class="line">        help_menu.addAction(<span class="variable language_">self</span>.about_action)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget = QtWidgets.QTreeWidget()</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.setSelectionMode(QtWidgets.QAbstractItemView.ExtendedSelection)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.setHeaderHidden(<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># header = self.tree_widget.headerItem()</span></span><br><span class="line">        <span class="comment"># header.setText(0, &quot;Column 0 Text&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn = QtWidgets.QPushButton(<span class="string">&quot;Refresh&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.refresh_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>) <span class="comment"># 设置左上右下的边距</span></span><br><span class="line">        main_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        main_layout.setMenuBar(<span class="variable language_">self</span>.menu_bar)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.about_action.triggered.connect(<span class="variable language_">self</span>.about)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.toggled.connect(<span class="variable language_">self</span>.set_shape_nodes_visible)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemCollapsed.connect(<span class="variable language_">self</span>.update_icon)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemExpanded.connect(<span class="variable language_">self</span>.update_icon)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemSelectionChanged.connect(<span class="variable language_">self</span>.select_items)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn.clicked.connect(<span class="variable language_">self</span>.refresh_tree_widget)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_tree_widget</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.shape_nodes = cmds.ls(shapes=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.clear()</span><br><span class="line"></span><br><span class="line">        top_level_object_names = cmds.ls(assemblies=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> top_level_object_names:</span><br><span class="line">            item = <span class="variable language_">self</span>.create_item(name)</span><br><span class="line">            <span class="variable language_">self</span>.tree_widget.addTopLevelItem(item)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update_selection()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">self, name</span>):</span><br><span class="line">        item = QtWidgets.QTreeWidgetItem([name])</span><br><span class="line">        <span class="variable language_">self</span>.add_children(item)</span><br><span class="line">        <span class="variable language_">self</span>.update_icon(item)</span><br><span class="line"></span><br><span class="line">        is_shape = name <span class="keyword">in</span> <span class="variable language_">self</span>.shape_nodes</span><br><span class="line">        item.setData(<span class="number">0</span>, QtCore.Qt.UserRole, is_shape)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_children</span>(<span class="params">self, item</span>):</span><br><span class="line">        children = cmds.listRelatives(item.text(<span class="number">0</span>), children=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> children:</span><br><span class="line">            <span class="keyword">for</span> child <span class="keyword">in</span> children:</span><br><span class="line">                child_item = <span class="variable language_">self</span>.create_item(child)</span><br><span class="line">                item.addChild(child_item)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_icon</span>(<span class="params">self, item</span>):</span><br><span class="line">        object_type = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> item.isExpanded():  <span class="comment"># 如果item被展开</span></span><br><span class="line">            object_type = <span class="string">&quot;transform&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            child_count = item.childCount()</span><br><span class="line">            <span class="keyword">if</span> child_count == <span class="number">0</span>:</span><br><span class="line">                object_type = cmds.objectType(item.text(<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">elif</span> child_count == <span class="number">1</span>:</span><br><span class="line">                child_item = item.child(<span class="number">0</span>)</span><br><span class="line">                object_type = cmds.objectType(child_item.text(<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                object_type = <span class="string">&quot;transform&quot;</span></span><br><span class="line">        <span class="keyword">if</span> object_type == <span class="string">&quot;transform&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.transform_icon)</span><br><span class="line">        <span class="keyword">elif</span> object_type == <span class="string">&quot;camera&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.camera_icon)</span><br><span class="line">        <span class="keyword">elif</span> object_type == <span class="string">&quot;mesh&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.mesh_icon)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_items</span>(<span class="params">self</span>):</span><br><span class="line">        items = <span class="variable language_">self</span>.tree_widget.selectedItems()</span><br><span class="line">        names = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            names.append(item.text(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        cmds.select(names, replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">about</span>(<span class="params">self</span>):</span><br><span class="line">        QtWidgets.QMessageBox.about(<span class="variable language_">self</span>, <span class="string">&quot;About Simple Outliner&quot;</span>, <span class="string">&quot;Add About Text Here&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_shape_nodes_visible</span>(<span class="params">self, visible</span>):</span><br><span class="line">        iterator = QtWidgets.QTreeWidgetItemIterator(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        <span class="keyword">while</span> iterator.value():</span><br><span class="line">            item = iterator.value()</span><br><span class="line">            is_shape = item.data(<span class="number">0</span>, QtCore.Qt.UserRole)</span><br><span class="line">            <span class="keyword">if</span> is_shape:</span><br><span class="line">                item.setHidden(<span class="keyword">not</span> visible)</span><br><span class="line"></span><br><span class="line">            iterator += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_context_menu</span>(<span class="params">self, point</span>):</span><br><span class="line">        context_menu = QtWidgets.QMenu()</span><br><span class="line">        context_menu.addAction(<span class="variable language_">self</span>.display_shape_action)</span><br><span class="line">        context_menu.addSeparator()  <span class="comment"># 分割线</span></span><br><span class="line">        context_menu.addAction(<span class="variable language_">self</span>.about_action)</span><br><span class="line"></span><br><span class="line">        context_menu.exec_(<span class="variable language_">self</span>.mapToGlobal(point))  <span class="comment"># 右键显示菜单</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_selection</span>(<span class="params">self</span>):</span><br><span class="line">        selection = cmds.ls(selection=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        iterator = QtWidgets.QTreeWidgetItemIterator(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        <span class="keyword">while</span> iterator.value():</span><br><span class="line">            item = iterator.value()</span><br><span class="line">            is_selected = item.text(<span class="number">0</span>) <span class="keyword">in</span> selection</span><br><span class="line">            item.setSelected(is_selected)</span><br><span class="line"></span><br><span class="line">            iterator += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_script_job_enabled</span>(<span class="params">self, enabled</span>):</span><br><span class="line">        <span class="keyword">if</span> enabled <span class="keyword">and</span> <span class="variable language_">self</span>.script_job_number &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.script_job_number = cmds.scriptJob(event=[<span class="string">&quot;SelectionChanged&quot;</span>, partial(<span class="variable language_">self</span>.update_selection)], protected=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> enabled <span class="keyword">and</span> <span class="variable language_">self</span>.script_job_number &gt;= <span class="number">0</span>:</span><br><span class="line">            cmds.scriptJob(kill=<span class="variable language_">self</span>.script_job_number, force=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.script_job_number = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleOutliner, <span class="variable language_">self</span>).showEvent(e)</span><br><span class="line">        <span class="variable language_">self</span>.set_script_job_enabled(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="variable language_">self</span>, SimpleOutliner):</span><br><span class="line">            <span class="built_in">super</span>(SimpleOutliner, <span class="variable language_">self</span>).closeEvent(e)</span><br><span class="line">            <span class="variable language_">self</span>.set_script_job_enabled(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.set_script_job_enabled(<span class="literal">False</span>)</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = SimpleOutliner()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="i75Bg"></a></p>
<h1>制作进度条</h1>
<p><a name="QCRZm"></a></p>
<h2 id="不同对话框">不同对话框</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661740738923-bdd5fa24-618f-4436-b04c-b92f416af8ff.png#averageHue=%23636262&amp;clientId=u8655e55d-37ca-4&amp;from=paste&amp;height=183&amp;id=uf5be9777&amp;originHeight=183&amp;originWidth=602&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=10984&amp;status=done&amp;style=none&amp;taskId=u4732af8d-49c4-43a5-a08f-52902460a05&amp;title=&amp;width=602" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgressTestDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Progress Test&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(ProgressTestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="keyword">if</span> cmds.about(ntOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line">        <span class="keyword">elif</span> cmds.about(macOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.Tool)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_button = QtWidgets.QPushButton(<span class="string">&quot;Do It!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.progress_bar_button)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_button.clicked.connect(<span class="variable language_">self</span>.run_progress_test)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_progress_test</span>(<span class="params">self</span>):</span><br><span class="line">        number_of_operations = <span class="number">10</span>  <span class="comment"># 循环的数量</span></span><br><span class="line"></span><br><span class="line">        progress_dialog = QtWidgets.QProgressDialog(<span class="string">&quot;Waiting to process...&quot;</span>, <span class="string">&quot;Cancel&quot;</span>, <span class="number">0</span>, number_of_operations, <span class="variable language_">self</span>)</span><br><span class="line">        progress_dialog.setWindowTitle(<span class="string">&quot;Progress...&quot;</span>)</span><br><span class="line">        progress_dialog.setValue(<span class="number">0</span>)</span><br><span class="line">        progress_dialog.setWindowModality(QtCore.Qt.WindowModal)  <span class="comment"># 设置为进度条窗口出现时，代码依然能够执行，但是不能使用除对话框之外的操作</span></span><br><span class="line">        progress_dialog.show()</span><br><span class="line"></span><br><span class="line">        QtCore.QCoreApplication.processEvents()  <span class="comment"># 在执行代码之前显示对话框</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, number_of_operations + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> progress_dialog.wasCanceled():  <span class="comment"># 当按了cancel按钮后中止代码</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            progress_dialog.setLabelText(<span class="string">&quot;Processing operation: &#123;0&#125; (fo &#123;1&#125;)&quot;</span>.<span class="built_in">format</span>(i, number_of_operations))</span><br><span class="line">            progress_dialog.setValue(i)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">            QtCore.QCoreApplication.processEvents()  <span class="comment"># 显示对话框的内容</span></span><br><span class="line"></span><br><span class="line">        progress_dialog.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = ProgressTestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>换一个函数举例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_progress_test</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">    mesh_list = cmds.ls(assemblies=<span class="literal">True</span>)</span><br><span class="line">    number_of_operations = <span class="built_in">len</span>(mesh_list)</span><br><span class="line"></span><br><span class="line">    progress_dialog = QtWidgets.QProgressDialog(<span class="string">&quot;Waiting to process...&quot;</span>, <span class="string">&quot;Cancel&quot;</span>, <span class="number">0</span>, number_of_operations, <span class="variable language_">self</span>)</span><br><span class="line">    progress_dialog.setWindowTitle(<span class="string">&quot;Progress...&quot;</span>)</span><br><span class="line">    progress_dialog.setValue(<span class="number">0</span>)</span><br><span class="line">    progress_dialog.setWindowModality(QtCore.Qt.WindowModal)  <span class="comment"># 设置为进度条窗口出现时，代码依然能够执行，但是不能使用除对话框之外的操作</span></span><br><span class="line">    progress_dialog.show()</span><br><span class="line"></span><br><span class="line">    QtCore.QCoreApplication.processEvents()  <span class="comment"># 在执行代码之前显示对话框</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> num,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(mesh_list):</span><br><span class="line">        <span class="keyword">if</span> progress_dialog.wasCanceled():  <span class="comment"># 当按了cancel按钮后中止代码</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        progress_dialog.setLabelText(<span class="string">&quot;&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">        progress_dialog.setValue(num)</span><br><span class="line">        <span class="built_in">print</span> i</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">        QtCore.QCoreApplication.processEvents()  <span class="comment"># 显示对话框的内容</span></span><br><span class="line"></span><br><span class="line">    progress_dialog.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="gP9wT"></a></p>
<h2 id="同一个对话框">同一个对话框</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661744051767-0810ebd0-b8ae-434d-ac81-c539eb784adf.png#averageHue=%23696969&amp;clientId=u8655e55d-37ca-4&amp;from=paste&amp;height=139&amp;id=u6ef4cc63&amp;originHeight=139&amp;originWidth=316&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3399&amp;status=done&amp;style=none&amp;taskId=ud246af90-c02d-4c8b-a77b-e03625aadad&amp;title=&amp;width=316" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1661744057610-f2773001-1ecb-4c07-b68f-8eabdd426779.png#averageHue=%23696968&amp;clientId=u8655e55d-37ca-4&amp;from=paste&amp;height=139&amp;id=u9287f141&amp;originHeight=139&amp;originWidth=316&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=5246&amp;status=done&amp;style=none&amp;taskId=u7482b385-c5c1-46f8-aa0e-a9604252dce&amp;title=&amp;width=316" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgressTestDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Progress Test&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(ProgressTestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="keyword">if</span> cmds.about(ntOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line">        <span class="keyword">elif</span> cmds.about(macOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.Tool)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.test_in_progress = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_label = QtWidgets.QLabel(<span class="string">&quot;Operation Progress&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar = QtWidgets.QProgressBar()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_button = QtWidgets.QPushButton(<span class="string">&quot;Do It!&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_button = QtWidgets.QPushButton(<span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update_visibility()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        progress_layout = QtWidgets.QVBoxLayout()</span><br><span class="line">        progress_layout.addWidget(<span class="variable language_">self</span>.progress_bar_label)</span><br><span class="line">        progress_layout.addWidget(<span class="variable language_">self</span>.progress_bar)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.progress_bar_button)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.cancel_button)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>) <span class="comment"># 设置左上右下的边距</span></span><br><span class="line">        main_layout.addLayout(progress_layout)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_button.clicked.connect(<span class="variable language_">self</span>.run_progress_test)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_button.clicked.connect(<span class="variable language_">self</span>.cancel_progress_test)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_visibility</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_label.setVisible(<span class="variable language_">self</span>.test_in_progress)</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar.setVisible(<span class="variable language_">self</span>.test_in_progress)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.cancel_button.setVisible(<span class="variable language_">self</span>.test_in_progress)</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_button.setHidden(<span class="variable language_">self</span>.test_in_progress)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_progress_test</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.test_in_progress:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        number_of_operation = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.progress_bar.setRange(<span class="number">0</span>, number_of_operation)</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar.setValue(<span class="number">0</span>)</span><br><span class="line">        <span class="variable language_">self</span>.progress_bar_label.setText(<span class="string">&quot;Operation Progress&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.test_in_progress = <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.update_visibility()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, number_of_operation + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.test_in_progress:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.progress_bar_label.setText(<span class="string">&quot;Processing operation: &#123;0&#125; (of &#123;1&#125;)&quot;</span>.<span class="built_in">format</span>(i, number_of_operation))</span><br><span class="line">            <span class="variable language_">self</span>.progress_bar.setValue(i)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">            QtCore.QCoreApplication.processEvents()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.test_in_progress = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.update_visibility()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cancel_progress_test</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.test_in_progress = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = ProgressTestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="oQ0bx"></a></p>
<h1>QWidget vs QDialog</h1>
<p><a name="GiDDj"></a></p>
<h2 id="QWidget与QDialog的显示区别">QWidget与QDialog的显示区别</h2>
<p>首先一个区别就是这两个<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1662026474082-19caa88c-f472-4130-9f16-c0d88eee7657.png#averageHue=%23494949&amp;clientId=u283bb055-7ea9-4&amp;from=paste&amp;height=337&amp;id=u7f86f38f&amp;originHeight=337&amp;originWidth=918&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=45973&amp;status=done&amp;style=none&amp;taskId=ub15c8f00-9cf4-4090-ae90-0b144a8e8c6&amp;title=&amp;width=918" alt="image.png"><br>但是如果想要使用QWidget窗口的话可能会出现窗口不能独立显示出画面中，可能会内嵌到maya主窗口中，要想使用QWidget需要解决这个问题。<br>导致QWidget窗口内嵌到maya主窗口中的原因是因为之前都一直设置的将maya主窗口设置为我们的工具UI的parent，因此QWidget会内嵌到maya主窗口中。<br>要想解决QWidget窗口内嵌到maya主窗口，这里给出一个QWidget的案例<br>主要解决代码为：self.setWindowFlags(QtCore.Qt.WindowType.Window)<br><strong>这行代码也可以直接用在QDialog的案例上面，可以直接将QDialog中的窗口类型改为Window。使QDialog窗口也能够显示最小化最大化窗口按钮</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QWidget):</span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Window Test&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.WindowType.Window)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ok_button = QtWidgets.QPushButton(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.ok_button.setMinimumWidth(<span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_button = QtWidgets.QPushButton(<span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cancel_button.setMinimumWidth(<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.ok_button)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.cancel_button)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br></pre></td></tr></table></figure>
<p><a name="hAiut"></a></p>
<h1>添加图片（QImage，QPixmap）</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1662358835263-488379c3-ddef-4112-9de1-9efe02044a60.png#averageHue=%23ceb079&amp;clientId=u4f2d97de-80f8-4&amp;from=paste&amp;height=259&amp;id=u9f6dd67f&amp;originHeight=259&amp;originWidth=619&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=112997&amp;status=done&amp;style=none&amp;taskId=u3f249d07-3316-4b17-8bfe-078053fe98f&amp;title=&amp;width=619" alt="image.png">左边是使用平滑模式，右边没有使用。<br>image = image.scaled(280, 100, QtCore.Qt.IgnoreAspectRatio, QtCore.Qt.SmoothTransformation)  # 使用平滑模式，使缩小图片时不会丢失细节。<br>QPushButton 使用setIcon方法<br>QLabel 使用setPixmap方法<br>设置pixmap对象时需要为pixmap指定一个image对象，调整图片就调整image。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDialog</span>(QtWidgets.QDialog):</span><br><span class="line">    FILE_FILTERS = <span class="string">&quot;Maya(*.ma *.mb);;Maya ASCII (*.ma);;Maya Binary (*.mb);;All Files (*.*)&quot;</span>  <span class="comment"># 全部的过滤项</span></span><br><span class="line"></span><br><span class="line">    selected_filter = <span class="string">&quot;Maya (*.ma *.mb)&quot;</span>  <span class="comment"># 记录选择的过滤项，每次更改过滤项的同时会更改这个全局变量的值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(TestDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Open/Import/Reference&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.create_title_label()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.filepath_le = QtWidgets.QLineEdit()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn = QtWidgets.QPushButton()</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setIcon(QtGui.QIcon(<span class="string">&#x27;:fileOpen.png&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.setToolTip(<span class="string">&quot;select File&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb = QtWidgets.QRadioButton(<span class="string">&quot;Open&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.open_rb.setChecked(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.import_rb = QtWidgets.QRadioButton(<span class="string">&quot;Import&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.reference_rb = QtWidgets.QRadioButton(<span class="string">&quot;Reference&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.force_cb = QtWidgets.QCheckBox(<span class="string">&quot;Force&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn = QtWidgets.QPushButton(<span class="string">&quot;Apply&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_title_label</span>(<span class="params">self</span>):</span><br><span class="line">        image_path = <span class="string">&quot;D:/ZhangRuiChen/image/test_image.jpg&quot;</span></span><br><span class="line">        image = QtGui.QImage(image_path)</span><br><span class="line">        image = image.scaled(<span class="number">280</span>, <span class="number">100</span>, QtCore.Qt.IgnoreAspectRatio, QtCore.Qt.SmoothTransformation)</span><br><span class="line"></span><br><span class="line">        pixmap = QtGui.QPixmap()</span><br><span class="line">        pixmap.convertFromImage(image)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.title_label = QtWidgets.QLabel(<span class="string">&quot;My Awesome Utility&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.title_label.setPixmap(pixmap)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        file_path_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.filepath_le)</span><br><span class="line">        file_path_layout.addWidget(<span class="variable language_">self</span>.select_file_path_btn)</span><br><span class="line"></span><br><span class="line">        radio_btn_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.open_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.import_rb)</span><br><span class="line">        radio_btn_layout.addWidget(<span class="variable language_">self</span>.reference_rb)</span><br><span class="line"></span><br><span class="line">        forme_layout = QtWidgets.QFormLayout()</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;File&quot;</span>, file_path_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, radio_btn_layout)</span><br><span class="line">        forme_layout.addRow(<span class="string">&quot;&quot;</span>, <span class="variable language_">self</span>.force_cb)</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.apply_btn)</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.title_label)</span><br><span class="line">        main_layout.addLayout(forme_layout)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.select_file_path_btn.clicked.connect(<span class="variable language_">self</span>.show_file_select_dialog)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.open_rb.toggled.connect(<span class="variable language_">self</span>.update_force_visibility)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.apply_btn.clicked.connect(<span class="variable language_">self</span>.load_file)</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_file_select_dialog</span>(<span class="params">self</span>):</span><br><span class="line">        file_path, <span class="variable language_">self</span>.selected_filter = QtWidgets.QFileDialog.getOpenFileName(<span class="variable language_">self</span>, <span class="string">&quot;Select File&quot;</span>, <span class="string">&quot;&quot;</span>,</span><br><span class="line">                                                                                <span class="variable language_">self</span>.FILE_FILTERS, <span class="variable language_">self</span>.selected_filter)</span><br><span class="line">        <span class="keyword">if</span> file_path:</span><br><span class="line">            <span class="variable language_">self</span>.filepath_le.setText(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_force_visibility</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.force_cb.setVisible(checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_file</span>(<span class="params">self</span>):</span><br><span class="line">        file_path = <span class="variable language_">self</span>.filepath_le.text()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_path:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)  <span class="comment"># 得到文件的信息</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_info.exists():  <span class="comment"># 判断文件是否存在</span></span><br><span class="line">            om.MGlobal.displayError(<span class="string">&quot;File does not exist: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(file_path))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.open_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.open_file(file_path)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.import_rb.isChecked():</span><br><span class="line">            <span class="variable language_">self</span>.import_file(file_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.reference_file(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        force = <span class="variable language_">self</span>.force_cb.isChecked()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> cmds.file(q=<span class="literal">True</span>, modified=<span class="literal">True</span>):</span><br><span class="line">            result = QtWidgets.QMessageBox.question(<span class="variable language_">self</span>, <span class="string">&quot;Modified&quot;</span>, <span class="string">&quot;Current scene has unsaved changes. Continue?&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> result == QtWidgets.QMessageBox.StandardButton.Yes:</span><br><span class="line">                force = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        cmds.file(file_path, <span class="built_in">open</span>=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>, force=force)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">import_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, i=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reference_file</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        cmds.file(file_path, r=<span class="literal">True</span>, ignoreVersion=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = TestDialog()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="jN8Ha"></a></p>
<h1>遍历文件夹列出树结构</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671160357979-d432cf28-a6dd-4089-a185-1fca578d8897.png#averageHue=%23484847&amp;clientId=u0295db91-fe64-4&amp;from=paste&amp;height=309&amp;id=u14a78c68&amp;originHeight=278&amp;originWidth=262&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6045&amp;status=done&amp;style=none&amp;taskId=u0d81fb05-71d8-41c8-817f-2df86fdee7e&amp;title=&amp;width=291.11111882292215" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># 以树状结构显示指定路径下的所有内容，并且可以通过右键打开资源管理器并进入路径</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileExplorerDialog</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;File Explorer&quot;</span></span><br><span class="line"></span><br><span class="line">    DIRECTOR_PATH = <span class="string">&quot;&#123;0&#125;scripts&quot;</span>.<span class="built_in">format</span>(cmds.internalVar(userAppDir=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(FileExplorerDialog, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="keyword">if</span> cmds.about(ntOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(<span class="variable language_">self</span>.windowFlags() ^ QtCore.Qt.WindowContextHelpButtonHint)</span><br><span class="line">        <span class="keyword">elif</span> cmds.about(macOS=<span class="literal">True</span>):</span><br><span class="line">            <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.Tool)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_actions()</span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_wdg.setContextMenuPolicy(QtCore.Qt.CustomContextMenu) <span class="comment"># 使Context菜单只针对tree_wdg</span></span><br><span class="line">        <span class="variable language_">self</span>.tree_wdg.customContextMenuRequested.connect(<span class="variable language_">self</span>.show_context_menu) <span class="comment"># 使Context菜单为自定义的并给出菜单</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_list()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_actions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.show_in_folder_action = QtWidgets.QAction(<span class="string">&quot;Show in Folder&quot;</span>, <span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.path_label = QtWidgets.QLabel(<span class="variable language_">self</span>.DIRECTOR_PATH)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_wdg = QtWidgets.QTreeWidget()</span><br><span class="line">        <span class="variable language_">self</span>.tree_wdg.setHeaderHidden(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.close_btn = QtWidgets.QPushButton(<span class="string">&quot;Close&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.close_btn)</span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>) <span class="comment"># 设置左上右下的边距</span></span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.path_label)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.tree_wdg)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.close_btn.clicked.connect(<span class="variable language_">self</span>.close)</span><br><span class="line">        <span class="variable language_">self</span>.show_in_folder_action.triggered.connect(<span class="variable language_">self</span>.show_in_folder)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_list</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 显示文件树状结构 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.tree_wdg.clear()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_children(<span class="literal">None</span>, <span class="variable language_">self</span>.DIRECTOR_PATH)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_children</span>(<span class="params">self, parent_item, dir_path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 添加所有的子节点 &quot;&quot;&quot;</span></span><br><span class="line">        directory = QtCore.QDir(dir_path) <span class="comment"># 创建目录为dir_path的QDir对象</span></span><br><span class="line">        <span class="comment"># entryList作用是得到目录下的所有文件的字符串列表，参数第一个是设置过滤器，这里是要所有项并且没有.和..   第二个是设置排列，目录在最上方并且不区分大小写</span></span><br><span class="line">        files_in_directory = directory.entryList(QtCore.QDir.NoDotAndDotDot | QtCore.QDir.AllEntries, QtCore.QDir.DirsFirst | QtCore.QDir.IgnoreCase) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> file_name <span class="keyword">in</span> files_in_directory:</span><br><span class="line">            <span class="variable language_">self</span>.add_child(parent_item, dir_path, file_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_child</span>(<span class="params">self, parent_item, dir_path, file_name</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 实现添加子节点 &quot;&quot;&quot;</span></span><br><span class="line">        file_path = <span class="string">&quot;&#123;0&#125;/&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(dir_path, file_name)</span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> file_info.suffix().lower() == <span class="string">&quot;pyc&quot;</span>: <span class="comment"># 过滤后缀为pyc的文件</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        item = QtWidgets.QTreeWidgetItem(parent_item, [file_name])</span><br><span class="line">        item.setData(<span class="number">0</span>, QtCore.Qt.UserRole, file_path) <span class="comment"># QtCore.Qt.UserRole可以理解为序号0,一个item可以拥有多个数据，因此可以通过QtCore.Qt.UserRole，QtCore.Qt.UserRole+1来设置数据的序号</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> file_info.isDir():</span><br><span class="line">            <span class="string">&quot;&quot;&quot; 如果是文件夹就用add_children方法 &quot;&quot;&quot;</span></span><br><span class="line">            <span class="variable language_">self</span>.add_children(item, file_info.absoluteFilePath())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> parent_item:</span><br><span class="line">            <span class="string">&quot;&quot;&quot; 将item添加到最顶层树结构中 &quot;&quot;&quot;</span></span><br><span class="line">            <span class="variable language_">self</span>.tree_wdg.addTopLevelItem(item)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_context_menu</span>(<span class="params">self, pos</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 自定义菜单 &quot;&quot;&quot;</span></span><br><span class="line">        item = <span class="variable language_">self</span>.tree_wdg.itemAt(pos) <span class="comment"># 鼠标位置处的item</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> item:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        file_path = item.data(<span class="number">0</span>, QtCore.Qt.UserRole) <span class="comment"># 得到item里的数据</span></span><br><span class="line">        <span class="variable language_">self</span>.show_in_folder_action.setData(file_path) <span class="comment"># 设置action对应的数据</span></span><br><span class="line"></span><br><span class="line">        context_menu = QtWidgets.QMenu() <span class="comment"># 创建一个菜单</span></span><br><span class="line">        context_menu.addAction(<span class="variable language_">self</span>.show_in_folder_action) <span class="comment"># 将action添加到菜单下</span></span><br><span class="line">        context_menu.exec_(<span class="variable language_">self</span>.tree_wdg.mapToGlobal(pos)) <span class="comment"># 在鼠标位置处右键显示菜单</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_in_folder</span>(<span class="params">self</span>):</span><br><span class="line">        file_path = <span class="variable language_">self</span>.show_in_folder_action.data()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> cmds.about(windows=<span class="literal">True</span>): <span class="comment"># 如果是windows系统就使用windows系统的方法打开资源管理器</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.open_in_explorer(file_path): </span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> cmds.about(macOS=<span class="literal">True</span>): <span class="comment"># 如果是mac系统就使用mac系统的方法打开资源管理器</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.open_in_finder(file_path):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 两个方法都不可以的情况下，使用Qt自带的方法打开，缺点是不能自动选择对应的文件</span></span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)</span><br><span class="line">        <span class="keyword">if</span> file_info.isDir(): <span class="comment"># 如果是路径是目录就直接使用</span></span><br><span class="line">            QtGui.QDesktopServices.openUrl(file_path)</span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 如果是文件就通过file_info.path方法得到目录路径</span></span><br><span class="line">            QtGui.QDesktopServices.openUrl(file_info.path())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_in_explorer</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Windows打开资源管理器 &quot;&quot;&quot;</span></span><br><span class="line">        file_info = QtCore.QFileInfo(file_path)</span><br><span class="line">        args = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_info.isDir(): <span class="comment"># 如果不是目录就选择路径对应的文件</span></span><br><span class="line">            args.append(<span class="string">&quot;/select,&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        args.append(QtCore.QDir.toNativeSeparators(file_path))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> QtCore.QProcess.startDetached(<span class="string">&quot;explorer&quot;</span>, args):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_in_finder</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        args = []</span><br><span class="line">        args.append(<span class="string">&#x27;-e&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;tell application &quot;Finder&quot;&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;-e&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;activate&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;-e&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;select POSIX file &quot;&#123;0&#125;&quot;&#x27;</span>.<span class="built_in">format</span>(file_path))</span><br><span class="line">        args.append(<span class="string">&#x27;-e&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;end tell&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;-e&#x27;</span>)</span><br><span class="line">        args.append(<span class="string">&#x27;return&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(QtCore.QPrecess.startDetached(<span class="string">&quot;/usr/bin/osascript&quot;</span>, args)):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        my_dialog.close()  </span><br><span class="line">        my_dialog.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    my_dialog = FileExplorerDialog()</span><br><span class="line">    my_dialog.show()</span><br><span class="line">    </span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<p><a name="NIYFB"></a></p>
<h1>灯光面板</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1672827738289-ccf9c154-f02e-4b86-9323-dde79302d9bb.png#averageHue=%23595958&amp;clientId=u1b81c09d-af2e-4&amp;from=paste&amp;height=324&amp;id=u58ec6abd&amp;originHeight=292&amp;originWidth=502&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13895&amp;status=done&amp;style=none&amp;taskId=uf8b0edb7-09fb-4b48-a1c4-4ca5add6f0d&amp;title=&amp;width=557.7777925538431" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># 灯光面板举例</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomColorButton</span>(QtWidgets.QWidget): <span class="comment"># 自定义颜色按钮</span></span><br><span class="line"></span><br><span class="line">    color_changed = QtCore.Signal(QtGui.QColor) <span class="comment"># 自定义信号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, color=QtCore.Qt.white, parent=<span class="literal">None</span></span>): <span class="comment"># 表示可以类接收一个颜色参数,默认是白色</span></span><br><span class="line">        <span class="built_in">super</span>(CustomColorButton, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setObjectName(<span class="string">&quot;CustomColorButton&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_control()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.set_size(<span class="number">50</span>, <span class="number">14</span>)</span><br><span class="line">        <span class="variable language_">self</span>.set_color(color) <span class="comment"># 设置初始颜色,如果对象有传过来颜色设置则为对象的颜色</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_control</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 1. 创建colorSliderGrp &quot;&quot;&quot;</span></span><br><span class="line">        window = cmds.window()</span><br><span class="line">        <span class="variable language_">self</span>._name = cmds.colorSliderGrp()</span><br><span class="line">        <span class="comment"># print(&quot;original name: &#123;0&#125;&quot;.format(self._name))</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 2. 找到colorSliderGrp控件 &quot;&quot;&quot;</span></span><br><span class="line">        color_slider_obj = omui.MQtUtil.findControl(<span class="variable language_">self</span>._name) <span class="comment"># color_slider_obj是一个c++的形式</span></span><br><span class="line">        <span class="keyword">if</span> color_slider_obj:</span><br><span class="line">            <span class="variable language_">self</span>._color_slider_widget = wrapInstance(long(color_slider_obj), QtWidgets.QWidget)</span><br><span class="line">        </span><br><span class="line">            <span class="string">&quot;&quot;&quot; 3. 将colorSliderGrp控件的父级设置为这个自定义控件 &quot;&quot;&quot;</span></span><br><span class="line">            main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">            main_layout.setObjectName(<span class="string">&quot;main_layout&quot;</span>)</span><br><span class="line">            main_layout.setContentsMargins(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            main_layout.addWidget(<span class="variable language_">self</span>._color_slider_widget)</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;&quot;&quot; 4. 更新colorSliderGrp的control name (之前是属于maya的) &quot;&quot;&quot;</span></span><br><span class="line">            <span class="variable language_">self</span>._name = <span class="variable language_">self</span>._color_slider_widget.objectName()</span><br><span class="line">            <span class="comment"># print(&quot;new name: &#123;0&#125;&quot;.format(self._name))</span></span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;&quot;&quot; 5. 识别或存储 colorSliderGrp的子控件(在必要的时候可以隐藏它) &quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># children = self._color_slider_widget.children()</span></span><br><span class="line">            <span class="comment"># for child in children:</span></span><br><span class="line">            <span class="comment">#     print(child)</span></span><br><span class="line">            <span class="comment">#     print(child.objectName())</span></span><br><span class="line">            <span class="comment"># print(&quot;---&quot;)</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>._slider_widget = <span class="variable language_">self</span>._color_slider_widget.findChild(QtWidgets.QWidget, <span class="string">&quot;slider&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>._slider_widget:</span><br><span class="line">                <span class="variable language_">self</span>._slider_widget.hide()</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>._color_widget = <span class="variable language_">self</span>._color_slider_widget.findChild(QtWidgets.QWidget, <span class="string">&quot;port&quot;</span>)</span><br><span class="line"></span><br><span class="line">            cmds.colorSliderGrp(<span class="variable language_">self</span>._name, e=<span class="literal">True</span>, changeCommand=partial(<span class="variable language_">self</span>.on_color_changed))</span><br><span class="line"></span><br><span class="line">        cmds.deleteUI(window, window=<span class="literal">True</span>)</span><br><span class="line">          </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_size</span>(<span class="params">self, width, height</span>):</span><br><span class="line">        <span class="variable language_">self</span>._color_slider_widget.setFixedWidth(width)</span><br><span class="line">        <span class="variable language_">self</span>._color_widget.setFixedHeight(height)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_color</span>(<span class="params">self, color</span>):</span><br><span class="line">        color = QtGui.QColor(color)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> color != <span class="variable language_">self</span>.get_color():</span><br><span class="line">            cmds.colorSliderGrp(<span class="variable language_">self</span>._name, e=<span class="literal">True</span>, rgbValue=(color.redF(), color.greenF(), color.blueF())) <span class="comment"># F代表以浮点数表示</span></span><br><span class="line">            <span class="variable language_">self</span>.on_color_changed()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_color</span>(<span class="params">self</span>):</span><br><span class="line">        color = cmds.colorSliderGrp(<span class="variable language_">self</span>._name, q=<span class="literal">True</span>, rgbValue=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        color = QtGui.QColor(color[<span class="number">0</span>] *<span class="number">255</span>, color[<span class="number">1</span>] * <span class="number">255</span>, color[<span class="number">2</span>] * <span class="number">255</span>)</span><br><span class="line">        <span class="keyword">return</span> color</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_color_changed</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.color_changed.emit(<span class="variable language_">self</span>.get_color())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightItem</span>(QtWidgets.QWidget):</span><br><span class="line">    <span class="comment"># 自定义灯光控件，一个灯光对应一个控件</span></span><br><span class="line"></span><br><span class="line">    SUPPORTED_TYPES = [<span class="string">&quot;ambientLight&quot;</span>, <span class="string">&quot;directionalLight&quot;</span>, <span class="string">&quot;pointLight&quot;</span>, <span class="string">&quot;spotLight&quot;</span>, <span class="string">&quot;areaLight&quot;</span>]</span><br><span class="line">    EMIT_TYPES = [<span class="string">&quot;directionalLight&quot;</span>, <span class="string">&quot;pointLight&quot;</span>, <span class="string">&quot;spotLight&quot;</span>, <span class="string">&quot;areaLight&quot;</span>]</span><br><span class="line"></span><br><span class="line">    node_deleted = QtCore.Signal(<span class="built_in">str</span>) <span class="comment"># 自定义节点删除时的信号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, shape_name, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(LightItem, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setFixedHeight(<span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.shape_name = shape_name <span class="comment"># 灯光的shape名字</span></span><br><span class="line">        <span class="variable language_">self</span>.uuid = cmds.ls(shape_name, uuid=<span class="literal">True</span>) <span class="comment"># 灯光的uuid</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs = []</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_script_jobs()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 创建控件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.light_type_btn = QtWidgets.QPushButton()</span><br><span class="line">        <span class="variable language_">self</span>.light_type_btn.setFixedSize(<span class="number">20</span>, <span class="number">20</span>)</span><br><span class="line">        <span class="variable language_">self</span>.light_type_btn.setFlat(<span class="literal">True</span>) <span class="comment"># 设置按钮的显示形式</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.visiblity_cb = QtWidgets.QCheckBox()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.transform_name_label = QtWidgets.QLabel(<span class="string">&quot;placeholder&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transform_name_label.setFixedWidth(<span class="number">120</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transform_name_label.setAlignment(QtCore.Qt.AlignCenter)</span><br><span class="line"></span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line">        <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.SUPPORTED_TYPES:</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb = QtWidgets.QDoubleSpinBox()</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.setRange(<span class="number">0.0</span>, <span class="number">100.0</span>)</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.setDecimals(<span class="number">3</span>) <span class="comment"># 设置数值到小数点后三位</span></span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.setSingleStep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.setButtonSymbols(QtWidgets.QAbstractSpinBox.NoButtons) <span class="comment"># 设置spinbox没有上下箭头</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.color_btn = CustomColorButton()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.EMIT_TYPES:</span><br><span class="line">                <span class="variable language_">self</span>.emit_diffuse_cb = QtWidgets.QCheckBox()</span><br><span class="line">                <span class="variable language_">self</span>.emit_specular_cb = QtWidgets.QCheckBox()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.update_values()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 创建布局 &quot;&quot;&quot;</span></span><br><span class="line">        main_layout = QtWidgets.QHBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.light_type_btn)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.visiblity_cb)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.transform_name_label)</span><br><span class="line"></span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line">        <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.SUPPORTED_TYPES:</span><br><span class="line">            main_layout.addWidget(<span class="variable language_">self</span>.intensity_dsb)</span><br><span class="line">            main_layout.addSpacing(<span class="number">10</span>)</span><br><span class="line">            main_layout.addWidget(<span class="variable language_">self</span>.color_btn)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.EMIT_TYPES:</span><br><span class="line">                main_layout.addSpacing(<span class="number">34</span>)</span><br><span class="line">                main_layout.addWidget(<span class="variable language_">self</span>.emit_diffuse_cb)</span><br><span class="line">                main_layout.addSpacing(<span class="number">50</span>)</span><br><span class="line">                main_layout.addWidget(<span class="variable language_">self</span>.emit_specular_cb)</span><br><span class="line"></span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 创建信号与槽的连接 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.light_type_btn.clicked.connect(<span class="variable language_">self</span>.select_light)</span><br><span class="line">        <span class="variable language_">self</span>.visiblity_cb.toggled.connect(<span class="variable language_">self</span>.set_visibility)</span><br><span class="line">        </span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line">        <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.SUPPORTED_TYPES:</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.editingFinished.connect(<span class="variable language_">self</span>.on_intensity_changed)</span><br><span class="line">            <span class="variable language_">self</span>.color_btn.color_changed.connect(<span class="variable language_">self</span>.set_color)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.EMIT_TYPES:</span><br><span class="line">                <span class="variable language_">self</span>.emit_diffuse_cb.toggled.connect(<span class="variable language_">self</span>.set_emit_diffuse)</span><br><span class="line">                <span class="variable language_">self</span>.emit_specular_cb.toggled.connect(<span class="variable language_">self</span>.set_emit_specular)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_values</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.light_type_btn.setIcon(<span class="variable language_">self</span>.get_light_type_icon())</span><br><span class="line">        <span class="variable language_">self</span>.visiblity_cb.setChecked(<span class="variable language_">self</span>.is_visible())</span><br><span class="line">        <span class="variable language_">self</span>.transform_name_label.setText(<span class="variable language_">self</span>.get_transform_name())</span><br><span class="line"></span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line">        <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.SUPPORTED_TYPES:</span><br><span class="line">            <span class="variable language_">self</span>.intensity_dsb.setValue(<span class="variable language_">self</span>.get_intensity())</span><br><span class="line">            <span class="variable language_">self</span>.color_btn.set_color(<span class="variable language_">self</span>.get_color())</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.EMIT_TYPES:</span><br><span class="line">                <span class="variable language_">self</span>.emit_diffuse_cb.setChecked(<span class="variable language_">self</span>.emits_diffuse())</span><br><span class="line">                <span class="variable language_">self</span>.emit_specular_cb.setChecked(<span class="variable language_">self</span>.emits_specular())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_transform_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.listRelatives(<span class="variable language_">self</span>.shape_name, parent=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_attribute_value</span>(<span class="params">self, name, attribute</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.getAttr(<span class="string">&quot;&#123;0&#125;.&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(name, attribute))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_attribute_value</span>(<span class="params">self, name, attribute,*args</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果设置颜色或者属性的值与当前值相同就不进行设置，避免script job产生的重复设置属性的bug</span></span><br><span class="line">        <span class="keyword">if</span> attribute == <span class="string">&quot;color&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.get_color() == <span class="variable language_">self</span>.color_btn.get_color():</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> args[<span class="number">0</span>] == <span class="variable language_">self</span>.get_attribute_value(name, attribute):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        attr_name = <span class="string">&quot;&#123;0&#125;.&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(name, attribute)</span><br><span class="line">        cmds.setAttr(attr_name, *args)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_light_type</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.objectType(<span class="variable language_">self</span>.shape_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_light_type_icon</span>(<span class="params">self</span>):</span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line"></span><br><span class="line">        icon = QtGui.QIcon()</span><br><span class="line">        <span class="keyword">if</span> light_type == <span class="string">&quot;ambientLight&quot;</span>:</span><br><span class="line">            icon = QtGui.QIcon(<span class="string">&quot;:ambientLight.svg&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> light_type == <span class="string">&quot;directionalLight&quot;</span>:</span><br><span class="line">            icon = QtGui.QIcon(<span class="string">&quot;:directionalLight.svg&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> light_type == <span class="string">&quot;pointLight&quot;</span>:</span><br><span class="line">            icon = QtGui.QIcon(<span class="string">&quot;:pointLight.svg&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> light_type == <span class="string">&quot;spotLight&quot;</span>:</span><br><span class="line">            icon = QtGui.QIcon(<span class="string">&quot;:spotLight.svg&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            icon = QtGui.QIcon(<span class="string">&quot;:Light.png&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> icon</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_visible</span>(<span class="params">self</span>):</span><br><span class="line">        transform_name = <span class="variable language_">self</span>.get_transform_name()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get_attribute_value(transform_name, <span class="string">&quot;visibility&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_intensity</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;intensity&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_color</span>(<span class="params">self</span>):</span><br><span class="line">        temp_color = <span class="variable language_">self</span>.get_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;color&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> QtGui.QColor(temp_color[<span class="number">0</span>] * <span class="number">255</span>, temp_color[<span class="number">1</span>] * <span class="number">255</span>, temp_color[<span class="number">2</span>] * <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">emits_diffuse</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitDiffuse&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">emits_specular</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitSpecular&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_light</span>(<span class="params">self</span>):</span><br><span class="line">        cmds.select(<span class="variable language_">self</span>.get_transform_name())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_visibility</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_attribute_value(<span class="variable language_">self</span>.get_transform_name(), <span class="string">&quot;visibility&quot;</span>, checked)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_intensity_changed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;intensity&quot;</span>, <span class="variable language_">self</span>.intensity_dsb.value())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_color</span>(<span class="params">self, color</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;color&quot;</span>, color.redF(), color.greenF(), color.blueF())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_emit_diffuse</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitDiffuse&quot;</span>, checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_emit_specular</span>(<span class="params">self, checked</span>):</span><br><span class="line">        <span class="variable language_">self</span>.set_attribute_value(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitSpecular&quot;</span>, checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_node_deleted</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当节点删除时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.node_deleted.emit(<span class="variable language_">self</span>.shape_name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_name_changed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当名字修改时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.shape_name = cmds.ls(<span class="variable language_">self</span>.uuid)[<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">self</span>.update_values()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_script_jobs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 为每个灯光都创建script jobs &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.delete_script_jobs()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_attribute_change_script_job(<span class="variable language_">self</span>.get_transform_name(), <span class="string">&quot;visibility&quot;</span>)</span><br><span class="line">        light_type = <span class="variable language_">self</span>.get_light_type()</span><br><span class="line">        <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.SUPPORTED_TYPES:</span><br><span class="line">            <span class="variable language_">self</span>.add_attribute_change_script_job(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;color&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.add_attribute_change_script_job(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;intensity&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> light_type <span class="keyword">in</span> <span class="variable language_">self</span>.EMIT_TYPES:</span><br><span class="line">                <span class="variable language_">self</span>.add_attribute_change_script_job(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitDiffuse&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.add_attribute_change_script_job(<span class="variable language_">self</span>.shape_name, <span class="string">&quot;emitSpecular&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs.append(cmds.scriptJob(nodeDeleted=(<span class="variable language_">self</span>.shape_name, partial(<span class="variable language_">self</span>.on_node_deleted))))</span><br><span class="line">        <span class="variable language_">self</span>.script_jobs.append(cmds.scriptJob(nodeNameChanged=(<span class="variable language_">self</span>.shape_name, partial(<span class="variable language_">self</span>.on_name_changed))))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_attribute_change_script_job</span>(<span class="params">self, name, attribute</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 添加某一节点的某一属性改变时的script_job时使用的方法 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs.append(cmds.scriptJob(attributeChange=(<span class="string">&quot;&#123;0&#125;.&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(name, attribute), partial(<span class="variable language_">self</span>.update_values))))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_script_jobs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> job_number <span class="keyword">in</span> <span class="variable language_">self</span>.script_jobs:</span><br><span class="line">            cmds.evalDeferred(<span class="string">&quot;if cmds.scriptJob(exists=&#123;0&#125;):\tcmds.scriptJob(kill=&#123;0&#125;, force=True)&quot;</span>.<span class="built_in">format</span>(job_number))</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.script_jobs = []</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightPanel</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Light Panel&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(LightPanel, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">500</span>, <span class="number">260</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.WindowType.Window)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.light_items = []</span><br><span class="line">        <span class="variable language_">self</span>.script_jobs = []</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 控件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.refreshButton = QtWidgets.QPushButton(<span class="string">&quot;Refresh Lights&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 布局 &quot;&quot;&quot;</span></span><br><span class="line">        header_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        header_layout.addSpacing(<span class="number">100</span>)</span><br><span class="line">        header_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Light&quot;</span>))</span><br><span class="line">        header_layout.addSpacing(<span class="number">50</span>)</span><br><span class="line">        header_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Intensity&quot;</span>))</span><br><span class="line">        header_layout.addSpacing(<span class="number">44</span>)</span><br><span class="line">        header_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Color&quot;</span>))</span><br><span class="line">        header_layout.addSpacing(<span class="number">24</span>)</span><br><span class="line">        header_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Emit Diffuse&quot;</span>))</span><br><span class="line">        header_layout.addSpacing(<span class="number">10</span>)</span><br><span class="line">        header_layout.addWidget(QtWidgets.QLabel(<span class="string">&quot;Emit Spec&quot;</span>))</span><br><span class="line">        header_layout.addStretch()</span><br><span class="line"></span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.refreshButton)</span><br><span class="line"></span><br><span class="line">        light_list_wdg = QtWidgets.QWidget()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.light_layout = QtWidgets.QVBoxLayout(light_list_wdg) <span class="comment"># light_list_wdg在light_layout下</span></span><br><span class="line">        <span class="variable language_">self</span>.light_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.light_layout.addSpacing(<span class="number">3</span>)</span><br><span class="line">        <span class="variable language_">self</span>.light_layout.setAlignment(QtCore.Qt.AlignTop)</span><br><span class="line"></span><br><span class="line">        light_list_scroll_area = QtWidgets.QScrollArea()</span><br><span class="line">        light_list_scroll_area.setWidgetResizable(<span class="literal">True</span>)</span><br><span class="line">        light_list_scroll_area.setWidget(light_list_wdg) <span class="comment"># scroll_area下有light_list_wdg</span></span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addLayout(header_layout)</span><br><span class="line">        main_layout.addWidget(light_list_scroll_area) <span class="comment"># 主布局下有个scroll_area</span></span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 信号与槽的连接 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.refreshButton.clicked.connect(<span class="variable language_">self</span>.refresh_lights)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_lights_in_scene</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 得到场景中所有灯光 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cmds.ls(typ=<span class="string">&quot;light&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_lights</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 刷新灯光面板 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.clear_lights()</span><br><span class="line"></span><br><span class="line">        scene_lights = <span class="variable language_">self</span>.get_lights_in_scene()</span><br><span class="line">        <span class="keyword">for</span> light <span class="keyword">in</span> scene_lights:</span><br><span class="line">            light_item = LightItem(light)</span><br><span class="line">            light_item.node_deleted.connect(<span class="variable language_">self</span>.on_node_deleted) <span class="comment"># 自定义信号node_deleted发送数据时传给on_node_deleted函数</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.light_layout.addWidget(light_item)</span><br><span class="line">            <span class="variable language_">self</span>.light_items.append(light_item)</span><br><span class="line">            </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear_lights</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 清空灯光面板 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> light <span class="keyword">in</span> <span class="variable language_">self</span>.light_items:</span><br><span class="line">            light.delete_script_jobs()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.light_items = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.light_layout.count() &gt; <span class="number">0</span>:</span><br><span class="line">            light_item = <span class="variable language_">self</span>.light_layout.takeAt(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> light_item.widget():</span><br><span class="line">                light_item.widget().deleteLater()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_script_jobs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 创建script jobs &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs.append(cmds.scriptJob(event=[<span class="string">&quot;DagObjectCreated&quot;</span>, partial(<span class="variable language_">self</span>.on_dag_object_created)])) <span class="comment"># 当创建dag物体时执行on_dag_object_created函数</span></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs.append(cmds.scriptJob(event=[<span class="string">&quot;Undo&quot;</span>, partial(<span class="variable language_">self</span>.on_undo)])) <span class="comment"># 当ctrl+z时执行on_undo函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_script_jobs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 删除script jobs &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> job_number <span class="keyword">in</span> <span class="variable language_">self</span>.script_jobs:</span><br><span class="line">            cmds.scriptJob(kill=job_number)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.script_jobs = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_dag_object_created</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当dag中出现新物体时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(cmds.ls(typ=<span class="string">&quot;light&quot;</span>)) != <span class="built_in">len</span>(<span class="variable language_">self</span>.light_items):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;New light created...&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.refresh_lights()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; ctrl+z时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(cmds.ls(typ=<span class="string">&quot;light&quot;</span>)) != <span class="built_in">len</span>(<span class="variable language_">self</span>.light_items):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Undo light created...&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.refresh_lights()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_node_deleted</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 节点删除时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.refresh_lights()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当打开窗口时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.refresh_lights()</span><br><span class="line">        <span class="variable language_">self</span>.create_script_jobs()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当关闭窗口时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.clear_lights()</span><br><span class="line">        <span class="variable language_">self</span>.delete_script_jobs()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line">    cmds.file(<span class="string">&quot;D:/ZhangRuiChen/Pyside2ForMaya/light_test.ma&quot;</span>,o=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        light_panel_dialog.close()</span><br><span class="line">        light_panel_dialog.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    light_panel_dialog = LightPanel()</span><br><span class="line">    light_panel_dialog.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="ZzJ9v"></a></p>
<h2 id="scriptJob">scriptJob</h2>
<p>不知道scriptJob的话在这里看<a target="_blank" rel="noopener" href="https://www.yuque.com/quanmianxiaokangdelouwangzhiyu/pk4uzy/ucqe3u#Rk562">https://www.yuque.com/quanmianxiaokangdelouwangzhiyu/pk4uzy/ucqe3u#Rk562</a><br>注册scriptJob：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671697160970-4d903cf0-97ad-438b-bd77-a3ad27d538c2.png#averageHue=%2334302c&amp;clientId=ub7d727ca-d9ed-4&amp;from=paste&amp;height=382&amp;id=u618a8281&amp;originHeight=344&amp;originWidth=1208&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=174235&amp;status=done&amp;style=none&amp;taskId=udb8d8554-33f9-4a7f-9192-67c2b7e20eb&amp;title=&amp;width=1342.2222577789694" alt="image.png"><br>取消注册scriptJob:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671697289737-9aca734a-76ed-46bf-820c-849acdf948ba.png#averageHue=%23291d1d&amp;clientId=ub7d727ca-d9ed-4&amp;from=paste&amp;height=146&amp;id=u7a1ba4a6&amp;originHeight=131&amp;originWidth=885&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=49637&amp;status=done&amp;style=none&amp;taskId=u8326d511-f58c-4ccb-be1f-125f8ed025a&amp;title=&amp;width=983.3333593827714" alt="image.png"><br>
<a name="TgmeX"></a></p>
<h1>Docking</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1676368412774-62e89b75-050f-4042-ae72-172252a91f7c.png#averageHue=%230b0b0b&amp;clientId=u0ed65455-fe7e-4&amp;from=paste&amp;height=575&amp;id=u9137e5aa&amp;originHeight=575&amp;originWidth=1321&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=195907&amp;status=done&amp;style=none&amp;taskId=u361a55fc-af62-47f2-bdfc-d0f90735912&amp;title=&amp;width=1321" alt="image.png"><br>
<a name="rVb0T"></a></p>
<h2 id="maya的workspaces设置存放的位置">maya的workspaces设置存放的位置</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1676428725500-72ba1326-f7bc-45b8-8e11-030d22cc2206.png#averageHue=%23f9f9f9&amp;clientId=u0ed65455-fe7e-4&amp;from=paste&amp;height=174&amp;id=ub49c11ba&amp;originHeight=174&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=48522&amp;status=done&amp;style=none&amp;taskId=u0996483e-911b-4ff2-90b3-113dba0bc9b&amp;title=&amp;width=537" alt="image.png"><br>
<a name="Ooqxq"></a></p>
<h2 id="mayaMixin-py"><a target="_blank" rel="noopener" href="http://mayaMixin.py">mayaMixin.py</a></h2>
<p>mayaMixin模块可以令我们更方便的创建可以停靠的窗口。<br>模块的路径为:C:\Program Files\Autodesk\Maya2018\Python\Lib\site-packages\maya\app\general\<a target="_blank" rel="noopener" href="http://mayaMixin.py">mayaMixin.py</a><br>其中模块使用的最重要的命令是cmds.workspaceControl<br>这里的会自动保存在工作区上面，关掉maya不会清除窗口内容。是有一个前置条件的，条件是这个模块是实实在在存在的文件，然后这个模块在maya的识别目录上面。<br>令其能够自动保存在工作区上面，实现的代码是：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677225584722-63c8cec0-dea6-42fa-8dab-15951408b3b1.png#averageHue=%23ffffff&amp;clientId=ueacdff51-fb88-4&amp;from=paste&amp;height=167&amp;id=ua8a8de90&amp;originHeight=150&amp;originWidth=607&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=19623&amp;status=done&amp;style=none&amp;taskId=ua8a9886e-c8f0-4d96-8f6b-4e390b8bc36&amp;title=&amp;width=674.4444623111211" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677225538425-50afbed0-ddf3-4d53-9d07-a61791ef937b.png#averageHue=%23ffffff&amp;clientId=ueacdff51-fb88-4&amp;from=paste&amp;height=52&amp;id=ub903c2e4&amp;originHeight=47&amp;originWidth=833&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=11152&amp;status=done&amp;style=none&amp;taskId=u534c562f-94d8-47fb-bf23-516bfb8f0b8&amp;title=&amp;width=925.5555800744052" alt="image.png"><br><a target="_blank" rel="noopener" href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__CommandsPython_index_html">Help</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配合MayaQWidgetDockableMixin模块制作 可以停靠在maya界面上的参考</span></span><br><span class="line"><span class="comment"># 特点：会自动保存在工作区上面，关掉maya不会清除窗口内容</span></span><br><span class="line"><span class="comment"># 开发时需要注意的点：在dock状态下不方便调试，开发时要在非dock状态以便调试</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> getCppPointer</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> maya.app.general.mayaMixin <span class="keyword">import</span> MayaQWidgetDockableMixin</span><br><span class="line"><span class="keyword">from</span> maya.OpenMayaUI <span class="keyword">import</span> MQtUtil</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="comment"># 多重继承中要把MayaQWidgetDockableMixin放在首位</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDockableButtonStatic</span>(MayaQWidgetDockableMixin, QtWidgets.QPushButton):</span><br><span class="line"></span><br><span class="line">    UI_NAME = <span class="string">&quot;MyDockableButtonStatic&quot;</span> <span class="comment"># 定义一个准确的UI_NAME使UI具有唯一性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyDockableButtonStatic, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setObjectName(<span class="variable language_">self</span>.UI_NAME)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&quot;Dockable Window&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setText(<span class="string">&quot;My Button&quot;</span>)</span><br><span class="line"></span><br><span class="line">        workspace_control_name = <span class="string">&quot;&#123;0&#125;WorkspaceControl&quot;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.UI_NAME)</span><br><span class="line">        <span class="comment"># 设置父级为工作区</span></span><br><span class="line">        <span class="keyword">if</span> cmds.workspaceControl(workspace_control_name, q=<span class="literal">True</span>, exists=<span class="literal">True</span>):</span><br><span class="line">            workspace_control_ptr = long(MQtUtil.findControl(workspace_control_name))</span><br><span class="line">            widget_ptr = long(getCppPointer(<span class="variable language_">self</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">            MQtUtil.addWidgetToMayaLayout(widget_ptr, workspace_control_ptr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> button <span class="keyword">and</span> button.parent():</span><br><span class="line">            workspace_control_name = button.parent().objectName()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> cmds.window(workspace_control_name, exists=<span class="literal">True</span>):</span><br><span class="line">                cmds.deleteUI(workspace_control_name)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    button = MyDockableButtonStatic()</span><br><span class="line"></span><br><span class="line">    ui_script = <span class="string">&quot;from dockable_button_example import MyDockableButtonStatic\nbutton = MyDockableButtonStatic()&quot;</span></span><br><span class="line">    button.show(dockable=<span class="literal">True</span>, uiScript=ui_script) <span class="comment"># 调用MayaQWidgetDockableMixin模块的show方法来使创建的窗口能够dock</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="OCpb5"></a></p>
<h2 id="workspace-control-py">workspace_control.py</h2>
<p>workspaceControl的介绍:<br>创建和管理用于在允许将窗口停靠和堆叠在一起的布局中托管窗口的小部件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 让UI成为workspaceControl的widget，这样就能够创建出可以dock的UI了</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span>  QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span>  QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> getCppPointer</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkspaceControl</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 根据workspaceControl命令自定义的方便使用类 &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.widget = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, label, widget, ui_script=<span class="literal">None</span></span>):</span><br><span class="line">        </span><br><span class="line">        cmds.workspaceControl(<span class="variable language_">self</span>.name, label=label)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ui_script:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, uiScript=ui_script)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.add_widget_to_layout(widget)</span><br><span class="line">        <span class="variable language_">self</span>.set_visible(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restore</span>(<span class="params">self, widget</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 恢复widget的显示 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.add_widget_to_layout(widget)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_widget_to_layout</span>(<span class="params">self, widget</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 将widget添加到layout上 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> widget:</span><br><span class="line">            <span class="variable language_">self</span>.widget = widget</span><br><span class="line">            <span class="variable language_">self</span>.widget.setAttribute(QtCore.Qt.WA_DontCreateNativeAncestors) <span class="comment"># 参考mayaMixin推荐的一个属性设置，意思是我们的widget会跟随父窗口属性改变，但是不要跟随父窗口属性改变的同时将祖先窗口改变。</span></span><br><span class="line"></span><br><span class="line">            workspace_control_ptr = long(omui.MQtUtil.findControl(<span class="variable language_">self</span>.name)) <span class="comment"># 得到workspaceControl的指针</span></span><br><span class="line">            widget_ptr = long(getCppPointer(<span class="variable language_">self</span>.widget)[<span class="number">0</span>]) <span class="comment"># 得到widget的cpp指针</span></span><br><span class="line"></span><br><span class="line">            omui.MQtUtil.addWidgetToMayaLayout(widget_ptr, workspace_control_ptr) <span class="comment"># 令我们的widget属于maya布局</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exists</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 判断workspaceControl是否存在 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, exists=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_visible</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 判断workspaceControl可视性 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, visible=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_visible</span>(<span class="params">self, visible</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 设置workspaceControl的可视性 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> visible:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, restore=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, visible=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_label</span>(<span class="params">self, label</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 设置workspaceControl的标签 &quot;&quot;&quot;</span></span><br><span class="line">        cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, label=label)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_floating</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 判断workspaceControl是否浮动 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, floating=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_collapsed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 判断workspaceControl是否收缩 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, collapse=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SampleUI</span>(QtWidgets.QWidget):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Sample UI&quot;</span></span><br><span class="line">    UI_NAME = <span class="string">&quot;SampleUI&quot;</span></span><br><span class="line"></span><br><span class="line">    ui_instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个类方法，方便外界调用来显示可以dock的UI,如果SampleUI存在就显示它，不存在就创建</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> cls.ui_instance:</span><br><span class="line">            cls.ui_instance.show_workspace_control()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cls.ui_instance = SampleUI()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_workspace_control_name</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 设置控件对应的workspaceControl名字 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;0&#125;WorkspaceControl&quot;</span>.<span class="built_in">format</span>(cls.UI_NAME)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SampleUI, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setObjectName(<span class="variable language_">self</span>.__class__.UI_NAME)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">200</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widget()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line">        <span class="variable language_">self</span>.create_workspace_control()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widget</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.apply_button = QtWidgets.QPushButton(<span class="string">&quot;Apply&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addStretch()</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.apply_button)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.apply_button.clicked.connect(<span class="variable language_">self</span>.on_clicked)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_workspace_control</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 创建workspaceControl &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.workspace_control_instance = WorkspaceControl(<span class="variable language_">self</span>.get_workspace_control_name())</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.workspace_control_instance.exists():</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.restore(<span class="variable language_">self</span>) <span class="comment"># 如果workspace_control已经存在了那么就将它显示出来</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.create(<span class="variable language_">self</span>.WINDOW_TITLE, <span class="variable language_">self</span>, ui_script=<span class="string">&quot;from workspace_control import SampleUI\nSampleUI.display()&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_workspace_control</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.workspace_control_instance.set_visible(<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_clicked</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Button Clicked&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 设置窗口float时以及dock时对应的标题 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.workspace_control_instance.is_floating():</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.set_label(<span class="string">&quot;Floating Window&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.set_label(<span class="string">&quot;Docked Window&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    workspace_control_name = SampleUI.get_workspace_control_name()</span><br><span class="line">    <span class="keyword">if</span> cmds.window(workspace_control_name, exists=<span class="literal">True</span>):</span><br><span class="line">        cmds.deleteUI(workspace_control_name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这串代码可以使UI在dock的同时能够通过更改UI的代码来更新界面</span></span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#     sample_ui.setParent(None)</span></span><br><span class="line">    <span class="comment">#     sample_ui.deleteLater()</span></span><br><span class="line">    <span class="comment"># except:</span></span><br><span class="line">    <span class="comment">#     pass</span></span><br><span class="line">    </span><br><span class="line">    sample_ui = SampleUI()</span><br><span class="line">    sample_ui.show()</span><br></pre></td></tr></table></figure>
<p><a name="mBEs1"></a></p>
<h2 id="将workspace-control作为模块导入使用的步骤">将workspace_control作为模块导入使用的步骤</h2>
<p><a name="Q6A1e"></a></p>
<h3 id="workspace-control主要修改区域：">workspace_control主要修改区域：</h3>
<p>新增类方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677206784328-27769875-35d3-4793-a1cd-9f5797845ec5.png#averageHue=%23201f1f&amp;clientId=u642778c3-94fb-4&amp;from=paste&amp;height=241&amp;id=u312e1185&amp;originHeight=241&amp;originWidth=1027&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=27884&amp;status=done&amp;style=none&amp;taskId=u1c14e281-ceaa-4e91-afcb-0e4981bc2f0&amp;title=&amp;width=1027" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677206827356-bdbb4405-ed33-4df9-bd50-6b9969887555.png#averageHue=%23231f1e&amp;clientId=u642778c3-94fb-4&amp;from=paste&amp;height=189&amp;id=ue63728d9&amp;originHeight=189&amp;originWidth=1212&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37526&amp;status=done&amp;style=none&amp;taskId=u1cee2a55-4a75-43ba-ab90-f9a252f71ba&amp;title=&amp;width=1212" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> getCppPointer</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkspaceControl</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.widget = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, label, widget, ui_script=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line">        cmds.workspaceControl(<span class="variable language_">self</span>.name, label=label)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ui_script:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, uiScript=ui_script)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_widget_to_layout(widget)</span><br><span class="line">        <span class="variable language_">self</span>.set_visible(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restore</span>(<span class="params">self, widget</span>):</span><br><span class="line">        <span class="variable language_">self</span>.add_widget_to_layout(widget)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_widget_to_layout</span>(<span class="params">self, widget</span>):</span><br><span class="line">        <span class="keyword">if</span> widget:</span><br><span class="line">            <span class="variable language_">self</span>.widget = widget</span><br><span class="line">            <span class="variable language_">self</span>.widget.setAttribute(QtCore.Qt.WA_DontCreateNativeAncestors)</span><br><span class="line"></span><br><span class="line">            workspace_control_ptr = long(omui.MQtUtil.findControl(<span class="variable language_">self</span>.name))</span><br><span class="line">            widget_ptr = long(getCppPointer(<span class="variable language_">self</span>.widget)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">            omui.MQtUtil.addWidgetToMayaLayout(widget_ptr, workspace_control_ptr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exists</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, exists=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_visible</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, visible=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_visible</span>(<span class="params">self, visible</span>):</span><br><span class="line">        <span class="keyword">if</span> visible:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, restore=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, visible=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_label</span>(<span class="params">self, label</span>):</span><br><span class="line">        cmds.workspaceControl(<span class="variable language_">self</span>.name, e=<span class="literal">True</span>, label=label)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_floating</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, floating=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_collapsed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> cmds.workspaceControl(<span class="variable language_">self</span>.name, q=<span class="literal">True</span>, collapse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DockableUI</span>(QtWidgets.QWidget):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;DockableUI&quot;</span></span><br><span class="line"></span><br><span class="line">    ui_instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> cls.ui_instance:</span><br><span class="line">            cls.ui_instance.show_workspace_control()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cls.ui_instance = cls()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_workspace_control_name</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;0&#125;WorkspaceControl&quot;</span>.<span class="built_in">format</span>(cls.__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_ui_script</span>(<span class="params">cls</span>):</span><br><span class="line">        module_name = cls.__module__</span><br><span class="line">        <span class="keyword">if</span> module_name == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">            module_name = cls.module_name_override</span><br><span class="line"></span><br><span class="line">        ui_script = <span class="string">&quot;from &#123;0&#125; import &#123;1&#125;\n&#123;1&#125;.display()&quot;</span>.<span class="built_in">format</span>(module_name, cls.__name__)</span><br><span class="line">        <span class="keyword">return</span> ui_script</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DockableUI, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setObjectName(<span class="variable language_">self</span>.__class__.__name__)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_actions()</span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layout()</span><br><span class="line">        <span class="variable language_">self</span>.create_connections()</span><br><span class="line">        <span class="variable language_">self</span>.create_workspace_control()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_actions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_workspace_control</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.workspace_control_instance = WorkspaceControl(<span class="variable language_">self</span>.get_workspace_control_name())</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.workspace_control_instance.exists():</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.restore(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.workspace_control_instance.create(<span class="variable language_">self</span>.WINDOW_TITLE, <span class="variable language_">self</span>, ui_script=<span class="variable language_">self</span>.get_ui_script())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_workspace_control</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.workspace_control_instance.set_visible(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="nmdWc"></a></p>
<h3 id="dockable-outliner与原版的区别：">dockable_outliner与原版的区别：</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677207029301-874922a2-f359-435d-98d9-0cf9bf68c815.png#averageHue=%23f9f0ef&amp;clientId=u642778c3-94fb-4&amp;from=paste&amp;height=570&amp;id=ub48cbe34&amp;originHeight=570&amp;originWidth=1597&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=63586&amp;status=done&amp;style=none&amp;taskId=ufb8c8f75-f8ce-4b61-aa78-830ce3efeb1&amp;title=&amp;width=1597" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1677207062777-560665cd-7aa2-4c38-a2fb-e418c1790104.png#averageHue=%23f9e7e7&amp;clientId=u642778c3-94fb-4&amp;from=paste&amp;height=221&amp;id=u25f2a923&amp;originHeight=221&amp;originWidth=1607&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=17522&amp;status=done&amp;style=none&amp;taskId=u4387a327-dd89-42da-abd6-615d531c8f8&amp;title=&amp;width=1607" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> workspace_control <span class="keyword">import</span> DockableUI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DockableOutliner</span>(<span class="title class_ inherited__">DockableUI</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Dockable Outliner&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DockableOutliner, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setMinimumWidth(<span class="number">300</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setContextMenuPolicy(QtCore.Qt.CustomContextMenu)</span><br><span class="line">        <span class="variable language_">self</span>.customContextMenuRequested.connect(<span class="variable language_">self</span>.show_context_menu)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.transform_icon = QtGui.QIcon(<span class="string">&quot;:transform.svg&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.camera_icon = QtGui.QIcon(<span class="string">&quot;:Camera.png&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.mesh_icon = QtGui.QIcon(<span class="string">&quot;:mesh.svg&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.script_job_number = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_tree_widget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_actions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.about_action = QtWidgets.QAction(<span class="string">&quot;About&quot;</span>, <span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action = QtWidgets.QAction(<span class="string">&quot;Shapes&quot;</span>, <span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setCheckable(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setChecked(<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.setShortcut(QtGui.QKeySequence(<span class="string">&quot;Ctrl+Shift+H&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.menu_bar = QtWidgets.QMenuBar()</span><br><span class="line">        display_menu = <span class="variable language_">self</span>.menu_bar.addMenu(<span class="string">&quot;Display&quot;</span>)</span><br><span class="line">        display_menu.addAction(<span class="variable language_">self</span>.display_shape_action)</span><br><span class="line">        help_menu = <span class="variable language_">self</span>.menu_bar.addMenu(<span class="string">&quot;Help&quot;</span>)</span><br><span class="line">        help_menu.addAction(<span class="variable language_">self</span>.about_action)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget = QtWidgets.QTreeWidget()</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.setSelectionMode(QtWidgets.QAbstractItemView.ExtendedSelection)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.setHeaderHidden(<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># header = self.tree_widget.headerItem()</span></span><br><span class="line">        <span class="comment"># header.setText(0, &quot;Column 0 Text&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn = QtWidgets.QPushButton(<span class="string">&quot;Refresh&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layout</span>(<span class="params">self</span>):</span><br><span class="line">        button_layout = QtWidgets.QHBoxLayout()</span><br><span class="line">        button_layout.addStretch()</span><br><span class="line">        button_layout.addWidget(<span class="variable language_">self</span>.refresh_btn)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.setSpacing(<span class="number">2</span>)</span><br><span class="line">        main_layout.setMenuBar(<span class="variable language_">self</span>.menu_bar)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        main_layout.addLayout(button_layout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.about_action.triggered.connect(<span class="variable language_">self</span>.about)</span><br><span class="line">        <span class="variable language_">self</span>.display_shape_action.toggled.connect(<span class="variable language_">self</span>.set_shape_nodes_visible)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemCollapsed.connect(<span class="variable language_">self</span>.update_icon)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemExpanded.connect(<span class="variable language_">self</span>.update_icon)</span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.itemSelectionChanged.connect(<span class="variable language_">self</span>.select_items)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.refresh_btn.clicked.connect(<span class="variable language_">self</span>.refresh_tree_widget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refresh_tree_widget</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.shape_nodes = cmds.ls(shapes=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.tree_widget.clear()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        top_level_object_names = cmds.ls(assemblies=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> top_level_object_names:</span><br><span class="line">            item = <span class="variable language_">self</span>.create_item(name)</span><br><span class="line">            <span class="variable language_">self</span>.tree_widget.addTopLevelItem(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update_selection()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">self, name</span>):</span><br><span class="line">        item = QtWidgets.QTreeWidgetItem([name])</span><br><span class="line">        <span class="variable language_">self</span>.add_children(item)</span><br><span class="line">        <span class="variable language_">self</span>.update_icon(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        is_shape = name <span class="keyword">in</span> <span class="variable language_">self</span>.shape_nodes</span><br><span class="line">        item.setData(<span class="number">0</span>, QtCore.Qt.UserRole, is_shape)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_children</span>(<span class="params">self, item</span>):</span><br><span class="line">        children = cmds.listRelatives(item.text(<span class="number">0</span>), children=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> children:</span><br><span class="line">            <span class="keyword">for</span> child <span class="keyword">in</span> children:</span><br><span class="line">                child_item = <span class="variable language_">self</span>.create_item(child)</span><br><span class="line">                item.addChild(child_item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_icon</span>(<span class="params">self, item</span>):</span><br><span class="line">        object_type = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> item.isExpanded():</span><br><span class="line">            object_type = <span class="string">&quot;transform&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            child_count = item.childCount()</span><br><span class="line">            <span class="keyword">if</span> child_count == <span class="number">0</span>:</span><br><span class="line">                object_type = cmds.objectType(item.text(<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">elif</span> child_count == <span class="number">1</span>:</span><br><span class="line">                child_item = item.child(<span class="number">0</span>)</span><br><span class="line">                object_type = cmds.objectType(child_item.text(<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                object_type = <span class="string">&quot;transform&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> object_type == <span class="string">&quot;transform&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.transform_icon)</span><br><span class="line">        <span class="keyword">elif</span> object_type == <span class="string">&quot;camera&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.camera_icon)</span><br><span class="line">        <span class="keyword">elif</span> object_type == <span class="string">&quot;mesh&quot;</span>:</span><br><span class="line">            item.setIcon(<span class="number">0</span>, <span class="variable language_">self</span>.mesh_icon)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_items</span>(<span class="params">self</span>):</span><br><span class="line">        items = <span class="variable language_">self</span>.tree_widget.selectedItems()</span><br><span class="line">        names = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            names.append(item.text(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cmds.select(names, replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">about</span>(<span class="params">self</span>):</span><br><span class="line">        QtWidgets.QMessageBox.about(<span class="variable language_">self</span>, <span class="string">&quot;About Simple Outliner&quot;</span>, <span class="string">&quot;Add About Text Here&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_shape_nodes_visible</span>(<span class="params">self, visible</span>):</span><br><span class="line">        iterator = QtWidgets.QTreeWidgetItemIterator(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        <span class="keyword">while</span> iterator.value():</span><br><span class="line">            item = iterator.value()</span><br><span class="line">            is_shape = item.data(<span class="number">0</span>, QtCore.Qt.UserRole)</span><br><span class="line">            <span class="keyword">if</span> is_shape:</span><br><span class="line">                item.setHidden(<span class="keyword">not</span> visible)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            iterator += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_context_menu</span>(<span class="params">self, point</span>):</span><br><span class="line">        context_menu = QtWidgets.QMenu()</span><br><span class="line">        context_menu.addAction(<span class="variable language_">self</span>.display_shape_action)</span><br><span class="line">        context_menu.addSeparator()</span><br><span class="line">        context_menu.addAction(<span class="variable language_">self</span>.about_action)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        context_menu.exec_(<span class="variable language_">self</span>.mapToGlobal(point))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_selection</span>(<span class="params">self</span>):</span><br><span class="line">        selection = cmds.ls(selection=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        iterator = QtWidgets.QTreeWidgetItemIterator(<span class="variable language_">self</span>.tree_widget)</span><br><span class="line">        <span class="keyword">while</span> iterator.value():</span><br><span class="line">            item = iterator.value()</span><br><span class="line">            is_selected = item.text(<span class="number">0</span>) <span class="keyword">in</span> selection</span><br><span class="line">            item.setSelected(is_selected)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            iterator += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_script_job_enabled</span>(<span class="params">self, enabled</span>):</span><br><span class="line">        <span class="keyword">if</span> enabled <span class="keyword">and</span> <span class="variable language_">self</span>.script_job_number &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.script_job_number = cmds.scriptJob(event=[<span class="string">&quot;SelectionChanged&quot;</span>, partial(<span class="variable language_">self</span>.update_selection)], protected=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> enabled <span class="keyword">and</span> <span class="variable language_">self</span>.script_job_number &gt;= <span class="number">0</span>:</span><br><span class="line">            cmds.scriptJob(kill=<span class="variable language_">self</span>.script_job_number, force=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.script_job_number = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">showEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="built_in">super</span>(DockableOutliner, <span class="variable language_">self</span>).showEvent(e)</span><br><span class="line">        <span class="variable language_">self</span>.set_script_job_enabled(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, e</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="variable language_">self</span>, DockableOutliner):</span><br><span class="line">            <span class="built_in">super</span>(DockableOutliner, <span class="variable language_">self</span>).closeEvent(e)</span><br><span class="line">            <span class="variable language_">self</span>.set_script_job_enabled(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    workspace_control_name = DockableOutliner.get_workspace_control_name()</span><br><span class="line">    <span class="keyword">if</span> cmds.window(workspace_control_name, exists=<span class="literal">True</span>):</span><br><span class="line">        cmds.deleteUI(workspace_control_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    DockableOutliner.module_name_override = <span class="string">&quot;dockable_outliner&quot;</span></span><br><span class="line">    test_dialog = DockableOutliner()</span><br></pre></td></tr></table></figure>
<p><a name="t4Cku"></a></p>
<h1>Qt事件</h1>
<p><a name="TNHWF"></a></p>
<h2 id="事件介绍">事件介绍</h2>
<p><a name="ENkHI"></a></p>
<h3 id="事件系统">事件系统</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673245476361-c19b8bda-147b-4b63-b911-2c617fab571b.png#averageHue=%230c0c0c&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=679&amp;id=u290a994e&amp;originHeight=611&amp;originWidth=1467&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=296520&amp;status=done&amp;style=none&amp;taskId=ucf5758dc-3e02-4f6a-aabb-391e65599eb&amp;title=&amp;width=1630.0000431802548" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673245481192-e407fce6-d96f-4dbb-826e-2700eed58b08.png#averageHue=%23100f0e&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=533&amp;id=u9e628b49&amp;originHeight=480&amp;originWidth=1061&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=67608&amp;status=done&amp;style=none&amp;taskId=u26ab3981-a2a1-454a-af85-fe10b864a6f&amp;title=&amp;width=1178.88892011878" alt="image.png"><br>
<a name="Miv2S"></a></p>
<h3 id="事件驱动VS实时">事件驱动VS实时</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246046841-93f5eafd-7c7b-4b50-b79b-75d9b3819b6a.png#averageHue=%230b0b0b&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=832&amp;id=uafbddc9f&amp;originHeight=749&amp;originWidth=1560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=366420&amp;status=done&amp;style=none&amp;taskId=udd76986b-f221-4f4b-b16e-72f9b1d9c34&amp;title=&amp;width=1733.3333792509868" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246088391-e3b83926-7b34-40de-a0ad-84bf9428a48a.png#averageHue=%230e0d0c&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=613&amp;id=u1524d774&amp;originHeight=552&amp;originWidth=1512&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=87238&amp;status=done&amp;style=none&amp;taskId=ud5e95d16-6dca-46a5-9155-c5151bff665&amp;title=&amp;width=1680.0000445048026" alt="image.png"><br>
<a name="C3KQI"></a></p>
<h3 id="Qt事件">Qt事件</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246124739-710bc149-89f6-4a35-a955-089bb7e468ed.png#averageHue=%23080808&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=787&amp;id=u7d60f664&amp;originHeight=708&amp;originWidth=1586&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=274694&amp;status=done&amp;style=none&amp;taskId=u7403b032-62a3-4e27-b7d9-12e5fd26a66&amp;title=&amp;width=1762.22226890517" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246139637-502905e8-36c7-4804-90e8-3a07a874ebe1.png#averageHue=%230b0a09&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=638&amp;id=ued172028&amp;originHeight=574&amp;originWidth=1077&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=63418&amp;status=done&amp;style=none&amp;taskId=u01787e55-a086-430c-8775-795e6e142f8&amp;title=&amp;width=1196.6666983675082" alt="image.png"><br>
<a name="IQQkl"></a></p>
<h3 id="事件处理">事件处理</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246166933-d98416fc-5646-4c61-b821-a40aafcda3bf.png#averageHue=%230a0a0a&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=780&amp;id=u3142b467&amp;originHeight=702&amp;originWidth=1624&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=350911&amp;status=done&amp;style=none&amp;taskId=u17e17f0c-3953-4dc1-825a-4b72eea3c04&amp;title=&amp;width=1804.444492245899" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246180926-469e0cbf-b90c-4b60-9766-4638289cef72.png#averageHue=%23090908&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=579&amp;id=u8b97687c&amp;originHeight=521&amp;originWidth=1598&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=69519&amp;status=done&amp;style=none&amp;taskId=u68fcd36c-086c-422f-a635-d9b3036c141&amp;title=&amp;width=1775.555602591716" alt="image.png"><br>
<a name="DWTYd"></a></p>
<h3 id="事件过滤">事件过滤</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246220310-155f22c4-3bc3-4967-bf62-9980f0ce6665.png#averageHue=%230b0b0b&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=543&amp;id=u9d714b1b&amp;originHeight=489&amp;originWidth=1574&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=232756&amp;status=done&amp;style=none&amp;taskId=uf7edba98-7884-4862-99c9-f020cc1bb21&amp;title=&amp;width=1748.8889352186238" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673246260732-b5d7bcd7-19f6-46ac-b103-4a72c450d97a.png#averageHue=%230d0c0b&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=390&amp;id=u94cec4c9&amp;originHeight=312&amp;originWidth=1266&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39026&amp;status=done&amp;style=none&amp;taskId=ud6a3f8ef-4721-4be4-9711-e7d89090604&amp;title=&amp;width=1582.4999764189129" alt="image.png"><br>
<a name="KYXAz"></a></p>
<h2 id="举例">举例</h2>
<p><a name="zdhdh"></a></p>
<h3 id="KeyPress事件处理">KeyPress事件处理</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673247679167-269b96f7-fd7d-447f-9332-8ae9a1310fce.png#averageHue=%23464645&amp;clientId=u07b614fd-bd46-4&amp;from=paste&amp;height=285&amp;id=ufb2910ab&amp;originHeight=228&amp;originWidth=302&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3096&amp;status=done&amp;style=none&amp;taskId=uc597ac55-cdd1-47db-a24e-bafbaf9e786&amp;title=&amp;width=377.4999943748117" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomPlainTextEdit</span>(QtWidgets.QPlainTextEdit):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 输入文本编辑器 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomPlainTextEdit, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keyPressEvent</span>(<span class="params">self, key_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 重载keyPressEvent方法 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># print(&quot;Key Pressed: &#123;0&#125;&quot;.format(key_event.text()))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ctrl = key_event.modifiers() == QtCore.Qt.ControlModifier <span class="comment"># ctrl为布尔值，代表ctrl键是否处于按下的状态</span></span><br><span class="line">        <span class="comment"># print(&quot;Control Modifiers: &#123;0&#125;&quot;.format(ctrl))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        shift = key_event.modifiers() == QtCore.Qt.ShiftModifier</span><br><span class="line">        <span class="comment"># print(&quot;Shift Modifiers: &#123;0&#125;&quot;.format(shift))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        alt = key_event.modifiers() == QtCore.Qt.AltModifier</span><br><span class="line">        <span class="comment"># print(&quot;Alt Modifiers: &#123;0&#125;&quot;.format(alt))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ctrl_alt = key_event.modifiers() == (QtCore.Qt.ControlModifier | QtCore.Qt.AltModifier)</span><br><span class="line">        <span class="comment"># print(&quot;Ctrl+Alt Modifiers: &#123;0&#125;&quot;.format(ctrl_alt))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if shift:</span></span><br><span class="line">        <span class="comment">#     return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        key = key_event.key()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key == QtCore.Qt.Key_Return <span class="keyword">or</span> key == QtCore.Qt.Key_Enter:</span><br><span class="line">            <span class="string">&quot;&quot;&quot; Key_Return代表中间的回车键 Key_Enter代表右边的回车键 &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> ctrl: <span class="comment"># 如果是ctrl+enter</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Execute Code&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span> ctrl_alt: <span class="comment"># 如果是ctrl+alt+enter</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Execute Line&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">super</span>(CustomPlainTextEdit, <span class="variable language_">self</span>).keyPressEvent(key_event) <span class="comment"># 重载QtWidgets.QPlainTextEdit的keyPressEvent方法的同时，不影响keyPressEvent的功能</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KeyPressExample</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;Keypress Example&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(KeyPressExample, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">300</span>, <span class="number">80</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.WindowType.Window)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 控件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.plain_text = CustomPlainTextEdit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 布局 &quot;&quot;&quot;</span></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        main_layout.addWidget(<span class="variable language_">self</span>.plain_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    ui = KeyPressExample()</span><br><span class="line">    ui.show()</span><br></pre></td></tr></table></figure>
<p><a name="Rwerv"></a></p>
<h3 id="Mouse事件处理">Mouse事件处理</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/2623605/1673251794443-0628b284-6f6f-49c8-b3e0-5dec7bb5f149.png#averageHue=%23504f4f&amp;clientId=ud572c1dd-7c66-4&amp;from=paste&amp;height=540&amp;id=u5a5d4291&amp;originHeight=432&amp;originWidth=402&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3716&amp;status=done&amp;style=none&amp;taskId=u36be2f99-c435-4d76-a543-e34e857c7e5&amp;title=&amp;width=502.4999925121666" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtCore</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">from</span> shiboken2 <span class="keyword">import</span> wrapInstance</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_main_window</span>():</span><br><span class="line">    main_window_ptr = omui.MQtUtil.mainWindow()</span><br><span class="line">    <span class="keyword">return</span> wrapInstance(long(main_window_ptr), QtWidgets.QWidget)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveableWidget</span>(QtWidgets.QWidget):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y, width, height, color, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(MoveableWidget, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setFixedSize(width, height)</span><br><span class="line">        <span class="variable language_">self</span>.move(x, y)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.color = color</span><br><span class="line">        <span class="variable language_">self</span>.original_color = color</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.move_enabled = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mousePressEvent</span>(<span class="params">self, mouse_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 鼠标点击时的事件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse Button Pressed&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mouse_event.button() == QtCore.Qt.LeftButton:</span><br><span class="line">            <span class="variable language_">self</span>.initial_pos = <span class="variable language_">self</span>.pos()</span><br><span class="line">            <span class="variable language_">self</span>.global_pos = mouse_event.globalPos()</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.move_enabled = <span class="literal">True</span> <span class="comment"># 点击时可以移动widget</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mouseReleaseEvent</span>(<span class="params">self, mouse_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 鼠标释放时的事件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse Button Released&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.move_enabled:</span><br><span class="line">            <span class="variable language_">self</span>.move_enabled = <span class="literal">False</span> <span class="comment"># 松开后不能移动widget</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mouseDoubleClickEvent</span>(<span class="params">self, mouse_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 鼠标双击后改变颜色 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse Double-Click&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.color == <span class="variable language_">self</span>.original_color:</span><br><span class="line">            <span class="variable language_">self</span>.color = QtCore.Qt.yellow</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.color = <span class="variable language_">self</span>.original_color</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update() <span class="comment"># 更新颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mouseMoveEvent</span>(<span class="params">self, mouse_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 鼠标点击并移动时widget也移动 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse Move&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.move_enabled:</span><br><span class="line">            diff = mouse_event.globalPos() - <span class="variable language_">self</span>.global_pos</span><br><span class="line">            <span class="variable language_">self</span>.move(<span class="variable language_">self</span>.initial_pos + diff)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paintEvent</span>(<span class="params">self, paint_event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 绘制填充矩形 &quot;&quot;&quot;</span></span><br><span class="line">        painter = QtGui.QPainter(<span class="variable language_">self</span>)</span><br><span class="line">        painter.fillRect(paint_event.rect(), <span class="variable language_">self</span>.color)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MouseEventExample</span>(QtWidgets.QDialog):</span><br><span class="line"></span><br><span class="line">    WINDOW_TITLE = <span class="string">&quot;MAYA-2018&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=maya_main_window(<span class="params"></span>)</span>):</span><br><span class="line">        <span class="built_in">super</span>(MouseEventExample, <span class="variable language_">self</span>).__init__(parent)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="variable language_">self</span>.WINDOW_TITLE)</span><br><span class="line">        <span class="variable language_">self</span>.setMinimumSize(<span class="number">400</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setWindowFlags(QtCore.Qt.WindowType.Window)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.create_widgets()</span><br><span class="line">        <span class="variable language_">self</span>.create_layouts()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_widgets</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 控件 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.red_widget = MoveableWidget(<span class="number">100</span>, <span class="number">100</span>, <span class="number">24</span>, <span class="number">24</span>, QtCore.Qt.red, <span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.blue_widget = MoveableWidget(<span class="number">300</span>, <span class="number">300</span>, <span class="number">24</span>, <span class="number">24</span>, QtCore.Qt.blue, <span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_layouts</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 布局 &quot;&quot;&quot;</span></span><br><span class="line">        main_layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        main_layout.setContentsMargins(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ui.close()</span><br><span class="line">        ui.deleteLater()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    ui = MouseEventExample()</span><br><span class="line">    ui.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="Hk9pA"></a></p>
<h1>Drag and Drop</h1>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>pyside2 for maya</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://example.com/2023/08/29/PySide2-pyside2-for-maya/">http://example.com/2023/08/29/PySide2-pyside2-for-maya/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>RuiChen</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-08-29</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-08-09</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/PySide2/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>PySide2</a></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/29/Geek-VisualStudio%E7%9A%84%E4%BD%BF%E7%94%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(12).jpg?raw=true" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">VisualStudio的使用</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/29/UnrealEngine-UE-%E6%9D%90%E8%B4%A8%E8%8A%82%E7%82%B9/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(54).jpg?raw=true" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">UE 材质节点</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/07/PySide2-PySide2%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BD%92%E7%BA%B3/" title="pyside2的一些归纳"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(78).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-08-09</div><div class="title">pyside2的一些归纳</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="author_top is-center"><div class="card-info-avatar"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/assets/TouXiang.jpg" onerror="this.onerror=null;this.src='/assets/r1.jpg'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">🐟</g-emoji><span>认真摸鱼中</span></div></div></div><b><div class="author-info__name">RuiChen</div></b><div class="author-info__description">TD,TA</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.yuque.com/quanmianxiaokangdelouwangzhiyu" title="前往作者的语雀文章"><span>前往我的语雀文章</span><i class="faa-passing animated" style="padding-left:20px;display:inline-block;vertical-align:middle;"><svg class="icon" style="height:28px;width:28px;fill:currentColor;position:relative;top:5px"><use xlink:href="#icon-xiaoqiche"></use></svg></i></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/violet-chen?tab=repositories" target="_blank" title="Github"><svg class="social_icon faa-tada" aria-hidden="true" style="width:1.15em;height:1.15em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-github"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/assets/WeChat.jpg" target="_blank" title="微信"><svg class="social_icon faa-tada" aria-hidden="true" style="width:1.15em;height:1.15em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-weixin"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/assets/QQ.jpg" target="_blank" title="QQ"><svg class="social_icon faa-tada" aria-hidden="true" style="width:1.15em;height:1.15em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-QQ"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">创建一个新的界面的初始模板</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">创建对话框</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">添加控件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">layout基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">删除对话框</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">信号与槽</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E8%BD%BD%E4%BF%A1%E5%8F%B7"><span class="toc-text">过载信号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E5%8F%B7"><span class="toc-text">自定义信号</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">打开&#x2F;导入&#x2F;引用文件举例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">将插件放入到工具架上</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-text">主要功能模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%AA%97%E5%8F%A3%E6%98%BE%E7%A4%BA%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-text">调用窗口显示的模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">各种模式对话框</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-text">自定义对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86Qt%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-text">标准Qt对话框</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">QListWidget</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">可以设置的选择模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">QTableDialog</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%A4%A7%E7%BA%B2%E6%A8%A1%E5%9E%8B%E5%90%8D%E5%AD%97%E4%BB%A5%E5%8F%8A%E5%8F%98%E6%8D%A2%E4%BF%A1%E6%81%AF%E7%AA%97%E5%8F%A3"><span class="toc-text">显示大纲模型名字以及变换信息窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E8%A1%A8%E6%A0%BC%E6%8E%A7%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%85%B6%E4%BB%96%E6%8E%A7%E4%BB%B6"><span class="toc-text">在表格控件中添加其他控件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">QSpinBox与QDoubleSpinBox</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">启动maya图标资源管理器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">QTreeView File Explorer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">制作简单的大纲</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">制作进度条</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-text">不同对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-text">同一个对话框</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">QWidget vs QDialog</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#QWidget%E4%B8%8EQDialog%E7%9A%84%E6%98%BE%E7%A4%BA%E5%8C%BA%E5%88%AB"><span class="toc-text">QWidget与QDialog的显示区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">添加图片（QImage，QPixmap）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">遍历文件夹列出树结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">灯光面板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#scriptJob"><span class="toc-text">scriptJob</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Docking</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#maya%E7%9A%84workspaces%E8%AE%BE%E7%BD%AE%E5%AD%98%E6%94%BE%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-text">maya的workspaces设置存放的位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mayaMixin-py"><span class="toc-text">mayaMixin.py</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#workspace-control-py"><span class="toc-text">workspace_control.py</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86workspace-control%E4%BD%9C%E4%B8%BA%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E4%BD%BF%E7%94%A8%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">将workspace_control作为模块导入使用的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#workspace-control%E4%B8%BB%E8%A6%81%E4%BF%AE%E6%94%B9%E5%8C%BA%E5%9F%9F%EF%BC%9A"><span class="toc-text">workspace_control主要修改区域：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockable-outliner%E4%B8%8E%E5%8E%9F%E7%89%88%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="toc-text">dockable_outliner与原版的区别：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Qt事件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">事件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">事件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8VS%E5%AE%9E%E6%97%B6"><span class="toc-text">事件驱动VS实时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Qt%E4%BA%8B%E4%BB%B6"><span class="toc-text">Qt事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4"><span class="toc-text">事件过滤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-text">举例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyPress%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">KeyPress事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mouse%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">Mouse事件处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Drag and Drop</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 760px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 640px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(/assets/1.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/AI/&quot;);" href="javascript:void(0);">AI</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">AI</span></li><li class="categoryBar-list-item" style="background:url(/assets/8.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/DCC工具开发/&quot;);" href="javascript:void(0);">DCC工具开发</a><span class="categoryBar-list-count">10</span><span class="categoryBar-list-descr">DCC工具开发</span></li><li class="categoryBar-list-item" style="background:url(/assets/3.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/DCC软件/&quot;);" href="javascript:void(0);">DCC软件</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">DCC软件</span></li><li class="categoryBar-list-item" style="background:url(/assets/4.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/PySide2/&quot;);" href="javascript:void(0);">PySide2</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">Geek</span></li><li class="categoryBar-list-item" style="background:url(/assets/5.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Geek/&quot;);" href="javascript:void(0);">Geek</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr">PySide2</span></li><li class="categoryBar-list-item" style="background:url(/assets/6.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/UnrealEngine/&quot;);" href="javascript:void(0);">UnrealEngine</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr">UE开发</span></li><li class="categoryBar-list-item" style="background:url(/assets/7.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/UE开发/&quot;);" href="javascript:void(0);">UE开发</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr">UnrealEngine</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><!-- hexo injector body_end end --></body></html>