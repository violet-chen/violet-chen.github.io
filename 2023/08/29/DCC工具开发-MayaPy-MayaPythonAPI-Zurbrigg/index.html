<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MayaPythonAPI_Zurbrigg | RuiChen</title><meta name="keywords" content="MayaPy"><meta name="author" content="RuiChen"><meta name="copyright" content="RuiChen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Maya Python OpenMaya 教学第一卷 Zurbrigg - Maya Python API (Volume1)_哔哩哔哩_bilibili00_introduction_哔哩哔哩_bilibiliMaya Python OpenMaya 教学第三卷 Zurbrigg - Maya Python API (Volume3)_哔哩哔哩_bilibili  第一卷  Maya API的">
<meta property="og:type" content="article">
<meta property="og:title" content="MayaPythonAPI_Zurbrigg">
<meta property="og:url" content="http://example.com/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-MayaPythonAPI-Zurbrigg/index.html">
<meta property="og:site_name" content="RuiChen">
<meta property="og:description" content="Maya Python OpenMaya 教学第一卷 Zurbrigg - Maya Python API (Volume1)_哔哩哔哩_bilibili00_introduction_哔哩哔哩_bilibiliMaya Python OpenMaya 教学第三卷 Zurbrigg - Maya Python API (Volume3)_哔哩哔哩_bilibili  第一卷  Maya API的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/violet-chen/image_lib/blob/main/img%20(69).jpg?raw=true">
<meta property="article:published_time" content="2023-08-28T19:57:00.000Z">
<meta property="article:modified_time" content="2024-07-27T18:58:06.895Z">
<meta property="article:author" content="RuiChen">
<meta property="article:tag" content="MayaPy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/violet-chen/image_lib/blob/main/img%20(69).jpg?raw=true"><link rel="shortcut icon" href="/"><link rel="canonical" href="http://example.com/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-MayaPythonAPI-Zurbrigg/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MayaPythonAPI_Zurbrigg',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-28 02:58:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="RuiChen" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/assets/TouXiang.jpg" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1"></use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian"></use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei"></use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">RuiChen</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1"></use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian"></use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei"></use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></div></div><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">MayaPythonAPI_Zurbrigg</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2023-08-28T19:57:00.000Z" title="发表于 2023-08-29 03:57:00">2023-08-29</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-27T18:58:06.895Z" title="更新于 2024-07-28 02:58:06">2024-07-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/">DCC工具开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.4w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>67分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MayaPythonAPI_Zurbrigg"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer">
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1MG4y1W7oH/">Maya Python OpenMaya 教学第一卷 Zurbrigg - Maya Python API (Volume1)_哔哩哔哩_bilibili</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ge4y1H7wy?p=1&amp;vd_source=b1de3fe38e887eb40fc55a5485724480">00_introduction_哔哩哔哩_bilibili</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ye4y1r7Yv/">Maya Python OpenMaya 教学第三卷 Zurbrigg - Maya Python API (Volume3)_哔哩哔哩_bilibili</a><br>
<a name="lj7rs"></a></p>
<h1>第一卷</h1>
<p><a name="hJDLu"></a></p>
<h2 id="Maya-API的应用场景">Maya API的应用场景:</h2>
<p>maya api 主要应用于扩展maya，例如它可以用来为maya添加新的：节点，命令，工具，发射器等<br>当需要遍历很多数据时，使用maya api 要比maya command要快很多<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667383421121-2ac3d043-5149-48d8-891e-ce6e905f4252.png#averageHue=%230a0a0a&amp;clientId=u9187013c-10f8-4&amp;from=paste&amp;height=644&amp;id=u3947ac1b&amp;originHeight=580&amp;originWidth=557&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=93832&amp;status=done&amp;style=none&amp;taskId=u9e3feeec-c18c-4ec6-b6fd-08c68cfaa93&amp;title=&amp;width=618.8889052838459" alt="image.png"><br>
<a name="ojBpd"></a></p>
<h2 id="C-的利与弊与python的利与弊">C++的利与弊与python的利与弊</h2>
<p><a name="NizdK"></a></p>
<h3 id="C">C++</h3>
<p>左边是好处，右边是坏处<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667460561714-02cc79bc-5a09-4d66-ae5b-4b14952c5fa9.png#averageHue=%23070707&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=450&amp;id=uef85ad53&amp;originHeight=405&amp;originWidth=1576&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=137560&amp;status=done&amp;style=none&amp;taskId=ua2aeee3a-e970-4573-81f2-14523c3abaa&amp;title=&amp;width=1751.1111574997149" alt="image.png"><br>
<a name="UJU6c"></a></p>
<h3 id="python">python</h3>
<p>左边是好处，右边是坏处<br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667460536414-c4f0fd77-9fb9-41cd-a74c-e00835523e53.png#averageHue=%23070707&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=411&amp;id=uc30849e2&amp;originHeight=370&amp;originWidth=1463&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=119984&amp;status=done&amp;style=none&amp;taskId=u34a04e09-3889-467a-9564-6e9e0908df3&amp;title=&amp;width=1625.555598618073" alt="image.png"><br>
<a name="JEY1o"></a></p>
<h2 id="api2-0与api1-0的一些区别">api2.0与api1.0的一些区别</h2>
<p>api2.0：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667463343036-0b4a6649-ed06-4c3e-8202-5373d1f8462d.png#averageHue=%232a2b27&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=48&amp;id=wST9g&amp;originHeight=43&amp;originWidth=333&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14164&amp;status=done&amp;style=none&amp;taskId=u18be0ca0-c1b6-4516-9fec-fb2da4c89af&amp;title=&amp;width=370.00000980165294" alt="image.png"><br>api1.0：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667463365727-46e6f487-7ebd-4849-a895-5b83867057b0.png#averageHue=%232b2c2a&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=49&amp;id=uf79a2471&amp;originHeight=44&amp;originWidth=286&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12305&amp;status=done&amp;style=none&amp;taskId=ube2ab404-30cb-49ac-9062-8f80bc9e075&amp;title=&amp;width=317.77778619601423" alt="image.png"></p>
<p>api2.0自带MFnPlugin方法，而api1.0没有MFnPlugin方法，api1.0需要额外导入OpenMayaMPx模块来使用这个模块的MFnPlugin，MPxNode，MPxCommand等方法</p>
<p><a name="ctKU8"></a></p>
<h2 id="脚本-scripts-与插件-plugin-的区别">脚本(scripts)与插件(plugin)的区别</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667464768035-cae1e0b8-6c17-4c09-8690-5441abfb36ab.png#averageHue=%23060606&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=573&amp;id=u01c321c5&amp;originHeight=516&amp;originWidth=1601&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=193951&amp;status=done&amp;style=none&amp;taskId=u88d271e3-3583-4dac-843e-bc4ff1b0da5&amp;title=&amp;width=1778.8889360133526" alt="image.png"></p>
<p><a name="Y4Hry"></a></p>
<h2 id="一种简单的让maya识别到自定义插件的方式">一种简单的让maya识别到自定义插件的方式</h2>
<p>在maya的版本文档下新建一个plug-ins文件夹，将插件放到这个文件夹下。<br>这种方式虽然简单，但是有个缺点是如果有多个版本的maya，那么需要在每个版本的maya文件夹下都要新建plug-ins文件夹。<br>
<a name="sVFQs"></a></p>
<h1><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667464831496-229a0aaa-265e-4126-93bd-cb14db98d2a9.png#averageHue=%23eae4ce&amp;clientId=u7c600ae3-8851-4&amp;from=paste&amp;height=344&amp;id=u5f2fcb0a&amp;originHeight=310&amp;originWidth=496&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=77486&amp;status=done&amp;style=none&amp;taskId=u2e7496e4-e5e6-44d4-8cc4-adfe38f0d22&amp;title=&amp;width=551.1111257105701" alt="image.png"></h1>
<p><a name="JXzvq"></a></p>
<h2 id="写maya插件的模板">写maya插件的模板</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya，使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后，在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_name = <span class="string">&quot;empty_plugin.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="dJth8"></a></p>
<h2 id="Hello-World">Hello World</h2>
<p><a name="k9ZiZ"></a></p>
<h3 id="HelloWorld命令">HelloWorld命令</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorldCmd</span>(om.MPxCommand):</span><br><span class="line">    COMMAND_NAME = <span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(HelloWorldCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doIt</span>(<span class="params">self, args</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 执行的命令 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 注册maya命令时使用的方法，用来得到类的实例 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> HelloWorldCmd()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 向maya注册一个新命令,第一个参数是命令的名字，第二个参数是类的实例</span></span><br><span class="line">        plugin_fn.registerCommand(HelloWorldCmd.COMMAND_NAME, HelloWorldCmd.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldCmd.COMMAND_NAME))  <span class="comment"># 注册失败时输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterCommand(HelloWorldCmd.COMMAND_NAME)  <span class="comment"># 取消注册新命令</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldCmd.COMMAND_NAME))  <span class="comment"># 取消注册失败时输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后，在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_name = <span class="string">&quot;command_01_HelloWorld.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="YBdwl"></a></p>
<h3 id="HelloWorld节点">HelloWorld节点</h3>
<p>这里是创建一个helloworld节点，创建节点后会在maya界面上绘制字体<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1667802585667-f2101105-470f-4ada-aa46-9822ecb9f68d.png#averageHue=%23494848&amp;clientId=u559e9f03-b86e-4&amp;from=paste&amp;height=1276&amp;id=uc1059362&amp;originHeight=1148&amp;originWidth=2431&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=101624&amp;status=done&amp;style=none&amp;taskId=ua9341f0d-6724-40be-9c6f-c75be391c03&amp;title=&amp;width=2701.1111826661213" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaRender <span class="keyword">as</span> omr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya，使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorldNode</span>(omui.MPxLocatorNode):</span><br><span class="line">    TYPE_NAME = <span class="string">&quot;helloworld&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007f7f7</span>)</span><br><span class="line">    DRAW_CLASSIFICATION = <span class="string">&quot;drawdb/geometry/helloworld&quot;</span></span><br><span class="line">    DRAW_REGISTRANT_ID = <span class="string">&quot;HelloWorldNode&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(HelloWorldNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> HelloWorldNode()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorldDrawOverride</span>(omr.MPxDrawOverride):</span><br><span class="line">    NAME = <span class="string">&quot;HelloWorldDrawOverride&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="built_in">super</span>(HelloWorldDrawOverride, <span class="variable language_">self</span>).__init__(obj, <span class="literal">None</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepareForDraw</span>(<span class="params">self, obj_path, camera_path, frame_context, old_data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">supportedDrawAPIs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> omr.MRenderer.kAllDevices</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasUIDrawables</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addUIDrawables</span>(<span class="params">self, obj_path, draw_manager, frame_context, data</span>):</span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line">        draw_manager.text2d(om.MPoint(<span class="number">100</span>, <span class="number">100</span>), <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> HelloWorldDrawOverride(obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(HelloWorldNode.TYPE_NAME,</span><br><span class="line">                               HelloWorldNode.TYPE_ID,</span><br><span class="line">                               HelloWorldNode.creator,</span><br><span class="line">                               HelloWorldNode.initialize,</span><br><span class="line">                               om.MPxNode.kLocatorNode,</span><br><span class="line">                               HelloWorldNode.DRAW_CLASSIFICATION)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.registerDrawOverrideCreator(HelloWorldNode.DRAW_CLASSIFICATION,</span><br><span class="line">                                                      HelloWorldNode.DRAW_REGISTRANT_ID,</span><br><span class="line">                                                      HelloWorldDrawOverride.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.deregisterDrawOverrideCreator(HelloWorldNode.DRAW_CLASSIFICATION,</span><br><span class="line">                                                        HelloWorldNode.DRAW_REGISTRANT_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(HelloWorldNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(HelloWorldNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后，在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_name = <span class="string">&quot;hello_world_node.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.createNode(&quot;helloworld&quot;)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="WjwE1"></a></p>
<h2 id="maya官方给的maya-python-api示例">maya官方给的maya python api示例</h2>
<p>首先下载maya开发者工具包，下载压缩后在devkitBase\devkit\plug-ins\scripted目录下可以看到各种示例<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668756899011-a00cc1a7-62fa-4227-a20e-6fe3d5068eda.png#averageHue=%23f8f5f2&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=361&amp;id=u9826c00d&amp;originHeight=325&amp;originWidth=414&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32253&amp;status=done&amp;style=none&amp;taskId=u4195e815-ad0b-4071-ad90-33cf4da6b01&amp;title=&amp;width=460.0000121858388" alt="image.png">py开头的是使用了maya api 2.0的，其他的是使用了maya api 1.0<br>
<a name="uhzNA"></a></p>
<h2 id="maya-api-基础">maya api 基础</h2>
<p>maya api 的四种对象类型：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757424116-5bcafdfe-528a-4e28-8fa2-2776830786e9.png#averageHue=%230d0d0d&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=413&amp;id=u45e06f43&amp;originHeight=372&amp;originWidth=580&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=72263&amp;status=done&amp;style=none&amp;taskId=u053e978a-be3a-4a87-a7ae-c7da6792118&amp;title=&amp;width=644.4444615163925" alt="image.png"><br>
<a name="HbQrQ"></a></p>
<h3 id="MObject">MObject</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757463577-ad1d2012-8326-4cc5-964f-d200e864d8df.png#averageHue=%23090909&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=403&amp;id=u9adfb691&amp;originHeight=363&amp;originWidth=1570&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=161345&amp;status=done&amp;style=none&amp;taskId=uf9c7c238-452a-4b07-99fc-c108395de57&amp;title=&amp;width=1744.4444906564418" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757486229-d8d55a9b-9ed9-427e-b4f9-dbc750251b5c.png#averageHue=%230c0c0b&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=410&amp;id=u0e624a36&amp;originHeight=369&amp;originWidth=1066&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36840&amp;status=done&amp;style=none&amp;taskId=ub45130b7-7469-4383-8eb9-4a6fd153b6a&amp;title=&amp;width=1184.4444758215077" alt="image.png"><br>
<a name="tMLbr"></a></p>
<h3 id="MFunction-Sets">MFunction Sets</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757603504-98b7ab6a-d4b5-4ce1-8b20-a299684d5ec0.png#averageHue=%230b0b0b&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=591&amp;id=uad6c347e&amp;originHeight=532&amp;originWidth=1925&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=306154&amp;status=done&amp;style=none&amp;taskId=uccd13f10-394d-439a-8bc6-fb894fb2726&amp;title=&amp;width=2138.8889455500957" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757617546-3e41599a-3c85-452f-aae5-766cc0d5f2d6.png#averageHue=%23030202&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=478&amp;id=u0f7b9081&amp;originHeight=430&amp;originWidth=1776&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46137&amp;status=done&amp;style=none&amp;taskId=ua8760436-76aa-44bc-b289-a533db449ec&amp;title=&amp;width=1973.3333856088157" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668758099121-90c8c82c-9144-4d07-aecb-96a98029ce5b.png#averageHue=%231e1c1b&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=79&amp;id=u65220e11&amp;originHeight=71&amp;originWidth=532&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6738&amp;status=done&amp;style=none&amp;taskId=ubcb16715-4419-4be2-b065-d292f84cce0&amp;title=&amp;width=591.1111267702083" alt="image.png"><br>
<a name="NvbOz"></a></p>
<h3 id="Wrappers">Wrappers</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668757981249-0896516f-f88c-4e6a-b7a1-46a246eaf888.png#averageHue=%230c0c0c&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=376&amp;id=ud54245f5&amp;originHeight=338&amp;originWidth=1849&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=174631&amp;status=done&amp;style=none&amp;taskId=u2c4ab016-58db-4b1f-8dd6-42237e46897&amp;title=&amp;width=2054.4444988686378" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668758001529-b6d25d43-aa16-4772-97bc-678e0f7ecf63.png#averageHue=%230b0b0a&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=333&amp;id=u28555cfc&amp;originHeight=300&amp;originWidth=1268&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24703&amp;status=done&amp;style=none&amp;taskId=u88125d2c-7024-4d98-85e4-d1edf78d038&amp;title=&amp;width=1408.8889262116995" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668758189352-8278e833-5834-4667-a300-ee18231c5229.png#averageHue=%23131313&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=140&amp;id=cbPpA&amp;originHeight=126&amp;originWidth=887&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57056&amp;status=done&amp;style=none&amp;taskId=u066e4b64-97b5-4f52-b7a4-b3ca8870621&amp;title=&amp;width=985.5555816638624" alt="image.png"><br>迭代器也被认为是wrappers<br>迭代器类的名字前缀为MIt<br>
<a name="XEXAt"></a></p>
<h3 id="Proxies">Proxies</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668758333101-5714a52d-bbac-4735-b67a-23c698a726b1.png#averageHue=%230a0a0a&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=259&amp;id=ue6ceda73&amp;originHeight=233&amp;originWidth=1552&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=109960&amp;status=done&amp;style=none&amp;taskId=u2eebbf2f-1478-4212-bbf9-bfafbbeb365&amp;title=&amp;width=1724.444490126623" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668758345822-91311951-6d7e-4d36-834c-44a765d10526.png#averageHue=%230a0908&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=239&amp;id=ub00deaaf&amp;originHeight=215&amp;originWidth=1076&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=21372&amp;status=done&amp;style=none&amp;taskId=u71a901fd-8fb6-438c-80d4-12ed3ebc05c&amp;title=&amp;width=1195.5555872269626" alt="image.png"><br>
<a name="tRBiS"></a></p>
<h3 id="举例">举例</h3>
<p>遍历当前maya选择的对象，根据对象是否拥有对应的函数集来输出调用函数集的功能所得到的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line">selection = om.MGlobal.getActiveSelectionList()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(selection.length()):</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;--------&quot;</span>)</span><br><span class="line">    obj = selection.getDependNode(i) <span class="comment"># Return an MObject</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;API Type: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(obj.apiTypeStr))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> obj.hasFn(om.MFn.kDependencyNode):  <span class="comment"># 检查这个MObject是否能够使用这个函数集</span></span><br><span class="line">        </span><br><span class="line">        depend_fn = om.MFnDependencyNode(obj)  <span class="comment"># 将这个函数集附加到obj上</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Dependency Node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(depend_fn.name()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> obj.hasFn(om.MFn.kTransform):</span><br><span class="line">        transform_fn = om.MFnTransform(obj)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Translation: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(transform_fn.translation(om.MSpace.kTransform)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> obj.hasFn(om.MFn.kMesh):</span><br><span class="line">        mesh_fn = om.MFnMesh(obj)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mesh Vertices: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(mesh_fn.getVertices()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> obj.hasFn(om.MFn.kCamera):</span><br><span class="line">        camera_fn = om.MFnCamera(obj)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Clipping Planes: &#123;0&#125;, &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(camera_fn.nearClippingPlane, camera_fn.farClippingPlane))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果选择一个方盒子和一个摄像机，输出的内容：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668760680105-a0eeb9d2-e575-4f3b-9924-ddf512182d37.png#averageHue=%23363433&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=122&amp;id=u425096dc&amp;originHeight=110&amp;originWidth=240&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4711&amp;status=done&amp;style=none&amp;taskId=u8d5c9f77-07fa-4b88-8cca-88e143fe2dc&amp;title=&amp;width=266.66667373092105" alt="image.png"><br>
<a name="jnx97"></a></p>
<h2 id="Dependence-Graph（DG）">Dependence Graph（DG）</h2>
<p><a name="Ccttp"></a></p>
<h3 id="DG的介绍与特点">DG的介绍与特点</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761163618-33e7c611-7817-405a-9b2b-766b1d533440.png#averageHue=%230b0b0b&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=810&amp;id=XyC36&amp;originHeight=729&amp;originWidth=2096&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=414736&amp;status=done&amp;style=none&amp;taskId=u42990e71-5a65-49d2-9e9c-a64e8f0d39f&amp;title=&amp;width=2328.888950583377" alt="image.png"><br>Dependency Graph(DG)是一个基于节点的体系架构，它为创建maya场景提供了基本构建块<br>它有以下四种特点<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761342892-93171d7e-a642-433e-aa4c-9b510cd2c498.png#averageHue=%230c0b0a&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=476&amp;id=uf3b601db&amp;originHeight=428&amp;originWidth=922&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33498&amp;status=done&amp;style=none&amp;taskId=ufcbe683c-7f8b-4354-ad6c-9c4062777e0&amp;title=&amp;width=1024.444471582955" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761150642-0a80b927-5a60-49c4-b027-bca05a8d6836.png#averageHue=%23272726&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=1327&amp;id=u257632d5&amp;originHeight=1194&amp;originWidth=2432&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=879147&amp;status=done&amp;style=none&amp;taskId=u4d62cf75-96a3-4cf7-ab48-e7cdc920b51&amp;title=&amp;width=2702.2222938066666" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761551913-c037888d-c7cc-4033-b3e1-81f92089bc8f.png#averageHue=%230e0e0e&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=841&amp;id=u3a92f826&amp;originHeight=757&amp;originWidth=2401&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=610510&amp;status=done&amp;style=none&amp;taskId=u7848e4b9-2ffc-492c-b063-76f725fa1c8&amp;title=&amp;width=2667.777848449756" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761571232-3ad31dae-60a3-41d3-bb34-e32524d77b3f.png#averageHue=%230a0909&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=704&amp;id=uf1c750fd&amp;originHeight=634&amp;originWidth=2308&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=75814&amp;status=done&amp;style=none&amp;taskId=ub881fa28-d2f8-4bb6-a522-6288ca49625&amp;title=&amp;width=2564.444512379024" alt="image.png"><br>
<a name="fboq8"></a></p>
<h3 id="DG如何使用Push-Pull模型更新">DG如何使用Push-Pull模型更新</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761923835-c285aae6-d84e-439f-8f0d-612828fc6232.png#averageHue=%230e0e0e&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=536&amp;id=ue98daa24&amp;originHeight=482&amp;originWidth=2212&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=352674&amp;status=done&amp;style=none&amp;taskId=u69e78de1-ae03-47ae-b798-4d361c6c080&amp;title=&amp;width=2457.777842886656" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668761946640-9119250d-ba52-4918-a15e-f01ab34b43cf.png#averageHue=%23111010&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=470&amp;id=u98338a51&amp;originHeight=423&amp;originWidth=1166&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=45255&amp;status=done&amp;style=none&amp;taskId=u50686900-2519-45e8-a38e-e5d12bc4f14&amp;title=&amp;width=1295.555589876058" alt="image.png"><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1MG4y1W7oH?t=388.5">https://www.bilibili.com/video/BV1MG4y1W7oH?t=388.5</a><br>1.例如这是一个DG结构，绿色代表这些节点都是干净的（clean），然后如果A发生改变，那么A节点就会变成脏的（dirty）状态，A节点变成了dirty状态，那么它会影响C和D都变成dirty状态<br>2.当maya要需要用到D时，发现D时dirty状态，那么它就从D出发然后追溯到A，然后更新A后，A变成了干净的状态就可以将C，D变成干净的状态了，都变成绿色后maya就可以刷新视口完成更新。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668762261343-90336c63-2aa9-44d0-bc1f-99d398d94eed.png#averageHue=%23050505&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=423&amp;id=u52c2d5b0&amp;originHeight=381&amp;originWidth=1013&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=77999&amp;status=done&amp;style=none&amp;taskId=uaef480b3-53a1-42ff-a51b-827f01eb71c&amp;title=&amp;width=1125.555585372596" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668762472151-9a16e2d6-12b9-42df-a940-ce73ec65bf69.png#averageHue=%23100404&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=452&amp;id=ub2f38869&amp;originHeight=407&amp;originWidth=1500&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=95134&amp;status=done&amp;style=none&amp;taskId=u298a6611-a2fe-4325-bc6a-39517ffabb6&amp;title=&amp;width=1666.6667108182567" alt="image.png"><br>
<a name="MfY5i"></a></p>
<h3 id="总结">总结</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668762937405-0f83ed9e-427f-4338-a3ce-494525a8a6c7.png#averageHue=%230e0e0e&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=683&amp;id=u3f2f378f&amp;originHeight=615&amp;originWidth=1945&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=387777&amp;status=done&amp;style=none&amp;taskId=u161273b9-8008-4861-b0af-daa93ecbb3d&amp;title=&amp;width=2161.111168361006" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668762950877-b186a562-aba5-47d0-b25e-182a33fcee83.png#averageHue=%23100f0e&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=598&amp;id=u299e3928&amp;originHeight=538&amp;originWidth=915&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=51259&amp;status=done&amp;style=none&amp;taskId=u2ed88ca5-47bb-49b9-a4d2-ade9399bc5b&amp;title=&amp;width=1016.6666935991365" alt="image.png"><br>
<a name="s9UG4"></a></p>
<h2 id="自定义节点">自定义节点</h2>
<p><a name="nay0M"></a></p>
<h3 id="节点介绍">节点介绍</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763130944-71ddc6f1-a5e5-4b4e-a5e6-c13d2bd1b7cf.png#averageHue=%2333302d&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=1257&amp;id=u554ce68a&amp;originHeight=1131&amp;originWidth=1662&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=369196&amp;status=done&amp;style=none&amp;taskId=u496f3ed9-acd8-47e8-a191-c4822f0f9cc&amp;title=&amp;width=1846.6667155866282" alt="image.png"><br>
<a name="RSfdh"></a></p>
<h3 id="节点属性">节点属性</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763156514-602afe94-bd9f-4395-a23e-31c35d42d1f2.png#averageHue=%230a0a0a&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=469&amp;id=u008121fa&amp;originHeight=422&amp;originWidth=1405&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=162964&amp;status=done&amp;style=none&amp;taskId=u2de4073e-e3fb-45b3-8f54-939757f8681&amp;title=&amp;width=1561.1111524664336" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763177599-8d85e678-ca47-447e-8218-84b8e95bb9b9.png#averageHue=%230b0a09&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=397&amp;id=ucccb7b5c&amp;originHeight=357&amp;originWidth=888&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36218&amp;status=done&amp;style=none&amp;taskId=u9053fc41-a882-4584-85c7-e31979437ed&amp;title=&amp;width=986.6666928044078" alt="image.png"><br>
<a name="dCqhu"></a></p>
<h3 id="计算方法">计算方法</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763493087-be9e5958-073a-4d4f-8745-67beb60079f4.png#averageHue=%23090909&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=790&amp;id=u3f359d80&amp;originHeight=711&amp;originWidth=2147&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=347598&amp;status=done&amp;style=none&amp;taskId=u8a0afed6-383d-45ce-abce-b3a3bfc647e&amp;title=&amp;width=2385.555618751198" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763520618-8b0d60cc-ab2b-4d15-bd61-1acb88ceb292.png#averageHue=%230a0a09&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=733&amp;id=u6e998dca&amp;originHeight=660&amp;originWidth=1554&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57469&amp;status=done&amp;style=none&amp;taskId=ue7713662-7819-46ca-bd4c-c15af6ccb71&amp;title=&amp;width=1726.6667124077137" alt="image.png"><br>
<a name="GbyfY"></a></p>
<h3 id="依赖属性">依赖属性</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763577672-f2f0b925-b1e7-4329-be7d-7a46ba7d99d1.png#averageHue=%230e0e0e&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=524&amp;id=ub2f2148a&amp;originHeight=472&amp;originWidth=1586&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=277578&amp;status=done&amp;style=none&amp;taskId=u14099266-66c8-433c-8417-51bb93f46b7&amp;title=&amp;width=1762.22226890517" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668763600580-5b7607ca-bd27-4cd4-910a-91b54913d0e2.png#averageHue=%23100e0d&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=477&amp;id=uc529be08&amp;originHeight=429&amp;originWidth=1062&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=50290&amp;status=done&amp;style=none&amp;taskId=u3f261be0-8e8e-4667-9953-dada8358768&amp;title=&amp;width=1180.0000312593256" alt="image.png"><br>
<a name="aw0a0"></a></p>
<h3 id="修改属性">修改属性</h3>
<p>修改属性有三种方法<br>
<a name="LB0eE"></a></p>
<h4 id="使用plug修改属性">使用plug修改属性</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668764346831-80c6083d-1b75-4ee4-8523-de7845605fa8.png#averageHue=%23c8cdd2&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=283&amp;id=ue57d47a7&amp;originHeight=255&amp;originWidth=1505&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=277460&amp;status=done&amp;style=none&amp;taskId=u0c705406-6e6d-400e-a75f-4fe35e0d483&amp;title=&amp;width=1672.222266520984" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1668764372359-5063c355-c623-4f55-bba6-bcd44af70080.png#averageHue=%23cbd4db&amp;clientId=ubf5ae5a3-31c1-4&amp;from=paste&amp;height=128&amp;id=BcXTq&amp;originHeight=115&amp;originWidth=1490&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=30751&amp;status=done&amp;style=none&amp;taskId=u167cfc41-ddfe-4f75-bfa3-ae848c87d6c&amp;title=&amp;width=1655.5555994128015" alt="image.png"><br></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line">node_name = <span class="string">&quot;pCube1&quot;</span></span><br><span class="line">attribute_name = <span class="string">&quot;translateY&quot;</span></span><br><span class="line"></span><br><span class="line">selection_list = om.MSelectionList()</span><br><span class="line">selection_list.add(node_name)</span><br><span class="line"></span><br><span class="line">obj = selection_list.getDependNode(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obj.hasFn(om.MFn.kTransform):</span><br><span class="line">    transform_fn = om.MFnTransform(obj)</span><br><span class="line">    </span><br><span class="line">    plug = transform_fn.findPlug(attribute_name,<span class="literal">False</span>)  <span class="comment"># 获取pCube的translateY的plug对象，False的含义在以后的章节讲</span></span><br><span class="line">    </span><br><span class="line">    attribute_value = plug.asDouble()  <span class="comment"># 得到plug对应的数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;0&#125;: &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(plug, attribute_value))  <span class="comment">#  这里输出plug虽然是pCube1.translateY，但是plug并不是字符串，plug覆盖了string方法，使其输出内容改变了。</span></span><br><span class="line">   </span><br><span class="line">    plug.setDouble(<span class="number">2.0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line">node_name = <span class="string">&quot;pCube1&quot;</span></span><br><span class="line">attribute_name = <span class="string">&quot;translate&quot;</span></span><br><span class="line"></span><br><span class="line">selection_list = om.MSelectionList()</span><br><span class="line">selection_list.add(node_name)</span><br><span class="line"></span><br><span class="line">obj = selection_list.getDependNode(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obj.hasFn(om.MFn.kTransform):</span><br><span class="line">    transform_fn = om.MFnTransform(obj)</span><br><span class="line">    </span><br><span class="line">    plug = transform_fn.findPlug(attribute_name,<span class="literal">False</span>) </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> plug.isCompound: <span class="comment"># 判断插头是否是复合类型</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(plug.numChildren()): <span class="comment"># 遍历插头的子项</span></span><br><span class="line">            child_plug = plug.child(i)</span><br><span class="line">            </span><br><span class="line">            attribute_value = child_plug.asDouble()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;0&#125;: &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(child_plug, attribute_value))</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a name="BLunB"></a></p>
<h4 id="利用函数集自带的修改属性的方法">利用函数集自带的修改属性的方法</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line">node_name = <span class="string">&quot;pCube1&quot;</span></span><br><span class="line">attribute_name = <span class="string">&quot;translate&quot;</span></span><br><span class="line"></span><br><span class="line">selection_list = om.MSelectionList()</span><br><span class="line">selection_list.add(node_name)</span><br><span class="line"></span><br><span class="line">obj = selection_list.getDependNode(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obj.hasFn(om.MFn.kTransform):</span><br><span class="line">    transform_fn = om.MFnTransform(obj)</span><br><span class="line">    </span><br><span class="line">    translation = transform_fn.translation(om.MSpace.kTransform)</span><br><span class="line">    translation[<span class="number">1</span>] = <span class="number">3.0</span></span><br><span class="line">    transform_fn.setTranslation(translation, om.MSpace.kTransform)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a name="mDfst"></a></p>
<h3 id="创建自定义节点所需要的基础">创建自定义节点所需要的基础</h3>
<p><a name="qK48a"></a></p>
<h4 id="MPxNode">MPxNode</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669002338612-6cd488a2-a0b5-4a42-b533-029835e1112c.png#averageHue=%231f1d1b&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=67&amp;id=ua2b59691&amp;originHeight=60&amp;originWidth=778&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9484&amp;status=done&amp;style=none&amp;taskId=u274c2a12-21b4-46a3-881f-b36d77cc888&amp;title=&amp;width=864.4444673444024" alt="image.png"><br>HelloWorld节点用到的MPxLocatorNode class是MPxNode派生的。<br>
<a name="XbsyV"></a></p>
<h4 id="initializePlugin">initializePlugin()</h4>
<p>任何新的自定义节点都需要在maya中注册，然后才能使用。<br>注册是在initializePlugin() 函数内使用MPxPlugin.registerNode()<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669002627571-0a9ab6a7-7bbd-4c42-8c41-fc59d6722fb8.png#averageHue=%23151515&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=58&amp;id=uf14fa594&amp;originHeight=52&amp;originWidth=1066&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35968&amp;status=done&amp;style=none&amp;taskId=u657637d1-41cc-41a0-9128-eeef564d1a5&amp;title=&amp;width=1184.4444758215077" alt="image.png"><br>
<a name="MyqhV"></a></p>
<h4 id="MPxPlugin-registerNode">MPxPlugin.registerNode()</h4>
<p>注册方法需要节点的名字，一个唯一的ID，创建的方法，初始化的方法。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669002669128-8f96557a-60bb-4d22-be51-bf52257e5bca.png#averageHue=%230d0d0d&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=258&amp;id=vNpME&amp;originHeight=232&amp;originWidth=672&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=65799&amp;status=done&amp;style=none&amp;taskId=ud60b7ac1-1cea-4b59-b4c0-73a5de343ec&amp;title=&amp;width=746.666686446579" alt="image.png"><br>
<a name="GWIJg"></a></p>
<h4 id="creator">creator()</h4>
<p>creator()用来返回一个类的新实例<br>
<a name="FAjY7"></a></p>
<h4 id="initialize">initialize()</h4>
<p>initialize()有三个作用：1.初始化所有的节点属性2.添加或修改节点的属性都在这个方法内3.只有当加载plugin时调用<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669002823683-177350b5-96c4-456d-8562-86a2638a561e.png#averageHue=%230b0b0b&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=271&amp;id=u3cb4080a&amp;originHeight=244&amp;originWidth=857&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=72938&amp;status=done&amp;style=none&amp;taskId=u92e4ec28-6dbe-4706-b9dc-9dd8dd76224&amp;title=&amp;width=952.2222474474972" alt="image.png"><br>
<a name="Qkry9"></a></p>
<h4 id="注：">注：</h4>
<p>creator()与initialize()方法可以用不同的函数名，creator与initialize是通用的容易表示的。只是一个命名约定<br>
<a name="fYVC7"></a></p>
<h4 id="Compute">Compute()</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669003318484-4b8a7b71-6973-4ff7-947a-830df396d988.png#averageHue=%23060606&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=139&amp;id=u04fdd6a7&amp;originHeight=125&amp;originWidth=581&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=22040&amp;status=done&amp;style=none&amp;taskId=u43cd17f4-c28f-4042-917c-cff5389dad0&amp;title=&amp;width=645.555572656938" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669003311035-561243ea-01cd-4745-a747-bbbd6c869d1b.png#averageHue=%230a0a0a&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=326&amp;id=u4c983ea9&amp;originHeight=293&amp;originWidth=1555&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=153631&amp;status=done&amp;style=none&amp;taskId=u0966b6f8-eb7f-4450-96f8-afad2cdf399&amp;title=&amp;width=1727.7778235482592" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669003340185-5a47b13d-570c-4674-bc43-9e24cab712ac.png#averageHue=%23080706&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=317&amp;id=u1d2aebb6&amp;originHeight=285&amp;originWidth=956&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36827&amp;status=done&amp;style=none&amp;taskId=u1d83cf90-56ee-431f-b3d5-10d667e9e17&amp;title=&amp;width=1062.2222503615021" alt="image.png"><br>
<a name="oQ8aa"></a></p>
<h4 id="postConstructor">postConstructor()</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669007286665-679ae1fc-3e15-4f05-93d6-9790d1ef97da.png#averageHue=%230b0b0b&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=183&amp;id=u2e060501&amp;originHeight=165&amp;originWidth=1357&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=81307&amp;status=done&amp;style=none&amp;taskId=u23c02b7c-84aa-43d3-9395-a55adeea4a8&amp;title=&amp;width=1507.7778177202495" alt="image.png"><br>当创建节点后调用<br>
<a name="vw2qD"></a></p>
<h4 id="connectionMade-和-connectionBroken">connectionMade() 和 connectionBroken()</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669007312866-0ed526c4-0327-4ec1-bff2-2d33ac61b0ce.png#averageHue=%230e0e0e&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=194&amp;id=ufb500e38&amp;originHeight=175&amp;originWidth=1053&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=80662&amp;status=done&amp;style=none&amp;taskId=uca63225e-eaf7-44b3-a444-baf2f71ae79&amp;title=&amp;width=1170.0000309944162" alt="image.png"><br>当节点连接状态发生改变时调用<br>
<a name="tX12q"></a></p>
<h3 id="举例：自定义一个简单的数学节点">举例：自定义一个简单的数学节点</h3>
<p>节点功能：将两个数相乘并输出结果值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669019508238-3c8534af-9ab0-4dcf-8d15-a91eb495d03e.png#averageHue=%2347cd89&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=223&amp;id=u361e46aa&amp;originHeight=201&amp;originWidth=290&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11821&amp;status=done&amp;style=none&amp;taskId=ue94ba214-cf36-495e-b391-f5fb74ba7b1&amp;title=&amp;width=322.22223075819625" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 这个函数告诉了maya这个插件生成,并且生成的对象使用maya python api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MutiplyNode</span>(om.MPxNode):</span><br><span class="line">    TYPE_NAME = <span class="string">&quot;multiplynode&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7F8</span>)</span><br><span class="line">    <span class="comment"># 提前声明节点的属性</span></span><br><span class="line">    multiplier_obj = <span class="literal">None</span></span><br><span class="line">    multiplicand_obj = <span class="literal">None</span></span><br><span class="line">    product_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MutiplyNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, plug, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;_summary_</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            plug (_type_): 当plug是dirty状态时,会传过来,要求更新</span></span><br><span class="line"><span class="string">            data (_type_): data提供了读取和写入节点属性值的方法</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> plug == MutiplyNode.product_obj:</span><br><span class="line"></span><br><span class="line">            multiplier = data.inputValue(MutiplyNode.multiplier_obj).asInt()  <span class="comment"># 获取multiplier_obj对象的输入的属性值</span></span><br><span class="line">            multiplicand = data.inputValue(MutiplyNode.multiplicand_obj).asDouble()  <span class="comment"># 获取multiplicand_obj对象的输入的属性值</span></span><br><span class="line">            product = multiplier * multiplicand </span><br><span class="line"></span><br><span class="line">            product_data_handle = data.outputValue(MutiplyNode.product_obj)  <span class="comment"># 获取product_obj对象的输出数据对象</span></span><br><span class="line">            product_data_handle.setDouble(product)  <span class="comment"># 设置product_obj对象的输出数据</span></span><br><span class="line"></span><br><span class="line">            data.setClean(plug) <span class="comment"># 将plug设置为clean状态</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> MutiplyNode()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        numeric_attr = om.MFnNumericAttribute() <span class="comment"># 创建一个用来设置数字系列属性的对象</span></span><br><span class="line"></span><br><span class="line">        cls.multiplier_obj = numeric_attr.create(<span class="string">&quot;multiplier&quot;</span>, <span class="string">&quot;mul&quot;</span>, om.MFnNumericData.kInt, <span class="number">2</span>)  <span class="comment"># 属性长名，属性短名，属性数字类型，属性初始值</span></span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span> <span class="comment"># 设置属性可以key关键帧(这样属性就能出现在channel box中)</span></span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span>  <span class="comment">#  设置属性没有输出引脚(其他属性不能读它)</span></span><br><span class="line"></span><br><span class="line">        cls.multiplicand_obj = numeric_attr.create(<span class="string">&quot;multiplicand&quot;</span>, <span class="string">&quot;mulc&quot;</span>, om.MFnNumericData.kDouble, <span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span></span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        cls.product_obj = numeric_attr.create(<span class="string">&quot;product&quot;</span>, <span class="string">&quot;prod&quot;</span>, om.MFnNumericData.kDouble, <span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.writable = <span class="literal">False</span> <span class="comment">#  设置属性没有输入引脚(其他属性不能直接写入它)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加属性</span></span><br><span class="line">        cls.addAttribute(cls.multiplier_obj)</span><br><span class="line">        cls.addAttribute(cls.multiplicand_obj)</span><br><span class="line">        cls.addAttribute(cls.product_obj)</span><br><span class="line">        <span class="comment"># 设置属性影响</span></span><br><span class="line">        cls.attributeAffects(cls.multiplier_obj, cls.product_obj)</span><br><span class="line">        cls.attributeAffects(cls.multiplicand_obj, cls.product_obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    加载插件时执行此函数</span></span><br><span class="line"><span class="string">    plugin: MObject用于使用MFnPlugin函数集注册插件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(MutiplyNode.TYPE_NAME,</span><br><span class="line">                               MutiplyNode.TYPE_ID,</span><br><span class="line">                               MutiplyNode.creator,</span><br><span class="line">                               MutiplyNode.initialize,</span><br><span class="line">                               om.MPxNode.kDependNode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(MutiplyNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    取消加载插件时执行此函数</span></span><br><span class="line"><span class="string">    plugin: MObject用于使用MFnPlugin函数集取消注册插件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    </span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(MutiplyNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(MutiplyNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    测试时使用</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>, force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;multiply_node.py&quot;</span></span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    </span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.createNode(&quot;multiplynode&quot;)&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a name="ql0oW"></a></p>
<h3 id="常用的调节属性的性质">常用的调节属性的性质</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669019751794-e5111da0-4859-4dfe-a62b-719679fbd182.png#averageHue=%23090909&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=392&amp;id=u50257840&amp;originHeight=353&amp;originWidth=1175&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=120633&amp;status=done&amp;style=none&amp;taskId=u96983a3b-dfa4-4300-94c2-b3ff711bd18&amp;title=&amp;width=1305.5555901409675" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669021067015-08a0e8e9-ae26-4a71-a0ca-9619d6aadb83.png#averageHue=%2320201f&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=38&amp;id=u79fd4fa9&amp;originHeight=34&amp;originWidth=814&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11256&amp;status=done&amp;style=none&amp;taskId=uae7d5d33-e785-4763-b450-46250892805&amp;title=&amp;width=904.4444684040405" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669019819465-9ccfd5b8-c99e-489c-8787-de360afaed0e.png#averageHue=%2320201e&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=30&amp;id=CaH2B&amp;originHeight=27&amp;originWidth=822&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12052&amp;status=done&amp;style=none&amp;taskId=uaa18bb8b-e8a9-4979-a92d-bac25b0aa99&amp;title=&amp;width=913.3333575284046" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669019987165-8c835b41-f49c-4b51-a3ce-0c5eac417ae6.png#averageHue=%23090909&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=236&amp;id=ub49b112e&amp;originHeight=212&amp;originWidth=1242&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=78468&amp;status=done&amp;style=none&amp;taskId=u51f4de9d-ef27-46b3-9636-fbf3e5cc3af&amp;title=&amp;width=1380.0000365575165" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669020148684-13a906e4-90af-4aa5-be15-78c439099d50.png#averageHue=%23090909&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=381&amp;id=ua1e6055b&amp;originHeight=343&amp;originWidth=938&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=106315&amp;status=done&amp;style=none&amp;taskId=ud409e366-f25b-499a-8cb3-2d6f9954e59&amp;title=&amp;width=1042.222249831683" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669020240602-493c3bfb-adc5-4f6f-99bc-59f2eb102aa2.png#averageHue=%230a0a0a&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=322&amp;id=u54535e8d&amp;originHeight=290&amp;originWidth=1279&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=137679&amp;status=done&amp;style=none&amp;taskId=u52d3524f-76ee-41c8-b248-5b8402b55c9&amp;title=&amp;width=1421.1111487577" alt="image.png"><br>channelBox不需要设置为True，因为设置keyable为True就完全不需要设置channelBox为True了。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669020628591-1294d6b3-d1fe-4fc4-96f4-095d47712df7.png#averageHue=%230e0e0e&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=228&amp;id=uff0e5a0f&amp;originHeight=205&amp;originWidth=980&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73712&amp;status=done&amp;style=none&amp;taskId=ub7b18945-e62f-4627-82b3-29888a0c6ca&amp;title=&amp;width=1088.8889177345943" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669020736102-fee13889-7dbd-452a-be70-796b0c54f0f1.png#averageHue=%23090909&amp;clientId=u7be5ff65-fd52-4&amp;from=paste&amp;height=346&amp;id=u93dfa081&amp;originHeight=311&amp;originWidth=627&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=60795&amp;status=done&amp;style=none&amp;taskId=u9c9b59e9-d647-4c5d-8282-17dfe382f18&amp;title=&amp;width=696.6666851220313" alt="image.png"><br>
<a name="bj2ZA"></a></p>
<h3 id="举例：自定义一个车轮节点">举例：自定义一个车轮节点</h3>
<p><a name="TMm86"></a></p>
<h4 id="数学原理：">数学原理：</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669176071940-be455bbf-e9bb-4cfb-8c7d-e0ade10a5a1a.png#averageHue=%23030303&amp;clientId=ua5409086-db96-4&amp;from=paste&amp;height=879&amp;id=u646b328b&amp;originHeight=791&amp;originWidth=2353&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=184127&amp;status=done&amp;style=none&amp;taskId=uaf267bee-530f-4f2d-b5a5-482826ee31f&amp;title=&amp;width=2614.444513703572" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669275903674-f01c8af3-35a6-4b12-b856-5fd11fafd372.png#averageHue=%233f3e3d&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=450&amp;id=uf1f8a322&amp;originHeight=405&amp;originWidth=316&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=31129&amp;status=done&amp;style=none&amp;taskId=uc7d49f3b-b9ed-4391-a948-f9f64c62a59&amp;title=&amp;width=351.11112041237936" alt="image.png"><br>
<a name="DuEqW"></a></p>
<h4 id="代码">代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 这个函数告诉了maya这个插件生成,并且生成的对象使用maya python api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RollingNode</span>(om.MPxNode):</span><br><span class="line">    TYPE_NAME = <span class="string">&quot;rollingnode&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7F9</span>)</span><br><span class="line">    <span class="comment"># 提前声明节点的属性</span></span><br><span class="line">    distance_obj = <span class="literal">None</span></span><br><span class="line">    radius_obj = <span class="literal">None</span></span><br><span class="line">    rotation_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(RollingNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, plug, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;_summary_</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            plug (_type_): 当plug是dirty状态时,会传过来,要求更新</span></span><br><span class="line"><span class="string">            data (_type_): data提供了读取和写入节点属性值的方法</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> plug == RollingNode.rotation_obj:</span><br><span class="line"></span><br><span class="line">            distance = data.inputValue(RollingNode.distance_obj).asDouble()</span><br><span class="line">            radius = data.inputValue(RollingNode.radius_obj).asDouble()</span><br><span class="line">            <span class="keyword">if</span> radius==<span class="number">0</span>:</span><br><span class="line">                rotation = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rotation = distance / radius</span><br><span class="line"></span><br><span class="line">            rotation_data_handle = data.outputValue(RollingNode.rotation_obj)</span><br><span class="line">            rotation_data_handle.setDouble(rotation)</span><br><span class="line"></span><br><span class="line">            data.setClean(plug)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> RollingNode()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        numeric_attr = om.MFnNumericAttribute() <span class="comment"># 创建一个针对数字属性的函数集</span></span><br><span class="line"></span><br><span class="line">        cls.distance_obj = numeric_attr.create(<span class="string">&quot;distance&quot;</span>, <span class="string">&quot;dis&quot;</span>, om.MFnNumericData.kDouble, <span class="number">0.0</span>)  <span class="comment"># 属性长名，属性短名，属性数字类型，属性初始值</span></span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span> <span class="comment"># 设置属性可以key关键帧(这样属性就能出现在channel box中)</span></span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span>  <span class="comment">#  设置属性没有输出引脚(其他属性不能读它)</span></span><br><span class="line"></span><br><span class="line">        cls.radius_obj = numeric_attr.create(<span class="string">&quot;radius&quot;</span>, <span class="string">&quot;rad&quot;</span>, om.MFnNumericData.kDouble, <span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span></span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        unit_attr = om.MFnUnitAttribute()  <span class="comment"># 创建一个针对单位属性的函数集</span></span><br><span class="line"></span><br><span class="line">        cls.rotation_obj = unit_attr.create(<span class="string">&quot;rotation&quot;</span>, <span class="string">&quot;rot&quot;</span>, om.MFnUnitAttribute.kAngle, <span class="number">0.0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># unit_attr.writable = False #  设置属性没有输入引脚(其他属性不能直接写入它)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加属性</span></span><br><span class="line">        cls.addAttribute(cls.distance_obj)</span><br><span class="line">        cls.addAttribute(cls.radius_obj)</span><br><span class="line">        cls.addAttribute(cls.rotation_obj)</span><br><span class="line">        <span class="comment"># 设置属性影响</span></span><br><span class="line">        cls.attributeAffects(cls.distance_obj, cls.rotation_obj)</span><br><span class="line">        cls.attributeAffects(cls.radius_obj, cls.rotation_obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    加载插件时执行此函数</span></span><br><span class="line"><span class="string">    plugin: MObject用于使用MFnPlugin函数集注册插件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(RollingNode.TYPE_NAME,</span><br><span class="line">                               RollingNode.TYPE_ID,</span><br><span class="line">                               RollingNode.creator,</span><br><span class="line">                               RollingNode.initialize,</span><br><span class="line">                               om.MPxNode.kDependNode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(RollingNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    取消加载插件时执行此函数</span></span><br><span class="line"><span class="string">    plugin: MObject用于使用MFnPlugin函数集取消注册插件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    </span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(RollingNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(RollingNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    测试时使用</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>, force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;rolling_node.py&quot;</span></span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name)) <span class="comment"># 取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))  <span class="comment"># 加载插件</span></span><br><span class="line">    </span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.createNode(&quot;rollingnode&quot;)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#cmds.evalDeferred(cmds.file(&quot;D:/ZhangRuiChen/zrctest/test.ma&quot;,o=True,f=True))</span></span><br></pre></td></tr></table></figure>
<p><a name="nd1Lv"></a></p>
<h2 id="自定义命令">自定义命令</h2>
<p><a name="f37a4"></a></p>
<h3 id="需要的函数">需要的函数</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669276191832-65919398-6691-44ce-bbfc-b786f0d57db8.png#averageHue=%230e0e0e&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=522&amp;id=ua468bd22&amp;originHeight=470&amp;originWidth=1569&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=281820&amp;status=done&amp;style=none&amp;taskId=u6a8fe328-ef18-45f7-aeb7-d103140d049&amp;title=&amp;width=1743.3333795158965" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669276232949-4b119564-f25d-4d0d-a359-cee351324e5f.png#averageHue=%230e0d0c&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=492&amp;id=oSROO&amp;originHeight=443&amp;originWidth=965&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=56721&amp;status=done&amp;style=none&amp;taskId=u451750ca-16d5-4f92-8197-4855bb2330b&amp;title=&amp;width=1072.2222506264118" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669276363671-fac83a4e-d68e-4f5b-9a03-88eaec3c83c5.png#averageHue=%23060606&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=581&amp;id=u9aa85282&amp;originHeight=523&amp;originWidth=1568&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=192253&amp;status=done&amp;style=none&amp;taskId=u64c636cd-f138-4976-9314-505ae075449&amp;title=&amp;width=1742.222268375351" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669278221295-f94858a1-b33c-4aea-943b-48dcaa816caf.png#averageHue=%23080706&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=458&amp;id=u42255ea5&amp;originHeight=412&amp;originWidth=895&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=42139&amp;status=done&amp;style=none&amp;taskId=uab215eb9-62a5-458e-a642-87b020a1b1d&amp;title=&amp;width=994.4444707882265" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669276507022-eaf4aa20-a034-4950-b8ec-8c17a566c63c.png#averageHue=%23080808&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=712&amp;id=u820ea853&amp;originHeight=641&amp;originWidth=1506&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=258176&amp;status=done&amp;style=none&amp;taskId=uc5112f50-bb7c-450e-b1d5-f222042dc58&amp;title=&amp;width=1673.3333776615295" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669276519908-13c30975-8158-4102-94ea-aae068fd6ca4.png#averageHue=%23070605&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=608&amp;id=uf6f553ea&amp;originHeight=547&amp;originWidth=891&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=51499&amp;status=done&amp;style=none&amp;taskId=u582aa433-4a9c-4ff8-89d1-9de5356c257&amp;title=&amp;width=990.0000262260444" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669277248587-3065461c-a73a-4930-9f36-5527e8510456.png#averageHue=%23080808&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=367&amp;id=MZ5PS&amp;originHeight=330&amp;originWidth=1566&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=142467&amp;status=done&amp;style=none&amp;taskId=u11da2dc7-0fe7-4350-8c2a-bf63bf32d74&amp;title=&amp;width=1740.00004609426" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669277259591-72c884bb-e983-4357-a732-04d7c378bbe4.png#averageHue=%23080706&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=317&amp;id=ej8Ow&amp;originHeight=285&amp;originWidth=1040&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32132&amp;status=done&amp;style=none&amp;taskId=u922a51ff-fc9f-4906-a0ae-f4379cef6e8&amp;title=&amp;width=1155.5555861673245" alt="image.png"><br>
<a name="GiOc2"></a></p>
<h3 id="堆栈">堆栈</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669277069508-5854ed27-7f25-4813-9f30-20d89614b42f.png#averageHue=%230a0a0a&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=540&amp;id=u2b02ebda&amp;originHeight=486&amp;originWidth=1517&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=196983&amp;status=done&amp;style=none&amp;taskId=u866b468d-4173-4666-ac88-9a7b163e4b5&amp;title=&amp;width=1685.5556002075302" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669277119960-0391684d-d8a7-4501-a7e9-f558d591621a.png#averageHue=%23090807&amp;clientId=uab71ef87-eb1c-4&amp;from=paste&amp;height=363&amp;id=u17b6ca56&amp;originHeight=327&amp;originWidth=1425&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40443&amp;status=done&amp;style=none&amp;taskId=u78f7c831-2ff9-4576-b00d-9ff9d96ffa2&amp;title=&amp;width=1583.3333752773437" alt="image.png"><br>
<a name="J5Af1"></a></p>
<h3 id="举例：">举例：</h3>
<p>创建一个命令，这个命令用来设置选择的一个物体的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCmd</span>(om.MPxCommand):</span><br><span class="line">    COMMAND_NAME = <span class="string">&quot;SimpleCmd&quot;</span></span><br><span class="line">    <span class="comment"># 定义命令的标志</span></span><br><span class="line">    TRANSLATE_FLAG = [<span class="string">&quot;-t&quot;</span>, <span class="string">&quot;-translate&quot;</span>, (om.MSyntax.kDouble,om.MSyntax.kDouble,om.MSyntax.kDouble)]</span><br><span class="line">    VERSION_FLAG = [<span class="string">&quot;-v&quot;</span>, <span class="string">&quot;-version&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.undoable = <span class="literal">False</span>  <span class="comment"># 初始设置命令不能撤回</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doIt</span>(<span class="params">self, arg_list</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">        doIt 通常用来进行执行redoIt的初始设置以及检查</span></span><br><span class="line"><span class="string">        doIt 在使用命令时只调用一次</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            arg_db = om.MArgDatabase(<span class="variable language_">self</span>.syntax(), arg_list) <span class="comment"># 创建对象解析语法与参数</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="variable language_">self</span>.displayError(<span class="string">&quot;Error parsing arguments&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        </span><br><span class="line">        selection_list = arg_db.getObjectList()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.selected_obj = selection_list.getDependNode(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># om.MFn为所有API类型提供常量的静态类</span></span><br><span class="line">        <span class="comment"># om.MSpace 提供坐标空间常量的静态类。</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.selected_obj.apiType() != om.MFn.kTransform:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;This command requires a transform node&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.edit = arg_db.isEdit</span><br><span class="line">        <span class="variable language_">self</span>.query = arg_db.isQuery</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.translate = arg_db.isFlagSet(SimpleCmd.TRANSLATE_FLAG[<span class="number">0</span>]) <span class="comment"># 判断语法中是否有这个flag</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.translate:</span><br><span class="line">            transform_fn = om.MFnTransform(<span class="variable language_">self</span>.selected_obj)</span><br><span class="line">            <span class="variable language_">self</span>.orig_translation = transform_fn.translation(om.MSpace.kTransform)  </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.edit:</span><br><span class="line">                <span class="variable language_">self</span>.new_translation = [arg_db.flagArgumentDouble(SimpleCmd.TRANSLATE_FLAG[<span class="number">0</span>],<span class="number">0</span>),</span><br><span class="line">                                        arg_db.flagArgumentDouble(SimpleCmd.TRANSLATE_FLAG[<span class="number">0</span>],<span class="number">1</span>),</span><br><span class="line">                                        arg_db.flagArgumentDouble(SimpleCmd.TRANSLATE_FLAG[<span class="number">0</span>],<span class="number">2</span>)]</span><br><span class="line">                <span class="variable language_">self</span>.undoable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.version = arg_db.isFlagSet(SimpleCmd.VERSION_FLAG[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.redoIt()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undoIt</span>(<span class="params">self</span>):</span><br><span class="line">        transform_fn = om.MFnTransform(<span class="variable language_">self</span>.selected_obj)</span><br><span class="line">        transform_fn.setTranslation(om.MVector(<span class="variable language_">self</span>.orig_translation),om.MSpace.kTransform)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">redoIt</span>(<span class="params">self</span>):</span><br><span class="line">        transform_fn = om.MFnTransform(<span class="variable language_">self</span>.selected_obj)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.query:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.translate:</span><br><span class="line">                <span class="variable language_">self</span>.setResult(<span class="variable language_">self</span>.orig_translation)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Flag does not support query&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.edit:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.translate:</span><br><span class="line">                transform_fn.setTranslation(om.MVector(<span class="variable language_">self</span>.new_translation),om.MSpace.kTransform)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Flag does not support edit&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.version:</span><br><span class="line">            <span class="variable language_">self</span>.setResult(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.setResult(transform_fn.name())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isUndoable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.undoable</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 注册maya命令时使用的方法，用来得到类的实例 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> SimpleCmd()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_syntax</span>(<span class="params">cls</span>):</span><br><span class="line"></span><br><span class="line">        syntax = om.MSyntax()</span><br><span class="line"></span><br><span class="line">        syntax.enableEdit = <span class="literal">True</span></span><br><span class="line">        syntax.enableQuery = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        syntax.addFlag(*cls.TRANSLATE_FLAG) <span class="comment"># 这里*的意思是解包，相当于将列表的中括号去掉</span></span><br><span class="line">        syntax.addFlag(*cls.VERSION_FLAG)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置要传递给命令的对象的类型和数量</span></span><br><span class="line">        syntax.setObjectType(om.MSyntax.kSelectionList, <span class="number">1</span>, <span class="number">1</span>) </span><br><span class="line">        <span class="comment"># 如果设置为True，那么当命令行上没有提供对象时，Maya将传递当前选择。默认为False。</span></span><br><span class="line">        syntax.useSelectionAsDefault(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> syntax</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 向maya注册一个新命令,第一个参数是命令的名字，第二个参数是类的实例, 第三个参数是命令的语法</span></span><br><span class="line">        plugin_fn.registerCommand(SimpleCmd.COMMAND_NAME, SimpleCmd.creator, SimpleCmd.create_syntax)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleCmd.COMMAND_NAME))  <span class="comment"># 注册失败时输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterCommand(SimpleCmd.COMMAND_NAME)  <span class="comment"># 取消注册新命令</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleCmd.COMMAND_NAME))  <span class="comment"># 取消注册失败时输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmds.file(new=<span class="literal">True</span>, force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;simple_cmd.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.polyCube()&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a name="R6LW8"></a></p>
<h1>第二卷</h1>
<p><a name="alXzd"></a></p>
<h2 id="变形器">变形器</h2>
<p><a name="N6AYF"></a></p>
<h3 id="变形器的介绍">变形器的介绍</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669355834333-997f0cfd-4fd2-4e73-bd1c-268e45820c36.png#averageHue=%230a0a0a&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=758&amp;id=uab4bc6b9&amp;originHeight=682&amp;originWidth=1588&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=274633&amp;status=done&amp;style=none&amp;taskId=ua74619f1-ec8a-4eaa-8110-9a3b7e20e55&amp;title=&amp;width=1764.4444911862608" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669355868141-c9c2dee3-b484-44bf-8984-361fdbba321a.png#averageHue=%23070606&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=428&amp;id=ue3d09ce8&amp;originHeight=385&amp;originWidth=1554&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39023&amp;status=done&amp;style=none&amp;taskId=ua7fbf361-57ec-4ce9-a4c2-5fbaa8bf153&amp;title=&amp;width=1726.6667124077137" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669355993057-27a8882a-9859-48e7-9188-f17fc91a795e.png#averageHue=%23131110&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=108&amp;id=u3c57da12&amp;originHeight=97&amp;originWidth=961&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9633&amp;status=done&amp;style=none&amp;taskId=udaa97a37-5c2a-44da-9674-14cf2cfa0a0&amp;title=&amp;width=1067.7778060642297" alt="image.png"><br>
<a name="iE55s"></a></p>
<h3 id="MPxDeformerNode">MPxDeformerNode</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669356025407-d53cd6b6-cbdb-4fcb-b805-7cde5540ac42.png#averageHue=%230d0d0d&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=642&amp;id=u12951ebb&amp;originHeight=578&amp;originWidth=1550&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=288740&amp;status=done&amp;style=none&amp;taskId=ud226216a-3c77-4f3b-a01a-eb27fb1868a&amp;title=&amp;width=1722.2222678455319" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669356050081-1d8d4016-947b-4c8b-8ee7-3a43518a50e2.png#averageHue=%23080706&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=410&amp;id=oaJRJ&amp;originHeight=369&amp;originWidth=1419&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40168&amp;status=done&amp;style=none&amp;taskId=ubb6dc37b-0067-4213-b570-9fedf41763e&amp;title=&amp;width=1576.6667084340706" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669356550372-1e916526-0fe3-4a99-b450-007141338fc0.png#averageHue=%230b0b0b&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=553&amp;id=u690eee88&amp;originHeight=498&amp;originWidth=1517&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=241699&amp;status=done&amp;style=none&amp;taskId=u526e405c-7ee6-4763-8500-dbb1b88be8a&amp;title=&amp;width=1685.5556002075302" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669356634899-5dae2046-df65-429d-8805-ee447cfa25f5.png#averageHue=%230c0b0a&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=373&amp;id=ufaf9dabb&amp;originHeight=336&amp;originWidth=1092&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=31029&amp;status=done&amp;style=none&amp;taskId=uda7bd747-a134-4d48-9472-b734da07645&amp;title=&amp;width=1213.3333654756907" alt="image.png"><br>deform方法是由compute方法自动调用的<br>
<a name="d052s"></a></p>
<h3 id="MPxDeformerNode-Attributes">MPxDeformerNode Attributes</h3>
<p>MPxDeformerNode 自带的属性:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669357128617-3053f189-10f7-4efc-90c7-36e5861d26fa.png#averageHue=%230b0b0b&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=596&amp;id=u242d61b4&amp;originHeight=536&amp;originWidth=1403&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=184275&amp;status=done&amp;style=none&amp;taskId=u07543215-b9eb-480e-b6f8-dac44166d44&amp;title=&amp;width=1558.8889301853426" alt="image.png"><br>
<a name="GBDH8"></a></p>
<h3 id="提醒">提醒</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669357196384-b048f1b1-8fa0-449b-ad53-429b20da40e0.png#averageHue=%230d0d0d&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=347&amp;id=u7f7dfbd9&amp;originHeight=312&amp;originWidth=1471&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=186140&amp;status=done&amp;style=none&amp;taskId=u50f233d0-1224-441d-83cd-f3d14e582f9&amp;title=&amp;width=1634.4444877424369" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669357212850-8737f12b-dac4-40f2-b8b1-90288f0f14f1.png#averageHue=%230f0d0c&amp;clientId=u5f664d41-9059-4&amp;from=paste&amp;height=312&amp;id=u1fbdea20&amp;originHeight=281&amp;originWidth=939&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37218&amp;status=done&amp;style=none&amp;taskId=u7b0303b6-7335-4ecb-8665-f04bd4fce06&amp;title=&amp;width=1043.3333609722285" alt="image.png"><br>
<a name="oqCbJ"></a></p>
<h3 id="创建变形器节点的三个举例">创建变形器节点的三个举例</h3>
<p><a name="Z2V6L"></a></p>
<h4 id="basicdeformernode">basicdeformernode</h4>
<p>创建一个名字叫basicdeformernode的变形器（遍历顶点，每隔一个顶点，改变顶点的位置）<br>然后可以通过cmds.deformer(typ=“basicdeformernode”)为选择的物体添加变形节点<br>变形使用的函数：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669601246904-9401a1e9-a3b4-49c8-8e47-581c3165cbfb.png#averageHue=%23ffffff&amp;clientId=u62d82c1e-27cd-4&amp;from=paste&amp;height=441&amp;id=u259ef204&amp;originHeight=397&amp;originWidth=572&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25233&amp;status=done&amp;style=none&amp;taskId=uf6e5ff20-e0c1-4fb5-9c36-f9c27b99539&amp;title=&amp;width=635.5555723920285" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaMPx <span class="keyword">as</span> ommpx</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicDeformerNode</span>(ommpx.MPxDeformerNode):</span><br><span class="line"></span><br><span class="line">    TYPE_NAME = <span class="string">&quot;basicdeformernode&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7FC</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(BasicDeformerNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deform</span>(<span class="params">self, data_block, geo_iter, matrix, multi_index</span>):</span><br><span class="line">        </span><br><span class="line">        envelope = data_block.inputValue(<span class="variable language_">self</span>.envelope).asFloat() <span class="comment"># 总权重</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> envelope == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        geo_iter.reset() <span class="comment"># 重置迭代器</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> geo_iter.isDone():</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> geo_iter.index() % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                pt = geo_iter.position()</span><br><span class="line">                <span class="comment"># 局部空间</span></span><br><span class="line">                <span class="comment"># pt.x += (0.2*envelope)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 世界空间</span></span><br><span class="line">                pt = pt * matrix * <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">                geo_iter.setPosition(pt)</span><br><span class="line"></span><br><span class="line">            geo_iter.<span class="built_in">next</span>()    </span><br><span class="line">        </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> BasicDeformerNode()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(BasicDeformerNode.TYPE_NAME,</span><br><span class="line">                               BasicDeformerNode.TYPE_ID,</span><br><span class="line">                               BasicDeformerNode.creator,</span><br><span class="line">                               BasicDeformerNode.initialize,</span><br><span class="line">                               ommpx.MPxNode.kDeformerNode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(BasicDeformerNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(BasicDeformerNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(BasicDeformerNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line">    plugin_name = <span class="string">&quot;basic_deformer_node.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.file(&quot;C:/Users/Adiministrator/Destop/test.ma&quot;,o=True,f=True)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.select(&quot;nurbsPlane1&quot;); cmds.deformer(typ=&quot;basicdeformernode&quot;)&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a name="AfQbY"></a></p>
<h4 id="blenddeformernode">blenddeformernode</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaMPx <span class="keyword">as</span> ommpx</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlendDeformerNode</span>(ommpx.MPxDeformerNode):</span><br><span class="line"></span><br><span class="line">    TYPE_NAME = <span class="string">&quot;blenddeformernode&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7FD</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(BlendDeformerNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deform</span>(<span class="params">self, data_block, geo_iter, matrix, multi_index</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            变形的逻辑</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            data_block (_type_): 数据块</span></span><br><span class="line"><span class="string">            geo_iter (_type_): 针对geometry的顶点迭代器</span></span><br><span class="line"><span class="string">            matrix (_type_): 世界空间的矩阵</span></span><br><span class="line"><span class="string">            multi_index (_type_): _description_</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># envelope是MPxDeformerNode类自带的属性</span></span><br><span class="line">        envelope = data_block.inputValue(<span class="variable language_">self</span>.envelope).asFloat() <span class="comment"># 获取控制整体权重值的值</span></span><br><span class="line">        <span class="keyword">if</span> envelope == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span>    </span><br><span class="line"></span><br><span class="line">        blend_weight = data_block.inputValue(<span class="variable language_">self</span>.blend_weight).asFloat() <span class="comment"># 获取混合的权重值</span></span><br><span class="line">        <span class="keyword">if</span> blend_weight == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        target_mesh = data_block.inputValue(<span class="variable language_">self</span>.blend_mesh).asMesh()  <span class="comment"># 获取目标mesh</span></span><br><span class="line">        <span class="keyword">if</span> target_mesh.isNull():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        target_points = om.MPointArray() <span class="comment"># 定义一个接受目标mesh所有点的数组</span></span><br><span class="line"></span><br><span class="line">        target_mesh_fn = om.MFnMesh(target_mesh) <span class="comment"># 定义一个目标mesh的函数集</span></span><br><span class="line">        target_mesh_fn.getPoints(target_points) <span class="comment"># 使用函数集的方法将点放入到点数组中</span></span><br><span class="line"></span><br><span class="line">        global_weight = blend_weight * envelope  <span class="comment"># 得到总的权重值</span></span><br><span class="line"></span><br><span class="line">        geo_iter.reset() <span class="comment"># 重置迭代器</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> geo_iter.isDone():</span><br><span class="line">            </span><br><span class="line">            source_pt = geo_iter.position()</span><br><span class="line">            target_pt = target_points[geo_iter.index()]</span><br><span class="line"></span><br><span class="line">            source_weight = <span class="variable language_">self</span>.weightValue(data_block, multi_index, geo_iter.index()) <span class="comment"># 获取绘制的权重值</span></span><br><span class="line"></span><br><span class="line">            final_pt = source_pt + ((target_pt - source_pt) * global_weight * source_weight)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            geo_iter.setPosition(final_pt)</span><br><span class="line">            </span><br><span class="line">            geo_iter.<span class="built_in">next</span>()    </span><br><span class="line">        </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> BlendDeformerNode()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        </span><br><span class="line">        typed_attr = om.MFnTypedAttribute()</span><br><span class="line">        cls.blend_mesh = typed_attr.create(<span class="string">&quot;blendMesh&quot;</span>, <span class="string">&quot;bMesh&quot;</span>, om.MFnData.kMesh)</span><br><span class="line"></span><br><span class="line">        numeric_attr = om.MFnNumericAttribute()</span><br><span class="line">        cls.blend_weight = numeric_attr.create(<span class="string">&quot;blendWeight&quot;</span>, <span class="string">&quot;bWeight&quot;</span>, om.MFnNumericData.kFloat, <span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.setKeyable(<span class="literal">True</span>)</span><br><span class="line">        numeric_attr.setMin(<span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.setMax(<span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">        cls.addAttribute(cls.blend_mesh)</span><br><span class="line">        cls.addAttribute(cls.blend_weight)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#变形器节点具有默认的outputGeom属性，因此我们没必要再创建一个输出的属性，我们可以直接利用这个默认的outputGemo属性</span></span><br><span class="line">        output_geom = ommpx.cvar.MPxGeometryFilter_outputGeom  </span><br><span class="line"></span><br><span class="line">        cls.attributeAffects(cls.blend_mesh, output_geom)</span><br><span class="line">        cls.attributeAffects(cls.blend_weight,output_geom)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(BlendDeformerNode.TYPE_NAME,</span><br><span class="line">                               BlendDeformerNode.TYPE_ID,</span><br><span class="line">                               BlendDeformerNode.creator,</span><br><span class="line">                               BlendDeformerNode.initialize,</span><br><span class="line">                               ommpx.MPxNode.kDeformerNode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(BlendDeformerNode.TYPE_NAME))</span><br><span class="line">    </span><br><span class="line">    cmds.makePaintable(BlendDeformerNode.TYPE_NAME, <span class="string">&quot;weights&quot;</span>, attrType=<span class="string">&quot;multiFloat&quot;</span>, shapeMode = <span class="string">&quot;deformer&quot;</span>) <span class="comment"># 使其能绘制权重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    cmds.makePaintable(BlendDeformerNode.TYPE_NAME, <span class="string">&quot;weights&quot;</span>,remove=<span class="literal">True</span>) <span class="comment"># 移除使其能绘制权重</span></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(BlendDeformerNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(BlendDeformerNode.TYPE_NAME))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line">    plugin_name = <span class="string">&quot;blend_deformer_node.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.file(&quot;D:/ZhangRuiChen/zrctest/blend_test.ma&quot;,o=True,f=True)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.select(&quot;sourceSphere&quot;); cmds.deformer(typ=&quot;blenddeformernode&quot;)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.connectAttr(&quot;deformerTargetShape.outMesh&quot;, &quot;blenddeformernode1.blendMesh&quot;, force=True)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="WKWiJ"></a></p>
<h4 id="attractordeformernode">attractordeformernode</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669885141889-8034d785-9229-4f17-b298-f544e314d66c.png#averageHue=%236c6c6c&amp;clientId=uc34e0430-0983-4&amp;from=paste&amp;height=526&amp;id=ubc0d0e8f&amp;originHeight=473&amp;originWidth=310&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=29030&amp;status=done&amp;style=none&amp;taskId=uae417cc9-9c77-4b0c-a221-7143d9e847d&amp;title=&amp;width=344.4444535691064" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669949631088-6257e607-fd16-41e0-9671-0b43342621e1.png#averageHue=%233a3938&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=334&amp;id=u61cce788&amp;originHeight=301&amp;originWidth=983&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44627&amp;status=done&amp;style=none&amp;taskId=ub33502f4-1fd1-4a61-bed4-6f5f6b0764f&amp;title=&amp;width=1092.2222511562309" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.OpenMayaMPx <span class="keyword">as</span> ommpx</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AttractorDeformerNode</span>(ommpx.MPxDeformerNode):</span><br><span class="line"></span><br><span class="line">    TYPE_NAME = <span class="string">&quot;attractordeformernode&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7FE</span>)</span><br><span class="line"></span><br><span class="line">    MAX_ANGLE = <span class="number">0.5</span> * <span class="number">3.14159265</span> <span class="comment"># 90度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(AttractorDeformerNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deform</span>(<span class="params">self, data_block, geo_iter, world_matrix, multi_index</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            变形的逻辑</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            data_block (_type_): 数据块</span></span><br><span class="line"><span class="string">            geo_iter (_type_): 针对geometry的顶点迭代器</span></span><br><span class="line"><span class="string">            matrix (_type_): 世界空间的矩阵</span></span><br><span class="line"><span class="string">            multi_index (_type_): geom_index</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># envelope是MPxDeformerNode类自带的属性</span></span><br><span class="line">        envelope = data_block.inputValue(<span class="variable language_">self</span>.envelope).asFloat() <span class="comment"># 获取控制整体权重值的值</span></span><br><span class="line">        <span class="keyword">if</span> envelope == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span>    </span><br><span class="line">        </span><br><span class="line">        max_distance = data_block.inputValue(AttractorDeformerNode.max_distance).asFloat()</span><br><span class="line">        <span class="keyword">if</span> max_distance == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        target_position = data_block.inputValue(AttractorDeformerNode.target_position).asFloatVector()</span><br><span class="line">        target_position = om.MPoint(target_position) * world_matrix.inverse() <span class="comment"># 将目标位置转换为局部空间下的数值</span></span><br><span class="line">        target_position = om.MFloatVector(target_position) <span class="comment"># 获取目标位置在局部空间下的floatVector</span></span><br><span class="line"></span><br><span class="line">        input_handle = data_block.outputArrayValue(<span class="variable language_">self</span>.<span class="built_in">input</span>) <span class="comment"># 使用outputArray代替inputArray以避免重新计算（外网翻译）</span></span><br><span class="line">        input_handle.jumpToElement(multi_index)</span><br><span class="line">        input_element_handle = input_handle.outputValue()</span><br><span class="line"></span><br><span class="line">        input_geom = input_element_handle.child(<span class="variable language_">self</span>.inputGeom).asMesh()</span><br><span class="line">        mesh_fn = om.MFnMesh(input_geom)</span><br><span class="line"></span><br><span class="line">        normals = om.MFloatVectorArray()  <span class="comment"># 用来存取inputgeom的顶点的所有浮点法线</span></span><br><span class="line">        mesh_fn.getVertexNormals(<span class="literal">False</span>, normals) <span class="comment"># False的作用是不要average normal</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        geo_iter.reset()</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> geo_iter.isDone():</span><br><span class="line">            <span class="comment"># 顶点迭代器所获取的位置都是在局部空间下的位置</span></span><br><span class="line">            pt_local = geo_iter.position()</span><br><span class="line"></span><br><span class="line">            target_vector = target_position - om.MFloatVector(pt_local)</span><br><span class="line"></span><br><span class="line">            distance = target_vector.length()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> distance &lt;= max_distance:</span><br><span class="line"></span><br><span class="line">                normal = normals[geo_iter.index()] <span class="comment"># 局部空间下的顶点的法线浮点向量</span></span><br><span class="line"></span><br><span class="line">                angle = normal.angle(target_vector)  <span class="comment"># 顶点的法线与顶点与目标点的向量之间的角度</span></span><br><span class="line">                <span class="keyword">if</span> angle &lt;= AttractorDeformerNode.MAX_ANGLE:</span><br><span class="line"></span><br><span class="line">                    offset = target_vector * ((max_distance-distance)/max_distance)</span><br><span class="line"></span><br><span class="line">                    new_pt_local = pt_local + om.MVector(offset)  <span class="comment"># 局部空间下的新顶点位置</span></span><br><span class="line"></span><br><span class="line">                    geo_iter.setPosition(new_pt_local)</span><br><span class="line"></span><br><span class="line">            geo_iter.<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accessoryAttribute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 返回要辅助修改的属性 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> AttractorDeformerNode.target_position</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accessoryNodeSetup</span>(<span class="params">self, dag_modifier</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; dag_modifier用于执行节点创建和连接操作 &quot;&quot;&quot;</span></span><br><span class="line">        locator = dag_modifier.createNode(<span class="string">&quot;locator&quot;</span>)</span><br><span class="line"></span><br><span class="line">        locator_fn = om.MFnDependencyNode(locator)</span><br><span class="line">        locator_translate_plug = locator_fn.findPlug(<span class="string">&quot;translate&quot;</span>, <span class="literal">False</span>) <span class="comment"># False意思是不需要networkplug，networkplug意思是在DG中建立连接的属性</span></span><br><span class="line"></span><br><span class="line">        target_position_plug = om.MPlug(<span class="variable language_">self</span>.thisMObject(), AttractorDeformerNode.target_position)  <span class="comment"># 获取变形器的target_position的plug</span></span><br><span class="line">        dag_modifier.connect(locator_translate_plug, target_position_plug)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将定位器得位置设置在output_geom的位置</span></span><br><span class="line">        <span class="comment"># 这里的output_geom指的是shape节点</span></span><br><span class="line">        <span class="comment"># parent指的是transform节点，因为只有transform节点才有xyz坐标</span></span><br><span class="line">        output_geom_plug = om.MPlug(<span class="variable language_">self</span>.thisMObject(), <span class="variable language_">self</span>.outputGeom)</span><br><span class="line">        mPlugArray2 = om.MPlugArray()</span><br><span class="line">        output_geom_plug[<span class="number">0</span>].connectedTo(mPlugArray2,<span class="literal">False</span>,<span class="literal">True</span>)</span><br><span class="line">        output_geom_obj = mPlugArray2[<span class="number">0</span>].node()</span><br><span class="line">        output_geom_fn = om.MFnDagNode(output_geom_obj)</span><br><span class="line">        parent_obj = output_geom_fn.parent(<span class="number">0</span>)</span><br><span class="line">        parent_fn = om.MFnDependencyNode(parent_obj)</span><br><span class="line">        parent_translate_plug = parent_fn.findPlug(<span class="string">&quot;translate&quot;</span>,<span class="literal">False</span>)</span><br><span class="line">        parent_translate_x_handle = parent_translate_plug.child(<span class="number">0</span>).asFloat()</span><br><span class="line">        parent_translate_y_handle = parent_translate_plug.child(<span class="number">1</span>).asFloat()</span><br><span class="line">        parent_translate_z_handle = parent_translate_plug.child(<span class="number">2</span>).asFloat()</span><br><span class="line">    </span><br><span class="line">        locator_translate_plug.child(<span class="number">0</span>).setFloat(parent_translate_x_handle)</span><br><span class="line">        locator_translate_plug.child(<span class="number">1</span>).setFloat(parent_translate_y_handle)</span><br><span class="line">        locator_translate_plug.child(<span class="number">2</span>).setFloat(parent_translate_z_handle)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> AttractorDeformerNode()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        </span><br><span class="line">        numeric_attr = om.MFnNumericAttribute()</span><br><span class="line">        cls.max_distance = numeric_attr.create(<span class="string">&quot;maximumDistance&quot;</span>, <span class="string">&quot;maxDist&quot;</span>, om.MFnNumericData.kFloat, <span class="number">1.0</span>)</span><br><span class="line">        numeric_attr.setKeyable(<span class="literal">True</span>)</span><br><span class="line">        numeric_attr.setMin(<span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.setMax(<span class="number">2.0</span>)</span><br><span class="line"></span><br><span class="line">        cls.target_position = numeric_attr.createPoint(<span class="string">&quot;targetPosition&quot;</span>, <span class="string">&quot;targetPos&quot;</span>)</span><br><span class="line">        numeric_attr.setKeyable(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        cls.addAttribute(cls.max_distance)</span><br><span class="line">        cls.addAttribute(cls.target_position)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#变形器节点具有默认的outputGeom属性，因此我们没必要再创建一个输出的属性，我们可以直接利用这个默认的outputGemo属性</span></span><br><span class="line">        output_geom = ommpx.cvar.MPxGeometryFilter_outputGeom  </span><br><span class="line"></span><br><span class="line">        cls.attributeAffects(cls.max_distance, output_geom)</span><br><span class="line">        cls.attributeAffects(cls.target_position,output_geom)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(AttractorDeformerNode.TYPE_NAME,</span><br><span class="line">                               AttractorDeformerNode.TYPE_ID,</span><br><span class="line">                               AttractorDeformerNode.creator,</span><br><span class="line">                               AttractorDeformerNode.initialize,</span><br><span class="line">                               ommpx.MPxNode.kDeformerNode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(AttractorDeformerNode.TYPE_NAME))</span><br><span class="line">    </span><br><span class="line">    cmds.makePaintable(AttractorDeformerNode.TYPE_NAME, <span class="string">&quot;weights&quot;</span>, attrType=<span class="string">&quot;multiFloat&quot;</span>, shapeMode = <span class="string">&quot;deformer&quot;</span>) <span class="comment"># 使其能绘制权重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    cmds.makePaintable(AttractorDeformerNode.TYPE_NAME, <span class="string">&quot;weights&quot;</span>,remove=<span class="literal">True</span>) <span class="comment"># 移除使其能绘制权重</span></span><br><span class="line">    plugin_fn = ommpx.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(AttractorDeformerNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(AttractorDeformerNode.TYPE_NAME))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line">    plugin_name = <span class="string">&quot;attractor_deformer_node.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(</span><br><span class="line">        <span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.file(&quot;D:/ZhangRuiChen/zrctest/attractor_test.ma&quot;,o=True,f=True)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.select(&quot;pSphere1&quot;); cmds.deformer(typ=&quot;attractordeformernode&quot;)&#x27;</span>)</span><br><span class="line">    <span class="comment">#cmds.evalDeferred(&#x27;cmds.connectAttr(&quot;locator1.translate&quot;,&quot;attractordeformernode1.targetPosition&quot;,f=True)&#x27;)</span></span><br></pre></td></tr></table></figure>
<p><a name="ChJzT"></a></p>
<h2 id="CallBack">CallBack</h2>
<p><a name="wF8X2"></a></p>
<h3 id="CallBack介绍">CallBack介绍</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669972488001-309540ae-07bb-4005-9919-aa1bcbcd5249.png#averageHue=%23090909&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=607&amp;id=uf36b7ab6&amp;originHeight=546&amp;originWidth=1583&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=232144&amp;status=done&amp;style=none&amp;taskId=u09bba1cb-0e33-41f0-acb0-9d7fd113a9e&amp;title=&amp;width=1758.8889354835335" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669972508805-3935a541-c38a-41c7-bff5-a896383060c3.png#averageHue=%23070606&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=451&amp;id=u73d5f3e5&amp;originHeight=406&amp;originWidth=1488&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36769&amp;status=done&amp;style=none&amp;taskId=uc8872394-a571-4aba-9dc3-eed480c8e03&amp;title=&amp;width=1653.3333771317104" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669972555239-dc7a204c-e356-4a26-98cd-78eecc67203a.png#averageHue=%230a0a0a&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=316&amp;id=u54239874&amp;originHeight=284&amp;originWidth=1421&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=121474&amp;status=done&amp;style=none&amp;taskId=u2df6defd-ff08-4b87-aa18-24fdac8740e&amp;title=&amp;width=1578.8889307151617" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669972581861-96ac13e4-dc9c-432e-a38c-9fc0e0cb561d.png#averageHue=%230c0b0a&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=289&amp;id=u05ef04b1&amp;originHeight=260&amp;originWidth=773&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24062&amp;status=done&amp;style=none&amp;taskId=u37fb79ad-66a9-4f9c-a91f-07d85da429f&amp;title=&amp;width=858.8889116416749" alt="image.png"><br>
<a name="pdr4V"></a></p>
<h3 id="CallBack-vs-ScriptJobs">CallBack vs ScriptJobs</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669973658033-4c79b1d1-9452-4ef8-a6e6-8c4718c15060.png#averageHue=%23090909&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=322&amp;id=udb20517a&amp;originHeight=290&amp;originWidth=1535&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=123374&amp;status=done&amp;style=none&amp;taskId=u72d56818-e005-4259-9bcc-2d2f92de29f&amp;title=&amp;width=1705.5556007373493" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669973698429-03371990-4d28-4a58-a840-c328a893017d.png#averageHue=%230b0a09&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=268&amp;id=u4d182dee&amp;originHeight=241&amp;originWidth=903&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25522&amp;status=done&amp;style=none&amp;taskId=u9eca8eda-559f-496e-8fca-521a2573681&amp;title=&amp;width=1003.3333599125905" alt="image.png"><br>
<a name="zUZUZ"></a></p>
<h3 id="MMessage">MMessage</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669974320245-42120466-d32c-4ecf-9172-d2c20ed0e2a0.png#averageHue=%230a0a0a&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=487&amp;id=u0a033b4e&amp;originHeight=438&amp;originWidth=1473&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=183961&amp;status=done&amp;style=none&amp;taskId=u2e9e4661-09ea-4df6-8dc8-1b3973d71ac&amp;title=&amp;width=1636.666710023528" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1669974341909-a7a9ab9a-696e-4401-a3d7-be2bf57cb093.png#averageHue=%230c0b0a&amp;clientId=u706cb6cd-4e7a-4&amp;from=paste&amp;height=300&amp;id=u78fb9785&amp;originHeight=270&amp;originWidth=1078&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26516&amp;status=done&amp;style=none&amp;taskId=u43a6d480-5105-4ad5-9240-28951bb8ef4&amp;title=&amp;width=1197.7778095080537" alt="image.png"><br>详情：<a target="_blank" rel="noopener" href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__py_ref_class_open_maya_1_1_m_message_html">https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__py_ref_class_open_maya_1_1_m_message_html</a><br>点击才能展开<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670232926009-a9fd1da3-d7b6-4e73-9bf9-68474c984507.png#averageHue=%23faf6f5&amp;clientId=u042c0c24-ff4e-4&amp;from=paste&amp;height=286&amp;id=ud08fa497&amp;originHeight=257&amp;originWidth=641&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16912&amp;status=done&amp;style=none&amp;taskId=u3e5a6d1b-d291-46be-8ba8-811380b34b6&amp;title=&amp;width=712.2222410896683" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670229085571-d2f1e418-55d9-4202-9e96-d148aafe3e9d.png#averageHue=%23f7f8fb&amp;clientId=u042c0c24-ff4e-4&amp;from=paste&amp;height=1050&amp;id=u24d41402&amp;originHeight=945&amp;originWidth=526&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57798&amp;status=done&amp;style=none&amp;taskId=ua93d13aa-78bc-45ba-95ae-93c0e8cd56a&amp;title=&amp;width=584.4444599269353" alt="image.png"><br>MEventMessage：在发生添加的全局事件时执行（例如场景被打开，选择发生变化，事件发生改变）时添加callback<br>MSceneMessage: 场景事件添加callback<br>MTimmerMessage: 在特定的事件间隔内调用一个函数<br>
<a name="cQifq"></a></p>
<h3 id="管理回调函数">管理回调函数</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670223085104-a250a1fb-6b2d-41ba-9713-e5c5985ab042.png#averageHue=%230d0d0d&amp;clientId=u042c0c24-ff4e-4&amp;from=paste&amp;height=313&amp;id=ud2c5aefb&amp;originHeight=282&amp;originWidth=1098&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=128211&amp;status=done&amp;style=none&amp;taskId=ue9e1910f-2311-4995-8b0f-700b4ea080c&amp;title=&amp;width=1220.0000323189638" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670223097855-5501613c-244e-40a0-b503-020f648889c5.png#averageHue=%230e0d0b&amp;clientId=u042c0c24-ff4e-4&amp;from=paste&amp;height=297&amp;id=u0aace71e&amp;originHeight=267&amp;originWidth=637&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26408&amp;status=done&amp;style=none&amp;taskId=u7b4bc1df-cfdb-4f6e-aa82-d153ca7ae91&amp;title=&amp;width=707.7777965274863" alt="image.png"><br>
<a name="IArRy"></a></p>
<h3 id="获取MEventMessage的事件名字">获取MEventMessage的事件名字</h3>
<p>import maya.api.OpenMaya as om<br>om.MEventMessage.getEventNames()<br>其中常用的事件：<br>deleteAll，undoSupressed（撤销后的返回），undo（撤销），timeChanged（时间轴变化）<br>其他事件的解释可以通过scriptjob命令的帮助文档找到:<br><a target="_blank" rel="noopener" href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__CommandsPython_index_html">https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__CommandsPython_index_html</a><br>
<a name="Du513"></a></p>
<h3 id="举例：-2">举例：</h3>
<p>MEventMessage<br>MSceneMessage<br>MConditionMessage<br>MUiMessage<br>MTimerMessage</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaAnim <span class="keyword">as</span> oma</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">callback_ids = [] <span class="comment"># 定义全局变量存放callback_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_new_scene</span>(<span class="params">client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 当新场景加载时调用,client_data为调用这个函数时传递的参数(可以为None) &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;New Scene opened&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_time_changed</span>(<span class="params">client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 当时间轴发生改变时调用 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Time changed: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(oma.MAnimControl.currentTime().asUnits(om.MTime.uiUnit()))) <span class="comment"># 输出当前时间轴的帧数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_selection_changed</span>(<span class="params">client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 当选择发生改变时调用 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Selection changed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_import</span>(<span class="params">client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 导入前执行 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Import pre-processing&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">after_import</span>(<span class="params">client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 导入后执行 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Import post-processing&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_viewport_changed</span>(<span class="params">model_panel,*args</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 在指定的视口面板处切换相机时调用 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Camera changed in model panel &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(model_panel))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_playing_back_state_changed</span>(<span class="params">is_playing, client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 当使用播放键预览拍屏时调用 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Playing state changed: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(is_playing))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_timer_fired</span>(<span class="params">elapsed_time, previous_execution_time, client_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    定时器调用此函数,每经过设定的秒数就调用一次这个函数</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        elapsed_time (float): 设定的秒数</span></span><br><span class="line"><span class="string">        previous_execution_time (_type_): 以前的运行的时间，为了防止此函数还没执行完就再次被调用</span></span><br><span class="line"><span class="string">        client_data (_type_): 用户自定义的参数,可以不传递</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Timer fired&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> callback_ids <span class="comment"># 调用全局变量</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line">    <span class="comment"># 注册回调，参数为事件类型名，回调函数，还有第三个参数可选（传递给回调函数的参数），返回值为回调函数id</span></span><br><span class="line">    callback_ids.append(om.MEventMessage.addEventCallback(<span class="string">&quot;NewSceneOpened&quot;</span>, on_new_scene)) </span><br><span class="line">    callback_ids.append(om.MEventMessage.addEventCallback(<span class="string">&quot;timeChanged&quot;</span>, on_time_changed))</span><br><span class="line">    callback_ids.append(om.MEventMessage.addEventCallback(<span class="string">&quot;SelectionChanged&quot;</span>, on_selection_changed))</span><br><span class="line"></span><br><span class="line">    callback_ids.append(om.MSceneMessage.addCallback(om.MSceneMessage.kBeforeImport, before_import))</span><br><span class="line">    callback_ids.append(om.MSceneMessage.addCallback(om.MSceneMessage.kAfterImport, after_import))</span><br><span class="line"></span><br><span class="line">    callback_ids.append(om.MConditionMessage.addConditionCallback(<span class="string">&quot;playingBack&quot;</span>, on_playing_back_state_changed))</span><br><span class="line">    </span><br><span class="line">    callback_ids.append(omui.MUiMessage.addCameraChangedCallback(<span class="string">&quot;modelPanel4&quot;</span>, on_viewport_changed))</span><br><span class="line"></span><br><span class="line">    callback_ids.append(om.MTimerMessage.addTimerCallback(<span class="number">2.5</span>, on_timer_fired))</span><br><span class="line"></span><br><span class="line">    om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> callback_ids</span><br><span class="line">    om.MEventMessage.removeCallbacks(callback_ids)</span><br><span class="line">    callback_ids = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_name = <span class="string">&quot;callback_example.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="laIwQ"></a></p>
<h2 id="遍历dag">遍历dag</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292234464-c3d01a0b-ccd6-4ee8-852f-e5389fdf7752.png#averageHue=%23080808&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=459&amp;id=ua4023119&amp;originHeight=413&amp;originWidth=1567&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=167105&amp;status=done&amp;style=none&amp;taskId=uce053f01-334d-4e15-8de8-78aa1e79a3e&amp;title=&amp;width=1741.1111572348054" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292256216-69999efc-8d41-4710-ab15-1a985a9c8152.png#averageHue=%23060605&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=424&amp;id=u89628321&amp;originHeight=382&amp;originWidth=1411&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39794&amp;status=done&amp;style=none&amp;taskId=uc546536e-6fbf-4060-808a-c47acbfc2d3&amp;title=&amp;width=1567.7778193097067" alt="image.png"><br>
<a name="cFSBy"></a></p>
<h3 id="什么是dag">什么是dag</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292398236-03017c4c-8d5f-4f10-b6d0-91592fe0db6b.png#averageHue=%230a0a0a&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=610&amp;id=u0bc3b1bf&amp;originHeight=549&amp;originWidth=1436&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=221882&amp;status=done&amp;style=none&amp;taskId=uc50a015a-a103-4472-b546-08929a1fe2c&amp;title=&amp;width=1595.5555978233442" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292460174-2d433e3c-e8f9-4689-9ec2-571f1fcbd908.png#averageHue=%230e0e0e&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=58&amp;id=uec348313&amp;originHeight=52&amp;originWidth=1490&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=42870&amp;status=done&amp;style=none&amp;taskId=ubd55d0a7-b5fe-426b-b234-1d7cd44798d&amp;title=&amp;width=1655.5555994128015" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292422966-d1c5fd82-cc5b-41cb-b937-675af3cfc63e.png#averageHue=%230b0a0a&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=566&amp;id=u6bf9b251&amp;originHeight=509&amp;originWidth=910&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47642&amp;status=done&amp;style=none&amp;taskId=u319e8271-3a6f-4646-8a16-f5d6cd7fb55&amp;title=&amp;width=1011.111137896409" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670292473901-af9cd6c3-52b3-41bd-9e80-ae83a553ea5b.png#averageHue=%230f0c0a&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=51&amp;id=u7343d157&amp;originHeight=46&amp;originWidth=808&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6927&amp;status=done&amp;style=none&amp;taskId=u30d89d08-9196-49be-965b-c1985fb545f&amp;title=&amp;width=897.7778015607676" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670293619209-ed47aed6-aeb7-43e5-8dbd-1333230b98dc.png#averageHue=%23454545&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=886&amp;id=u65792787&amp;originHeight=797&amp;originWidth=1623&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=321869&amp;status=done&amp;style=none&amp;taskId=uc9cf94af-62f9-4940-99b1-c4c33239cc7&amp;title=&amp;width=1803.3333811053535" alt="image.png"><br>
<a name="fAnTI"></a></p>
<h3 id="DG-vs-DAG">DG vs DAG</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670293830064-e4d086ae-db35-4015-a039-1dcab37c54ac.png#averageHue=%23111111&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=869&amp;id=u1b0787ac&amp;originHeight=782&amp;originWidth=1578&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=266546&amp;status=done&amp;style=none&amp;taskId=u8128643d-cd26-48d6-9a51-cc55757311d&amp;title=&amp;width=1753.333379780806" alt="image.png"><br>DG:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670293934734-671f858a-c3d3-4606-b322-07be4b8f1c9f.png#averageHue=%23181614&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=149&amp;id=ucf7299e1&amp;originHeight=134&amp;originWidth=430&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=10145&amp;status=done&amp;style=none&amp;taskId=ud7190181-f6e4-41be-b488-d30ed0c2252&amp;title=&amp;width=477.7777904345669" alt="image.png"><br>DAG:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670293952304-026248cd-50f0-4949-951e-a39832dc47e3.png#averageHue=%23130f0c&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=100&amp;id=ue9c857d9&amp;originHeight=90&amp;originWidth=250&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4254&amp;status=done&amp;style=none&amp;taskId=ubcad7d02-6ea2-47b5-b3f5-933558275f6&amp;title=&amp;width=277.7777851363761" alt="image.png"><br>
<a name="RT5I8"></a></p>
<h3 id="遍历dag的常用api-class">遍历dag的常用api class</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670293997068-3d94d62f-ce6b-4fad-8699-234e64ee6427.png#averageHue=%230b0b0b&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=492&amp;id=u072129c2&amp;originHeight=443&amp;originWidth=735&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=88990&amp;status=done&amp;style=none&amp;taskId=u9be385a2-bef2-46da-aeb5-f318ec6b27c&amp;title=&amp;width=816.6666883009457" alt="image.png"><br>
<a name="xZdiD"></a></p>
<h3 id="MItDag">MItDag</h3>
<p><a target="_blank" rel="noopener" href="https://help.autodesk.com/view/MAYAUL/2019/CHS/?guid=Maya_SDK_MERGED_cpp_ref_class_m_it_dag_html">https://help.autodesk.com/view/MAYAUL/2019/CHS/?guid=Maya_SDK_MERGED_cpp_ref_class_m_it_dag_html</a><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294064469-4920d97b-6f92-41f7-8771-e73e0bd0a24b.png#averageHue=%23090909&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=563&amp;id=uc63fdefe&amp;originHeight=507&amp;originWidth=1585&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=190360&amp;status=done&amp;style=none&amp;taskId=u7aee5de1-3dca-4924-9a7c-3f19d2cadfc&amp;title=&amp;width=1761.1111577646245" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294104355-c1a8787c-e8ce-45ae-a79f-181ac15dbbb6.png#averageHue=%23080707&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=417&amp;id=ub9109e3b&amp;originHeight=375&amp;originWidth=1095&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=38847&amp;status=done&amp;style=none&amp;taskId=u378de64f-b571-4dad-b4d4-8f7454d5c9f&amp;title=&amp;width=1216.6666988973273" alt="image.png"><br>
<a name="OAENk"></a></p>
<h3 id="MFnDagNode">MFnDagNode</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294341336-eeaea299-9516-44bb-90b8-7258f819f2f4.png#averageHue=%23080808&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=793&amp;id=u7c73b66b&amp;originHeight=714&amp;originWidth=1566&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=238697&amp;status=done&amp;style=none&amp;taskId=u1e08df4c-cfb5-41fc-aa9b-a26535552c0&amp;title=&amp;width=1740.00004609426" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294373623-54804cd2-b2ee-41d9-a6ee-d750d503ea32.png#averageHue=%23070706&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=408&amp;id=u3504b445&amp;originHeight=367&amp;originWidth=1248&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33475&amp;status=done&amp;style=none&amp;taskId=u06d5765d-56e5-4db6-ae66-63805df8373&amp;title=&amp;width=1386.6667034007894" alt="image.png"><br>
<a name="Utj5z"></a></p>
<h3 id="MDagPath-和-MDagPathArray">MDagPath 和 MDagPathArray</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294577548-ccb4d943-8d92-4b42-a7cc-80dfcd04dc72.png#averageHue=%230a0a0a&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=674&amp;id=u90f42400&amp;originHeight=607&amp;originWidth=1605&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=222042&amp;status=done&amp;style=none&amp;taskId=u4908e162-454a-4240-a318-c2e4648060e&amp;title=&amp;width=1783.3333805755344" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670294597971-19963ec7-1a5e-4e38-a0fa-669fbd475fbe.png#averageHue=%23090808&amp;clientId=ud856797a-7bad-4&amp;from=paste&amp;height=468&amp;id=u4739d8f8&amp;originHeight=421&amp;originWidth=1069&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37094&amp;status=done&amp;style=none&amp;taskId=u17d10d7a-1de6-423b-b8c0-24bb9f4b714&amp;title=&amp;width=1187.7778092431442" alt="image.png"><br>
<a name="UO1pS"></a></p>
<h3 id="代码举例">代码举例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line">selection_list = om.MGlobal.getActiveSelectionList()  <span class="comment"># 获取当前选择的对象并为其创建列表</span></span><br><span class="line">traversal_type = om.MItDag.kBreadthFirst <span class="comment"># 遍历方式为广度优先（默认是深度优先）</span></span><br><span class="line">filter_type = om.MFn.kMesh <span class="comment"># 过滤器设置，只遍历kMesh类型</span></span><br><span class="line">dag_iter = om.MItDag(traversal_type,filter_type) <span class="comment"># 创建迭代器，并指定遍历方式和遍历类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> selection_list.isEmpty():</span><br><span class="line">    </span><br><span class="line">    dag_fn = om.MFnDagNode(selection_list.getDependNode(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(&quot;Child:&quot;)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dag_fn.childCount()):</span><br><span class="line">        child_obj = dag_fn.child(i)</span><br><span class="line">        child_fn = om.MFnDagNode(child_obj)</span><br><span class="line">        <span class="comment">#print(child_fn.fullPathName())</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(&quot;Parent:&quot;)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dag_fn.parentCount()):</span><br><span class="line">        parent_obj = dag_fn.parent(i)</span><br><span class="line">        parent_fn = om.MFnDagNode(parent_obj)</span><br><span class="line">        <span class="comment">#print(parent_fn.fullPathName())</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果场景中有选择的物体，那么就以选择的物体为迭代起始点</span></span><br><span class="line">    dag_iter.reset(selection_list.getDependNode(<span class="number">0</span>),traversal_type,filter_type) </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> dag_iter.isDone():</span><br><span class="line">        <span class="comment"># print(dag_iter.partialPathName()) # 输出短名</span></span><br><span class="line">        <span class="comment"># print(dag_iter.fullPathName()) # 输出长名</span></span><br><span class="line">        <span class="comment"># dag_path = dag_iter.getPath() # 获取dagpath对象</span></span><br><span class="line">        <span class="comment"># print(dag_path.fullPathName()) # 输出dagpath对象的长名</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 迭代器遍历类型为kmesh，然后通过类型为kmesh的shape节点得到父节点transform的名字</span></span><br><span class="line">        shape_obj = dag_iter.currentItem()</span><br><span class="line">        dag_fn = om.MFnDagNode(shape_obj)</span><br><span class="line">        dag_fn = om.MFnDagNode(shape_obj)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dag_fn.parentCount()):</span><br><span class="line">            parent_fn = om.MFnDagNode(dag_fn.parent(i))</span><br><span class="line">            <span class="built_in">print</span>(parent_fn.fullPathName())</span><br><span class="line"></span><br><span class="line">        dag_iter.<span class="built_in">next</span>()</span><br></pre></td></tr></table></figure>
<p><a name="PhLMD"></a></p>
<h2 id="contexts（工具，以下所有的上下文的翻译统统理解为工具）">contexts（工具，以下所有的上下文的翻译统统理解为工具）</h2>
<p><a name="dRb2V"></a></p>
<h3 id="什么是contexts">什么是contexts</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314380302-2759dcb4-96c9-4b21-9356-2d53238597ff.png#averageHue=%230b0b0b&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=644&amp;id=u323f8700&amp;originHeight=580&amp;originWidth=1516&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=293536&amp;status=done&amp;style=none&amp;taskId=u14d47ef0-7d15-46bb-8a52-644ef70c433&amp;title=&amp;width=1684.4444890669847" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314393717-42515b83-5815-4197-b73f-f52b2c2db5f5.png#averageHue=%230a0908&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=459&amp;id=uc33a7326&amp;originHeight=413&amp;originWidth=1193&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57581&amp;status=done&amp;style=none&amp;taskId=u3cf547d7-c0b4-4678-9c6f-8a34ee1998a&amp;title=&amp;width=1325.5555906707866" alt="image.png"><br>
<a name="qWk3F"></a></p>
<h3 id="contexts-class">contexts class</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670320855146-146a11fe-e7a9-411e-b1d9-d58b9c330cfa.png#averageHue=%2312110f&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=79&amp;id=u8728caa8&amp;originHeight=71&amp;originWidth=845&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9417&amp;status=done&amp;style=none&amp;taskId=ufbbfce46-4d32-4de2-b7f7-32074698e2e&amp;title=&amp;width=938.8889137609511" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314506168-9e976551-b9c4-40d3-9154-05c98c1261e7.png#averageHue=%23070707&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=553&amp;id=u536dda83&amp;originHeight=498&amp;originWidth=1560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=130220&amp;status=done&amp;style=none&amp;taskId=u1b19bdfe-5338-4feb-aa95-eef5717db4e&amp;title=&amp;width=1733.3333792509868" alt="image.png"><br>
<a name="yasrt"></a></p>
<h4 id="MPxContext">MPxContext</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314566636-98b3ea1e-9d0c-4747-bb35-2218020358f4.png#averageHue=%230a0a0a&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=748&amp;id=ud98b9990&amp;originHeight=673&amp;originWidth=1505&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=271852&amp;status=done&amp;style=none&amp;taskId=uc86eae1f-512d-4354-8966-b6dab1fdb16&amp;title=&amp;width=1672.222266520984" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314628131-bfae171b-b57a-41c5-a45e-615dcc82baae.png#averageHue=%23090808&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=531&amp;id=uefea2edf&amp;originHeight=478&amp;originWidth=944&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47400&amp;status=done&amp;style=none&amp;taskId=uf3a88e84-bc4a-4608-8a60-c833daa9f4b&amp;title=&amp;width=1048.8889166749561" alt="image.png"><br>
<a name="EjDvf"></a></p>
<h4 id="MPxContextCommand">MPxContextCommand</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314724095-6febfa93-6eea-4fc6-9105-afd449a494eb.png#averageHue=%230b0b0b&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=522&amp;id=uf02ad2a6&amp;originHeight=470&amp;originWidth=1468&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=199346&amp;status=done&amp;style=none&amp;taskId=ueac65ccb-dd00-44e2-8fd6-2d7f77603f7&amp;title=&amp;width=1631.1111543208003" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314741398-3373638b-1a47-4bf9-8867-5d284b8de65b.png#averageHue=%23090807&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=380&amp;id=u18854ee7&amp;originHeight=342&amp;originWidth=1117&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=34098&amp;status=done&amp;style=none&amp;taskId=uf0c2fafe-41ed-4817-b2bc-f16806ad7f9&amp;title=&amp;width=1241.1111439893284" alt="image.png"><br>
<a name="Bg5Ad"></a></p>
<h4 id="MPxToolCommand">MPxToolCommand</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314838409-43a977bf-405b-4c77-9730-aedb1ff303fd.png#averageHue=%230a0a0a&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=803&amp;id=ucc5b9b9d&amp;originHeight=723&amp;originWidth=1596&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=321569&amp;status=done&amp;style=none&amp;taskId=u0e8c7561-12c9-40fc-aca5-44a8e6b6c3b&amp;title=&amp;width=1773.333380310625" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670314882771-837d3d6a-b70e-4d2e-a8a9-17717a3f045a.png#averageHue=%23080707&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=631&amp;id=u3381456a&amp;originHeight=568&amp;originWidth=1060&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=48382&amp;status=done&amp;style=none&amp;taskId=u4dd9e33c-e430-4e3f-b520-0b5d969ade2&amp;title=&amp;width=1177.7778089782346" alt="image.png"><br>
<a name="WebzE"></a></p>
<h3 id="限制">限制</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670315161425-a8ef71e2-6d09-4adb-8efe-1f147b239d59.png#averageHue=%230a0a0a&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=774&amp;id=uea1d0fe0&amp;originHeight=697&amp;originWidth=1517&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=288780&amp;status=done&amp;style=none&amp;taskId=u0358ebe1-b9eb-488c-9e69-a825fba52d6&amp;title=&amp;width=1685.5556002075302" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670315219263-813cdfbd-9de5-4e6c-a69e-4447059f2732.png#averageHue=%23080807&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=583&amp;id=uba1e83d3&amp;originHeight=525&amp;originWidth=1466&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57377&amp;status=done&amp;style=none&amp;taskId=ue52ba2c5-7e30-4a13-a220-8e1f35b8355&amp;title=&amp;width=1628.8889320397095" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670315514778-102a372c-5ec9-4310-a356-34a085abdc54.png#averageHue=%230b0b0b&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=877&amp;id=uacd4817c&amp;originHeight=789&amp;originWidth=1576&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=373584&amp;status=done&amp;style=none&amp;taskId=u9d104a94-f5d6-4217-81a8-c5092cd5ead&amp;title=&amp;width=1751.1111574997149" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670315560657-f135614b-2a7f-4e37-aeb6-c08ecf020f6e.png#averageHue=%23070606&amp;clientId=u7f1d3d8f-5941-4&amp;from=paste&amp;height=827&amp;id=u9b5dc5f0&amp;originHeight=744&amp;originWidth=1552&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=90249&amp;status=done&amp;style=none&amp;taskId=u1155dc37-d283-4e88-ba8a-914ffc61b0c&amp;title=&amp;width=1724.444490126623" alt="image.png"><br>
<a name="aHpYe"></a></p>
<h3 id="举例-2">举例</h3>
<p><a name="jLo8j"></a></p>
<h4 id="context工具模板">context工具模板</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># 此插件只适用于maya2020及以上版本</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleContext</span>(omui.MPxContext):</span><br><span class="line"></span><br><span class="line">    TITLE = <span class="string">&quot;Simple Context&quot;</span></span><br><span class="line"></span><br><span class="line">    HELP_TEXT = <span class="string">&quot;&lt;insert help text here&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleContext, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setTitleString(SimpleContext.TITLE)</span><br><span class="line">        plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;template_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>))  </span><br><span class="line">        <span class="variable language_">self</span>.setImage(plugin_dir_path + <span class="string">&quot;/icons/icon_windows.png&quot;</span>, omui.MPxContext.kImage1) <span class="comment"># 设置工具的图标</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">helpSlateHasChanged</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="variable language_">self</span>.setHelpString(SimpleContext.HELP_TEXT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOnSetup</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 工具加载时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOnSetup&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOffCleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 取消工具加载时执行(在使用工具的同时创建模型maya会自动先取消加载工具再自动加载工具) &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOffCleanup&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doPress</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        mouse_button = event.mouseButton()  <span class="comment"># 获取鼠标的按键</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mouse_button == omui.MEvent.kLeftMouse:</span><br><span class="line">            <span class="comment"># 如果按下鼠标左键执行</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Left mouse button pressed&quot;</span>) </span><br><span class="line">        <span class="keyword">elif</span> mouse_button == omui.MEvent.kMiddleMouse:</span><br><span class="line">            <span class="comment"># 如果按下鼠标中键执行</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Middle mouse button pressed&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doRelease</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 松开键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse button released&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doDrag</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按住鼠标左键并进行移动时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse drag&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">completeAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下enter键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Complete action (enter/return key pressed)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deleteAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下delete键或者backspace键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Delete action (backspace/delete key pressed)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">abortAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下esc键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Abort action (escape key pressed)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleContextCmd</span>(omui.MPxContextCommand):</span><br><span class="line"></span><br><span class="line">        COMMAND_NAME = <span class="string">&quot;rcSimpleCtx&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="built_in">super</span>(SimpleContextCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">makeObj</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> SimpleContext()</span><br><span class="line">        </span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">            <span class="keyword">return</span> SimpleContextCmd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerContextCommand(SimpleContextCmd.COMMAND_NAME, SimpleContextCmd.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterContextCommand(SimpleContextCmd.COMMAND_NAME)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;template_context.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;context = cmds.rcSimpleCtx(); cmds.setToolTo(context)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="filnU"></a></p>
<h4 id="custom-select-工具">custom select 工具</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># 此插件只适用于maya2020及以上版本</span></span><br><span class="line"><span class="comment"># 插件介绍: 使用context时按ctrl键框选只选择mesh,按ctrl+shift键时只选择light，不按只框选就全选择</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomSelectContext</span>(omui.MPxContext):</span><br><span class="line"></span><br><span class="line">    TITLE = <span class="string">&quot;Custom Select Context&quot;</span></span><br><span class="line"></span><br><span class="line">    HELP_TEXT = <span class="string">&quot;Ctrl to select only meshes. Ctrl+Shift to select only lights.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomSelectContext, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setTitleString(CustomSelectContext.TITLE)</span><br><span class="line">        plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;custom_select_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>))  </span><br><span class="line">        <span class="variable language_">self</span>.setImage(plugin_dir_path + <span class="string">&quot;/icons/icon_windows.png&quot;</span>, omui.MPxContext.kImage1) <span class="comment"># 设置工具的图标</span></span><br><span class="line">        test_file_path = plugin_dir_path + <span class="string">&quot;/test_scene/custom_select_context_test.ma&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">helpStateHasChanged</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在左下角显示帮助 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.setHelpString(CustomSelectContext.HELP_TEXT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOnSetup</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 工具加载时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOnSetup&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOffCleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 取消工具加载时执行(在使用工具的同时创建模型maya会自动先取消加载工具再自动加载工具) &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOffCleanup&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doPress</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.viewport_start_pos = event.position</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.light_only = <span class="literal">False</span> <span class="comment"># 用来判断是否只选择灯光类型</span></span><br><span class="line">        <span class="variable language_">self</span>.meshes_only = <span class="literal">False</span> <span class="comment"># 用来判断是否只选择mesh类型</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> event.isModifierControl():</span><br><span class="line">            <span class="keyword">if</span> event.isModifierShift():</span><br><span class="line">                <span class="variable language_">self</span>.light_only = <span class="literal">True</span>  <span class="comment"># 当ctrl和shift键同时按下时为True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="variable language_">self</span>.meshes_only = <span class="literal">True</span>  <span class="comment"># 当ctrl键按下时为True</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doRelease</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 松开键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.viewport_end_pos = event.position</span><br><span class="line"></span><br><span class="line">        initial_selection = om.MGlobal.getActiveSelectionList() <span class="comment"># 获取场景中已经选择的对象的列表</span></span><br><span class="line"></span><br><span class="line">        om.MGlobal.selectFromScreen(<span class="variable language_">self</span>.viewport_start_pos[<span class="number">0</span>], <span class="variable language_">self</span>.viewport_start_pos[<span class="number">1</span>],</span><br><span class="line">                                    <span class="variable language_">self</span>.viewport_end_pos[<span class="number">0</span>], <span class="variable language_">self</span>.viewport_end_pos[<span class="number">1</span>],</span><br><span class="line">                                    om.MGlobal.kReplaceList) <span class="comment"># 根据矩形框选择矩形中的对象（这个命令所进行的选择不会进入undo堆栈，因此需要通过其他命令设置正常的堆栈）</span></span><br><span class="line">        </span><br><span class="line">        selection_list = om.MGlobal.getActiveSelectionList() <span class="comment"># 获取通过矩形框选中的对象的列表</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.light_only <span class="keyword">or</span> <span class="variable language_">self</span>.meshes_only:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(selection_list.length())):</span><br><span class="line">                obj = selection_list.getDependNode(i)</span><br><span class="line">                shape = om.MFnDagNode(obj).child(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.light_only <span class="keyword">and</span> <span class="keyword">not</span> shape.hasFn(om.MFn.kLight): <span class="comment"># 如果shape节点是light类型</span></span><br><span class="line">                    selection_list.remove(i)</span><br><span class="line">                <span class="keyword">elif</span> <span class="variable language_">self</span>.meshes_only <span class="keyword">and</span> <span class="keyword">not</span> shape.hasFn(om.MFn.kMesh): <span class="comment"># 如果shape节点是mesh类型</span></span><br><span class="line">                    selection_list.remove(i)</span><br><span class="line"></span><br><span class="line">        om.MGlobal.setActiveSelectionList(initial_selection, om.MGlobal.kReplaceList) <span class="comment"># 首先选择场景中之前已经选择的列表</span></span><br><span class="line">        om.MGlobal.selectCommand(selection_list, om.MGlobal.kReplaceList)  <span class="comment"># 通过调用内置的maya选择命令来选择，并且让maya负责维护堆栈</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doDrag</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按住鼠标左键并进行移动时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.viewport_end_pos = event.position</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.draw_selection_rectangle(draw_manager,</span><br><span class="line">                                      <span class="variable language_">self</span>.viewport_start_pos[<span class="number">0</span>],<span class="variable language_">self</span>.viewport_start_pos[<span class="number">1</span>],</span><br><span class="line">                                      <span class="variable language_">self</span>.viewport_end_pos[<span class="number">0</span>],<span class="variable language_">self</span>.viewport_start_pos[<span class="number">1</span>],</span><br><span class="line">                                      <span class="variable language_">self</span>.viewport_end_pos[<span class="number">0</span>],<span class="variable language_">self</span>.viewport_end_pos[<span class="number">1</span>],</span><br><span class="line">                                      <span class="variable language_">self</span>.viewport_start_pos[<span class="number">0</span>],<span class="variable language_">self</span>.viewport_end_pos[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_selection_rectangle</span>(<span class="params">self, draw_manager, x0, y0, x1, y1, x2, y2, x3, y3</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 根据鼠标拖拽的范围进行矩形绘制 &quot;&quot;&quot;</span></span><br><span class="line">        draw_manager.beginDrawable() <span class="comment"># 开始绘制</span></span><br><span class="line">        draw_manager.setLineWidth(<span class="number">1.0</span>) <span class="comment"># 设置绘制线的宽度</span></span><br><span class="line">        draw_manager.setColor(om.MColor((<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>))) <span class="comment"># 设置绘制的颜色（颜色数值是一个集合）</span></span><br><span class="line"></span><br><span class="line">        draw_manager.line2d(om.MPoint(x0,y0),om.MPoint(x1,y1))</span><br><span class="line">        draw_manager.line2d(om.MPoint(x1,y1),om.MPoint(x2,y2))</span><br><span class="line">        draw_manager.line2d(om.MPoint(x2,y2),om.MPoint(x3,y3))</span><br><span class="line">        draw_manager.line2d(om.MPoint(x3,y3),om.MPoint(x0,y0))</span><br><span class="line"></span><br><span class="line">        draw_manager.endDrawable() <span class="comment"># 结束绘制</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomSelectContextCmd</span>(omui.MPxContextCommand):</span><br><span class="line"></span><br><span class="line">        COMMAND_NAME = <span class="string">&quot;rcCustomSelectCtx&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="built_in">super</span>(CustomSelectContextCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">makeObj</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> CustomSelectContext()</span><br><span class="line">        </span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">            <span class="keyword">return</span> CustomSelectContextCmd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerContextCommand(CustomSelectContextCmd.COMMAND_NAME, CustomSelectContextCmd.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(CustomSelectContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterContextCommand(CustomSelectContextCmd.COMMAND_NAME)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(CustomSelectContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;custom_select_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>)) </span><br><span class="line">    test_file_path = plugin_dir_path + <span class="string">&quot;/test_scene/custom_select_context_test.ma&quot;</span></span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;custom_select_context.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.file(test_file_path,o=True,f=True)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;context = cmds.rcCustomSelectCtx(); cmds.setToolTo(context)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="zOgx0"></a></p>
<h4 id="创建骨骼工具">创建骨骼工具</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># 此插件只适用于maya2020及以上版本</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JointCreateContext</span>(omui.MPxContext):</span><br><span class="line"></span><br><span class="line">    TITLE = <span class="string">&quot;JointCreate Context&quot;</span></span><br><span class="line"></span><br><span class="line">    HELP_TEXT = [<span class="string">&quot;Select first joint location&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;Select second joint location&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;Select final joint location&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;Press Enter to complete&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(JointCreateContext, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setTitleString(JointCreateContext.TITLE)</span><br><span class="line">        plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;joint_create_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>))  </span><br><span class="line">        <span class="variable language_">self</span>.setImage(plugin_dir_path + <span class="string">&quot;/icons/icon_windows.png&quot;</span>, omui.MPxContext.kImage1) <span class="comment"># 设置工具的图标</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.state = <span class="number">0</span> <span class="comment"># 判断通过工具选择的对象的个数</span></span><br><span class="line">        <span class="variable language_">self</span>.context_selection = om.MSelectionList() <span class="comment"># 通过工具选择的对象的列表</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">helpStateHasChanged</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="variable language_">self</span>.update_help_string()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_help_string</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.setHelpString(JointCreateContext.HELP_TEXT[<span class="variable language_">self</span>.state])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOnSetup</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 工具加载时执行 &quot;&quot;&quot;</span></span><br><span class="line">        om.MGlobal.selectCommand(om.MSelectionList()) <span class="comment"># 确保工具刚开始使用时是一个健康的选择状态</span></span><br><span class="line">        <span class="variable language_">self</span>.reset_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOffCleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 取消工具加载时执行(在使用工具的同时创建模型maya会自动先取消加载工具再自动加载工具) &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.reset_state()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doRelease</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 松开键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.state &gt;= <span class="number">0</span> <span class="keyword">and</span> <span class="variable language_">self</span>.state &lt; <span class="number">3</span>:</span><br><span class="line">            om.MGlobal.selectFromScreen(event.position[<span class="number">0</span>], event.position[<span class="number">1</span>],event.position[<span class="number">0</span>],event.position[<span class="number">1</span>],om.MGlobal.kReplaceList)</span><br><span class="line"></span><br><span class="line">            active_selection = om.MGlobal.getActiveSelectionList() <span class="comment"># 获取当前选择的物体</span></span><br><span class="line">            <span class="keyword">if</span> active_selection.length() == <span class="number">1</span>:</span><br><span class="line">                <span class="variable language_">self</span>.context_selection.merge(active_selection) <span class="comment"># 使用merge方法防止重复的对象出现在context_selection中</span></span><br><span class="line"></span><br><span class="line">            om.MGlobal.setActiveSelectionList(<span class="variable language_">self</span>.context_selection) <span class="comment"># 更改当前选择的物体</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.update_state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">completeAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下enter键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        selection_count = <span class="variable language_">self</span>.context_selection.length()</span><br><span class="line">        <span class="keyword">if</span> selection_count == <span class="number">3</span>:</span><br><span class="line">            om.MGlobal.setActiveSelectionList(om.MSelectionList())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(selection_count):</span><br><span class="line">                transform_fn = om.MFnTransform(<span class="variable language_">self</span>.context_selection.getDependNode(i))</span><br><span class="line"></span><br><span class="line">                cmds.joint(position = transform_fn.translation(om.MSpace.kTransform))</span><br><span class="line">                cmds.delete(transform_fn.name())</span><br><span class="line">            </span><br><span class="line">            cmds.select(clear=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.reset_state()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            om.MGlobal.displayError(<span class="string">&quot;Three objects must be selected&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deleteAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下delete键或者backspace键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        selection_count = <span class="variable language_">self</span>.context_selection.length()</span><br><span class="line">        <span class="keyword">if</span> selection_count &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.context_selection.remove(selection_count - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            om.MGlobal.setActiveSelectionList(<span class="variable language_">self</span>.context_selection)</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.update_state()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">abortAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下esc键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.reset_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 更新状态 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.state = <span class="variable language_">self</span>.context_selection.length()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update_help_string()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 重置状态 &quot;&quot;&quot;</span></span><br><span class="line">        om.MGlobal.setActiveSelectionList(om.MSelectionList())</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.context_selection.clear()</span><br><span class="line">        <span class="variable language_">self</span>.update_state</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JointCreateContextCmd</span>(omui.MPxContextCommand):</span><br><span class="line"></span><br><span class="line">        COMMAND_NAME = <span class="string">&quot;rcJointCreateCtx&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="built_in">super</span>(JointCreateContextCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">makeObj</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> JointCreateContext()</span><br><span class="line">        </span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">            <span class="keyword">return</span> JointCreateContextCmd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerContextCommand(JointCreateContextCmd.COMMAND_NAME, JointCreateContextCmd.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(JointCreateContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterContextCommand(JointCreateContextCmd.COMMAND_NAME)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(JointCreateContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,force=<span class="literal">True</span>)</span><br><span class="line">    plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;joint_create_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>)) </span><br><span class="line">    test_file_path = plugin_dir_path + <span class="string">&quot;/test_scene/joint_create_context_test.ma&quot;</span></span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;joint_create_context.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.file(test_file_path,o=True,f=True)&#x27;</span>)</span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;context = cmds.rcJointCreateCtx(); cmds.setToolTo(context)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="nmCaZ"></a></p>
<h4 id="各种绘制举例">各种绘制举例</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># 此插件只适用于maya2020及以上版本</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleContext</span>(omui.MPxContext):</span><br><span class="line"></span><br><span class="line">    TITLE = <span class="string">&quot;Simple Context&quot;</span></span><br><span class="line"></span><br><span class="line">    HELP_TEXT = <span class="string">&quot;&lt;insert help text here&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleContext, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.setTitleString(SimpleContext.TITLE)</span><br><span class="line">        plugin_dir_path = os.path.dirname(cmds.pluginInfo(<span class="string">&quot;draw_persistence_example_context.py&quot;</span>,p=<span class="literal">True</span>,q=<span class="literal">True</span>))  </span><br><span class="line">        <span class="variable language_">self</span>.setImage(plugin_dir_path + <span class="string">&quot;/icons/icon_windows.png&quot;</span>, omui.MPxContext.kImage1) <span class="comment"># 设置工具的图标 </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">helpStateHasChanged</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="variable language_">self</span>.setHelpString(SimpleContext.HELP_TEXT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOnSetup</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 工具加载时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOnSetup&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toolOffCleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 取消工具加载时执行(在使用工具的同时创建模型maya会自动先取消加载工具再自动加载工具) &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;toolOffCleanup&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doPress</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        mouse_button = event.mouseButton()  <span class="comment"># 获取鼠标的按键</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mouse_button == omui.MEvent.kLeftMouse:</span><br><span class="line">            <span class="comment"># 如果按下鼠标左键执行</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Left mouse button pressed&quot;</span>) </span><br><span class="line">        <span class="keyword">elif</span> mouse_button == omui.MEvent.kMiddleMouse:</span><br><span class="line">            <span class="comment"># 如果按下鼠标中键执行</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Middle mouse button pressed&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doRelease</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 松开键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse button released&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doDrag</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按住鼠标左键并进行移动时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Mouse drag&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">completeAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下enter键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Complete action (enter/return key pressed)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deleteAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下delete键或者backspace键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Delete action (backspace/delete key pressed)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">abortAction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 按下esc键时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Abort action (escape key pressed)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">doPtrMoved</span>(<span class="params">self, event, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 当鼠标移动并且没有按下鼠标按钮时执行 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.position = om.MPoint(event.position)</span><br><span class="line">        <span class="comment"># self.draw_circle(event, draw_manager)</span></span><br><span class="line">        <span class="variable language_">self</span>.draw_info(draw_manager, frame_context)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">drawFeedback</span>(<span class="params">self, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 无论执行什么操作都会始终执行绘制 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># self.draw_sphere(draw_manager)</span></span><br><span class="line">        <span class="comment"># self.draw_info(draw_manager, frame_context) # 在这个函数中执行绘制text有显示的bug，不推荐使用</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_circle</span>(<span class="params">self, event, draw_manager</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在鼠标指针的位置处绘制圆形 &quot;&quot;&quot;</span></span><br><span class="line">        center = om.MPoint(event.position)</span><br><span class="line">        radius = <span class="number">20</span></span><br><span class="line">        </span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line">        draw_manager.circle2d(center, radius, <span class="literal">True</span>)</span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_sphere</span>(<span class="params">self, draw_manager</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在坐标原点绘制一个半径为5cm的圆球 &quot;&quot;&quot;</span></span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line">        draw_manager.sphere(om.MPoint(<span class="number">0</span>,<span class="number">0</span>), <span class="number">5</span>)</span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_info</span>(<span class="params">self, draw_manager, frame_context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在视口左上角绘制文字信息 &quot;&quot;&quot;</span></span><br><span class="line">        viewport_height = frame_context.getViewportDimensions()[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        info_position = om.MPoint(<span class="number">20</span>, viewport_height - <span class="number">20</span>)</span><br><span class="line">        text = <span class="string">&quot;Mouse pos: &#123;0&#125;, &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.position.x, <span class="variable language_">self</span>.position.y)</span><br><span class="line"></span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line">        draw_manager.text2d(info_position, text)</span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleContextCmd</span>(omui.MPxContextCommand):</span><br><span class="line"></span><br><span class="line">        COMMAND_NAME = <span class="string">&quot;rcSimpleCtx&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="built_in">super</span>(SimpleContextCmd, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">makeObj</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> SimpleContext()</span><br><span class="line">        </span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">            <span class="keyword">return</span> SimpleContextCmd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>): </span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerContextCommand(SimpleContextCmd.COMMAND_NAME, SimpleContextCmd.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterContextCommand(SimpleContextCmd.COMMAND_NAME)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister context command: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleContextCmd.COMMAND_NAME))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;draw_persistence_example_context.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;context = cmds.rcSimpleCtx(); cmds.setToolTo(context)&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="y0TKk"></a></p>
<h1>第三卷</h1>
<p><a name="mPC43"></a></p>
<h2 id="Locators（可参考HelloWorldNode）">Locators（可参考HelloWorldNode）</h2>
<p><a name="L8NWI"></a></p>
<h3 id="MPxLocatorNode">MPxLocatorNode</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670824784593-b4e2aa98-d50f-45e4-abea-b3f7a774eece.png#averageHue=%230b0b0b&amp;clientId=u0fb33782-733b-4&amp;from=paste&amp;height=562&amp;id=u38288abb&amp;originHeight=506&amp;originWidth=1113&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=141834&amp;status=done&amp;style=none&amp;taskId=u297df3fd-7477-4bdf-9932-2e82aad8e03&amp;title=&amp;width=1236.6666994271463" alt="image.png"><br>
<a name="t7d3P"></a></p>
<h3 id="MPxDrawOverride（VP2-0）">MPxDrawOverride（VP2.0）</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670824823422-3d2a2cad-30cd-4e17-963c-2128659f31cb.png#averageHue=%230b0b0b&amp;clientId=u0fb33782-733b-4&amp;from=paste&amp;height=532&amp;id=u11b5804e&amp;originHeight=479&amp;originWidth=1509&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=197495&amp;status=done&amp;style=none&amp;taskId=u6f2950a7-2835-4757-bed7-59ba1cbfff1&amp;title=&amp;width=1676.666711083166" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670824872793-3e8e184c-6dc4-4370-bfc6-8eccc2aafa5b.png#averageHue=%230c0b0a&amp;clientId=u0fb33782-733b-4&amp;from=paste&amp;height=328&amp;id=uacb92293&amp;originHeight=295&amp;originWidth=1042&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33544&amp;status=done&amp;style=none&amp;taskId=u0bc92d29-62bd-46dc-84d6-27e74402a71&amp;title=&amp;width=1157.7778084484155" alt="image.png"><br>
<a name="xbGCL"></a></p>
<h3 id="代码举例-2">代码举例</h3>
<p><a name="z2Xy5"></a></p>
<h4 id="创建带形状变形器，通过更改序号改变定位器的形状">创建带形状变形器，通过更改序号改变定位器的形状</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670928053999-00cb576f-99ea-468c-b2a7-064038a8aafe.png#averageHue=%23545353&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=719&amp;id=uc070a55d&amp;originHeight=647&amp;originWidth=1214&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35937&amp;status=done&amp;style=none&amp;taskId=ue639a515-b28b-4461-a1ba-db5b1dc486c&amp;title=&amp;width=1348.8889246222423" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670928061330-bde1870c-6966-4420-b47b-7e98ece72314.png#averageHue=%23535353&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=590&amp;id=uc5b9d692&amp;originHeight=531&amp;originWidth=1203&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26767&amp;status=done&amp;style=none&amp;taskId=u0dfebbe0-bd33-4164-9f7f-6277ed2cf7a&amp;title=&amp;width=1336.6667020762418" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaRender <span class="keyword">as</span> omr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleLocatorNode</span>(omui.MPxLocatorNode):</span><br><span class="line">    TYPE_NAME = <span class="string">&quot;simplelocator&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7FE</span>)</span><br><span class="line">    DRAW_CLASSIFICATION = <span class="string">&quot;drawdb/geometry/simplelocator&quot;</span></span><br><span class="line">    DRAW_REGISTRANT_ID = <span class="string">&quot;SimpleLocatorNode&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleLocatorNode, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> SimpleLocatorNode()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        numeric_attr = om.MFnNumericAttribute()</span><br><span class="line"></span><br><span class="line">        cls.shape_index_obj = numeric_attr.create(<span class="string">&quot;shapeIndex&quot;</span>, <span class="string">&quot;si&quot;</span>, om.MFnNumericData.kInt, <span class="number">0</span>)</span><br><span class="line">        numeric_attr.setMin(<span class="number">0</span>)</span><br><span class="line">        numeric_attr.setMax(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        cls.addAttribute(cls.shape_index_obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleLocatorUserData</span>(om.MUserData):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 创建MUserData类使其对象能够将数据在prepareForDraw与addUIDrawables之间相互传递  &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init</span>(<span class="params">self, deleteAfterUse = <span class="literal">False</span></span>):  <span class="comment"># 设置为使用数据后不删除数据</span></span><br><span class="line">        <span class="built_in">super</span>(SimpleLocatorUserData, <span class="variable language_">self</span>).__init__(deleteAfterUse)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.shape_index = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.wireframe_color = om.MColor((<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>))  <span class="comment"># 线框颜色</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleLocatorDrawOverride</span>(omr.MPxDrawOverride):</span><br><span class="line">    NAME = <span class="string">&quot;SimpleLocatorDrawOverride&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleLocatorDrawOverride, <span class="variable language_">self</span>).__init__(obj, <span class="literal">None</span>, <span class="literal">True</span>)  <span class="comment"># 第一个参数是maya object,第二个参数是绘制是callback函数,第三个参数是默认为True,为True时将会将此标志位dirty状态，因此可以持续更新,建议为True,除非遇到了性能问题可以为False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">supportedDrawAPIs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> omr.MRenderer.kAllDevices</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasUIDrawables</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepareForDraw</span>(<span class="params">self, obj_path, camera_path, frame_context, old_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在使用绘制图形的方法之前,使用这个方法来将数据检索与缓存 &quot;&quot;&quot;</span></span><br><span class="line">        data = old_data</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            data = SimpleLocatorUserData()</span><br><span class="line"></span><br><span class="line">        locator_obj = obj_path.node()</span><br><span class="line">        node_fn = om.MFnDependencyNode(locator_obj)</span><br><span class="line"></span><br><span class="line">        data.shape_index = node_fn.findPlug(<span class="string">&quot;shapeIndex&quot;</span>, <span class="literal">False</span>).asInt()</span><br><span class="line"></span><br><span class="line">        display_status = omr.MGeometryUtilities.displayStatus(obj_path)</span><br><span class="line">        <span class="keyword">if</span> display_status == omr.MGeometryUtilities.kDormant:  </span><br><span class="line">            data.wireframe_color = om.MColor((<span class="number">0.0</span>, <span class="number">0.1</span>, <span class="number">0.0</span>)) <span class="comment"># 当节点处于未选中状态时设置颜色为深绿色</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.wireframe_color = omr.MGeometryUtilities.wireframeColor(obj_path)  <span class="comment"># 其他状态按照maya的标准来设置线框颜色</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addUIDrawables</span>(<span class="params">self, obj_path, draw_manager, frame_context, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 绘制图形的方法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            obj_path (_type_): 指向正在绘制的对象的路径,这里是指locator节点</span></span><br><span class="line"><span class="string">            draw_manager (_type_): 用于绘制简单的几何图形</span></span><br><span class="line"><span class="string">            frame_context (_type_): 包含当前渲染框架的一些全局信息</span></span><br><span class="line"><span class="string">            data (_type_): 用户创建的数据对象,存储缓存数据,类型为MUserDataObject</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line"></span><br><span class="line">        draw_manager.setColor(data.wireframe_color)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data.shape_index == <span class="number">0</span>: <span class="comment"># 绘制圆形</span></span><br><span class="line">            draw_manager.circle(om.MPoint(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>), om.MVector(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>), <span class="number">1</span>, <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">elif</span> data.shape_index == <span class="number">1</span>: <span class="comment"># 绘制矩形</span></span><br><span class="line">            draw_manager.rect(om.MPoint(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>), om.MVector(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>), om.MVector(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>), <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">elif</span> data.shape_index == <span class="number">2</span>: <span class="comment"># 绘制三角形</span></span><br><span class="line">            point_array = om.MPointArray([(-<span class="number">1.0</span>, <span class="number">0.0</span>, -<span class="number">1.0</span>), (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),(<span class="number">1.0</span>, <span class="number">0.0</span>, -<span class="number">1.0</span>),(-<span class="number">1.0</span>, <span class="number">0.0</span>, -<span class="number">1.0</span>)])</span><br><span class="line">            draw_manager.lineStrip(point_array, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> SimpleLocatorDrawOverride(obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(SimpleLocatorNode.TYPE_NAME,</span><br><span class="line">                               SimpleLocatorNode.TYPE_ID,</span><br><span class="line">                               SimpleLocatorNode.creator,</span><br><span class="line">                               SimpleLocatorNode.initialize,</span><br><span class="line">                               om.MPxNode.kLocatorNode,</span><br><span class="line">							   SimpleLocatorNode.DRAW_CLASSIFICATION)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleLocatorNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.registerDrawOverrideCreator(SimpleLocatorNode.DRAW_CLASSIFICATION,</span><br><span class="line">                                                      SimpleLocatorNode.DRAW_REGISTRANT_ID,</span><br><span class="line">                                                      SimpleLocatorDrawOverride.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleLocatorDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.deregisterDrawOverrideCreator(SimpleLocatorNode.DRAW_CLASSIFICATION,</span><br><span class="line">                                                        SimpleLocatorNode.DRAW_REGISTRANT_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleLocatorDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(SimpleLocatorNode.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(SimpleLocatorNode.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>,f=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    plugin_name = <span class="string">&quot;simple_locator_node.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;cmds.createNode(&quot;simplelocator&quot;)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a name="ANATJ"></a></p>
<h4 id="测量两个网格体的距离的定位器">测量两个网格体的距离的定位器</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670928161742-d22eb865-d937-45aa-9c8a-2e3abdf0886d.png#averageHue=%235c5c5c&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=352&amp;id=u10c1c9ed&amp;originHeight=317&amp;originWidth=743&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9114&amp;status=done&amp;style=none&amp;taskId=u9189b8ad-021b-4a51-be13-9a89b8cf206&amp;title=&amp;width=825.5555774253097" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670928211727-341226e9-16d0-4861-9ca7-9c2b4fdf4444.png#averageHue=%23403f3f&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=349&amp;id=u45f8f19c&amp;originHeight=314&amp;originWidth=690&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=27137&amp;status=done&amp;style=none&amp;taskId=ua5d7643a-88f6-4aa3-9bc2-a3527437368&amp;title=&amp;width=766.6666869763981" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># 不适用于2018及以下版本</span></span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMayaRender <span class="keyword">as</span> omr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 告知maya,使用的是maya api 2.0 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DistanceBetweenLocator</span>(omui.MPxLocatorNode):</span><br><span class="line">    TYPE_NAME = <span class="string">&quot;distanceBetweenLocator&quot;</span></span><br><span class="line">    TYPE_ID = om.MTypeId(<span class="number">0x0007F7FD</span>)</span><br><span class="line">    DRAW_CLASSIFICATION = <span class="string">&quot;drawdb/geometry/distancebetweenlocator&quot;</span></span><br><span class="line">    DRAW_REGISTRANT_ID = <span class="string">&quot;DistanceBetweenLocator&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    point1_obj = <span class="literal">None</span></span><br><span class="line">    point2_obj = <span class="literal">None</span></span><br><span class="line">    distance_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DistanceBetweenLocator, <span class="variable language_">self</span>).__init__()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, plug, data</span>):</span><br><span class="line">        point1 = om.MPoint(data.inputValue(<span class="variable language_">self</span>.point1_obj).asFloatVector()) <span class="comment"># 得到MPoint对象</span></span><br><span class="line">        point2 = om.MPoint(data.inputValue(<span class="variable language_">self</span>.point2_obj).asFloatVector())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        distance = point1.distanceTo(point2) <span class="comment"># 使用MPoint的计算距离的方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data.outputValue(<span class="variable language_">self</span>.distance_obj).setDouble(distance)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data.setClean(plug) <span class="comment"># 使plug变成干净的状态</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @<span class="built_in">classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> DistanceBetweenLocator()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @<span class="built_in">classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">cls</span>):</span><br><span class="line">        numeric_attr = om.MFnNumericAttribute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cls.point1_obj = numeric_attr.createPoint(<span class="string">&quot;point1&quot;</span>, <span class="string">&quot;p1&quot;</span>)</span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span></span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cls.point2_obj = numeric_attr.createPoint(<span class="string">&quot;point2&quot;</span>, <span class="string">&quot;p2&quot;</span>)</span><br><span class="line">        numeric_attr.readable = <span class="literal">False</span></span><br><span class="line">        numeric_attr.keyable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cls.distance_obj = numeric_attr.create(<span class="string">&quot;distance&quot;</span>, <span class="string">&quot;dist&quot;</span>, om.MFnNumericData.kDouble, <span class="number">0.0</span>)</span><br><span class="line">        numeric_attr.writable = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cls.addAttribute(cls.point1_obj)</span><br><span class="line">        cls.addAttribute(cls.point2_obj)</span><br><span class="line">        cls.addAttribute(cls.distance_obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cls.attributeAffects(cls.point1_obj, cls.distance_obj)</span><br><span class="line">        cls.attributeAffects(cls.point2_obj, cls.distance_obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DistanceBetweenUserData</span>(om.MUserData):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init</span>(<span class="params">self, deleteAfterUse = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(DistanceBetweenUserData, <span class="variable language_">self</span>).__init__(deleteAfterUse)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.distance = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.point1 = om.MPoint()</span><br><span class="line">        <span class="variable language_">self</span>.point2 = om.MPoint()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DistanceBetweenDrawOverride</span>(omr.MPxDrawOverride):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 负责在视口中绘制几何图形 &quot;&quot;&quot;</span></span><br><span class="line">    NAME = <span class="string">&quot;DistanceBetweenDrawOverride&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="built_in">super</span>(DistanceBetweenDrawOverride, <span class="variable language_">self</span>).__init__(obj, <span class="literal">None</span>, <span class="literal">False</span>) <span class="comment"># 第一个参数是maya object,第二个参数是绘制是callback函数,第三个参数是默认为True,为True时将会将此标志位dirty状态，因此可以持续更新,建议为True,除非遇到了性能问题可以为False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">refineSelectionPath</span>(<span class="params">self, select_info, hit_item, path, components, obj_mask</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 重新定义选择，使绘制的几何图形不能够被选中 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">supportedDrawAPIs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 让maya知道支持哪个图形api,kAllDevices指的是使用OpenGL and Direct X 11&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> omr.MRenderer.kAllDevices</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasUIDrawables</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 表示使用addUIDrawables方法来绘制图形 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepareForDraw</span>(<span class="params">self, obj_path, camera_path, frame_context, old_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 在使用绘制图形的方法之前,使用这个方法来将数据检索与缓存 &quot;&quot;&quot;</span></span><br><span class="line">        data = old_data</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            data = DistanceBetweenUserData()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        node_fn = om.MFnDependencyNode(obj_path.node())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data.point1 = om.MPoint(node_fn.findPlug(<span class="string">&quot;point1X&quot;</span>, <span class="literal">False</span>).asDouble(),</span><br><span class="line">                                node_fn.findPlug(<span class="string">&quot;point1Y&quot;</span>, <span class="literal">False</span>).asDouble(),</span><br><span class="line">                                node_fn.findPlug(<span class="string">&quot;point1Z&quot;</span>, <span class="literal">False</span>).asDouble())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data.point2 = om.MPoint(node_fn.findPlug(<span class="string">&quot;point2X&quot;</span>, <span class="literal">False</span>).asDouble(),</span><br><span class="line">                                node_fn.findPlug(<span class="string">&quot;point2Y&quot;</span>, <span class="literal">False</span>).asDouble(),</span><br><span class="line">                                node_fn.findPlug(<span class="string">&quot;point2Z&quot;</span>, <span class="literal">False</span>).asDouble())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data.distance = node_fn.findPlug(<span class="string">&quot;distance&quot;</span>, <span class="literal">False</span>).asDouble()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addUIDrawables</span>(<span class="params">self, obj_path, draw_manager, frame_context, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 绘制图形的方法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            obj_path (_type_): 指向正在绘制的对象的路径,这里是指locator节点</span></span><br><span class="line"><span class="string">            draw_manager (_type_): 用于绘制简单的几何图形</span></span><br><span class="line"><span class="string">            frame_context (_type_): 包含当前渲染框架的一些全局信息</span></span><br><span class="line"><span class="string">            data (_type_): 用户创建的数据对象,存储缓存数据</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        draw_manager.beginDrawable()</span><br><span class="line">        </span><br><span class="line">        draw_manager.setFontSize(<span class="number">14</span>)</span><br><span class="line">        draw_manager.setFontWeight(<span class="number">100</span>)</span><br><span class="line">        draw_manager.setColor(om.MColor((<span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.5</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        pos = om.MPoint((om.MVector(data.point1) + om.MVector(data.point2))/<span class="number">2.0</span>) <span class="comment"># 得到两点之间的重点</span></span><br><span class="line">        text = <span class="string">&quot;&#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(data.distance)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        draw_manager.text(pos, text, omr.MUIDrawManager.kCenter)</span><br><span class="line">        draw_manager.line(data.point1,data.point2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        draw_manager.endDrawable()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @<span class="built_in">classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">creator</span>(<span class="params">cls, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> DistanceBetweenDrawOverride(obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    vendor = <span class="string">&quot;RuiChen&quot;</span>  <span class="comment"># 插件制作人的名字</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span>  <span class="comment"># 插件的版本</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin, vendor, version)  <span class="comment"># 定义插件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.registerNode(DistanceBetweenLocator.TYPE_NAME,</span><br><span class="line">                               DistanceBetweenLocator.TYPE_ID,</span><br><span class="line">                               DistanceBetweenLocator.creator,</span><br><span class="line">                               DistanceBetweenLocator.initialize,</span><br><span class="line">                               om.MPxNode.kLocatorNode,</span><br><span class="line">                               DistanceBetweenLocator.DRAW_CLASSIFICATION)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(DistanceBetweenLocator.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.registerDrawOverrideCreator(DistanceBetweenLocator.DRAW_CLASSIFICATION,</span><br><span class="line">                                                      DistanceBetweenLocator.DRAW_REGISTRANT_ID,</span><br><span class="line">                                                      DistanceBetweenDrawOverride.creator)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to register draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(DistanceBetweenDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">plugin</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 插件取消加载时执行这个函数&quot;&quot;&quot;</span></span><br><span class="line">    plugin_fn = om.MFnPlugin(plugin)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        omr.MDrawRegistry.deregisterDrawOverrideCreator(DistanceBetweenLocator.DRAW_CLASSIFICATION,</span><br><span class="line">                                                        DistanceBetweenLocator.DRAW_REGISTRANT_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister draw override: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(DistanceBetweenDrawOverride.NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_fn.deregisterNode(DistanceBetweenLocator.TYPE_ID)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        om.MGlobal.displayError(<span class="string">&quot;Failed to deregister node: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(DistanceBetweenLocator.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc_distance_between_test</span>():</span><br><span class="line">    cmds.setAttr(<span class="string">&quot;persp.translate&quot;</span>, <span class="number">3.5</span>, <span class="number">5.5</span>, <span class="number">10.0</span>)</span><br><span class="line">    cmds.setAttr(<span class="string">&quot;persp.rotate&quot;</span>, -<span class="number">27.0</span>, <span class="number">19.0</span>, <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cube1 = cmds.polyCube()[<span class="number">0</span>]</span><br><span class="line">    cube2 = cmds.polyCube()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmds.setAttr(<span class="string">&quot;&#123;0&#125;.translateX&quot;</span>.<span class="built_in">format</span>(cube1), -<span class="number">2.5</span>)</span><br><span class="line">    cmds.setAttr(<span class="string">&quot;&#123;0&#125;.translateX&quot;</span>.<span class="built_in">format</span>(cube2), <span class="number">2.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    distance_locator = cmds.createNode(<span class="string">&quot;&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(DistanceBetweenLocator.TYPE_NAME))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmds.connectAttr(<span class="string">&quot;&#123;0&#125;.translate&quot;</span>.<span class="built_in">format</span>(cube1),<span class="string">&quot;&#123;0&#125;.point1&quot;</span>.<span class="built_in">format</span>(distance_locator))</span><br><span class="line">    cmds.connectAttr(<span class="string">&quot;&#123;0&#125;.translate&quot;</span>.<span class="built_in">format</span>(cube2),<span class="string">&quot;&#123;0&#125;.point2&quot;</span>.<span class="built_in">format</span>(distance_locator))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmds.select(distance_locator)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmds.file(new=<span class="literal">True</span>, force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 注册后,在maya脚本编辑器中的使用方法 &quot;&quot;&quot;</span></span><br><span class="line">    plugin_name = <span class="string">&quot;distance_between_locator.py&quot;</span>  <span class="comment"># 插件的文件名</span></span><br><span class="line">    <span class="comment"># 如果插件加载了就先取消加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.unloadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line">    <span class="comment"># 如果插件没有加载就加载插件</span></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;if not cmds.pluginInfo(&quot;&#123;0&#125;&quot;, q=True, loaded=True): cmds.loadPlugin(&quot;&#123;0&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(plugin_name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmds.evalDeferred(<span class="string">&#x27;rc_distance_between_test()&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a name="bhu4x"></a></p>
<h3 id="设置自定义变形器节点在大纲处的图标以及节点编辑器中的图标">设置自定义变形器节点在大纲处的图标以及节点编辑器中的图标</h3>
<p>默认图标：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670915721160-2897f85d-23d1-4da0-b908-073f4a498ad3.png#averageHue=%234a4947&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=224&amp;id=u00e4ba98&amp;originHeight=202&amp;originWidth=435&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44175&amp;status=done&amp;style=none&amp;taskId=u5efe4482-dfd4-46b5-b713-a5709e88b68&amp;title=&amp;width=483.3333461372944" alt="image.png"><br>设置自定义图标：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670915626186-0dedd648-4117-4033-996f-d3cfebeaa7d8.png#averageHue=%23f4f0f0&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=309&amp;id=u55d6291d&amp;originHeight=278&amp;originWidth=2056&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=146769&amp;status=done&amp;style=none&amp;taskId=u430907cc-fccc-4cdb-8475-9e8c16155a4&amp;title=&amp;width=2284.444504961557" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670915685735-9cbb3ab8-60ee-425f-aaee-64bd6043d88a.png#averageHue=%23373636&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=586&amp;id=ue61cf00e&amp;originHeight=527&amp;originWidth=1561&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=134322&amp;status=done&amp;style=none&amp;taskId=u941b3c90-01ba-41f8-852b-0fe57b00d77&amp;title=&amp;width=1734.4444903915323" alt="image.png"></p>
<p><a name="ICWzV"></a></p>
<h3 id="自定义节点属性编辑器的排列模板">自定义节点属性编辑器的排列模板</h3>
<p>名字格式： AE + 节点名字 + Template<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1670998413353-26d9a2c7-905a-41a8-8014-f8856a348242.png#averageHue=%23fcfbfb&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=160&amp;id=u7cf72e1c&amp;originHeight=144&amp;originWidth=841&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=10569&amp;status=done&amp;style=none&amp;taskId=udaaeb6d3-9808-4518-94f7-a4de82fc5ed&amp;title=&amp;width=934.4444691987692" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671002285775-651ec0d7-129b-498e-8b3d-73b7059bb024.png#averageHue=%23413f3f&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=910&amp;id=uedf888c6&amp;originHeight=819&amp;originWidth=2682&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=197038&amp;status=done&amp;style=none&amp;taskId=ua342705b-c5da-4f06-ab25-1d2ed2f6eb9&amp;title=&amp;width=2980.000078943043" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// distanceBetweenLocator节点在属性编辑器中的模板</span><br><span class="line">// 在mel中不需要在意缩进，这里的缩进只是为了排版更好看而已</span><br><span class="line"><span class="keyword">global</span> proc AEdistanceBetweenLocatorTemplate(string $nodeName)</span><br><span class="line">&#123;</span><br><span class="line">    editorTemplate -beginScrollLayout;</span><br><span class="line">        </span><br><span class="line">        editorTemplate -beginLayout <span class="string">&quot;Distance Between Attributes&quot;</span> -collapse <span class="number">0</span>; //collapse 意思是展开，不折叠</span><br><span class="line"></span><br><span class="line">            editorTemplate -addControl <span class="string">&quot;point1&quot;</span>;</span><br><span class="line">            editorTemplate -addControl <span class="string">&quot;point2&quot;</span>;</span><br><span class="line">            editorTemplate -addControl <span class="string">&quot;minDistance&quot;</span>;</span><br><span class="line">            editorTemplate -addControl <span class="string">&quot;maxDistance&quot;</span>;</span><br><span class="line"></span><br><span class="line">            AEaddRampControl($nodeName + <span class="string">&quot;.colorRamp&quot;</span>);</span><br><span class="line">            AEaddRampControl($nodeName + <span class="string">&quot;.curveRamp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        editorTemplate -endLayout;</span><br><span class="line"></span><br><span class="line">    editorTemplate -addExtraControls;</span><br><span class="line">    editorTemplate -endScrollLayout;</span><br><span class="line">&#125;</span><br><span class="line">// 刷新属性编辑器，便于快速看到代码改变带来的影响</span><br><span class="line">refreshEditorTemplates; </span><br></pre></td></tr></table></figure>
<p><a name="GS9oN"></a></p>
<h2 id="如何将单一功能的插件组合起来">如何将单一功能的插件组合起来</h2>
<p>之前的教程写插件都是写一个节点，命令，工具，但是一个插件功能往往包含这几个而不是单一的。因此这节课讲如何将它们组合起来。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671002908082-7d4cacc1-e487-44ba-a7ae-efa738c0738c.png#averageHue=%234e4d4d&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=589&amp;id=u572c52c2&amp;originHeight=530&amp;originWidth=1056&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=258887&amp;status=done&amp;style=none&amp;taskId=uf636dc9d-f8a2-44cd-a42e-cc119c2e58d&amp;title=&amp;width=1173.3333644160525" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671003972925-52e4ee7b-8749-49f0-a5c4-adf90b440a2a.png#averageHue=%232f2c29&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=783&amp;id=u57719ee8&amp;originHeight=705&amp;originWidth=602&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=223814&amp;status=done&amp;style=none&amp;taskId=u04d1646a-4660-41f1-b5e9-e78ae8f70e4&amp;title=&amp;width=668.8889066083937" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671004010290-e78014d7-5d18-4628-9c7c-5bcb91bddfcf.png#averageHue=%23212121&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=1046&amp;id=ua9ae1ad0&amp;originHeight=941&amp;originWidth=1536&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=727699&amp;status=done&amp;style=none&amp;taskId=u5f75e573-ad72-446a-996c-86981f697d1&amp;title=&amp;width=1706.6667118778946" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671004083035-035c41b0-5c84-4647-a8a4-f3caf7bc457d.png#averageHue=%23302d2a&amp;clientId=uaca77ae3-2815-4&amp;from=paste&amp;height=487&amp;id=uec481016&amp;originHeight=438&amp;originWidth=1467&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=313778&amp;status=done&amp;style=none&amp;taskId=u289682d5-d3e7-4138-a0d0-3e070a43529&amp;title=&amp;width=1630.0000431802548" alt="image.png"><br>
<a name="Z0mEb"></a></p>
<h2 id="如何将文件功能分成多个文件使其更方便管理">如何将文件功能分成多个文件使其更方便管理</h2>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ye4y1r7Yv?p=22&amp;vd_source=b1de3fe38e887eb40fc55a5485724480">21_multifile_plugins_part1_哔哩哔哩_bilibili</a></p>
<p><a name="NaikZ"></a></p>
<h2 id="maya-modules">maya_modules</h2>
<p>maya的module是一种共享多文件插件的方法<br>
<a name="KygeB"></a></p>
<h3 id="简单的插件管理方式">简单的插件管理方式</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085566693-242de11c-b079-407b-9ad9-b5629e1f57b7.png#averageHue=%23090909&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=474&amp;id=u10ec219a&amp;originHeight=999&amp;originWidth=2302&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=446960&amp;status=done&amp;style=none&amp;taskId=u14d3c7bc-c9b8-440e-a906-3239120e487&amp;title=&amp;width=1091.77783203125" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085583642-e0336d04-41a2-4b39-86d4-5e935f755935.png#averageHue=%230a0a09&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=566&amp;id=ua342f8b0&amp;originHeight=960&amp;originWidth=1313&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=74945&amp;status=done&amp;style=none&amp;taskId=u51d14b57-8c0c-4c1e-a609-cc750826055&amp;title=&amp;width=773.885498046875" alt="image.png"><br>
<a name="LqOTk"></a></p>
<h3 id="maya-moudules的介绍">maya moudules的介绍</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085676299-c57674c6-1f6f-4ee5-bcc2-60bd6e0a6fb0.png#averageHue=%230b0b0b&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=705&amp;id=u5180ec1e&amp;originHeight=1209&amp;originWidth=2391&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=773548&amp;status=done&amp;style=none&amp;taskId=uff00fa39-30b7-45ff-8814-4fb583a9506&amp;title=&amp;width=1393.666748046875" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085698913-02ec178c-e03e-497d-a604-646e22f7edaa.png#averageHue=%23070706&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=499&amp;id=uf3e91b3f&amp;originHeight=992&amp;originWidth=2166&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=107701&amp;status=done&amp;style=none&amp;taskId=uf1ae4133-dc3a-49d9-b7ee-c0c722fb84a&amp;title=&amp;width=1089.6597900390625" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085897512-879e9245-c9c2-4791-94ce-b97e769f6dea.png#averageHue=%23070707&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=546&amp;id=ubbe1b506&amp;originHeight=1160&amp;originWidth=2317&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=501083&amp;status=done&amp;style=none&amp;taskId=u51a1f977-673d-4d3a-8e2e-16257618636&amp;title=&amp;width=1090.4410400390625" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671085945440-91ba49c0-e5cc-4915-9a7c-0f8ec2202152.png#averageHue=%23060505&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=544&amp;id=uc781249b&amp;originHeight=490&amp;originWidth=623&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=29185&amp;status=done&amp;style=none&amp;taskId=ud20ce58b-f589-4c12-8bbe-b547c32c8fa&amp;title=&amp;width=692.2222405598492" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671086048276-89436e5a-f14e-4519-92c2-a82765897eef.png#averageHue=%23090909&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=614&amp;id=u51148265&amp;originHeight=1105&amp;originWidth=2370&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=632215&amp;status=done&amp;style=none&amp;taskId=ub78af419-6f55-40f7-9388-0486ff38c2c&amp;title=&amp;width=1317.33349609375" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671086097304-6d550613-068b-4541-9834-6b6a98e53b59.png#averageHue=%23100e0d&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=72&amp;id=u65a6db8a&amp;originHeight=65&amp;originWidth=1018&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12774&amp;status=done&amp;style=none&amp;taskId=u13033f6e-a119-483f-8afa-1f1c19ccce7&amp;title=&amp;width=1131.1111410753235" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671086196037-6f4c580e-9d75-4d11-8bfa-74c19b3eaee4.png#averageHue=%23080808&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=509&amp;id=u78836d3d&amp;originHeight=957&amp;originWidth=2394&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=491507&amp;status=done&amp;style=none&amp;taskId=u7fffcc80-71f5-49fd-ae0c-1d322634ce6&amp;title=&amp;width=1274.000244140625" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671086210447-0fb7c8df-8a81-42d0-b2b9-9a1837e43ae5.png#averageHue=%23100f0d&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=91&amp;id=uc3b16ff9&amp;originHeight=82&amp;originWidth=1103&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14596&amp;status=done&amp;style=none&amp;taskId=u29092a1d-5a81-46ef-b3f9-cc91b458fcb&amp;title=&amp;width=1225.5555880216914" alt="image.png"><br>
<a name="xPeit"></a></p>
<h3 id="使用创建moudules的步骤举例">使用创建moudules的步骤举例</h3>
<p><a name="Wywr1"></a></p>
<h4 id="一个工具的所需内容放到一个文件夹里，在这个文件夹下创建一个mod文件">一个工具的所需内容放到一个文件夹里，在这个文件夹下创建一个mod文件</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671086906525-ecf3a55b-7fb2-45f8-970e-74b5a0e78433.png#averageHue=%23f6f0ee&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=258&amp;id=u4b1ffb67&amp;originHeight=232&amp;originWidth=498&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40431&amp;status=done&amp;style=none&amp;taskId=u9ceb672d-5a22-4b0b-83ba-a0792fe994f&amp;title=&amp;width=553.3333479916612" alt="image.png"></p>
<p><a name="CEzh9"></a></p>
<h4 id="mod文件夹下添加这个工具">mod文件夹下添加这个工具</h4>
<p>最后的./是相对路径<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671087583273-798c1a11-2f9a-4962-b7f4-64d87267d22f.png#averageHue=%231c1c1b&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=130&amp;id=udbd71950&amp;originHeight=117&amp;originWidth=426&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=22000&amp;status=done&amp;style=none&amp;taskId=u3fd26225-2368-4abe-a127-880bb47af8b&amp;title=&amp;width=473.3333458723849" alt="image.png"></p>
<p><a name="HHsqn"></a></p>
<h4 id="在maya-env文件下添加mod：">在maya.env文件下添加mod：</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671087574805-d58f52d1-d084-47ae-9b85-13f2c55c7582.png#averageHue=%23fbfaf9&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=341&amp;id=u16c56c7c&amp;originHeight=307&amp;originWidth=998&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=113257&amp;status=done&amp;style=none&amp;taskId=u31848ebf-4e7b-411a-8224-e8cbbcac93e&amp;title=&amp;width=1108.8889182644134" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671087635395-42e2c798-9bc5-4375-a4e2-607c9f3a01b4.png#averageHue=%232a2625&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=286&amp;id=u2a3ea13a&amp;originHeight=257&amp;originWidth=1176&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=163738&amp;status=done&amp;style=none&amp;taskId=u64e5efb4-58b1-4f8f-8899-18ca8aaae3f&amp;title=&amp;width=1306.666701281513" alt="image.png"><br>
<a name="eq346"></a></p>
<h4 id="检查工作">检查工作</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671087702883-c89e5cb5-b753-4e3a-a0b8-7b846180b311.png#averageHue=%232a2a2a&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=194&amp;id=u97c8351c&amp;originHeight=175&amp;originWidth=886&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=63681&amp;status=done&amp;style=none&amp;taskId=u3904e6b9-7b09-488c-a7f5-7032e9edb68&amp;title=&amp;width=984.4444705233169" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/2623605/1671087721464-4de9fa78-8fde-4dd4-8ecd-041f13c2e409.png#averageHue=%23747470&amp;clientId=uc9db9e09-998d-4&amp;from=paste&amp;height=230&amp;id=udf99d51b&amp;originHeight=207&amp;originWidth=262&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46299&amp;status=done&amp;style=none&amp;taskId=ue653480e-135e-44db-b10b-b1a737c00b5&amp;title=&amp;width=291.11111882292215" alt="image.png"></p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>MayaPythonAPI_Zurbrigg</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://example.com/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-MayaPythonAPI-Zurbrigg/">http://example.com/2023/08/29/DCC工具开发-MayaPy-MayaPythonAPI-Zurbrigg/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>RuiChen</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-08-29</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-07-28</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MayaPy/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>MayaPy</a></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/29/UnrealEngine-UE4-BenCloward%E6%95%99%E7%A8%8B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(29).jpg?raw=true" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">UE4 BenCloward教程</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-NukePy-Python-for-nuke-101/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(40).jpg?raw=true" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python_for_nuke_101</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/09/26/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-MayaPy%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A1%A5%E5%85%85-%E7%A7%AF%E7%B4%AF/" title="MayaPy的一些补充(积累)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(4).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-07-28</div><div class="title">MayaPy的一些补充(积累)</div></div></a></div><div><a href="/2023/10/09/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-Maya%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC/" title="Maya后台执行脚本"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(53).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-07-28</div><div class="title">Maya后台执行脚本</div></div></a></div><div><a href="/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-MAYA-PYTHON-API/" title="MAYA PYTHON API"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(60).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-07-28</div><div class="title">MAYA PYTHON API</div></div></a></div><div><a href="/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-maya-python-%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B%E5%92%8CB%E7%AB%99maya-TD/" title="maya python 简易教程和B站maya TD"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(78).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-07-28</div><div class="title">maya python 简易教程和B站maya TD</div></div></a></div><div><a href="/2023/08/29/DCC%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-MayaPy-Maya%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/" title="Maya开发实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/violet-chen/image_lib/blob/main/img%20(39).jpg?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-07-28</div><div class="title">Maya开发实践</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第一卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Maya-API%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">Maya API的应用场景:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E7%9A%84%E5%88%A9%E4%B8%8E%E5%BC%8A%E4%B8%8Epython%E7%9A%84%E5%88%A9%E4%B8%8E%E5%BC%8A"><span class="toc-text">C++的利与弊与python的利与弊</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C"><span class="toc-text">C++</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python"><span class="toc-text">python</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api2-0%E4%B8%8Eapi1-0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8C%BA%E5%88%AB"><span class="toc-text">api2.0与api1.0的一些区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC-scripts-%E4%B8%8E%E6%8F%92%E4%BB%B6-plugin-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">脚本(scripts)与插件(plugin)的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%A7%8D%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A9maya%E8%AF%86%E5%88%AB%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">一种简单的让maya识别到自定义插件的方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99maya%E6%8F%92%E4%BB%B6%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-text">写maya插件的模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-text">Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HelloWorld%E5%91%BD%E4%BB%A4"><span class="toc-text">HelloWorld命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HelloWorld%E8%8A%82%E7%82%B9"><span class="toc-text">HelloWorld节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maya%E5%AE%98%E6%96%B9%E7%BB%99%E7%9A%84maya-python-api%E7%A4%BA%E4%BE%8B"><span class="toc-text">maya官方给的maya python api示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maya-api-%E5%9F%BA%E7%A1%80"><span class="toc-text">maya api 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MObject"><span class="toc-text">MObject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFunction-Sets"><span class="toc-text">MFunction Sets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Wrappers"><span class="toc-text">Wrappers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proxies"><span class="toc-text">Proxies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependence-Graph%EF%BC%88DG%EF%BC%89"><span class="toc-text">Dependence Graph（DG）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DG%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%89%B9%E7%82%B9"><span class="toc-text">DG的介绍与特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DG%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Push-Pull%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%96%B0"><span class="toc-text">DG如何使用Push-Pull模型更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9"><span class="toc-text">自定义节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E4%BB%8B%E7%BB%8D"><span class="toc-text">节点介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="toc-text">节点属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95"><span class="toc-text">计算方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7"><span class="toc-text">依赖属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7"><span class="toc-text">修改属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8plug%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7"><span class="toc-text">使用plug修改属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%87%BD%E6%95%B0%E9%9B%86%E8%87%AA%E5%B8%A6%E7%9A%84%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">利用函数集自带的修改属性的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E5%9F%BA%E7%A1%80"><span class="toc-text">创建自定义节点所需要的基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MPxNode"><span class="toc-text">MPxNode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#initializePlugin"><span class="toc-text">initializePlugin()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MPxPlugin-registerNode"><span class="toc-text">MPxPlugin.registerNode()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#creator"><span class="toc-text">creator()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#initialize"><span class="toc-text">initialize()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9A"><span class="toc-text">注：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compute"><span class="toc-text">Compute()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postConstructor"><span class="toc-text">postConstructor()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#connectionMade-%E5%92%8C-connectionBroken"><span class="toc-text">connectionMade() 和 connectionBroken()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E8%8A%82%E7%82%B9"><span class="toc-text">举例：自定义一个简单的数学节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%B0%83%E8%8A%82%E5%B1%9E%E6%80%A7%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="toc-text">常用的调节属性的性质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E8%BD%A6%E8%BD%AE%E8%8A%82%E7%82%B9"><span class="toc-text">举例：自定义一个车轮节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-text">数学原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-text">代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4"><span class="toc-text">自定义命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-text">需要的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E6%A0%88"><span class="toc-text">堆栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A"><span class="toc-text">举例：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第二卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2%E5%99%A8"><span class="toc-text">变形器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2%E5%99%A8%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">变形器的介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MPxDeformerNode"><span class="toc-text">MPxDeformerNode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MPxDeformerNode-Attributes"><span class="toc-text">MPxDeformerNode Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E9%86%92"><span class="toc-text">提醒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8F%98%E5%BD%A2%E5%99%A8%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%89%E4%B8%AA%E4%B8%BE%E4%BE%8B"><span class="toc-text">创建变形器节点的三个举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#basicdeformernode"><span class="toc-text">basicdeformernode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blenddeformernode"><span class="toc-text">blenddeformernode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#attractordeformernode"><span class="toc-text">attractordeformernode</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CallBack"><span class="toc-text">CallBack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CallBack%E4%BB%8B%E7%BB%8D"><span class="toc-text">CallBack介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CallBack-vs-ScriptJobs"><span class="toc-text">CallBack vs ScriptJobs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MMessage"><span class="toc-text">MMessage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-text">管理回调函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96MEventMessage%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%90%8D%E5%AD%97"><span class="toc-text">获取MEventMessage的事件名字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A-2"><span class="toc-text">举例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86dag"><span class="toc-text">遍历dag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdag"><span class="toc-text">什么是dag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DG-vs-DAG"><span class="toc-text">DG vs DAG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%8D%E5%8E%86dag%E7%9A%84%E5%B8%B8%E7%94%A8api-class"><span class="toc-text">遍历dag的常用api class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MItDag"><span class="toc-text">MItDag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFnDagNode"><span class="toc-text">MFnDagNode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MDagPath-%E5%92%8C-MDagPathArray"><span class="toc-text">MDagPath 和 MDagPathArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B"><span class="toc-text">代码举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#contexts%EF%BC%88%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%BB%A5%E4%B8%8B%E6%89%80%E6%9C%89%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E7%BF%BB%E8%AF%91%E7%BB%9F%E7%BB%9F%E7%90%86%E8%A7%A3%E4%B8%BA%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="toc-text">contexts（工具，以下所有的上下文的翻译统统理解为工具）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFcontexts"><span class="toc-text">什么是contexts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#contexts-class"><span class="toc-text">contexts class</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MPxContext"><span class="toc-text">MPxContext</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MPxContextCommand"><span class="toc-text">MPxContextCommand</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MPxToolCommand"><span class="toc-text">MPxToolCommand</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6"><span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-2"><span class="toc-text">举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#context%E5%B7%A5%E5%85%B7%E6%A8%A1%E6%9D%BF"><span class="toc-text">context工具模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#custom-select-%E5%B7%A5%E5%85%B7"><span class="toc-text">custom select 工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%AA%A8%E9%AA%BC%E5%B7%A5%E5%85%B7"><span class="toc-text">创建骨骼工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E7%BB%98%E5%88%B6%E4%B8%BE%E4%BE%8B"><span class="toc-text">各种绘制举例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第三卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Locators%EF%BC%88%E5%8F%AF%E5%8F%82%E8%80%83HelloWorldNode%EF%BC%89"><span class="toc-text">Locators（可参考HelloWorldNode）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MPxLocatorNode"><span class="toc-text">MPxLocatorNode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MPxDrawOverride%EF%BC%88VP2-0%EF%BC%89"><span class="toc-text">MPxDrawOverride（VP2.0）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-2"><span class="toc-text">代码举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A6%E5%BD%A2%E7%8A%B6%E5%8F%98%E5%BD%A2%E5%99%A8%EF%BC%8C%E9%80%9A%E8%BF%87%E6%9B%B4%E6%94%B9%E5%BA%8F%E5%8F%B7%E6%94%B9%E5%8F%98%E5%AE%9A%E4%BD%8D%E5%99%A8%E7%9A%84%E5%BD%A2%E7%8A%B6"><span class="toc-text">创建带形状变形器，通过更改序号改变定位器的形状</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E9%87%8F%E4%B8%A4%E4%B8%AA%E7%BD%91%E6%A0%BC%E4%BD%93%E7%9A%84%E8%B7%9D%E7%A6%BB%E7%9A%84%E5%AE%9A%E4%BD%8D%E5%99%A8"><span class="toc-text">测量两个网格体的距离的定位器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E5%BD%A2%E5%99%A8%E8%8A%82%E7%82%B9%E5%9C%A8%E5%A4%A7%E7%BA%B2%E5%A4%84%E7%9A%84%E5%9B%BE%E6%A0%87%E4%BB%A5%E5%8F%8A%E8%8A%82%E7%82%B9%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%AD%E7%9A%84%E5%9B%BE%E6%A0%87"><span class="toc-text">设置自定义变形器节点在大纲处的图标以及节点编辑器中的图标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E6%8E%92%E5%88%97%E6%A8%A1%E6%9D%BF"><span class="toc-text">自定义节点属性编辑器的排列模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E5%8D%95%E4%B8%80%E5%8A%9F%E8%83%BD%E7%9A%84%E6%8F%92%E4%BB%B6%E7%BB%84%E5%90%88%E8%B5%B7%E6%9D%A5"><span class="toc-text">如何将单一功能的插件组合起来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%88%86%E6%88%90%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E4%BD%BF%E5%85%B6%E6%9B%B4%E6%96%B9%E4%BE%BF%E7%AE%A1%E7%90%86"><span class="toc-text">如何将文件功能分成多个文件使其更方便管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maya-modules"><span class="toc-text">maya_modules</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-text">简单的插件管理方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maya-moudules%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">maya moudules的介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%9B%E5%BB%BAmoudules%E7%9A%84%E6%AD%A5%E9%AA%A4%E4%B8%BE%E4%BE%8B"><span class="toc-text">使用创建moudules的步骤举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%B7%A5%E5%85%B7%E7%9A%84%E6%89%80%E9%9C%80%E5%86%85%E5%AE%B9%E6%94%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E9%87%8C%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAmod%E6%96%87%E4%BB%B6"><span class="toc-text">一个工具的所需内容放到一个文件夹里，在这个文件夹下创建一个mod文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mod%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E6%B7%BB%E5%8A%A0%E8%BF%99%E4%B8%AA%E5%B7%A5%E5%85%B7"><span class="toc-text">mod文件夹下添加这个工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8maya-env%E6%96%87%E4%BB%B6%E4%B8%8B%E6%B7%BB%E5%8A%A0mod%EF%BC%9A"><span class="toc-text">在maya.env文件下添加mod：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%B7%A5%E4%BD%9C"><span class="toc-text">检查工作</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 760px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 640px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(/assets/1.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/AI/&quot;);" href="javascript:void(0);">AI</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">AI</span></li><li class="categoryBar-list-item" style="background:url(/assets/8.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/DCC工具开发/&quot;);" href="javascript:void(0);">DCC工具开发</a><span class="categoryBar-list-count">10</span><span class="categoryBar-list-descr">DCC工具开发</span></li><li class="categoryBar-list-item" style="background:url(/assets/3.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/DCC软件/&quot;);" href="javascript:void(0);">DCC软件</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">DCC软件</span></li><li class="categoryBar-list-item" style="background:url(/assets/4.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Geek/&quot;);" href="javascript:void(0);">Geek</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr">Geek</span></li><li class="categoryBar-list-item" style="background:url(/assets/5.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/PySide2/&quot;);" href="javascript:void(0);">PySide2</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">PySide2</span></li><li class="categoryBar-list-item" style="background:url(/assets/6.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/UE开发/&quot;);" href="javascript:void(0);">UE开发</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr">UE开发</span></li><li class="categoryBar-list-item" style="background:url(/assets/7.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/UnrealEngine/&quot;);" href="javascript:void(0);">UnrealEngine</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr">UnrealEngine</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><!-- hexo injector body_end end --></body></html>